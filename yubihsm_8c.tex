\doxysection{libraries/yubihsm/lib/yubihsm.c File Reference}
\hypertarget{yubihsm_8c}{}\label{yubihsm_8c}\index{libraries/yubihsm/lib/yubihsm.c@{libraries/yubihsm/lib/yubihsm.c}}
{\ttfamily \#include $<$yubihsm.\+h$>$}\newline
{\ttfamily \#include "{}internal.\+h"{}}\newline
{\ttfamily \#include $<$arpa/inet.\+h$>$}\newline
{\ttfamily \#include $<$dlfcn.\+h$>$}\newline
{\ttfamily \#include $<$errno.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$strings.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$limits.\+h$>$}\newline
{\ttfamily \#include "{}../common/rand.\+h"{}}\newline
{\ttfamily \#include "{}../common/pkcs5.\+h"{}}\newline
{\ttfamily \#include "{}../common/hash.\+h"{}}\newline
{\ttfamily \#include "{}../aes\+\_\+cmac/aes\+\_\+cmac.\+h"{}}\newline
{\ttfamily \#include "{}debug\+\_\+lib.\+h"{}}\newline
{\ttfamily \#include "{}../common/insecure\+\_\+memzero.\+h"{}}\newline
Include dependency graph for yubihsm.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{yubihsm_8c_ac5513a56708e275ba0a95f9aeb325c1a}{STATIC\+\_\+\+USB\+\_\+\+BACKEND}}~"{}usb"{}
\item 
\#define \mbox{\hyperlink{yubihsm_8c_ac07ffd02c4e4c6eefceb0e90c4005367}{STATIC\+\_\+\+HTTP\+\_\+\+BACKEND}}~"{}http"{}
\item 
\#define \mbox{\hyperlink{yubihsm_8c_ab62526d2d58f00a4d33d306db1a39507}{LIST\+\_\+\+SEPARATORS}}~"{}\+:,;\texorpdfstring{$\vert$}{|}"{}
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a0b9ea5683398966b2db794d1a5a78005}{LIST\+\_\+\+ID}}~1
\item 
\#define \mbox{\hyperlink{yubihsm_8c_aa606355c30aa4b5f0ad83d25ed069b25}{LIST\+\_\+\+TYPE}}~2
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a2eea78213279842d562d311a118c4e64}{LIST\+\_\+\+DOMAINS}}~3
\item 
\#define \mbox{\hyperlink{yubihsm_8c_ad2887e3e4dd005035b369ba8a9ec94b7}{LIST\+\_\+\+CAPABILITIES}}~4
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a4144e686fa1e1d546a89875fb152ed4b}{LIST\+\_\+\+ALGORITHM}}~5
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a0b34189280c5fe21d735f5bd67ce2c1e}{LIST\+\_\+\+LABEL}}~6
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a055ab06cb17913ccd704c735dbf3c332}{STATUS\+\_\+\+ENDPOINT}}~"{}/connector/status"{}
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a7518f88b39b8ffaf830fefd5943291bb}{API\+\_\+\+ENDPOINT}}~"{}/connector/api"{}
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a02343c4c03f60828514b2a220ea3e9c1}{USB\+\_\+\+LIB}}~"{}libyubihsm\+\_\+usb.\+so."{} SOVERSION
\item 
\#define \mbox{\hyperlink{yubihsm_8c_ac8bfb55db13a8e48927730381cc57822}{HTTP\+\_\+\+LIB}}~"{}libyubihsm\+\_\+http.\+so."{} SOVERSION
\item 
\#define \mbox{\hyperlink{yubihsm_8c_a9f4bf0773c45ad9a9753a1b784a13fbb}{htonll}}(x)
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a799e299be8d4c13dfa2112a60d05480d}{yh\+\_\+send\+\_\+plain\+\_\+msg}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}} cmd, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}data, size\+\_\+t data\+\_\+len, \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}} \texorpdfstring{$\ast$}{*}response\+\_\+cmd, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}response, size\+\_\+t \texorpdfstring{$\ast$}{*}response\+\_\+len)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\+\_\+send\+\_\+secure\+\_\+msg}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}} cmd, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}data, size\+\_\+t data\+\_\+len, \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}} \texorpdfstring{$\ast$}{*}response\+\_\+cmd, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}response, size\+\_\+t \texorpdfstring{$\ast$}{*}response\+\_\+len)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a3be331dcf8907ff3569e4dc230e1c615}{yh\+\_\+create\+\_\+session\+\_\+derived}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} authkey\+\_\+id, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}password, size\+\_\+t password\+\_\+len, bool recreate, \mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a0e96ea59c5f32def80843fec5a3c2142}{yh\+\_\+create\+\_\+session}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} authkey\+\_\+id, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+enc, size\+\_\+t key\+\_\+enc\+\_\+len, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+mac, size\+\_\+t key\+\_\+mac\+\_\+len, bool recreate, \mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a296b43eadb1151017ba8e9578b351c5e}{yh\+\_\+begin\+\_\+create\+\_\+session\+\_\+ext}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} authkey\+\_\+id, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structcontext}{context}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}card\+\_\+cryptogram, size\+\_\+t card\+\_\+cryptogram\+\_\+len, \mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_afbcb5c761339fbcf444be8f338b4614f}{yh\+\_\+finish\+\_\+create\+\_\+session\+\_\+ext}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+senc, size\+\_\+t key\+\_\+senc\+\_\+len, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+smac, size\+\_\+t key\+\_\+smac\+\_\+len, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+srmac, size\+\_\+t key\+\_\+srmac\+\_\+len, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}card\+\_\+cryptogram, size\+\_\+t card\+\_\+cryptogram\+\_\+len)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a1a35f8ae5a739848408633a514e41b2d}{yh\+\_\+destroy\+\_\+session}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})
\item 
bool \mbox{\hyperlink{yubihsm_8c_a163506939cedbc1e849bdcfb8b5fe1de}{yh\+\_\+connector\+\_\+has\+\_\+device}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a2b9f4070a103724b241e0a2b6a56d1ba}{yh\+\_\+get\+\_\+connector\+\_\+version}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a5bd4e4c943762926c8f653b6224cced2}{major}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ae2f416b0a34b7beb4ed3873d791ac393}{minor}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a00c54fad5fef8d31eb75c1163468005b}{patch}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_acb5d5e9a2718b9427269f7d267ca25b9}{yh\+\_\+get\+\_\+connector\+\_\+address}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, char \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}const address)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a6ab558e1426359cc78e7a362f8b3acd9}{yh\+\_\+util\+\_\+get\+\_\+device\+\_\+info}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a5bd4e4c943762926c8f653b6224cced2}{major}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ae2f416b0a34b7beb4ed3873d791ac393}{minor}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a00c54fad5fef8d31eb75c1163468005b}{patch}}, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a1149ca4bd0659030412db8e77bebdf88}{serial}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}log\+\_\+total, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}log\+\_\+used, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \texorpdfstring{$\ast$}{*}algorithms, size\+\_\+t \texorpdfstring{$\ast$}{*}n\+\_\+algorithms)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a7cbea7103efff8473ccfaaa35bfc6346}{yh\+\_\+util\+\_\+list\+\_\+objects}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}, \mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} type, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{structyh__object__descriptor}{yh\+\_\+object\+\_\+descriptor}} \texorpdfstring{$\ast$}{*}objects, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a351300ca15aa70c149f1301f89bcbe9b}{n\+\_\+objects}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a7b5f1f0c1cbca11fbe21e7e4e6b29a1b}{yh\+\_\+util\+\_\+get\+\_\+object\+\_\+info}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}, \mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} type, \mbox{\hyperlink{structyh__object__descriptor}{yh\+\_\+object\+\_\+descriptor}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a85d991d90970121ba1480cd98d93aab9}{object}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aa7b8b42156c4bdaf41d8b9758a2fd73f}{yh\+\_\+util\+\_\+get\+\_\+public\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}data, size\+\_\+t \texorpdfstring{$\ast$}{*}data\+\_\+len, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a61ab8dbab67b1cceb49cd306f8c3f4b1}{yh\+\_\+util\+\_\+close\+\_\+session}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aa0a7644b7b368d6aaf8b4aff5e3d19b8}{yh\+\_\+util\+\_\+sign\+\_\+pkcs1v1\+\_\+5}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, bool hashed, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a944e6f31487857709f032598fd43fef5}{yh\+\_\+util\+\_\+sign\+\_\+pss}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}}, size\+\_\+t salt\+\_\+len, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} mgf1\+Algo)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a5121c90d3bd745afd8264fef2ef39ace}{yh\+\_\+util\+\_\+sign\+\_\+ecdsa}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a690a5585de21ce82495e139ec1dfdf9d}{yh\+\_\+util\+\_\+sign\+\_\+eddsa}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a9000d43fe8cf7313b319f316521eb0c4}{yh\+\_\+util\+\_\+sign\+\_\+hmac}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_af1bc8ed34687d83701eb3cc673ad4b96}{yh\+\_\+util\+\_\+get\+\_\+pseudo\+\_\+random}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ab0ca24007ce6942d2185859560c43e8a}{yh\+\_\+util\+\_\+import\+\_\+rsa\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}q)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_adc142d8f397eee024b3c145fa8abad85}{yh\+\_\+util\+\_\+import\+\_\+ec\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a7a886e052bc1571f24c6b7f0c57e2d8c}{yh\+\_\+util\+\_\+import\+\_\+ed\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}k)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a19c79faaf10c405864f0179821d551a5}{yh\+\_\+util\+\_\+import\+\_\+hmac\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ab1c62ef2643184a8ad44c569c87712d1}{yh\+\_\+util\+\_\+generate\+\_\+rsa\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a2db9bbd57a908c5c454fc6254f57dcff}{yh\+\_\+util\+\_\+generate\+\_\+ec\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a41f4326fe736e99302442d6a6109edbc}{yh\+\_\+util\+\_\+generate\+\_\+ed\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ab37ae2f7fc6857b420e173284130686d}{yh\+\_\+util\+\_\+verify\+\_\+hmac}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}signature, size\+\_\+t signature\+\_\+len, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}data, size\+\_\+t data\+\_\+len, bool \texorpdfstring{$\ast$}{*}verified)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a1eac22853548b7ceab92550c22233b18}{yh\+\_\+util\+\_\+generate\+\_\+hmac\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a5ebf6932cd2e68b9a23787c27fde3e26}{yh\+\_\+util\+\_\+decrypt\+\_\+pkcs1v1\+\_\+5}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aa939f8764ed0cca27884d9c8f640ac14}{yh\+\_\+util\+\_\+decrypt\+\_\+oaep}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_ae76ac4adc41ec92427b4a14cd3385c1b}{label\+\_\+len}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} mgf1\+Algo)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a2900aee87732f9ec017bd1662bcef7e9}{yh\+\_\+util\+\_\+derive\+\_\+ecdh}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ae736702f9463878db4adfd45b6a597f9}{yh\+\_\+util\+\_\+delete\+\_\+object}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}, \mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} type)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aa3f473e6dbb9188ad0269b40921c4f5f}{yh\+\_\+util\+\_\+export\+\_\+wrapped}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} wrapping\+\_\+key\+\_\+id, \mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a16deaf35253f2106ecf4fd8003b1284f}{target\+\_\+type}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ad82e96deab6d88b5e26f9f11da9d3fa3}{target\+\_\+id}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ae5bf13f9558bb0340468b722accf94d3}{yh\+\_\+util\+\_\+import\+\_\+wrapped}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} wrapping\+\_\+key\+\_\+id, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a16deaf35253f2106ecf4fd8003b1284f}{target\+\_\+type}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ad82e96deab6d88b5e26f9f11da9d3fa3}{target\+\_\+id}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a3a9729ea5b2e299a735b43f2b23e50a7}{yh\+\_\+util\+\_\+import\+\_\+wrap\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\+\_\+capabilities}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a1f749a696792e7911844629e056d9c15}{yh\+\_\+util\+\_\+generate\+\_\+wrap\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\+\_\+capabilities}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a5ae52ad56b7e83baeb33b46104263aa6}{yh\+\_\+util\+\_\+get\+\_\+log\+\_\+entries}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}unlogged\+\_\+boot, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}unlogged\+\_\+auth, \mbox{\hyperlink{structyh__log__entry}{yh\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}n\+\_\+items)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a9d844855c9066bbea0e4344978dd7fdc}{yh\+\_\+util\+\_\+set\+\_\+log\+\_\+index}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} index)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a56e060e71fb8baa0531b3a20848abf37}{yh\+\_\+util\+\_\+get\+\_\+opaque}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} object\+\_\+id, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a1249c920eec24f634d04eaafb90a1ca2}{yh\+\_\+util\+\_\+import\+\_\+opaque}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}object\+\_\+id, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a45c32b993856be818a70c0ffad589cbd}{yh\+\_\+util\+\_\+sign\+\_\+ssh\+\_\+certificate}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} template\+\_\+id, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} sig\+\_\+algo, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a47768ae0e72beba49f02db1baddf4823}{yh\+\_\+util\+\_\+get\+\_\+template}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} object\+\_\+id, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ae0fc8d6520950868365011d1a9f450f1}{yh\+\_\+util\+\_\+import\+\_\+template}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}object\+\_\+id, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aeabf472faf1ba8d963b39866e04df6b0}{yh\+\_\+get\+\_\+session\+\_\+id}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}sid)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a77870209747d5ccd90f9da3aae2bdfa8}{yh\+\_\+authenticate\+\_\+session}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ac154da7ac6dc0a7b4b3a6cdff9433da8}{yh\+\_\+util\+\_\+import\+\_\+authentication\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\+\_\+capabilities}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+enc, size\+\_\+t key\+\_\+enc\+\_\+len, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+mac, size\+\_\+t key\+\_\+mac\+\_\+len)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a80b4c4caeb9c768737c2dbf46d9352e4}{yh\+\_\+util\+\_\+import\+\_\+authentication\+\_\+key\+\_\+derived}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\+\_\+capabilities}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}password, size\+\_\+t password\+\_\+len)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a8f229874e387887d7c5b4c7e6e07db8e}{yh\+\_\+util\+\_\+change\+\_\+authentication\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+enc, size\+\_\+t key\+\_\+enc\+\_\+len, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key\+\_\+mac, size\+\_\+t key\+\_\+mac\+\_\+len)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a8761bd8bcffcee4af737bda255ce5e53}{yh\+\_\+util\+\_\+change\+\_\+authentication\+\_\+key\+\_\+derived}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}password, size\+\_\+t password\+\_\+len)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a82d295a02d9eb628f6dea4b4c01fdec4}{yh\+\_\+util\+\_\+create\+\_\+otp\+\_\+aead}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}key, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}private\+\_\+id, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a4bb1d420f681bc91bd36dc08695dbad6}{yh\+\_\+util\+\_\+randomize\+\_\+otp\+\_\+aead}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a3677afe2209a1cae31f70a304e260e28}{yh\+\_\+util\+\_\+decrypt\+\_\+otp}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}aead, size\+\_\+t aead\+\_\+len, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubico__otp_8c_ab1e1d61db8c48d537faca71988a7c123}{otp}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}use\+Ctr, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}session\+Ctr, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}tstph, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}tstpl)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_addc22271306d847f53321984f41d818b}{yh\+\_\+util\+\_\+import\+\_\+otp\+\_\+aead\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} nonce\+\_\+id, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a9e130d225a8dc003d7a7c0ce4b8ea5e4}{yh\+\_\+util\+\_\+generate\+\_\+otp\+\_\+aead\+\_\+key}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} nonce\+\_\+id)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a5988faffd97366b188728ff1a7fb6e89}{yh\+\_\+util\+\_\+sign\+\_\+attestation\+\_\+certificate}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} attest\+\_\+id, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a85ac840aec77cb1ca3c3ce1f2ab26282}{yh\+\_\+util\+\_\+set\+\_\+option}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option}} \mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}}, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}val)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a11871e03c808e2d25737f893e58ed094}{yh\+\_\+util\+\_\+get\+\_\+option}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option}} \mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ae87d5578703775b9d4151a14435f4a73}{yh\+\_\+util\+\_\+get\+\_\+storage\+\_\+info}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}total\+\_\+records, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}free\+\_\+records, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}total\+\_\+pages, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}free\+\_\+pages, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}page\+\_\+size)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a7c2e101be04ad1546d99d5600e732eca}{yh\+\_\+util\+\_\+wrap\+\_\+data}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a550567a0f56d8536b9b5f34e905da7ec}{yh\+\_\+util\+\_\+unwrap\+\_\+data}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\+\_\+id}}, const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}in, size\+\_\+t \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\+\_\+len}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}out, size\+\_\+t \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\+\_\+len}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ad112fe09ee88d595333fa87e8059717b}{yh\+\_\+util\+\_\+blink\+\_\+device}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} seconds)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a5c153fe27877bcc7927d391fb55550af}{yh\+\_\+util\+\_\+reset\+\_\+device}} (\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a24c3146e51242256af505961e763f417}{yh\+\_\+set\+\_\+verbosity}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} verbosity)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a17d49ccb12b100e98d8b99585a705444}{yh\+\_\+get\+\_\+verbosity}} (\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}verbosity)
\item 
void \mbox{\hyperlink{yubihsm_8c_a7d223fd4ee6ae3f578307d72aba37a19}{yh\+\_\+set\+\_\+debug\+\_\+output}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, FILE \texorpdfstring{$\ast$}{*}output)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a5392844a98c6220c69fe08d3dcf8f1bc}{yh\+\_\+init}} (void)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a36e3d9a07c6689e14a9339ca1ebb7259}{yh\+\_\+exit}} (void)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a9c700747902a722d6c1d2073277de294}{yh\+\_\+init\+\_\+connector}} (const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{programs_2clio_2main_8cpp_aa03c1ef4c41f36b048cf58d5aade7653}{url}}, \mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}connector)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a9addbfae4cdb70b819986e7769cdd102}{yh\+\_\+set\+\_\+connector\+\_\+option}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, \mbox{\hyperlink{yubihsm_8h_a59400bce0478b88e048d5e62b2b0b015}{yh\+\_\+connector\+\_\+option}} opt, const void \texorpdfstring{$\ast$}{*}val)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aa19be6ac70a2a5d1cef8d7e6902fe05f}{yh\+\_\+connect}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector, int timeout)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ab12d5a42d2219741bd3630b99ed1c7d2}{yh\+\_\+disconnect}} (\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}connector)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities}} (const char \texorpdfstring{$\ast$}{*}capability, \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}result)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_ac46bac75dfd0a4358a4e6b432a50e48a}{yh\+\_\+capabilities\+\_\+to\+\_\+strings}} (const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}num, const char \texorpdfstring{$\ast$}{*}result\mbox{[}$\,$\mbox{]}, size\+\_\+t \texorpdfstring{$\ast$}{*}n\+\_\+result)
\item 
bool \mbox{\hyperlink{yubihsm_8c_aba384949362ccaf19cbeae3bb046489c}{yh\+\_\+check\+\_\+capability}} (const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, const char \texorpdfstring{$\ast$}{*}capability)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_afcca1608845e7a783d41d8ffd6aac8ed}{yh\+\_\+merge\+\_\+capabilities}} (const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}b, \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}result)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a900031f15115ee22e885d2de7ec80a4a}{yh\+\_\+filter\+\_\+capabilities}} (const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}, const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}filter, \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}result)
\item 
bool \mbox{\hyperlink{yubihsm_8c_a0a67155f2a7970ecb52e4f6aac6bbe84}{yh\+\_\+is\+\_\+rsa}} (\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
bool \mbox{\hyperlink{yubihsm_8c_a3032a8f45bfad36ed6157b0158dd7921}{yh\+\_\+is\+\_\+ec}} (\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
bool \mbox{\hyperlink{yubihsm_8c_a16fbf4426acbf42695c4ec4738b6ae8a}{yh\+\_\+is\+\_\+ed}} (\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
bool \mbox{\hyperlink{yubihsm_8c_acb19de78e7d1aed72abbed5c74c676bc}{yh\+\_\+is\+\_\+hmac}} (\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a375000f12ac554eb8cbaa0e6b75c3a08}{yh\+\_\+get\+\_\+key\+\_\+bitlength}} (\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}, size\+\_\+t \texorpdfstring{$\ast$}{*}result)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a2a0d369611aa795c62645467062a9acb}{yh\+\_\+algo\+\_\+to\+\_\+string}} (\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} algo, char const \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}result)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_aad9943d12261cc0f0cada93cbd6d0704}{yh\+\_\+string\+\_\+to\+\_\+algo}} (const char \texorpdfstring{$\ast$}{*}string, \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \texorpdfstring{$\ast$}{*}algo)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_afe3d701f7470c1d7b05480e4b6728bf7}{yh\+\_\+type\+\_\+to\+\_\+string}} (\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} type, char const \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}result)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a57cdfa4b6224bd2c4a8bab24513475d8}{yh\+\_\+string\+\_\+to\+\_\+type}} (const char \texorpdfstring{$\ast$}{*}string, \mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} \texorpdfstring{$\ast$}{*}type)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a5464c7a6ad858c1e4e42e588b406c2d3}{yh\+\_\+string\+\_\+to\+\_\+option}} (const char \texorpdfstring{$\ast$}{*}string, \mbox{\hyperlink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}})
\item 
bool \mbox{\hyperlink{yubihsm_8c_a00b81c3c9ca2964a672b7b0b725925e4}{yh\+\_\+verify\+\_\+logs}} (\mbox{\hyperlink{structyh__log__entry}{yh\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*}logs, size\+\_\+t n\+\_\+items, \mbox{\hyperlink{structyh__log__entry}{yh\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*}last\+\_\+previous\+\_\+log)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains}} (const char \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}result)
\item 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} \mbox{\hyperlink{yubihsm_8c_a0100df295f7ecf0d0cc90052aac20586}{yh\+\_\+domains\+\_\+to\+\_\+string}} (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}, char \texorpdfstring{$\ast$}{*}string, size\+\_\+t max\+\_\+len)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \mbox{\hyperlink{debug__lib_8h_a4ba5f59460a312e3f5f14926f4b2299e}{\+\_\+yh\+\_\+verbosity}} \mbox{\hyperlink{yubihsm_8c_a53dbe31d2d75719fb2b97437fcb42f2a}{YH\+\_\+\+INTERNAL}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\Hypertarget{yubihsm_8c_a7518f88b39b8ffaf830fefd5943291bb}\index{yubihsm.c@{yubihsm.c}!API\_ENDPOINT@{API\_ENDPOINT}}
\index{API\_ENDPOINT@{API\_ENDPOINT}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{API\_ENDPOINT}{API\_ENDPOINT}}
{\footnotesize\ttfamily \label{yubihsm_8c_a7518f88b39b8ffaf830fefd5943291bb} 
\#define API\+\_\+\+ENDPOINT~"{}/connector/api"{}}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03913}{3913}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_a9f4bf0773c45ad9a9753a1b784a13fbb}\index{yubihsm.c@{yubihsm.c}!htonll@{htonll}}
\index{htonll@{htonll}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{htonll}{htonll}}
{\footnotesize\ttfamily \label{yubihsm_8c_a9f4bf0773c45ad9a9753a1b784a13fbb} 
\#define htonll(\begin{DoxyParamCaption}\item[{}]{x}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ ((1\ ==\ htonl(1))\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ ?\ (x)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ :\ ((\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}})\ htonl((x)\ \&0xFFFFFFFF)\ <<\ 32)\ |\ htonl((x)\ >>\ 32))}

\end{DoxyCode}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04110}{4110}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04110\ \textcolor{preprocessor}{\#define\ htonll(x)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{04111\ \textcolor{preprocessor}{\ \ ((1\ ==\ htonl(1))\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{04112\ \textcolor{preprocessor}{\ \ \ \ \ ?\ (x)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{04113\ \textcolor{preprocessor}{\ \ \ \ \ :\ ((uint64\_t)\ htonl((x)\ \&0xFFFFFFFF)\ <<\ 32)\ |\ htonl((x)\ >>\ 32))}}

\end{DoxyCode}
\Hypertarget{yubihsm_8c_ac8bfb55db13a8e48927730381cc57822}\index{yubihsm.c@{yubihsm.c}!HTTP\_LIB@{HTTP\_LIB}}
\index{HTTP\_LIB@{HTTP\_LIB}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{HTTP\_LIB}{HTTP\_LIB}}
{\footnotesize\ttfamily \label{yubihsm_8c_ac8bfb55db13a8e48927730381cc57822} 
\#define HTTP\+\_\+\+LIB~"{}libyubihsm\+\_\+http.\+so."{} SOVERSION}

\Hypertarget{yubihsm_8c_a4144e686fa1e1d546a89875fb152ed4b}\index{yubihsm.c@{yubihsm.c}!LIST\_ALGORITHM@{LIST\_ALGORITHM}}
\index{LIST\_ALGORITHM@{LIST\_ALGORITHM}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{LIST\_ALGORITHM}{LIST\_ALGORITHM}}
{\footnotesize\ttfamily \label{yubihsm_8c_a4144e686fa1e1d546a89875fb152ed4b} 
\#define LIST\+\_\+\+ALGORITHM~5}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01027}{1027}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_ad2887e3e4dd005035b369ba8a9ec94b7}\index{yubihsm.c@{yubihsm.c}!LIST\_CAPABILITIES@{LIST\_CAPABILITIES}}
\index{LIST\_CAPABILITIES@{LIST\_CAPABILITIES}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{LIST\_CAPABILITIES}{LIST\_CAPABILITIES}}
{\footnotesize\ttfamily \label{yubihsm_8c_ad2887e3e4dd005035b369ba8a9ec94b7} 
\#define LIST\+\_\+\+CAPABILITIES~4}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01026}{1026}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_a2eea78213279842d562d311a118c4e64}\index{yubihsm.c@{yubihsm.c}!LIST\_DOMAINS@{LIST\_DOMAINS}}
\index{LIST\_DOMAINS@{LIST\_DOMAINS}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{LIST\_DOMAINS}{LIST\_DOMAINS}}
{\footnotesize\ttfamily \label{yubihsm_8c_a2eea78213279842d562d311a118c4e64} 
\#define LIST\+\_\+\+DOMAINS~3}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01025}{1025}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_a0b9ea5683398966b2db794d1a5a78005}\index{yubihsm.c@{yubihsm.c}!LIST\_ID@{LIST\_ID}}
\index{LIST\_ID@{LIST\_ID}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{LIST\_ID}{LIST\_ID}}
{\footnotesize\ttfamily \label{yubihsm_8c_a0b9ea5683398966b2db794d1a5a78005} 
\#define LIST\+\_\+\+ID~1}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01023}{1023}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_a0b34189280c5fe21d735f5bd67ce2c1e}\index{yubihsm.c@{yubihsm.c}!LIST\_LABEL@{LIST\_LABEL}}
\index{LIST\_LABEL@{LIST\_LABEL}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{LIST\_LABEL}{LIST\_LABEL}}
{\footnotesize\ttfamily \label{yubihsm_8c_a0b34189280c5fe21d735f5bd67ce2c1e} 
\#define LIST\+\_\+\+LABEL~6}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01028}{1028}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_ab62526d2d58f00a4d33d306db1a39507}\index{yubihsm.c@{yubihsm.c}!LIST\_SEPARATORS@{LIST\_SEPARATORS}}
\index{LIST\_SEPARATORS@{LIST\_SEPARATORS}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{LIST\_SEPARATORS}{LIST\_SEPARATORS}}
{\footnotesize\ttfamily \label{yubihsm_8c_ab62526d2d58f00a4d33d306db1a39507} 
\#define LIST\+\_\+\+SEPARATORS~"{}\+:,;\texorpdfstring{$\vert$}{|}"{}}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00055}{55}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_aa606355c30aa4b5f0ad83d25ed069b25}\index{yubihsm.c@{yubihsm.c}!LIST\_TYPE@{LIST\_TYPE}}
\index{LIST\_TYPE@{LIST\_TYPE}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{LIST\_TYPE}{LIST\_TYPE}}
{\footnotesize\ttfamily \label{yubihsm_8c_aa606355c30aa4b5f0ad83d25ed069b25} 
\#define LIST\+\_\+\+TYPE~2}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01024}{1024}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_ac07ffd02c4e4c6eefceb0e90c4005367}\index{yubihsm.c@{yubihsm.c}!STATIC\_HTTP\_BACKEND@{STATIC\_HTTP\_BACKEND}}
\index{STATIC\_HTTP\_BACKEND@{STATIC\_HTTP\_BACKEND}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{STATIC\_HTTP\_BACKEND}{STATIC\_HTTP\_BACKEND}}
{\footnotesize\ttfamily \label{yubihsm_8c_ac07ffd02c4e4c6eefceb0e90c4005367} 
\#define STATIC\+\_\+\+HTTP\+\_\+\+BACKEND~"{}http"{}}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00044}{44}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_ac5513a56708e275ba0a95f9aeb325c1a}\index{yubihsm.c@{yubihsm.c}!STATIC\_USB\_BACKEND@{STATIC\_USB\_BACKEND}}
\index{STATIC\_USB\_BACKEND@{STATIC\_USB\_BACKEND}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{STATIC\_USB\_BACKEND}{STATIC\_USB\_BACKEND}}
{\footnotesize\ttfamily \label{yubihsm_8c_ac5513a56708e275ba0a95f9aeb325c1a} 
\#define STATIC\+\_\+\+USB\+\_\+\+BACKEND~"{}usb"{}}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00043}{43}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_a055ab06cb17913ccd704c735dbf3c332}\index{yubihsm.c@{yubihsm.c}!STATUS\_ENDPOINT@{STATUS\_ENDPOINT}}
\index{STATUS\_ENDPOINT@{STATUS\_ENDPOINT}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{STATUS\_ENDPOINT}{STATUS\_ENDPOINT}}
{\footnotesize\ttfamily \label{yubihsm_8c_a055ab06cb17913ccd704c735dbf3c332} 
\#define STATUS\+\_\+\+ENDPOINT~"{}/connector/status"{}}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03912}{3912}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

\Hypertarget{yubihsm_8c_a02343c4c03f60828514b2a220ea3e9c1}\index{yubihsm.c@{yubihsm.c}!USB\_LIB@{USB\_LIB}}
\index{USB\_LIB@{USB\_LIB}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{USB\_LIB}{USB\_LIB}}
{\footnotesize\ttfamily \label{yubihsm_8c_a02343c4c03f60828514b2a220ea3e9c1} 
\#define USB\+\_\+\+LIB~"{}libyubihsm\+\_\+usb.\+so."{} SOVERSION}



\doxysubsection{Function Documentation}
\Hypertarget{yubihsm_8c_a2a0d369611aa795c62645467062a9acb}\index{yubihsm.c@{yubihsm.c}!yh\_algo\_to\_string@{yh\_algo\_to\_string}}
\index{yh\_algo\_to\_string@{yh\_algo\_to\_string}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_algo\_to\_string()}{yh\_algo\_to\_string()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a2a0d369611aa795c62645467062a9acb} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+algo\+\_\+to\+\_\+string (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algo}{, }\item[{char const \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}

Convert an algorithm to its string representation.


\begin{DoxyParams}{Parameters}
{\em algo} & Algorithm to convert. See \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm} \\
\hline
{\em result} & The algorithm as a String. "{}\+Unknown"{} if the algorithm is not supported by Yubi\+HSM 2.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if {\ttfamily result} is NULL.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Algorithms.html}{\texttt{ Algorithms}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04384}{4384}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04385\ }
\DoxyCodeLine{04386\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ NULL)\ \{}
\DoxyCodeLine{04387\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04388\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04389\ \ \ \}}
\DoxyCodeLine{04390\ }
\DoxyCodeLine{04391\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(yh\_algorithms)\ /\ \textcolor{keyword}{sizeof}(yh\_algorithms[0]);}
\DoxyCodeLine{04392\ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{04393\ \ \ \ \ \textcolor{keywordflow}{if}\ (algo\ ==\ yh\_algorithms[i].\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{04394\ \ \ \ \ \ \ *result\ =\ yh\_algorithms[i].name;}
\DoxyCodeLine{04395\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04396\ \ \ \ \ \}}
\DoxyCodeLine{04397\ \ \ \}}
\DoxyCodeLine{04398\ }
\DoxyCodeLine{04399\ \ \ *result\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{04400\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04401\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=271pt]{yubihsm_8c_a2a0d369611aa795c62645467062a9acb_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a2a0d369611aa795c62645467062a9acb_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a77870209747d5ccd90f9da3aae2bdfa8}\index{yubihsm.c@{yubihsm.c}!yh\_authenticate\_session@{yh\_authenticate\_session}}
\index{yh\_authenticate\_session@{yh\_authenticate\_session}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_authenticate\_session()}{yh\_authenticate\_session()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a77870209747d5ccd90f9da3aae2bdfa8} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+authenticate\+\_\+session (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{}\end{DoxyParamCaption})}

Authenticate session


\begin{DoxyParams}{Parameters}
{\em session} & Session to authenticate\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366af8d55718c98750591e891a37409c9266}{YHR\+\_\+\+SESSION\+\_\+\+AUTHENTICATION\+\_\+\+FAILED} if the session fails to authenticate. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Session.html}{\texttt{ Session}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02927}{2927}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02928\ }
\DoxyCodeLine{02929\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ msg;}
\DoxyCodeLine{02930\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ response\_msg;}
\DoxyCodeLine{02931\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02932\ }
\DoxyCodeLine{02933\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ mac\_buf[64];}
\DoxyCodeLine{02934\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ mac\_buf\_len;}
\DoxyCodeLine{02935\ }
\DoxyCodeLine{02936\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02937\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02938\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02939\ \ \ \}}
\DoxyCodeLine{02940\ }
\DoxyCodeLine{02941\ \ \ \textcolor{comment}{//\ Send\ AUTHENTICATE\ SESSION\ command}}
\DoxyCodeLine{02942\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd\ =\ YHC\_AUTHENTICATE\_SESSION;}
\DoxyCodeLine{02943\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ =\ 1\ +\ \mbox{\hyperlink{scp_8h_ab69c4b9b326bc5bd847773167ca5c969}{SCP\_HOST\_CRYPTO\_LEN}}\ +\ \mbox{\hyperlink{scp_8h_a4b017661aafe8f0a0bde0ff377684303}{SCP\_MAC\_LEN}};}
\DoxyCodeLine{02944\ }
\DoxyCodeLine{02945\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data[0]\ =\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.sid;}
\DoxyCodeLine{02946\ }
\DoxyCodeLine{02947\ \ \ \textcolor{comment}{//\ Compute\ host\ cryptogram}}
\DoxyCodeLine{02948\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ compute\_host\_cryptogram(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data\ +\ 1);}
\DoxyCodeLine{02949\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02950\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02951\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02952\ \ \ \}}
\DoxyCodeLine{02953\ }
\DoxyCodeLine{02954\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data\ +\ 1,\ \mbox{\hyperlink{scp_8h_ab69c4b9b326bc5bd847773167ca5c969}{SCP\_HOST\_CRYPTO\_LEN}},\ \textcolor{stringliteral}{"{}Host\ cryptogram:\ "{}});}
\DoxyCodeLine{02955\ }
\DoxyCodeLine{02956\ \ \ mac\_buf\_len\ =\ \mbox{\hyperlink{scp_8h_a8f01665a0470dd4125b6518bd77e3328}{SCP\_PRF\_LEN}}\ +\ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ +\ 3\ -\/\ \mbox{\hyperlink{scp_8h_a4b017661aafe8f0a0bde0ff377684303}{SCP\_MAC\_LEN}};}
\DoxyCodeLine{02957\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(mac\_buf,\ 0,\ \mbox{\hyperlink{scp_8h_a8f01665a0470dd4125b6518bd77e3328}{SCP\_PRF\_LEN}});\ \textcolor{comment}{//\ Initial\ mac\ chaining\ value}}
\DoxyCodeLine{02958\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ =\ htons(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len);}
\DoxyCodeLine{02959\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(mac\_buf\ +\ \mbox{\hyperlink{scp_8h_a8f01665a0470dd4125b6518bd77e3328}{SCP\_PRF\_LEN}},\ msg.\mbox{\hyperlink{union___msg_aeba349af15322ba6c42fe23750437b0d}{raw}},\ mac\_buf\_len);}
\DoxyCodeLine{02960\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ =\ ntohs(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len);}
\DoxyCodeLine{02961\ }
\DoxyCodeLine{02962\ \ \ compute\_full\_mac(mac\_buf,\ mac\_buf\_len,\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.s\_mac,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},}
\DoxyCodeLine{02963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.mac\_chaining\_value);}
\DoxyCodeLine{02964\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data\ +\ 1\ +\ \mbox{\hyperlink{scp_8h_ab69c4b9b326bc5bd847773167ca5c969}{SCP\_HOST\_CRYPTO\_LEN}},\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.mac\_chaining\_value,}
\DoxyCodeLine{02965\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scp_8h_a4b017661aafe8f0a0bde0ff377684303}{SCP\_MAC\_LEN}});}
\DoxyCodeLine{02966\ }
\DoxyCodeLine{02967\ \ \ \textcolor{comment}{//\ Reset\ counter\ to\ 1}}
\DoxyCodeLine{02968\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.ctr,\ 0,\ \mbox{\hyperlink{scp_8h_a8f01665a0470dd4125b6518bd77e3328}{SCP\_PRF\_LEN}});}
\DoxyCodeLine{02969\ \ \ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.ctr[\mbox{\hyperlink{scp_8h_a8f01665a0470dd4125b6518bd77e3328}{SCP\_PRF\_LEN}}\ -\/\ 1]++;}
\DoxyCodeLine{02970\ }
\DoxyCodeLine{02971\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ send\_msg(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>parent,\ \&msg,\ \&response\_msg);}
\DoxyCodeLine{02972\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02973\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02974\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02975\ \ \ \}}
\DoxyCodeLine{02976\ }
\DoxyCodeLine{02977\ \ \ \textcolor{keywordflow}{if}\ (response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd\ !=\ YHC\_AUTHENTICATE\_SESSION\_R)\ \{}
\DoxyCodeLine{02978\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02979\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366af8d55718c98750591e891a37409c9266}{YHR\_SESSION\_AUTHENTICATION\_FAILED}};}
\DoxyCodeLine{02980\ \ \ \}}
\DoxyCodeLine{02981\ }
\DoxyCodeLine{02982\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02983\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=303pt]{yubihsm_8c_a77870209747d5ccd90f9da3aae2bdfa8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{yubihsm_8c_a77870209747d5ccd90f9da3aae2bdfa8_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a296b43eadb1151017ba8e9578b351c5e}\index{yubihsm.c@{yubihsm.c}!yh\_begin\_create\_session\_ext@{yh\_begin\_create\_session\_ext}}
\index{yh\_begin\_create\_session\_ext@{yh\_begin\_create\_session\_ext}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_begin\_create\_session\_ext()}{yh\_begin\_create\_session\_ext()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a296b43eadb1151017ba8e9578b351c5e} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+begin\+\_\+create\+\_\+session\+\_\+ext (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{authkey\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{context}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{card\+\_\+cryptogram}{, }\item[{size\+\_\+t}]{card\+\_\+cryptogram\+\_\+len}{, }\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{session}{}\end{DoxyParamCaption})}

Begin creating an external session. The session\textquotesingle{}s encryption key and MAC key are not stored in the device.

This function must be followed by \doxylink{yubihsm_8h_afbcb5c761339fbcf444be8f338b4614f}{yh\+\_\+finish\+\_\+create\+\_\+session\+\_\+ext()} to set the session keys.


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to the device \\
\hline
{\em authkey\+\_\+id} & Object ID of the Authentication Key used to authenticate the session \\
\hline
{\em context} & pointer to where context data is saved \\
\hline
{\em card\+\_\+cryptogram} & Card cryptogram \\
\hline
{\em card\+\_\+cryptogram\+\_\+len} & Length of card cryptogram \\
\hline
{\em session} & created session\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a75ea079345046cdbf5612bf9065d8711}{YHR\+\_\+\+MEMORY\+\_\+\+ERROR} if failed to allocate memory for the session. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Session.html}{\texttt{ Session}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00751}{751}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ msg;}
\DoxyCodeLine{00757\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ response\_msg;}
\DoxyCodeLine{00758\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00759\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ *ptr;}
\DoxyCodeLine{00760\ \ \ \mbox{\hyperlink{structyh__session}{yh\_session}}\ *new\_session;}
\DoxyCodeLine{00761\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ host\_challenge[\mbox{\hyperlink{yubihsm_8h_a397824bc3574858c6c4502b81f7fae31}{YH\_HOST\_CHAL\_LEN}}];}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ \mbox{\hyperlink{structcontext}{context}}\ ==\ NULL\ ||\ card\_cryptogram\ ==\ NULL\ ||}
\DoxyCodeLine{00764\ \ \ \ \ \ \ card\_cryptogram\_len\ !=\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}}\ ||\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00766\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00767\ \ \ \}}
\DoxyCodeLine{00768\ }
\DoxyCodeLine{00769\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{rand_8c_a2d3d1e86f4093fbe0a1b2a7eede4cd75}{rand\_generate}}(host\_challenge,\ \textcolor{keyword}{sizeof}(host\_challenge)))\ \{}
\DoxyCodeLine{00770\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a39fbc5bce29b178582419ae9d31ad252}{YHR\_GENERIC\_ERROR}};}
\DoxyCodeLine{00771\ \ \ \}\ \textcolor{comment}{//\ TODO(adma):\ take\ this\ as\ an\ input\ so\ that\ it\ can\ be\ generated\ from\ the}}
\DoxyCodeLine{00772\ \ \ \textcolor{comment}{//\ YubiKey}}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \textcolor{comment}{\ \ /**********/}}
\DoxyCodeLine{00775\ \ \ \textcolor{comment}{//\ TODO(adma):\ replace\ with\ func}}
\DoxyCodeLine{00776\ \ \ new\_session\ =\ calloc(1,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structyh__session}{yh\_session}}));}
\DoxyCodeLine{00777\ \ \ \textcolor{keywordflow}{if}\ (new\_session\ ==\ NULL)\ \{}
\DoxyCodeLine{00778\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a75ea079345046cdbf5612bf9065d8711}{YHR\_MEMORY\_ERROR}}));}
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a75ea079345046cdbf5612bf9065d8711}{YHR\_MEMORY\_ERROR}};}
\DoxyCodeLine{00780\ \ \ \}}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ \ \ \textcolor{comment}{//\ Send\ CREATE\ SESSION\ command}}
\DoxyCodeLine{00783\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd\ =\ YHC\_CREATE\_SESSION;}
\DoxyCodeLine{00784\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ =\ \mbox{\hyperlink{scp_8h_aaa32e6b7edd5513108f1410315fa594e}{SCP\_AUTHKEY\_ID\_LEN}}\ +\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}};}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00786\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ authkey\_id\_n\ =\ htons(authkey\_id);}
\DoxyCodeLine{00787\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data,\ \&authkey\_id\_n,\ \mbox{\hyperlink{scp_8h_aaa32e6b7edd5513108f1410315fa594e}{SCP\_AUTHKEY\_ID\_LEN}});}
\DoxyCodeLine{00788\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data\ +\ \mbox{\hyperlink{scp_8h_aaa32e6b7edd5513108f1410315fa594e}{SCP\_AUTHKEY\_ID\_LEN}},\ host\_challenge,\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}});}
\DoxyCodeLine{00789\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}},\ host\_challenge,\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}});}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(host\_challenge,\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}},\ \textcolor{stringliteral}{"{}Host\ challenge:\ "{}});}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00793\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ send\_msg(connector,\ \&msg,\ \&response\_msg);}
\DoxyCodeLine{00794\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00795\ \ \ \ \ \textcolor{keywordflow}{goto}\ bcse\_failure;}
\DoxyCodeLine{00796\ \ \ \}}
\DoxyCodeLine{00797\ }
\DoxyCodeLine{00798\ \ \ \textcolor{comment}{//\ Parse\ response}}
\DoxyCodeLine{00799\ \ \ \textcolor{keywordflow}{if}\ (response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd\ !=\ YHC\_CREATE\_SESSION\_R)\ \{}
\DoxyCodeLine{00800\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data[0]);}
\DoxyCodeLine{00801\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Device\ error\ \%s\ (\%d)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data[0]);}
\DoxyCodeLine{00803\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ translated;}
\DoxyCodeLine{00804\ \ \ \ \ \textcolor{keywordflow}{goto}\ bcse\_failure;}
\DoxyCodeLine{00805\ \ \ \}}
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00807\ \ \ \textcolor{keywordflow}{if}\ (response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ !=\ 1\ +\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}}\ +\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}})\ \{}
\DoxyCodeLine{00808\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\_WRONG\_LENGTH}};}
\DoxyCodeLine{00809\ \ \ \ \ \textcolor{keywordflow}{goto}\ bcse\_failure;}
\DoxyCodeLine{00810\ \ \ \}}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ \ \ ptr\ =\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data;}
\DoxyCodeLine{00813\ }
\DoxyCodeLine{00814\ \ \ \textcolor{comment}{//\ Save\ sid}}
\DoxyCodeLine{00815\ \ \ new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}}.\mbox{\hyperlink{struct_scp__ctx_af58bb8b1e7185c27de7c8a2df94de1f5}{sid}}\ =\ (*ptr++);}
\DoxyCodeLine{00816\ }
\DoxyCodeLine{00817\ \ \ \textcolor{comment}{//\ Save\ card\ challenge}}
\DoxyCodeLine{00818\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}}\ +\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}},\ ptr,\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}});}
\DoxyCodeLine{00819\ \ \ ptr\ +=\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}};}
\DoxyCodeLine{00820\ }
\DoxyCodeLine{00821\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(card\_cryptogram,\ ptr,\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}});}
\DoxyCodeLine{00822\ \ \ ptr\ +=\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}};}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Received\ Session\ ID:\ \%d"{}},\ new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}}.\mbox{\hyperlink{struct_scp__ctx_af58bb8b1e7185c27de7c8a2df94de1f5}{sid}});}
\DoxyCodeLine{00825\ }
\DoxyCodeLine{00826\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}}\ +\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}},\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}},}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Card\ challenge:\ "{}});}
\DoxyCodeLine{00828\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(card\_cryptogram,\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}},\ \textcolor{stringliteral}{"{}Card\ cryptogram:\ "{}});}
\DoxyCodeLine{00829\ }
\DoxyCodeLine{00830\ \ \ \textcolor{comment}{//\ Save\ link\ back\ to\ connector}}
\DoxyCodeLine{00831\ \ \ new\_session-\/>\mbox{\hyperlink{structyh__session_a481fb0215d72e52bb619d6c934078167}{parent}}\ =\ connector;}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00833\ \ \ *\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ =\ new\_session;}
\DoxyCodeLine{00834\ \ \ *\mbox{\hyperlink{structcontext}{context}}\ =\ new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}};}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ bcse\_failure:}
\DoxyCodeLine{00839\ \ \ free(new\_session);}
\DoxyCodeLine{00840\ \ \ (new\_session)\ =\ NULL;}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00845\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=339pt]{yubihsm_8c_a296b43eadb1151017ba8e9578b351c5e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a296b43eadb1151017ba8e9578b351c5e_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ac46bac75dfd0a4358a4e6b432a50e48a}\index{yubihsm.c@{yubihsm.c}!yh\_capabilities\_to\_strings@{yh\_capabilities\_to\_strings}}
\index{yh\_capabilities\_to\_strings@{yh\_capabilities\_to\_strings}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_capabilities\_to\_strings()}{yh\_capabilities\_to\_strings()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ac46bac75dfd0a4358a4e6b432a50e48a} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+capabilities\+\_\+to\+\_\+strings (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{num}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{result}{\mbox{[}$\,$\mbox{]}, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{n\+\_\+result}{}\end{DoxyParamCaption})}

Convert an array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities} into strings separated by \textquotesingle{},\textquotesingle{}


\begin{DoxyParams}{Parameters}
{\em num} & Array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities} \\
\hline
{\em result} & Array of the capabilies as strings \\
\hline
{\em n\+\_\+result} & Number of elements in result\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if {\ttfamily n\+\_\+result} is too small
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Capability.html}{\texttt{ Capability}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04168}{4168}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04170\ }
\DoxyCodeLine{04171\ \ \ \textcolor{keywordflow}{if}\ (num\ ==\ 0\ ||\ result\ ==\ NULL\ ||\ n\_result\ ==\ NULL)\ \{}
\DoxyCodeLine{04172\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04173\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04174\ \ \ \}}
\DoxyCodeLine{04175\ }
\DoxyCodeLine{04176\ \ \ \textcolor{keywordtype}{size\_t}\ matching\ =\ 0;}
\DoxyCodeLine{04177\ }
\DoxyCodeLine{04178\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(yh\_capability)\ /\ \textcolor{keyword}{sizeof}(yh\_capability[0]);}
\DoxyCodeLine{04179\ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{04180\ \ \ \ \ \textcolor{keywordflow}{if}\ (((1ULL\ <<\ (yh\_capability[i].\mbox{\hyperlink{yubihsm_8h_a276ec4ea44aa77416c732159c90a37b9}{bit}}\ \%\ 8))\ \&}
\DoxyCodeLine{04181\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_i_r_aa1afcba889279fa935b76ba278be7fd6a0fc3cfbc27e91ea60a787de13dae3e3c}{num}}-\/>capabilities[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}\ -\/\ 1\ -\/}
\DoxyCodeLine{04182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (yh\_capability[i].bit\ /\ 8)])\ !=\ 0)\ \{}
\DoxyCodeLine{04183\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++matching\ >\ *n\_result)\ \{}
\DoxyCodeLine{04184\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(result,\ 0,\ *n\_result);}
\DoxyCodeLine{04185\ }
\DoxyCodeLine{04186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{04187\ \ \ \ \ \ \ \}}
\DoxyCodeLine{04188\ }
\DoxyCodeLine{04189\ \ \ \ \ \ \ result[matching\ -\/\ 1]\ =\ yh\_capability[i].name;}
\DoxyCodeLine{04190\ \ \ \ \ \}}
\DoxyCodeLine{04191\ \ \ \}}
\DoxyCodeLine{04192\ }
\DoxyCodeLine{04193\ \ \ *n\_result\ =\ matching;}
\DoxyCodeLine{04194\ }
\DoxyCodeLine{04195\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04196\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=273pt]{yubihsm_8c_ac46bac75dfd0a4358a4e6b432a50e48a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ac46bac75dfd0a4358a4e6b432a50e48a_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aba384949362ccaf19cbeae3bb046489c}\index{yubihsm.c@{yubihsm.c}!yh\_check\_capability@{yh\_check\_capability}}
\index{yh\_check\_capability@{yh\_check\_capability}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_check\_capability()}{yh\_check\_capability()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aba384949362ccaf19cbeae3bb046489c} 
bool yh\+\_\+check\+\_\+capability (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{capability}{}\end{DoxyParamCaption})}

Check if a capability is set


\begin{DoxyParams}{Parameters}
{\em capabilities} & Array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities} \\
\hline
{\em capability} & Capability to check as a string.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the {\ttfamily capability} is in {\ttfamily capabilities}. False otherwise
\end{DoxyReturn}
\begin{DoxyParagraph}{Code sample}
\begin{DoxyVerb}char *capabilities_str = "sign-pkcs,decrypt-pkcs,set-option";
yh_capabilities capabilities = {{0}};
yh_string_to_capabilities(capabilities_str, &capabilities);
//yh_check_capability(&capabilities, "something") => false
//yh_check_capability(&capabilities, "sign-pss") => false
//yh_check_capability(&capabilities, "decrypt-pkcs") => true
\end{DoxyVerb}

\end{DoxyParagraph}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Capability.html}{\texttt{ Capability}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04198}{4198}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04200\ }
\DoxyCodeLine{04201\ \ \ \mbox{\hyperlink{structyh__capabilities}{yh\_capabilities}}\ check\_capabilities\ =\ \{\{0\}\};}
\DoxyCodeLine{04202\ }
\DoxyCodeLine{04203\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm_8c_aab440e1cb671d9ba7a2e7d1243960e42}{yh\_string\_to\_capabilities}}(capability,\ \&check\_capabilities)\ !=}
\DoxyCodeLine{04204\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{04205\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04206\ \ \ \}}
\DoxyCodeLine{04207\ }
\DoxyCodeLine{04208\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}};\ i++)\ \{}
\DoxyCodeLine{04209\ \ \ \ \ \textcolor{keywordflow}{if}\ (check\_capabilities.\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}}[i]\ !=\ 0\ \&\&}
\DoxyCodeLine{04210\ \ \ \ \ \ \ \ \ (check\_capabilities.\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}}[i]\ \&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}-\/>\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}}[i])\ !=}
\DoxyCodeLine{04211\ \ \ \ \ \ \ \ \ \ \ 0)\ \{}
\DoxyCodeLine{04212\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{04213\ \ \ \ \ \}}
\DoxyCodeLine{04214\ \ \ \}}
\DoxyCodeLine{04215\ }
\DoxyCodeLine{04216\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04217\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aba384949362ccaf19cbeae3bb046489c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=333pt]{yubihsm_8c_aba384949362ccaf19cbeae3bb046489c_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aa19be6ac70a2a5d1cef8d7e6902fe05f}\index{yubihsm.c@{yubihsm.c}!yh\_connect@{yh\_connect}}
\index{yh\_connect@{yh\_connect}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_connect()}{yh\_connect()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aa19be6ac70a2a5d1cef8d7e6902fe05f} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+connect (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{int}]{timeout}{}\end{DoxyParamCaption})}

Connect to the device through the specified connector


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to the device \\
\hline
{\em timeout} & Connection timeout in seconds\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the connector does not exist. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04079}{4079}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04080\ }
\DoxyCodeLine{04081\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}\ ==\ NULL)\ \{}
\DoxyCodeLine{04082\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Invalid\ parameters:\ undefined\ pointer"{}});}
\DoxyCodeLine{04083\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04084\ \ \ \}}
\DoxyCodeLine{04085\ }
\DoxyCodeLine{04086\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a97917e1d5a9fa5e8b7a4495dc9234ac7}{rc}};}
\DoxyCodeLine{04087\ }
\DoxyCodeLine{04088\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a97917e1d5a9fa5e8b7a4495dc9234ac7}{rc}}\ =\ connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}-\/>backend\_connect(connector,\ timeout);}
\DoxyCodeLine{04089\ }
\DoxyCodeLine{04090\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a97917e1d5a9fa5e8b7a4495dc9234ac7}{rc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{04091\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ when\ connecting:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a97917e1d5a9fa5e8b7a4495dc9234ac7}{rc}}));}
\DoxyCodeLine{04092\ \ \ \}}
\DoxyCodeLine{04093\ }
\DoxyCodeLine{04094\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a97917e1d5a9fa5e8b7a4495dc9234ac7}{rc}};}
\DoxyCodeLine{04095\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=245pt]{yubihsm_8c_aa19be6ac70a2a5d1cef8d7e6902fe05f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa19be6ac70a2a5d1cef8d7e6902fe05f_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a163506939cedbc1e849bdcfb8b5fe1de}\index{yubihsm.c@{yubihsm.c}!yh\_connector\_has\_device@{yh\_connector\_has\_device}}
\index{yh\_connector\_has\_device@{yh\_connector\_has\_device}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_connector\_has\_device()}{yh\_connector\_has\_device()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a163506939cedbc1e849bdcfb8b5fe1de} 
bool yh\+\_\+connector\+\_\+has\+\_\+device (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{}\end{DoxyParamCaption})}

Check if the connector has a device connected


\begin{DoxyParams}{Parameters}
{\em connector} & Connector currently in use\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the connector is not NULL and there is a device connected to it. False otherwise 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00906}{906}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \textcolor{keywordflow}{return}\ connector\ \&\&\ connector-\/>\mbox{\hyperlink{structyh__connector_a5528332cb62657dbe6fc7e795738872a}{has\_device}};}
\DoxyCodeLine{00909\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{yubihsm_8c_a163506939cedbc1e849bdcfb8b5fe1de_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a0e96ea59c5f32def80843fec5a3c2142}\index{yubihsm.c@{yubihsm.c}!yh\_create\_session@{yh\_create\_session}}
\index{yh\_create\_session@{yh\_create\_session}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_create\_session()}{yh\_create\_session()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a0e96ea59c5f32def80843fec5a3c2142} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+create\+\_\+session (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{authkey\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+enc}{, }\item[{size\+\_\+t}]{key\+\_\+enc\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+mac}{, }\item[{size\+\_\+t}]{key\+\_\+mac\+\_\+len}{, }\item[{bool}]{recreate\+\_\+session}{, }\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{session}{}\end{DoxyParamCaption})}

Create a session that uses the specified encryption key and MAC key to derive session-\/specific keys


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to the device \\
\hline
{\em authkey\+\_\+id} & Object ID of the Authentication Key used to authenticate the session \\
\hline
{\em key\+\_\+enc} & Encryption key used to derive the session encryption key \\
\hline
{\em key\+\_\+enc\+\_\+len} & Length of the encryption key. \\
\hline
{\em key\+\_\+mac} & MAC key used to derive the session MAC key \\
\hline
{\em key\+\_\+mac\+\_\+len} & Length of the MAC key. \\
\hline
{\em recreate\+\_\+session} & If true, the session will be recreated if expired. This caches the password in memory \\
\hline
{\em session} & created session\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or incorrect. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Session.html}{\texttt{ Session}}, \href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Authentication Key}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00616}{616}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ msg;}
\DoxyCodeLine{00622\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ response\_msg;}
\DoxyCodeLine{00623\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00624\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ *ptr;}
\DoxyCodeLine{00625\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ card\_cryptogram[\mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}}];}
\DoxyCodeLine{00626\ \ \ \mbox{\hyperlink{structyh__session}{yh\_session}}\ *new\_session;}
\DoxyCodeLine{00627\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ host\_challenge[\mbox{\hyperlink{yubihsm_8h_a397824bc3574858c6c4502b81f7fae31}{YH\_HOST\_CHAL\_LEN}}];}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00629\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ key\_enc\ ==\ NULL\ ||\ key\_enc\_len\ !=\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}\ ||}
\DoxyCodeLine{00630\ \ \ \ \ \ \ key\_mac\ ==\ NULL\ ||\ key\_mac\_len\ !=\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}\ ||\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{00631\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00633\ \ \ \}}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{rand_8c_a2d3d1e86f4093fbe0a1b2a7eede4cd75}{rand\_generate}}(host\_challenge,\ \textcolor{keyword}{sizeof}(host\_challenge)))\ \{}
\DoxyCodeLine{00636\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a39fbc5bce29b178582419ae9d31ad252}{YHR\_GENERIC\_ERROR}};}
\DoxyCodeLine{00637\ \ \ \}}
\DoxyCodeLine{00638\ }
\DoxyCodeLine{00639\ \ \ \textcolor{keywordflow}{if}\ (!*\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}})\ \{}
\DoxyCodeLine{00640\ \ \ \ \ new\_session\ =\ calloc(1,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structyh__session}{yh\_session}}));}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_session\ ==\ NULL)\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a75ea079345046cdbf5612bf9065d8711}{YHR\_MEMORY\_ERROR}}));}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a75ea079345046cdbf5612bf9065d8711}{YHR\_MEMORY\_ERROR}};}
\DoxyCodeLine{00644\ \ \ \ \ \}}
\DoxyCodeLine{00645\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00646\ \ \ \ \ new\_session\ =\ *\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}};}
\DoxyCodeLine{00647\ \ \ \}}
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00649\ \ \ new\_session-\/>\mbox{\hyperlink{structyh__session_a6c208ce524e1f71bde33103fd883db5a}{authkey\_id}}\ =\ authkey\_id;}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \ \ \textcolor{keywordflow}{if}\ (recreate)\ \{}
\DoxyCodeLine{00652\ \ \ \ \ new\_session-\/>\mbox{\hyperlink{structyh__session_a2bcf5cb8c6bfb10b2300ed5f3a4f6e7b}{recreate}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00653\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a2cce834e130b57e28a660ede08039e02}{key\_enc}},\ key\_enc,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}});}
\DoxyCodeLine{00654\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a88795cd7a6018303e3cea5cc3bdf02cf}{key\_mac}},\ key\_mac,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}});}
\DoxyCodeLine{00655\ \ \ \}}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00657\ \ \ \textcolor{comment}{//\ Send\ CREATE\ SESSION\ command}}
\DoxyCodeLine{00658\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd\ =\ YHC\_CREATE\_SESSION;}
\DoxyCodeLine{00659\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ =\ \mbox{\hyperlink{scp_8h_aaa32e6b7edd5513108f1410315fa594e}{SCP\_AUTHKEY\_ID\_LEN}}\ +\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}};}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ authkey\_id\_n\ =\ htons(authkey\_id);}
\DoxyCodeLine{00662\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data,\ \&authkey\_id\_n,\ \mbox{\hyperlink{scp_8h_aaa32e6b7edd5513108f1410315fa594e}{SCP\_AUTHKEY\_ID\_LEN}});}
\DoxyCodeLine{00663\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data\ +\ \mbox{\hyperlink{scp_8h_aaa32e6b7edd5513108f1410315fa594e}{SCP\_AUTHKEY\_ID\_LEN}},\ host\_challenge,\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}});}
\DoxyCodeLine{00664\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}},\ host\_challenge,\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}});}
\DoxyCodeLine{00665\ }
\DoxyCodeLine{00666\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(host\_challenge,\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}},\ \textcolor{stringliteral}{"{}Host\ challenge:\ "{}});}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ send\_msg(connector,\ \&msg,\ \&response\_msg);}
\DoxyCodeLine{00669\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \textcolor{keywordflow}{goto}\ cs\_failure;}
\DoxyCodeLine{00671\ \ \ \}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ \ \ \textcolor{comment}{//\ Parse\ response}}
\DoxyCodeLine{00674\ \ \ \textcolor{keywordflow}{if}\ (response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd\ !=\ YHC\_CREATE\_SESSION\_R)\ \{}
\DoxyCodeLine{00675\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data[0]);}
\DoxyCodeLine{00676\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Device\ error\ \%s\ (\%d)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data[0]);}
\DoxyCodeLine{00678\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ translated;}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{keywordflow}{goto}\ cs\_failure;}
\DoxyCodeLine{00680\ \ \ \}}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \ \ \textcolor{keywordflow}{if}\ (response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ !=\ 1\ +\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}}\ +\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}})\ \{}
\DoxyCodeLine{00683\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\_WRONG\_LENGTH}};}
\DoxyCodeLine{00684\ \ \ \ \ \textcolor{keywordflow}{goto}\ cs\_failure;}
\DoxyCodeLine{00685\ \ \ \}}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \ \ ptr\ =\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data;}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \textcolor{comment}{//\ Save\ sid}}
\DoxyCodeLine{00690\ \ \ new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}}.\mbox{\hyperlink{struct_scp__ctx_af58bb8b1e7185c27de7c8a2df94de1f5}{sid}}\ =\ (*ptr++);}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00692\ \ \ \textcolor{comment}{//\ Save\ card\ challenge}}
\DoxyCodeLine{00693\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}}\ +\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}},\ ptr,\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}});}
\DoxyCodeLine{00694\ \ \ ptr\ +=\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}};}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(card\_cryptogram,\ ptr,\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}});}
\DoxyCodeLine{00697\ \ \ ptr\ +=\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}};}
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00699\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Received\ Session\ ID:\ \%d"{}},\ new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}}.\mbox{\hyperlink{struct_scp__ctx_af58bb8b1e7185c27de7c8a2df94de1f5}{sid}});}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}}\ +\ \mbox{\hyperlink{scp_8h_ac8a88e113e5d7d245aeb27e841214563}{SCP\_HOST\_CHAL\_LEN}},\ \mbox{\hyperlink{scp_8h_aa341425f7d11b792662ebc93abf38cde}{SCP\_CARD\_CHAL\_LEN}},}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Card\ challenge:\ "{}});}
\DoxyCodeLine{00703\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(card\_cryptogram,\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}},\ \textcolor{stringliteral}{"{}Card\ cryptogram:\ "{}});}
\DoxyCodeLine{00704\ }
\DoxyCodeLine{00705\ \ \ \textcolor{comment}{//\ Derive\ session\ keys}}
\DoxyCodeLine{00706\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{00707\ \ \ \ \ derive\_s\_enc(\&new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}},\ key\_enc,\ key\_enc\_len,\ new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}});}
\DoxyCodeLine{00708\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})}
\DoxyCodeLine{00709\ \ \ \ \ \textcolor{keywordflow}{goto}\ cs\_failure;}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{00712\ \ \ \ \ derive\_s\_mac(\&new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}},\ key\_mac,\ key\_mac\_len,\ new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}});}
\DoxyCodeLine{00713\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})}
\DoxyCodeLine{00714\ \ \ \ \ \textcolor{keywordflow}{goto}\ cs\_failure;}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{00717\ \ \ \ \ derive\_s\_rmac(\&new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}},\ key\_mac,\ key\_enc\_len,\ new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}});}
\DoxyCodeLine{00718\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})}
\DoxyCodeLine{00719\ \ \ \ \ \textcolor{keywordflow}{goto}\ cs\_failure;}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}}.\mbox{\hyperlink{struct_scp__ctx_af74beebd17620c5ff6fc1bd48fd017bf}{s\_enc}},\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \textcolor{stringliteral}{"{}S-\/ENC:\ "{}});}
\DoxyCodeLine{00722\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}}.\mbox{\hyperlink{struct_scp__ctx_a5c1e57aa4641ea9404201193367bfd37}{s\_mac}},\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \textcolor{stringliteral}{"{}S-\/MAC:\ "{}});}
\DoxyCodeLine{00723\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}}.\mbox{\hyperlink{struct_scp__ctx_a6d4e08d26c9ab0e28d75a3976d16967c}{s\_rmac}},\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \textcolor{stringliteral}{"{}S-\/RMAC:\ "{}});}
\DoxyCodeLine{00724\ \ \ \textcolor{comment}{//\ Verify\ card\ cryptogram}}
\DoxyCodeLine{00725\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ verify\_card\_cryptogram(\&new\_session-\/>\mbox{\hyperlink{structyh__session_a5582d82fd5b88d1e26738437268fb285}{s}},\ new\_session-\/>\mbox{\hyperlink{structyh__session_a92d2141eb31c70c19d90519c6446c12d}{context}},}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ card\_cryptogram);}
\DoxyCodeLine{00727\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00728\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{00729\ \ \ \ \ \textcolor{keywordflow}{goto}\ cs\_failure;}
\DoxyCodeLine{00730\ \ \ \}}
\DoxyCodeLine{00731\ }
\DoxyCodeLine{00732\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Card\ cryptogram\ successfully\ verified"{}});}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00734\ \ \ \textcolor{comment}{//\ Save\ link\ back\ to\ connector}}
\DoxyCodeLine{00735\ \ \ new\_session-\/>\mbox{\hyperlink{structyh__session_a481fb0215d72e52bb619d6c934078167}{parent}}\ =\ connector;}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ *\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ =\ new\_session;}
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ cs\_failure:}
\DoxyCodeLine{00742\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(new\_session,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structyh__session}{yh\_session}}));}
\DoxyCodeLine{00743\ \ \ free(new\_session);}
\DoxyCodeLine{00744\ \ \ (new\_session)\ =\ NULL;}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00746\ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{00747\ }
\DoxyCodeLine{00748\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00749\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=291pt]{yubihsm_8c_a0e96ea59c5f32def80843fec5a3c2142_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{yubihsm_8c_a0e96ea59c5f32def80843fec5a3c2142_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a3be331dcf8907ff3569e4dc230e1c615}\index{yubihsm.c@{yubihsm.c}!yh\_create\_session\_derived@{yh\_create\_session\_derived}}
\index{yh\_create\_session\_derived@{yh\_create\_session\_derived}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_create\_session\_derived()}{yh\_create\_session\_derived()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a3be331dcf8907ff3569e4dc230e1c615} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+create\+\_\+session\+\_\+derived (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{authkey\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{password}{, }\item[{size\+\_\+t}]{password\+\_\+len}{, }\item[{bool}]{recreate\+\_\+session}{, }\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{session}{}\end{DoxyParamCaption})}

Create a session that uses an encryption key and a MAC key derived from a password


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to the device \\
\hline
{\em authkey\+\_\+id} & Object ID of the Authentication Key used to authenticate the session \\
\hline
{\em password} & Password used to derive the session encryption key and MAC key \\
\hline
{\em password\+\_\+len} & Length of the password in bytes \\
\hline
{\em recreate\+\_\+session} & If true, the session will be recreated if expired. This caches the password in memory \\
\hline
{\em session} & The created session\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the connector, the password or the session are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a39fbc5bce29b178582419ae9d31ad252}{YHR\+\_\+\+GENERIC\+\_\+\+ERROR} if failed to derive the session encryption key and/or the MAC key or if PRNG related errors occur. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a75ea079345046cdbf5612bf9065d8711}{YHR\+\_\+\+MEMORY\+\_\+\+ERROR} if failed to allocate memory for the session. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Session.html}{\texttt{ Session}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00593}{593}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ password\ ==\ NULL\ ||\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{00598\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00600\ \ \ \}}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_enc[\mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}];}
\DoxyCodeLine{00603\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_mac[\mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}];}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ derive\_keys(password,\ password\_len,\ key\_enc,\ key\_mac);}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ ==\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00608\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a0e96ea59c5f32def80843fec5a3c2142}{yh\_create\_session}}(connector,\ authkey\_id,\ key\_enc,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\_mac,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ recreate,\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}});}
\DoxyCodeLine{00610\ \ \ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(key\_enc,\ \textcolor{keyword}{sizeof}(key\_enc));}
\DoxyCodeLine{00611\ \ \ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(key\_mac,\ \textcolor{keyword}{sizeof}(key\_mac));}
\DoxyCodeLine{00612\ \ \ \}}
\DoxyCodeLine{00613\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00614\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a3be331dcf8907ff3569e4dc230e1c615_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a3be331dcf8907ff3569e4dc230e1c615_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a1a35f8ae5a739848408633a514e41b2d}\index{yubihsm.c@{yubihsm.c}!yh\_destroy\_session@{yh\_destroy\_session}}
\index{yh\_destroy\_session@{yh\_destroy\_session}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_destroy\_session()}{yh\_destroy\_session()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a1a35f8ae5a739848408633a514e41b2d} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+destroy\+\_\+session (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{session}{}\end{DoxyParamCaption})}

Free data associated with the session


\begin{DoxyParams}{Parameters}
{\em session} & Pointer to the session to destroy\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Session.html}{\texttt{ Session}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00890}{890}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00891\ }
\DoxyCodeLine{00892\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{00893\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00894\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00895\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (*\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{00896\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00897\ \ \ \}}
\DoxyCodeLine{00898\ }
\DoxyCodeLine{00899\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(*\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structyh__session}{yh\_session}}));}
\DoxyCodeLine{00900\ \ \ free(*\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}});}
\DoxyCodeLine{00901\ \ \ *\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ =\ NULL;}
\DoxyCodeLine{00902\ }
\DoxyCodeLine{00903\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00904\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=282pt]{yubihsm_8c_a1a35f8ae5a739848408633a514e41b2d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a1a35f8ae5a739848408633a514e41b2d_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ab12d5a42d2219741bd3630b99ed1c7d2}\index{yubihsm.c@{yubihsm.c}!yh\_disconnect@{yh\_disconnect}}
\index{yh\_disconnect@{yh\_disconnect}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_disconnect()}{yh\_disconnect()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ab12d5a42d2219741bd3630b99ed1c7d2} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+disconnect (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{}\end{DoxyParamCaption})}

Disconnect from a connector


\begin{DoxyParams}{Parameters}
{\em connector} & Connector from which to disconnect\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the connector is NULL 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04097}{4097}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04098\ }
\DoxyCodeLine{04099\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL)\ \{}
\DoxyCodeLine{04100\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04101\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04102\ \ \ \}}
\DoxyCodeLine{04103\ }
\DoxyCodeLine{04104\ \ \ destroy\_connector(connector);}
\DoxyCodeLine{04105\ }
\DoxyCodeLine{04106\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04107\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{yubihsm_8c_ab12d5a42d2219741bd3630b99ed1c7d2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ab12d5a42d2219741bd3630b99ed1c7d2_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a0100df295f7ecf0d0cc90052aac20586}\index{yubihsm.c@{yubihsm.c}!yh\_domains\_to\_string@{yh\_domains\_to\_string}}
\index{yh\_domains\_to\_string@{yh\_domains\_to\_string}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_domains\_to\_string()}{yh\_domains\_to\_string()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a0100df295f7ecf0d0cc90052aac20586} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+domains\+\_\+to\+\_\+string (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{char \texorpdfstring{$\ast$}{*}}]{string}{, }\item[{size\+\_\+t}]{max\+\_\+len}{}\end{DoxyParamCaption})}

Convert domains parameter to its String representation


\begin{DoxyParams}{Parameters}
{\em domains} & Encoded domains \\
\hline
{\em string} & Domains as a string \\
\hline
{\em max\+\_\+len} & Maximum length of the string\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if {\ttfamily max\+\_\+len} is too small
\end{DoxyReturn}
\begin{DoxyParagraph}{Examples}

\end{DoxyParagraph}

\begin{DoxyItemize}
\item 1 =\texorpdfstring{$>$}{>} "{}1"{}
\item 0x8001 =\texorpdfstring{$>$}{>} "{}1\+:16"{}
\item 0, "{}"{}
\item 0xffff =\texorpdfstring{$>$}{>} "{}1\+:2\+:3\+:4\+:5\+:6\+:7\+:8\+:9\+:10\+:11\+:12\+:13\+:14\+:15\+:16"{}
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Domain.html}{\texttt{ Domains}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04587}{4587}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04588\ \ \ \textcolor{keywordtype}{char}\ *ptr\ =\ string;}
\DoxyCodeLine{04589\ \ \ *ptr\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{04590\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{yubihsm_8h_aedf3b950c50f82299eddf54d0338dd60}{YH\_MAX\_DOMAINS}};\ i++)\ \{}
\DoxyCodeLine{04591\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}\ \&\ (1\ <<\ i))\ \{}
\DoxyCodeLine{04592\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wrote\ =\ snprintf(ptr,\ max\_len,\ \textcolor{stringliteral}{"{}\%d:"{}},\ i\ +\ 1);}
\DoxyCodeLine{04593\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wrote\ >=\ max\_len)\ \{}
\DoxyCodeLine{04594\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{04595\ \ \ \ \ \ \ \}}
\DoxyCodeLine{04596\ \ \ \ \ \ \ ptr\ +=\ wrote;}
\DoxyCodeLine{04597\ \ \ \ \ \ \ max\_len\ -\/=\ wrote;}
\DoxyCodeLine{04598\ \ \ \ \ \}}
\DoxyCodeLine{04599\ \ \ \}}
\DoxyCodeLine{04600\ \ \ \textcolor{keywordflow}{if}\ (ptr\ !=\ \textcolor{keywordtype}{string})\ \{}
\DoxyCodeLine{04601\ \ \ \ \ *(ptr\ -\/\ 1)\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{04602\ \ \ \}}
\DoxyCodeLine{04603\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04604\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a0100df295f7ecf0d0cc90052aac20586_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a36e3d9a07c6689e14a9339ca1ebb7259}\index{yubihsm.c@{yubihsm.c}!yh\_exit@{yh\_exit}}
\index{yh\_exit@{yh\_exit}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_exit()}{yh\_exit()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a36e3d9a07c6689e14a9339ca1ebb7259} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+exit (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}

Global library clean up

\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03910}{3910}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03910\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=294pt]{yubihsm_8c_a36e3d9a07c6689e14a9339ca1ebb7259_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a900031f15115ee22e885d2de7ec80a4a}\index{yubihsm.c@{yubihsm.c}!yh\_filter\_capabilities@{yh\_filter\_capabilities}}
\index{yh\_filter\_capabilities@{yh\_filter\_capabilities}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_filter\_capabilities()}{yh\_filter\_capabilities()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a900031f15115ee22e885d2de7ec80a4a} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+filter\+\_\+capabilities (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{filter}{, }\item[{\mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}

Filter one set of capabilities with another. The resulting set of capabilities contains only the capabilities that exist in both sets of input capabilities


\begin{DoxyParams}{Parameters}
{\em capabilities} & Array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities} \\
\hline
{\em filter} & Array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities} \\
\hline
{\em result} & Resulting array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Capability.html}{\texttt{ Capability}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04231}{4231}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04234\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}\ ==\ NULL\ ||\ filter\ ==\ NULL\ ||\ result\ ==\ NULL)\ \{}
\DoxyCodeLine{04235\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04236\ \ \ \}}
\DoxyCodeLine{04237\ }
\DoxyCodeLine{04238\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}};\ i++)\ \{}
\DoxyCodeLine{04239\ \ \ \ \ result-\/>capabilities[i]\ =}
\DoxyCodeLine{04240\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}-\/>\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}}[i]\ \&\ filter-\/>capabilities[i];}
\DoxyCodeLine{04241\ \ \ \}}
\DoxyCodeLine{04242\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04243\ \}}

\end{DoxyCode}
\Hypertarget{yubihsm_8c_afbcb5c761339fbcf444be8f338b4614f}\index{yubihsm.c@{yubihsm.c}!yh\_finish\_create\_session\_ext@{yh\_finish\_create\_session\_ext}}
\index{yh\_finish\_create\_session\_ext@{yh\_finish\_create\_session\_ext}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_finish\_create\_session\_ext()}{yh\_finish\_create\_session\_ext()}}
{\footnotesize\ttfamily \label{yubihsm_8c_afbcb5c761339fbcf444be8f338b4614f} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+finish\+\_\+create\+\_\+session\+\_\+ext (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+senc}{, }\item[{size\+\_\+t}]{key\+\_\+senc\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+smac}{, }\item[{size\+\_\+t}]{key\+\_\+smac\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+srmac}{, }\item[{size\+\_\+t}]{key\+\_\+srmac\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{card\+\_\+cryptogram}{, }\item[{size\+\_\+t}]{card\+\_\+cryptogram\+\_\+len}{}\end{DoxyParamCaption})}

Finish creating external session. The session\textquotesingle{}s encryption key and MAC key are not stored in the device.

This function must be called after \doxylink{yubihsm_8h_a296b43eadb1151017ba8e9578b351c5e}{yh\+\_\+begin\+\_\+create\+\_\+session\+\_\+ext()}.


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to the device \\
\hline
{\em session} & The session created with \doxylink{yubihsm_8h_a296b43eadb1151017ba8e9578b351c5e}{yh\+\_\+begin\+\_\+create\+\_\+session\+\_\+ext()} \\
\hline
{\em key\+\_\+senc} & Session encryption key used to encrypt the messages exchanged with the device \\
\hline
{\em key\+\_\+senc\+\_\+len} & Lenght of the encryption key. Must be \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN} \\
\hline
{\em key\+\_\+smac} & Session MAC key used for creating the authentication tag for each message \\
\hline
{\em key\+\_\+smac\+\_\+len} & Length of the MAC key. Must be \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN} \\
\hline
{\em key\+\_\+srmac} & Session return MAC key used for creating the authentication tag for each response message \\
\hline
{\em key\+\_\+srmac\+\_\+len} & Length of the return MAC key. Must be \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN} \\
\hline
{\em card\+\_\+cryptogram} & Card cryptogram \\
\hline
{\em card\+\_\+cryptogram\+\_\+len} & Length of card cryptogram\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or any of the key lengths are not \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Session.html}{\texttt{ Session}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00847}{847}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ TODO(adma):\ remove\ all\ these}}
\DoxyCodeLine{00852\ }
\DoxyCodeLine{00853\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ key\_senc\ ==\ NULL\ ||}
\DoxyCodeLine{00854\ \ \ \ \ \ \ key\_senc\_len\ !=\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}\ ||\ key\_smac\ ==\ NULL\ ||}
\DoxyCodeLine{00855\ \ \ \ \ \ \ key\_smac\_len\ !=\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}\ ||\ key\_srmac\ ==\ NULL\ ||}
\DoxyCodeLine{00856\ \ \ \ \ \ \ key\_srmac\_len\ !=\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}\ ||\ card\_cryptogram\ ==\ NULL\ ||}
\DoxyCodeLine{00857\ \ \ \ \ \ \ card\_cryptogram\_len\ !=\ \mbox{\hyperlink{scp_8h_afa9d0a3bb1ce2a7951ca1b5f9f06dbe7}{SCP\_CARD\_CRYPTO\_LEN}})\ \{}
\DoxyCodeLine{00858\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00860\ \ \ \}}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.s\_enc,\ key\_senc,\ key\_senc\_len);}
\DoxyCodeLine{00865\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.s\_mac,\ key\_smac,\ key\_smac\_len);}
\DoxyCodeLine{00866\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.s\_rmac,\ key\_srmac,\ key\_srmac\_len);}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.s\_enc,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \textcolor{stringliteral}{"{}S-\/ENC:\ "{}});}
\DoxyCodeLine{00869\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.s\_mac,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \textcolor{stringliteral}{"{}S-\/MAC:\ "{}});}
\DoxyCodeLine{00870\ \ \ \mbox{\hyperlink{debug__lib_8h_a81b33f0d4ec623bff78e988d14388d60}{DBG\_INT}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.s\_rmac,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \textcolor{stringliteral}{"{}S-\/RMAC:\ "{}});}
\DoxyCodeLine{00871\ }
\DoxyCodeLine{00872\ \ \ \textcolor{comment}{//\ Verify\ card\ cryptogram}}
\DoxyCodeLine{00873\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ verify\_card\_cryptogram(\&\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s,\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>context,\ card\_cryptogram);}
\DoxyCodeLine{00874\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00875\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{00876\ }
\DoxyCodeLine{00877\ \ \ \ \ free(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}});}
\DoxyCodeLine{00878\ \ \ \ \ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ =\ NULL;}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00882\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00883\ \ \ \}}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Card\ cryptogram\ successfully\ verified"{}});}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00888\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=324pt]{yubihsm_8c_afbcb5c761339fbcf444be8f338b4614f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_afbcb5c761339fbcf444be8f338b4614f_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_acb5d5e9a2718b9427269f7d267ca25b9}\index{yubihsm.c@{yubihsm.c}!yh\_get\_connector\_address@{yh\_get\_connector\_address}}
\index{yh\_get\_connector\_address@{yh\_get\_connector\_address}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_get\_connector\_address()}{yh\_get\_connector\_address()}}
{\footnotesize\ttfamily \label{yubihsm_8c_acb5d5e9a2718b9427269f7d267ca25b9} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+get\+\_\+connector\+\_\+address (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{char \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}const}]{address}{}\end{DoxyParamCaption})}

Get connector address


\begin{DoxyParams}{Parameters}
{\em connector} & Connector currently in use \\
\hline
{\em address} & Pointer to the connector address as string\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00926}{926}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00927\ }
\DoxyCodeLine{00928\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ address\ ==\ NULL)\ \{}
\DoxyCodeLine{00929\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00930\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00931\ \ \ \}}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ *address\ =\ (\textcolor{keywordtype}{char}\ *)\ connector-\/>\mbox{\hyperlink{structyh__connector_a72b90da1f0e2f5b24ba1d2ce503754ff}{address}};}
\DoxyCodeLine{00934\ }
\DoxyCodeLine{00935\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00936\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=312pt]{yubihsm_8c_acb5d5e9a2718b9427269f7d267ca25b9_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=286pt]{yubihsm_8c_acb5d5e9a2718b9427269f7d267ca25b9_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a2b9f4070a103724b241e0a2b6a56d1ba}\index{yubihsm.c@{yubihsm.c}!yh\_get\_connector\_version@{yh\_get\_connector\_version}}
\index{yh\_get\_connector\_version@{yh\_get\_connector\_version}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_get\_connector\_version()}{yh\_get\_connector\_version()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a2b9f4070a103724b241e0a2b6a56d1ba} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+get\+\_\+connector\+\_\+version (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{major}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{minor}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{patch}{}\end{DoxyParamCaption})}

Get the connector version


\begin{DoxyParams}{Parameters}
{\em connector} & Connector currently in use \\
\hline
{\em major} & Connector major version \\
\hline
{\em minor} & Connector minor version \\
\hline
{\em patch} & Connector patch version\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00911}{911}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00913\ }
\DoxyCodeLine{00914\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5bd4e4c943762926c8f653b6224cced2}{major}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae2f416b0a34b7beb4ed3873d791ac393}{minor}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a00c54fad5fef8d31eb75c1163468005b}{patch}}\ ==\ NULL)\ \{}
\DoxyCodeLine{00915\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00916\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00917\ \ \ \}}
\DoxyCodeLine{00918\ }
\DoxyCodeLine{00919\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a5bd4e4c943762926c8f653b6224cced2}{major}}\ =\ connector-\/>\mbox{\hyperlink{structyh__connector_af9b0901bc659e7e0c22d76e350bc7269}{version\_major}};}
\DoxyCodeLine{00920\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ae2f416b0a34b7beb4ed3873d791ac393}{minor}}\ =\ connector-\/>\mbox{\hyperlink{structyh__connector_ab53147f120dfdfa7f19882b8631401ce}{version\_minor}};}
\DoxyCodeLine{00921\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a00c54fad5fef8d31eb75c1163468005b}{patch}}\ =\ connector-\/>\mbox{\hyperlink{structyh__connector_a888c95a32a81c6c6e62f336214e965fa}{version\_patch}};}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00923\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00924\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=309pt]{yubihsm_8c_a2b9f4070a103724b241e0a2b6a56d1ba_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=283pt]{yubihsm_8c_a2b9f4070a103724b241e0a2b6a56d1ba_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a375000f12ac554eb8cbaa0e6b75c3a08}\index{yubihsm.c@{yubihsm.c}!yh\_get\_key\_bitlength@{yh\_get\_key\_bitlength}}
\index{yh\_get\_key\_bitlength@{yh\_get\_key\_bitlength}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_get\_key\_bitlength()}{yh\_get\_key\_bitlength()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a375000f12ac554eb8cbaa0e6b75c3a08} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+get\+\_\+key\+\_\+bitlength (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}

Get the expected key length of a key generated by the given algorithm


\begin{DoxyParams}{Parameters}
{\em algorithm} & Algorithm to check. See \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm} \\
\hline
{\em result} & Expected bitlength of a key generated by the algorithm\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if {\ttfamily result} is NULL or if the algorithm is no supported by Yubi\+HSM 2. For a list of supported algorithms, see \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm} 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04309}{4309}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04310\ }
\DoxyCodeLine{04311\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ NULL)\ \{}
\DoxyCodeLine{04312\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04313\ \ \ \}}
\DoxyCodeLine{04314\ }
\DoxyCodeLine{04315\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{04316\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\_ALGO\_RSA\_2048}}:}
\DoxyCodeLine{04317\ \ \ \ \ \ \ *result\ =\ 2048;}
\DoxyCodeLine{04318\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04319\ }
\DoxyCodeLine{04320\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\_ALGO\_RSA\_3072}}:}
\DoxyCodeLine{04321\ \ \ \ \ \ \ *result\ =\ 3072;}
\DoxyCodeLine{04322\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04323\ }
\DoxyCodeLine{04324\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\_ALGO\_RSA\_4096}}:}
\DoxyCodeLine{04325\ \ \ \ \ \ \ *result\ =\ 4096;}
\DoxyCodeLine{04326\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04327\ }
\DoxyCodeLine{04328\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\_ALGO\_EC\_P256}}:}
\DoxyCodeLine{04329\ \ \ \ \ \ \ *result\ =\ 256;}
\DoxyCodeLine{04330\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04331\ }
\DoxyCodeLine{04332\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\_ALGO\_EC\_P384}}:}
\DoxyCodeLine{04333\ \ \ \ \ \ \ *result\ =\ 384;}
\DoxyCodeLine{04334\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04335\ }
\DoxyCodeLine{04336\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\_ALGO\_EC\_P521}}:}
\DoxyCodeLine{04337\ \ \ \ \ \ \ *result\ =\ 521;}
\DoxyCodeLine{04338\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04339\ }
\DoxyCodeLine{04340\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\_ALGO\_EC\_P224}}:}
\DoxyCodeLine{04341\ \ \ \ \ \ \ *result\ =\ 224;}
\DoxyCodeLine{04342\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04343\ }
\DoxyCodeLine{04344\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\_ALGO\_EC\_K256}}:}
\DoxyCodeLine{04345\ \ \ \ \ \ \ *result\ =\ 256;}
\DoxyCodeLine{04346\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04347\ }
\DoxyCodeLine{04348\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\_ALGO\_EC\_BP256}}:}
\DoxyCodeLine{04349\ \ \ \ \ \ \ *result\ =\ 256;}
\DoxyCodeLine{04350\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04351\ }
\DoxyCodeLine{04352\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\_ALGO\_EC\_BP384}}:}
\DoxyCodeLine{04353\ \ \ \ \ \ \ *result\ =\ 394;}
\DoxyCodeLine{04354\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04355\ }
\DoxyCodeLine{04356\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\_ALGO\_EC\_BP512}}:}
\DoxyCodeLine{04357\ \ \ \ \ \ \ *result\ =\ 512;}
\DoxyCodeLine{04358\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04359\ }
\DoxyCodeLine{04360\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa942e65c8cd0034eebe9a20c2297c7b06}{YH\_ALGO\_HMAC\_SHA1}}:}
\DoxyCodeLine{04361\ \ \ \ \ \ \ *result\ =\ 160;}
\DoxyCodeLine{04362\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04363\ }
\DoxyCodeLine{04364\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab0a0e1eb424b61057f159f1e53311f5c}{YH\_ALGO\_HMAC\_SHA256}}:}
\DoxyCodeLine{04365\ \ \ \ \ \ \ *result\ =\ 256;}
\DoxyCodeLine{04366\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04367\ }
\DoxyCodeLine{04368\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa781e7ca62563917d2129bde8ec53401b}{YH\_ALGO\_HMAC\_SHA384}}:}
\DoxyCodeLine{04369\ \ \ \ \ \ \ *result\ =\ 384;}
\DoxyCodeLine{04370\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04371\ }
\DoxyCodeLine{04372\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa72d6c7ea77f10e39bbadc8b58d55b9ec}{YH\_ALGO\_HMAC\_SHA512}}:}
\DoxyCodeLine{04373\ \ \ \ \ \ \ *result\ =\ 512;}
\DoxyCodeLine{04374\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04375\ }
\DoxyCodeLine{04376\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{04377\ \ \ \ \ \ \ *result\ =\ 0;}
\DoxyCodeLine{04378\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04379\ \ \ \}}
\DoxyCodeLine{04380\ }
\DoxyCodeLine{04381\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04382\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=253pt]{yubihsm_8c_a375000f12ac554eb8cbaa0e6b75c3a08_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aeabf472faf1ba8d963b39866e04df6b0}\index{yubihsm.c@{yubihsm.c}!yh\_get\_session\_id@{yh\_get\_session\_id}}
\index{yh\_get\_session\_id@{yh\_get\_session\_id}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_get\_session\_id()}{yh\_get\_session\_id()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aeabf472faf1ba8d963b39866e04df6b0} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+get\+\_\+session\+\_\+id (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{sid}{}\end{DoxyParamCaption})}

Get the session ID


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em sid} & Session ID\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02915}{2915}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02916\ }
\DoxyCodeLine{02917\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ sid\ ==\ NULL)\ \{}
\DoxyCodeLine{02918\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02919\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02920\ \ \ \}}
\DoxyCodeLine{02921\ }
\DoxyCodeLine{02922\ \ \ *sid\ =\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>s.sid;}
\DoxyCodeLine{02923\ }
\DoxyCodeLine{02924\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02925\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=276pt]{yubihsm_8c_aeabf472faf1ba8d963b39866e04df6b0_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aeabf472faf1ba8d963b39866e04df6b0_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a17d49ccb12b100e98d8b99585a705444}\index{yubihsm.c@{yubihsm.c}!yh\_get\_verbosity@{yh\_get\_verbosity}}
\index{yh\_get\_verbosity@{yh\_get\_verbosity}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_get\_verbosity()}{yh\_get\_verbosity()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a17d49ccb12b100e98d8b99585a705444} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+get\+\_\+verbosity (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{verbosity}{}\end{DoxyParamCaption})}

Get verbosity level when executing commands


\begin{DoxyParams}{Parameters}
{\em verbosity} & The verbosity level\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if seccessful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if verbosity is NULL
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\doxylink{yubihsm_8h_aa11030bbf6092d8934236958e9478084}{YH\+\_\+\+VERB\+\_\+\+QUIET}, \doxylink{yubihsm_8h_af507fefd9d19bfd531277a6c6cb56452}{YH\+\_\+\+VERB\+\_\+\+INTERMEDIATE}, \doxylink{yubihsm_8h_a8881b983de3922f9abb5d1fcc99216e2}{YH\+\_\+\+VERB\+\_\+\+CRYPTO}, \doxylink{yubihsm_8h_a4ead07ea7b1232808085d4bdbc7eb5b9}{YH\+\_\+\+VERB\+\_\+\+RAW}, \doxylink{yubihsm_8h_a2ac0b183de01f2dc9f64372e6c66bba4}{YH\+\_\+\+VERB\+\_\+\+INFO}, \doxylink{yubihsm_8h_a978bb82a3974b6778aadb56fa450e8ca}{YH\+\_\+\+VERB\+\_\+\+ERR}, \doxylink{yubihsm_8h_a15dbe0ac973691939ca6e9148b181ccd}{YH\+\_\+\+VERB\+\_\+\+ALL} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03837}{3837}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03837\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03838\ }
\DoxyCodeLine{03839\ \ \ \textcolor{keywordflow}{if}\ (verbosity\ ==\ NULL)\ \{}
\DoxyCodeLine{03840\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03841\ \ \ \}}
\DoxyCodeLine{03842\ }
\DoxyCodeLine{03843\ \ \ *verbosity\ =\ \mbox{\hyperlink{debug__lib_8h_a4ba5f59460a312e3f5f14926f4b2299e}{\_yh\_verbosity}};}
\DoxyCodeLine{03844\ }
\DoxyCodeLine{03845\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03846\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a17d49ccb12b100e98d8b99585a705444_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a5392844a98c6220c69fe08d3dcf8f1bc}\index{yubihsm.c@{yubihsm.c}!yh\_init@{yh\_init}}
\index{yh\_init@{yh\_init}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_init()}{yh\_init()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a5392844a98c6220c69fe08d3dcf8f1bc} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}

Global library initialization

\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03857}{3857}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03858\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{debug__lib_8h_a76ba6bc136c2b38b71a9e3c56282cd3a}{\_yh\_output}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03859\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a76ba6bc136c2b38b71a9e3c56282cd3a}{\_yh\_output}}\ =\ stderr;}
\DoxyCodeLine{03860\ \ \ \}}
\DoxyCodeLine{03861\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03862\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=291pt]{yubihsm_8c_a5392844a98c6220c69fe08d3dcf8f1bc_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a9c700747902a722d6c1d2073277de294}\index{yubihsm.c@{yubihsm.c}!yh\_init\_connector@{yh\_init\_connector}}
\index{yh\_init\_connector@{yh\_init\_connector}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_init\_connector()}{yh\_init\_connector()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a9c700747902a722d6c1d2073277de294} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+init\+\_\+connector (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{url}{, }\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{connector}{}\end{DoxyParamCaption})}

Instantiate a new connector


\begin{DoxyParams}{Parameters}
{\em url} & URL associated with this connector \\
\hline
{\em connector} & Connector to the device\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if either the URL or the connector are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a39fbc5bce29b178582419ae9d31ad252}{YHR\+\_\+\+GENERIC\+\_\+\+ERROR} if failed to load the backend. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a75ea079345046cdbf5612bf9065d8711}{YHR\+\_\+\+MEMORY\+\_\+\+ERROR} if failed to allocate memory for the connector. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae4f6537a9d33914ea06c53b015d92ca8}{YHR\+\_\+\+CONNECTION\+\_\+\+ERROR} if failed to create the connector 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04024}{4024}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04025\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{programs_2clio_2main_8cpp_aa03c1ef4c41f36b048cf58d5aade7653}{url}}\ ==\ NULL\ ||\ connector\ ==\ NULL)\ \{}
\DoxyCodeLine{04026\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Invalid\ parameters:\ undefined\ pointer"{}});}
\DoxyCodeLine{04027\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04028\ \ \ \}}
\DoxyCodeLine{04029\ }
\DoxyCodeLine{04030\ \textcolor{preprocessor}{\#ifdef\ STATIC}}
\DoxyCodeLine{04031\ \textcolor{preprocessor}{\#define\ USB\_LIB\ STATIC\_USB\_BACKEND}}
\DoxyCodeLine{04032\ \textcolor{preprocessor}{\#define\ HTTP\_LIB\ STATIC\_HTTP\_BACKEND}}
\DoxyCodeLine{04033\ \textcolor{preprocessor}{\#elif\ defined\ WIN32}}
\DoxyCodeLine{04034\ \textcolor{preprocessor}{\#define\ USB\_LIB\ "{}libyubihsm\_usb.dll"{}}}
\DoxyCodeLine{04035\ \textcolor{preprocessor}{\#define\ HTTP\_LIB\ "{}libyubihsm\_http.dll"{}}}
\DoxyCodeLine{04036\ \textcolor{preprocessor}{\#elif\ defined\ \_\_APPLE\_\_}}
\DoxyCodeLine{04037\ \textcolor{preprocessor}{\#define\ USB\_LIB\ "{}libyubihsm\_usb."{}\ SOVERSION\ "{}.dylib"{}}}
\DoxyCodeLine{04038\ \textcolor{preprocessor}{\#define\ HTTP\_LIB\ "{}libyubihsm\_http."{}\ SOVERSION\ "{}.dylib"{}}}
\DoxyCodeLine{04039\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{04040\ \textcolor{preprocessor}{\#define\ USB\_LIB\ "{}libyubihsm\_usb.so."{}\ SOVERSION}}
\DoxyCodeLine{04041\ \textcolor{preprocessor}{\#define\ HTTP\_LIB\ "{}libyubihsm\_http.so."{}\ SOVERSION}}
\DoxyCodeLine{04042\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{04043\ }
\DoxyCodeLine{04044\ \ \ \textcolor{keywordtype}{void}\ *backend\ =\ NULL;}
\DoxyCodeLine{04045\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structbackend__functions}{backend\_functions}}\ *bf\ =\ NULL;}
\DoxyCodeLine{04046\ }
\DoxyCodeLine{04047\ \ \ \textcolor{keywordflow}{if}\ (strncmp(\mbox{\hyperlink{programs_2clio_2main_8cpp_aa03c1ef4c41f36b048cf58d5aade7653}{url}},\ \mbox{\hyperlink{yubihsm_8h_a4c5f4e9bfa0e29ea9b0d951c9c928c90}{YH\_USB\_URL\_SCHEME}},\ strlen(\mbox{\hyperlink{yubihsm_8h_a4c5f4e9bfa0e29ea9b0d951c9c928c90}{YH\_USB\_URL\_SCHEME}}))\ ==\ 0)\ \{}
\DoxyCodeLine{04048\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Loading\ usb\ backend"{}});}
\DoxyCodeLine{04049\ \ \ \ \ load\_backend(\mbox{\hyperlink{yubihsm_8c_a02343c4c03f60828514b2a220ea3e9c1}{USB\_LIB}},\ \&backend,\ \&bf);}
\DoxyCodeLine{04050\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strncmp(\mbox{\hyperlink{programs_2clio_2main_8cpp_aa03c1ef4c41f36b048cf58d5aade7653}{url}},\ \textcolor{stringliteral}{"{}http://"{}},\ strlen(\textcolor{stringliteral}{"{}http://"{}}))\ ==\ 0\ ||}
\DoxyCodeLine{04051\ \ \ \ \ \ \ \ \ \ \ \ \ \ strncmp(\mbox{\hyperlink{programs_2clio_2main_8cpp_aa03c1ef4c41f36b048cf58d5aade7653}{url}},\ \textcolor{stringliteral}{"{}https://"{}},\ strlen(\textcolor{stringliteral}{"{}https://"{}}))\ ==\ 0)\ \{}
\DoxyCodeLine{04052\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Loading\ http\ backend"{}});}
\DoxyCodeLine{04053\ \ \ \ \ load\_backend(\mbox{\hyperlink{yubihsm_8c_ac8bfb55db13a8e48927730381cc57822}{HTTP\_LIB}},\ \&backend,\ \&bf);}
\DoxyCodeLine{04054\ \ \ \}}
\DoxyCodeLine{04055\ \ \ \textcolor{keywordflow}{if}\ (bf\ ==\ NULL)\ \{}
\DoxyCodeLine{04056\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ loading\ the\ backend"{}});}
\DoxyCodeLine{04057\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a39fbc5bce29b178582419ae9d31ad252}{YHR\_GENERIC\_ERROR}};}
\DoxyCodeLine{04058\ \ \ \}}
\DoxyCodeLine{04059\ }
\DoxyCodeLine{04060\ \ \ \textcolor{keywordflow}{return}\ create\_connector(connector,\ \mbox{\hyperlink{programs_2clio_2main_8cpp_aa03c1ef4c41f36b048cf58d5aade7653}{url}},\ backend,\ bf);}
\DoxyCodeLine{04061\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9c700747902a722d6c1d2073277de294_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a3032a8f45bfad36ed6157b0158dd7921}\index{yubihsm.c@{yubihsm.c}!yh\_is\_ec@{yh\_is\_ec}}
\index{yh\_is\_ec@{yh\_is\_ec}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_is\_ec()}{yh\_is\_ec()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a3032a8f45bfad36ed6157b0158dd7921} 
bool yh\+\_\+is\+\_\+ec (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Check if an algorithm is a supported Elliptic Curve algorithm.

Supported EC algorithms\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P224}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P521}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+K256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP384} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP512}


\begin{DoxyParams}{Parameters}
{\em algorithm} & Algorithm to check. See \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the algorithm is one of the supported EC algorithms. False otherwise 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04260}{4260}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04261\ }
\DoxyCodeLine{04262\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{04263\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\_ALGO\_EC\_P224}}:}
\DoxyCodeLine{04264\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\_ALGO\_EC\_P256}}:}
\DoxyCodeLine{04265\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\_ALGO\_EC\_P384}}:}
\DoxyCodeLine{04266\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\_ALGO\_EC\_P521}}:}
\DoxyCodeLine{04267\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\_ALGO\_EC\_K256}}:}
\DoxyCodeLine{04268\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\_ALGO\_EC\_BP256}}:}
\DoxyCodeLine{04269\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\_ALGO\_EC\_BP384}}:}
\DoxyCodeLine{04270\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\_ALGO\_EC\_BP512}}:}
\DoxyCodeLine{04271\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{04272\ }
\DoxyCodeLine{04273\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{04274\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04275\ \ \ \}}
\DoxyCodeLine{04276\ }
\DoxyCodeLine{04277\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04278\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a3032a8f45bfad36ed6157b0158dd7921_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a16fbf4426acbf42695c4ec4738b6ae8a}\index{yubihsm.c@{yubihsm.c}!yh\_is\_ed@{yh\_is\_ed}}
\index{yh\_is\_ed@{yh\_is\_ed}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_is\_ed()}{yh\_is\_ed()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a16fbf4426acbf42695c4ec4738b6ae8a} 
bool yh\+\_\+is\+\_\+ed (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Check if an algorithm is a supported ED algorithm.

Supported ED algorithms\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+ED25519}


\begin{DoxyParams}{Parameters}
{\em algorithm} & algorithm. See \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the algorithm is \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+ED25519}. False otherwise 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04280}{4280}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04281\ }
\DoxyCodeLine{04282\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{04283\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\_ALGO\_EC\_ED25519}}:}
\DoxyCodeLine{04284\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{04285\ }
\DoxyCodeLine{04286\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{04287\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04288\ \ \ \}}
\DoxyCodeLine{04289\ }
\DoxyCodeLine{04290\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04291\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a16fbf4426acbf42695c4ec4738b6ae8a_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_acb19de78e7d1aed72abbed5c74c676bc}\index{yubihsm.c@{yubihsm.c}!yh\_is\_hmac@{yh\_is\_hmac}}
\index{yh\_is\_hmac@{yh\_is\_hmac}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_is\_hmac()}{yh\_is\_hmac()}}
{\footnotesize\ttfamily \label{yubihsm_8c_acb19de78e7d1aed72abbed5c74c676bc} 
bool yh\+\_\+is\+\_\+hmac (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Check if algorithm is a supported HMAC algorithm.

Supported HMAC algorithms\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa942e65c8cd0034eebe9a20c2297c7b06}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA1}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab0a0e1eb424b61057f159f1e53311f5c}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa781e7ca62563917d2129bde8ec53401b}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA384} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa72d6c7ea77f10e39bbadc8b58d55b9ec}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA512}


\begin{DoxyParams}{Parameters}
{\em algorithm} & Algorithm to check. See \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the algorithm is one of the supported HMAC algorithms. False otherwise 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04293}{4293}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04294\ }
\DoxyCodeLine{04295\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{04296\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa942e65c8cd0034eebe9a20c2297c7b06}{YH\_ALGO\_HMAC\_SHA1}}:}
\DoxyCodeLine{04297\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab0a0e1eb424b61057f159f1e53311f5c}{YH\_ALGO\_HMAC\_SHA256}}:}
\DoxyCodeLine{04298\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa781e7ca62563917d2129bde8ec53401b}{YH\_ALGO\_HMAC\_SHA384}}:}
\DoxyCodeLine{04299\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa72d6c7ea77f10e39bbadc8b58d55b9ec}{YH\_ALGO\_HMAC\_SHA512}}:}
\DoxyCodeLine{04300\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{04301\ }
\DoxyCodeLine{04302\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{04303\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04304\ \ \ \}}
\DoxyCodeLine{04305\ }
\DoxyCodeLine{04306\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04307\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_acb19de78e7d1aed72abbed5c74c676bc_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a0a67155f2a7970ecb52e4f6aac6bbe84}\index{yubihsm.c@{yubihsm.c}!yh\_is\_rsa@{yh\_is\_rsa}}
\index{yh\_is\_rsa@{yh\_is\_rsa}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_is\_rsa()}{yh\_is\_rsa()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a0a67155f2a7970ecb52e4f6aac6bbe84} 
bool yh\+\_\+is\+\_\+rsa (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Check if an algorithm is a supported RSA algorithm.

Supported RSA algorithms\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+2048}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+3072} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+4096}


\begin{DoxyParams}{Parameters}
{\em algorithm} & Algorithm to check. See \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if the algorithm is one of the supported RSA algorithms . False otherwise 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04245}{4245}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04246\ }
\DoxyCodeLine{04247\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{04248\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\_ALGO\_RSA\_2048}}:}
\DoxyCodeLine{04249\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\_ALGO\_RSA\_3072}}:}
\DoxyCodeLine{04250\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\_ALGO\_RSA\_4096}}:}
\DoxyCodeLine{04251\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{04252\ }
\DoxyCodeLine{04253\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{04254\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04255\ \ \ \}}
\DoxyCodeLine{04256\ }
\DoxyCodeLine{04257\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04258\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a0a67155f2a7970ecb52e4f6aac6bbe84_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_afcca1608845e7a783d41d8ffd6aac8ed}\index{yubihsm.c@{yubihsm.c}!yh\_merge\_capabilities@{yh\_merge\_capabilities}}
\index{yh\_merge\_capabilities@{yh\_merge\_capabilities}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_merge\_capabilities()}{yh\_merge\_capabilities()}}
{\footnotesize\ttfamily \label{yubihsm_8c_afcca1608845e7a783d41d8ffd6aac8ed} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+merge\+\_\+capabilities (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{a}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{b}{, }\item[{\mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}

Merge two sets of capabilities. The resulting set of capabilities contain all capabilities from both arrays


\begin{DoxyParams}{Parameters}
{\em a} & Array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities} \\
\hline
{\em b} & Array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities} \\
\hline
{\em result} & Resulting array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Capability.html}{\texttt{ Capability}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04219}{4219}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04221\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ ==\ NULL\ ||\ b\ ==\ NULL\ ||\ result\ ==\ NULL)\ \{}
\DoxyCodeLine{04222\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04223\ \ \ \}}
\DoxyCodeLine{04224\ }
\DoxyCodeLine{04225\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}};\ i++)\ \{}
\DoxyCodeLine{04226\ \ \ \ \ result-\/>capabilities[i]\ =\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}-\/>capabilities[i]\ |\ b-\/>\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}}[i];}
\DoxyCodeLine{04227\ \ \ \}}
\DoxyCodeLine{04228\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04229\ \}}

\end{DoxyCode}
\Hypertarget{yubihsm_8c_a799e299be8d4c13dfa2112a60d05480d}\index{yubihsm.c@{yubihsm.c}!yh\_send\_plain\_msg@{yh\_send\_plain\_msg}}
\index{yh\_send\_plain\_msg@{yh\_send\_plain\_msg}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_send\_plain\_msg()}{yh\_send\_plain\_msg()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a799e299be8d4c13dfa2112a60d05480d} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+send\+\_\+plain\+\_\+msg (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}}}]{cmd}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{data}{, }\item[{size\+\_\+t}]{data\+\_\+len}{, }\item[{\mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}} \texorpdfstring{$\ast$}{*}}]{response\+\_\+cmd}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{response}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{response\+\_\+len}{}\end{DoxyParamCaption})}

Send a plain (unencrypted) message to the device through a connector


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to the device \\
\hline
{\em cmd} & \doxylink{struct_command}{Command} to send. See \doxylink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd} \\
\hline
{\em data} & \doxylink{struct_data}{Data} to send \\
\hline
{\em data\+\_\+len} & length of data to send \\
\hline
{\em response\+\_\+cmd} & Response command \\
\hline
{\em response} & Response data \\
\hline
{\em response\+\_\+len} & Length of response data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if the actual response was longer than response\+\_\+len. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00126}{126}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ msg;}
\DoxyCodeLine{00132\ \ \ \mbox{\hyperlink{union___msg}{Msg}}\ response\_msg;}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ (data\_len\ !=\ 0\ \&\&\ data\ ==\ NULL)\ ||}
\DoxyCodeLine{00137\ \ \ \ \ \ \ response\_cmd\ ==\ NULL\ ||\ response\ ==\ NULL\ ||\ response\_len\ ==\ NULL)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00140\ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \textcolor{keywordflow}{if}\ (data\_len\ >\ \textcolor{keyword}{sizeof}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data))\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Tried\ to\ transfer\ oversized\ data\ (\%zu\ >\ \%zu)"{}},\ data\_len,}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data));}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd\ =\ cmd;}
\DoxyCodeLine{00149\ \ \ msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ =\ data\_len;}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{if}\ (data\_len\ >\ 0)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data,\ data,\ data\_len);}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \mbox{\hyperlink{debug__lib_8h_ac9fd02aaaf96a535c1d73aefb379e4d6}{DBG\_DUMPINFO}}(msg.\mbox{\hyperlink{union___msg_aeba349af15322ba6c42fe23750437b0d}{raw}},\ data\_len\ +\ 3,\ \textcolor{stringliteral}{"{}Sending\ cmd\ \%02x\ (\%3zu\ Bytes):\ "{}},\ cmd,}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_len\ +\ 3);}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ send\_msg(connector,\ \&msg,\ \&response\_msg);}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00161\ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{if}\ (*response\_len\ <\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len)\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a741bf237335f48769194bd9e625c1d53}{DBG\_DUMPERR}}(response\_msg.\mbox{\hyperlink{union___msg_aeba349af15322ba6c42fe23750437b0d}{raw}},\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len\ +\ 3,}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\%s\ (received\ \%3d\ Bytes,\ can\ fit\ \%3zu\ Bytes)\ "{}},}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}}),\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len,}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *response\_len);}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ *response\_cmd\ =\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.cmd;}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(response,\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.data,\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len);}
\DoxyCodeLine{00174\ \ \ *response\_len\ =\ response\_msg.\mbox{\hyperlink{union___msg_a6b67958147999d1199c922c26763d7f0}{st}}.len;}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{00177\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=281pt]{yubihsm_8c_a799e299be8d4c13dfa2112a60d05480d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a799e299be8d4c13dfa2112a60d05480d_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}\index{yubihsm.c@{yubihsm.c}!yh\_send\_secure\_msg@{yh\_send\_secure\_msg}}
\index{yh\_send\_secure\_msg@{yh\_send\_secure\_msg}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_send\_secure\_msg()}{yh\_send\_secure\_msg()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+send\+\_\+secure\+\_\+msg (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}}}]{cmd}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{data}{, }\item[{size\+\_\+t}]{data\+\_\+len}{, }\item[{\mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\+\_\+cmd}} \texorpdfstring{$\ast$}{*}}]{response\+\_\+cmd}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{response}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{response\+\_\+len}{}\end{DoxyParamCaption})}

Send an encrypted message to the device over a session. The session has to be authenticated


\begin{DoxyParams}{Parameters}
{\em session} & Session to send the message over \\
\hline
{\em cmd} & \doxylink{struct_command}{Command} to send \\
\hline
{\em data} & \doxylink{struct_data}{Data} to send \\
\hline
{\em data\+\_\+len} & Length of data to send \\
\hline
{\em response\+\_\+cmd} & Response command \\
\hline
{\em response} & Response data \\
\hline
{\em response\+\_\+len} & Length of response data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00416}{416}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \textcolor{keywordtype}{size\_t}\ saved\_len\ =\ *response\_len;}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \_send\_secure\_msg(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ cmd,\ data,\ data\_len,\ response\_cmd,}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response,\ response\_len);}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ ==\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a36bb9a78d1e8eda6adcf8fb3eff2bf9d}{YHR\_DEVICE\_INVALID\_SESSION}}\ ||}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ ==\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a9fdf081102d4876da3b7bc9986cdbef8}{YHR\_DEVICE\_AUTHENTICATION\_FAILED}})\ \&\&}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>recreate)\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Recreating\ session"{}});}
\DoxyCodeLine{00428\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a0e96ea59c5f32def80843fec5a3c2142}{yh\_create\_session}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>parent,\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>authkey\_id,}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>key\_enc,\ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}-\/>key\_mac,}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}},\ \textcolor{keyword}{true},\ \&\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}});}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00433\ \ \ \ \ \}}
\DoxyCodeLine{00434\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a77870209747d5ccd90f9da3aae2bdfa8}{yh\_authenticate\_session}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}});}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00437\ \ \ \ \ \}}
\DoxyCodeLine{00438\ \ \ \ \ *response\_len\ =\ saved\_len;}
\DoxyCodeLine{00439\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \_send\_secure\_msg(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ cmd,\ data,\ data\_len,\ response\_cmd,\ response,}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response\_len);}
\DoxyCodeLine{00441\ \ \ \}}
\DoxyCodeLine{00442\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00443\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a9addbfae4cdb70b819986e7769cdd102}\index{yubihsm.c@{yubihsm.c}!yh\_set\_connector\_option@{yh\_set\_connector\_option}}
\index{yh\_set\_connector\_option@{yh\_set\_connector\_option}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_set\_connector\_option()}{yh\_set\_connector\_option()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a9addbfae4cdb70b819986e7769cdd102} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+set\+\_\+connector\+\_\+option (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a59400bce0478b88e048d5e62b2b0b015}{yh\+\_\+connector\+\_\+option}}}]{opt}{, }\item[{const void \texorpdfstring{$\ast$}{*}}]{val}{}\end{DoxyParamCaption})}

Set connector options.

Note that backend options are not supported with winhttp or USB connectors


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to set an option on \\
\hline
{\em opt} & Option to set. See \doxylink{yubihsm_8h_a59400bce0478b88e048d5e62b2b0b015}{yh\+\_\+connector\+\_\+option} \\
\hline
{\em val} & Value of the option. Type of value is specific to the given option\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the connector or the value are NULL or if the option is unknown. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad9339b4f96ca48d9c987ce1e05596fe9}{YHR\+\_\+\+CONNECTOR\+\_\+\+ERROR} if failed to set the option 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04063}{4063}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04065\ }
\DoxyCodeLine{04066\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL\ ||\ val\ ==\ NULL)\ \{}
\DoxyCodeLine{04067\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Invalid\ parameters:\ undefined\ pointer"{}});}
\DoxyCodeLine{04068\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04069\ \ \ \}}
\DoxyCodeLine{04070\ }
\DoxyCodeLine{04071\ \ \ \textcolor{keywordflow}{if}\ (connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}\ ==\ NULL)\ \{}
\DoxyCodeLine{04072\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}No\ backend\ loaded"{}});}
\DoxyCodeLine{04073\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04074\ \ \ \}}
\DoxyCodeLine{04075\ }
\DoxyCodeLine{04076\ \ \ \textcolor{keywordflow}{return}\ connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}-\/>backend\_option(connector-\/>\mbox{\hyperlink{structyh__connector_aafc44285171a0cb9b662fed6230a0648}{connection}},\ opt,\ val);}
\DoxyCodeLine{04077\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9addbfae4cdb70b819986e7769cdd102_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a7d223fd4ee6ae3f578307d72aba37a19}\index{yubihsm.c@{yubihsm.c}!yh\_set\_debug\_output@{yh\_set\_debug\_output}}
\index{yh\_set\_debug\_output@{yh\_set\_debug\_output}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_set\_debug\_output()}{yh\_set\_debug\_output()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a7d223fd4ee6ae3f578307d72aba37a19} 
void yh\+\_\+set\+\_\+debug\+\_\+output (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{FILE \texorpdfstring{$\ast$}{*}}]{output}{}\end{DoxyParamCaption})}

Set file for debug output


\begin{DoxyParams}{Parameters}
{\em connector} & If not NULL, the debug messages will be written to the specified output file \\
\hline
{\em output} & The destination of the debug messages\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03848}{3848}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03849\ \ \ \mbox{\hyperlink{debug__lib_8h_a76ba6bc136c2b38b71a9e3c56282cd3a}{\_yh\_output}}\ =\ output;}
\DoxyCodeLine{03850\ }
\DoxyCodeLine{03851\ \ \ \textcolor{keywordflow}{if}\ (connector\ !=\ NULL\ \&\&\ connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}\ !=\ NULL)\ \{}
\DoxyCodeLine{03852\ \ \ \ \ \textcolor{comment}{//\ TODO(adma):\ should\ we\ error\ out\ if\ NULL?}}
\DoxyCodeLine{03853\ \ \ \ \ connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}-\/>backend\_set\_verbosity(\mbox{\hyperlink{debug__lib_8h_a4ba5f59460a312e3f5f14926f4b2299e}{\_yh\_verbosity}},\ \mbox{\hyperlink{debug__lib_8h_a76ba6bc136c2b38b71a9e3c56282cd3a}{\_yh\_output}});}
\DoxyCodeLine{03854\ \ \ \}}
\DoxyCodeLine{03855\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7d223fd4ee6ae3f578307d72aba37a19_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a24c3146e51242256af505961e763f417}\index{yubihsm.c@{yubihsm.c}!yh\_set\_verbosity@{yh\_set\_verbosity}}
\index{yh\_set\_verbosity@{yh\_set\_verbosity}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_set\_verbosity()}{yh\_set\_verbosity()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a24c3146e51242256af505961e763f417} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+set\+\_\+verbosity (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}}]{verbosity}{}\end{DoxyParamCaption})}

Set verbosity level when executing commands. Default verbosity is \doxylink{yubihsm_8h_aa11030bbf6092d8934236958e9478084}{YH\+\_\+\+VERB\+\_\+\+QUIET}

This function may be called prior to global library initialization to set the debug level


\begin{DoxyParams}{Parameters}
{\em connector} & If not NULL, the verbosity of the specific connector will be set \\
\hline
{\em verbosity} & The desired level of debug output\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS}
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\doxylink{yubihsm_8h_aa11030bbf6092d8934236958e9478084}{YH\+\_\+\+VERB\+\_\+\+QUIET}, \doxylink{yubihsm_8h_af507fefd9d19bfd531277a6c6cb56452}{YH\+\_\+\+VERB\+\_\+\+INTERMEDIATE}, \doxylink{yubihsm_8h_a8881b983de3922f9abb5d1fcc99216e2}{YH\+\_\+\+VERB\+\_\+\+CRYPTO}, \doxylink{yubihsm_8h_a4ead07ea7b1232808085d4bdbc7eb5b9}{YH\+\_\+\+VERB\+\_\+\+RAW}, \doxylink{yubihsm_8h_a2ac0b183de01f2dc9f64372e6c66bba4}{YH\+\_\+\+VERB\+\_\+\+INFO}, \doxylink{yubihsm_8h_a978bb82a3974b6778aadb56fa450e8ca}{YH\+\_\+\+VERB\+\_\+\+ERR}, \doxylink{yubihsm_8h_a15dbe0ac973691939ca6e9148b181ccd}{YH\+\_\+\+VERB\+\_\+\+ALL} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03825}{3825}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03825\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03826\ }
\DoxyCodeLine{03827\ \ \ \mbox{\hyperlink{debug__lib_8h_a4ba5f59460a312e3f5f14926f4b2299e}{\_yh\_verbosity}}\ =\ verbosity;}
\DoxyCodeLine{03828\ }
\DoxyCodeLine{03829\ \ \ \textcolor{keywordflow}{if}\ (connector\ !=\ NULL\ \&\&\ connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}\ !=\ NULL)\ \{}
\DoxyCodeLine{03830\ \ \ \ \ \textcolor{comment}{//\ TODO(adma):\ should\ we\ error\ out\ if\ NULL?}}
\DoxyCodeLine{03831\ \ \ \ \ connector-\/>\mbox{\hyperlink{structyh__connector_a88057cfd7ee5af648c3aa315bbff7f8e}{bf}}-\/>backend\_set\_verbosity(\mbox{\hyperlink{debug__lib_8h_a4ba5f59460a312e3f5f14926f4b2299e}{\_yh\_verbosity}},\ \mbox{\hyperlink{debug__lib_8h_a76ba6bc136c2b38b71a9e3c56282cd3a}{\_yh\_output}});}
\DoxyCodeLine{03832\ \ \ \}}
\DoxyCodeLine{03833\ }
\DoxyCodeLine{03834\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03835\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a24c3146e51242256af505961e763f417_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aad9943d12261cc0f0cada93cbd6d0704}\index{yubihsm.c@{yubihsm.c}!yh\_string\_to\_algo@{yh\_string\_to\_algo}}
\index{yh\_string\_to\_algo@{yh\_string\_to\_algo}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_string\_to\_algo()}{yh\_string\_to\_algo()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aad9943d12261cc0f0cada93cbd6d0704} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+string\+\_\+to\+\_\+algo (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{string}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \texorpdfstring{$\ast$}{*}}]{algo}{}\end{DoxyParamCaption})}

Convert a string to an algorithm\textquotesingle{}s numeric value


\begin{DoxyParams}{Parameters}
{\em string} & Algorithm as string. See \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm} \\
\hline
{\em algo} & Algorithm numeric value\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if the algorithm is not supported by Yubi\+HSM 2.
\end{DoxyReturn}
\begin{DoxyParagraph}{Code sample}
\begin{DoxyVerb}yh_algorithm algorithm;
//yh_string_to_algo(NULL, &algorithm) => YHR_INVALID_PARAMETERS
//yh_string_to_algo("something", NULL) => YHR_INVALID_PARAMETERS
//yh_string_to_algo("something", &algorithm) => YHR_INVALID_PARAMETERS
//yh_string_to_algo("rsa-pkcs1-sha1", &algorithm) =>
\end{DoxyVerb}
 YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+\+PKCS1\+\_\+\+SHA1 //yh\+\_\+string\+\_\+to\+\_\+algo("{}rsa2048"{}, \&algorithm) =\texorpdfstring{$>$}{>} YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+2048
\end{DoxyParagraph}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Algorithms.html}{\texttt{ Algorithms}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04403}{4403}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04404\ }
\DoxyCodeLine{04405\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{string}\ ==\ NULL\ ||\ algo\ ==\ NULL)\ \{}
\DoxyCodeLine{04406\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04407\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04408\ \ \ \}}
\DoxyCodeLine{04409\ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(\textcolor{keywordtype}{string},\ \textcolor{stringliteral}{"{}any"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{04410\ \ \ \ \ *algo\ =\ 0;}
\DoxyCodeLine{04411\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04412\ \ \ \}}
\DoxyCodeLine{04413\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(yh\_algorithms)\ /\ \textcolor{keyword}{sizeof}(yh\_algorithms[0]);}
\DoxyCodeLine{04414\ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{04415\ \ \ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(\textcolor{keywordtype}{string},\ yh\_algorithms[i].\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}})\ ==\ 0)\ \{}
\DoxyCodeLine{04416\ \ \ \ \ \ \ *algo\ =\ yh\_algorithms[i].algorithm;}
\DoxyCodeLine{04417\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04418\ \ \ \ \ \}}
\DoxyCodeLine{04419\ \ \ \}}
\DoxyCodeLine{04420\ }
\DoxyCodeLine{04421\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04422\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=271pt]{yubihsm_8c_aad9943d12261cc0f0cada93cbd6d0704_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aad9943d12261cc0f0cada93cbd6d0704_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aab440e1cb671d9ba7a2e7d1243960e42}\index{yubihsm.c@{yubihsm.c}!yh\_string\_to\_capabilities@{yh\_string\_to\_capabilities}}
\index{yh\_string\_to\_capabilities@{yh\_string\_to\_capabilities}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_string\_to\_capabilities()}{yh\_string\_to\_capabilities()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aab440e1cb671d9ba7a2e7d1243960e42} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+string\+\_\+to\+\_\+capabilities (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{capability}{, }\item[{\mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}

Convert capability string to byte array


\begin{DoxyParams}{Parameters}
{\em capability} & String of capabilities separated by \textquotesingle{},\textquotesingle{}, \textquotesingle{}\+:\textquotesingle{} or \textquotesingle{}\texorpdfstring{$\vert$}{|}\textquotesingle{} \\
\hline
{\em result} & Array of \doxylink{structyh__capabilities}{yh\+\_\+capabilities}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if {\ttfamily capability} is too big
\end{DoxyReturn}
\begin{DoxyParagraph}{Examples\+:}

\end{DoxyParagraph}

\begin{DoxyItemize}
\item "{}get-\/opaque"{} =\texorpdfstring{$>$}{>} \{"{}\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x01"{}\}
\item "{}sign-\/hmac\+:verify-\/hmac\texorpdfstring{$\vert$}{|}exportable-\/under-\/wrap,"{} =\texorpdfstring{$>$}{>} \{"{}\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}xc1\textbackslash{}x00\textbackslash{}x00"{}\}
\item "{},,unwrap-\/data\texorpdfstring{$\vert$}{|}\+:wrap-\/data,,,"{} =\texorpdfstring{$>$}{>} \{"{}\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x60\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00\textbackslash{}x00"{}\}
\item "{}0x7fffffffffffffff"{} =\texorpdfstring{$>$}{>} \{"{}\textbackslash{}x7f\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff"{}\}
\item "{}0xffffffffffffffff"{} =\texorpdfstring{$>$}{>} \{"{}\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff\textbackslash{}xff"{}\}
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Capability.html}{\texttt{ Capability}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04115}{4115}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04117\ }
\DoxyCodeLine{04118\ \ \ \textcolor{keywordtype}{char}\ *endptr;}
\DoxyCodeLine{04119\ \ \ \textcolor{keywordtype}{char}\ *saveptr\ =\ NULL;}
\DoxyCodeLine{04120\ \ \ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{namespace_c_l_i_1_1detail_ab4542375c903302c3876ce0403d55596}{str}}\ =\ NULL;}
\DoxyCodeLine{04121\ \ \ \textcolor{keywordtype}{char}\ tmp[2048]\ =\ \{0\};}
\DoxyCodeLine{04122\ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}};}
\DoxyCodeLine{04123\ }
\DoxyCodeLine{04124\ \ \ \textcolor{keywordflow}{if}\ (capability\ ==\ NULL\ ||\ result\ ==\ NULL)\ \{}
\DoxyCodeLine{04125\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04126\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04127\ \ \ \}}
\DoxyCodeLine{04128\ }
\DoxyCodeLine{04129\ \ \ errno\ =\ 0;}
\DoxyCodeLine{04130\ \ \ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ =\ strtoull(capability,\ \&endptr,\ 0);}
\DoxyCodeLine{04131\ }
\DoxyCodeLine{04132\ \ \ \textcolor{keywordflow}{if}\ (capability\ !=\ endptr\ \&\&\ errno\ !=\ ERANGE)\ \{}
\DoxyCodeLine{04133\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ actual\ =\ \mbox{\hyperlink{yubihsm_8c_a9f4bf0773c45ad9a9753a1b784a13fbb}{htonll}}(\mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}});}
\DoxyCodeLine{04134\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(result,\ \&actual,\ 8);}
\DoxyCodeLine{04135\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04136\ \ \ \}}
\DoxyCodeLine{04137\ }
\DoxyCodeLine{04138\ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(capability,\ \textcolor{stringliteral}{"{}all"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{04139\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(result-\/>capabilities,\ 0xff,\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{04140\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04141\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strcasecmp(capability,\ \textcolor{stringliteral}{"{}none"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{04142\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(result-\/>capabilities,\ 0x00,\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{04143\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04144\ \ \ \}}
\DoxyCodeLine{04145\ }
\DoxyCodeLine{04146\ \ \ \textcolor{keywordflow}{if}\ (strlen(capability)\ >\ \textcolor{keyword}{sizeof}(tmp))\ \{}
\DoxyCodeLine{04147\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{04148\ \ \ \}}
\DoxyCodeLine{04149\ \ \ strncpy(tmp,\ capability,\ \textcolor{keyword}{sizeof}(tmp)\ -\/\ 1);}
\DoxyCodeLine{04150\ }
\DoxyCodeLine{04151\ \ \ \textcolor{keywordflow}{while}\ ((str\ =\ strtok\_r(str\ ?\ NULL\ :\ tmp,\ \mbox{\hyperlink{yubihsm_8c_ab62526d2d58f00a4d33d306db1a39507}{LIST\_SEPARATORS}},\ \&saveptr)))\ \{}
\DoxyCodeLine{04152\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(yh\_capability)\ /\ \textcolor{keyword}{sizeof}(yh\_capability[0]);}
\DoxyCodeLine{04153\ \ \ \ \ \ \ \ \ \ i++)\ \{}
\DoxyCodeLine{04154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(str,\ yh\_capability[i].\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}})\ ==\ 0)\ \{}
\DoxyCodeLine{04155\ \ \ \ \ \ \ \ \ result}
\DoxyCodeLine{04156\ \ \ \ \ \ \ \ \ \ \ -\/>capabilities[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}\ -\/\ 1\ -\/\ yh\_capability[i].bit\ /\ 8]\ |=}
\DoxyCodeLine{04157\ \ \ \ \ \ \ \ \ \ \ 1ULL\ <<\ (yh\_capability[i].bit\ \%\ 8);}
\DoxyCodeLine{04158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{04159\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (i\ +\ 1\ ==\ \textcolor{keyword}{sizeof}(yh\_capability)\ /\ \textcolor{keyword}{sizeof}(yh\_capability[0]))\ \{}
\DoxyCodeLine{04160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04161\ \ \ \ \ \ \ \}}
\DoxyCodeLine{04162\ \ \ \ \ \}}
\DoxyCodeLine{04163\ \ \ \}}
\DoxyCodeLine{04164\ }
\DoxyCodeLine{04165\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04166\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=302pt]{yubihsm_8c_aab440e1cb671d9ba7a2e7d1243960e42_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aab440e1cb671d9ba7a2e7d1243960e42_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a96a4c751a281515d5610adb8fd779438}\index{yubihsm.c@{yubihsm.c}!yh\_string\_to\_domains@{yh\_string\_to\_domains}}
\index{yh\_string\_to\_domains@{yh\_string\_to\_domains}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_string\_to\_domains()}{yh\_string\_to\_domains()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a96a4c751a281515d5610adb8fd779438} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+string\+\_\+to\+\_\+domains (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{domains}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}

Convert a string to a domain\textquotesingle{}s numeric value.

The domains string can contain one or several domains separated by \textquotesingle{},\textquotesingle{}, \textquotesingle{}\+:\textquotesingle{} or \textquotesingle{}\texorpdfstring{$\vert$}{|}\textquotesingle{}. Each domain can be written in decimal or hex format


\begin{DoxyParams}{Parameters}
{\em domains} & String of domains \\
\hline
{\em result} & Resulting parsed domains as an unsigned int\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL, if the domains string is does not contains the expected values
\end{DoxyReturn}
\begin{DoxyParagraph}{Examples}

\end{DoxyParagraph}

\begin{DoxyItemize}
\item "{}1"{} =\texorpdfstring{$>$}{>} 1
\item "{}1,2\+:3,4\texorpdfstring{$\vert$}{|}5,6;7,8,9,10,11,12,13,14,15,16"{} =\texorpdfstring{$>$}{>} 0xffff
\item "{}1,16"{} =\texorpdfstring{$>$}{>} 0x8001
\item "{}16"{} =\texorpdfstring{$>$}{>} 0x8000
\item "{}16,15"{} =\texorpdfstring{$>$}{>} 0xc000
\item "{}1,0xf"{} =\texorpdfstring{$>$}{>} 0x4001
\item "{}0x1,0x2"{} =\texorpdfstring{$>$}{>} 3
\item "{}0x8888"{} =\texorpdfstring{$>$}{>} 0x8888
\item "{}0"{} =\texorpdfstring{$>$}{>} 0
\item "{}all"{} =\texorpdfstring{$>$}{>} 0xffff
\item "{}2"{} =\texorpdfstring{$>$}{>} 2
\item "{}2\+:4"{} =\texorpdfstring{$>$}{>} 10
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Domain.html}{\texttt{ Domains}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04535}{4535}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04536\ \ \ \textcolor{keywordtype}{char}\ *endptr;}
\DoxyCodeLine{04537\ \ \ \textcolor{keywordtype}{char}\ *saveptr\ =\ NULL;}
\DoxyCodeLine{04538\ \ \ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{namespace_c_l_i_1_1detail_ab4542375c903302c3876ce0403d55596}{str}}\ =\ NULL;}
\DoxyCodeLine{04539\ \ \ \textcolor{keywordtype}{char}\ tmp[64]\ =\ \{0\};}
\DoxyCodeLine{04540\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}};}
\DoxyCodeLine{04541\ }
\DoxyCodeLine{04542\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}\ ==\ NULL\ ||\ result\ ==\ NULL)\ \{}
\DoxyCodeLine{04543\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04544\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04545\ \ \ \}}
\DoxyCodeLine{04546\ \ \ *result\ =\ 0;}
\DoxyCodeLine{04547\ }
\DoxyCodeLine{04548\ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \textcolor{stringliteral}{"{}all"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{04549\ \ \ \ \ *result\ =\ 0xffff;}
\DoxyCodeLine{04550\ \ \ \ \ \textcolor{keywordflow}{goto}\ out;}
\DoxyCodeLine{04551\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strcmp(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \textcolor{stringliteral}{"{}0"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{04552\ \ \ \ \ \textcolor{keywordflow}{goto}\ out;}
\DoxyCodeLine{04553\ \ \ \}}
\DoxyCodeLine{04554\ }
\DoxyCodeLine{04555\ \ \ errno\ =\ 0;}
\DoxyCodeLine{04556\ \ \ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ =\ strtoul(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \&endptr,\ 0);}
\DoxyCodeLine{04557\ }
\DoxyCodeLine{04558\ \ \ \textcolor{keywordflow}{if}\ (strncmp(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \textcolor{stringliteral}{"{}0x"{}},\ 2)\ ==\ 0\ \&\&\ *endptr\ ==\ \textcolor{charliteral}{'\(\backslash\)0'}\ \&\&\ errno\ !=\ ERANGE\ \&\&}
\DoxyCodeLine{04559\ \ \ \ \ \ \ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ !=\ ULONG\_MAX)\ \{}
\DoxyCodeLine{04560\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ >\ USHRT\_MAX)\ \{}
\DoxyCodeLine{04561\ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Tried\ to\ parse\ to\ long\ number\ for\ domains"{}});}
\DoxyCodeLine{04562\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04563\ \ \ \ \ \}}
\DoxyCodeLine{04564\ \ \ \ \ *result\ =\ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}};}
\DoxyCodeLine{04565\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{04566\ \ \ \ \ \textcolor{keywordflow}{if}\ (strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}})\ >\ \textcolor{keyword}{sizeof}(tmp))\ \{}
\DoxyCodeLine{04567\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{04568\ \ \ \ \ \}}
\DoxyCodeLine{04569\ \ \ \ \ strncpy(tmp,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \textcolor{keyword}{sizeof}(tmp)\ -\/\ 1);}
\DoxyCodeLine{04570\ }
\DoxyCodeLine{04571\ \ \ \ \ \textcolor{keywordflow}{while}\ ((str\ =\ strtok\_r(str\ ?\ NULL\ :\ tmp,\ \mbox{\hyperlink{yubihsm_8c_ab62526d2d58f00a4d33d306db1a39507}{LIST\_SEPARATORS}},\ \&saveptr)))\ \{}
\DoxyCodeLine{04572\ \ \ \ \ \ \ endptr\ =\ NULL;}
\DoxyCodeLine{04573\ \ \ \ \ \ \ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ =\ strtoul(str,\ \&endptr,\ 0);}
\DoxyCodeLine{04574\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (errno\ ==\ ERANGE\ ||\ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ >\ \mbox{\hyperlink{yubihsm_8h_aedf3b950c50f82299eddf54d0338dd60}{YH\_MAX\_DOMAINS}}\ ||\ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ ==\ 0)\ \{}
\DoxyCodeLine{04575\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Domains\ are\ numbered\ from\ 1\ to\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_aedf3b950c50f82299eddf54d0338dd60}{YH\_MAX\_DOMAINS}});}
\DoxyCodeLine{04576\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04577\ \ \ \ \ \ \ \}}
\DoxyCodeLine{04578\ \ \ \ \ \ \ *result\ |=\ 1\ <<\ (\mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}}\ -\/\ 1);}
\DoxyCodeLine{04579\ \ \ \ \ \}}
\DoxyCodeLine{04580\ \ \ \}}
\DoxyCodeLine{04581\ }
\DoxyCodeLine{04582\ out:}
\DoxyCodeLine{04583\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Domains\ parsed\ as\ \%x"{}},\ *result);}
\DoxyCodeLine{04584\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04585\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=290pt]{yubihsm_8c_a96a4c751a281515d5610adb8fd779438_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a96a4c751a281515d5610adb8fd779438_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a5464c7a6ad858c1e4e42e588b406c2d3}\index{yubihsm.c@{yubihsm.c}!yh\_string\_to\_option@{yh\_string\_to\_option}}
\index{yh\_string\_to\_option@{yh\_string\_to\_option}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_string\_to\_option()}{yh\_string\_to\_option()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a5464c7a6ad858c1e4e42e588b406c2d3} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+string\+\_\+to\+\_\+option (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{string}{, }\item[{\mbox{\hyperlink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option}} \texorpdfstring{$\ast$}{*}}]{option}{}\end{DoxyParamCaption})}

Convert a string to an option\textquotesingle{}s numeric value


\begin{DoxyParams}{Parameters}
{\em string} & Option as string. See \doxylink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option} \\
\hline
{\em option} & Option numeric value\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if the option was not recognized.
\end{DoxyReturn}
\begin{DoxyParagraph}{Code sample}
\begin{DoxyVerb}yh_option option;
//yh_string_to_option(NULL, &option) => YHR_INVALID_PARAMETERS
//yh_string_to_option("something", NULL) => YHR_INVALID_PARAMETERS
//yh_string_to_option("something", &option) => YHR_INVALID_PARAMETERS
//yh_string_to_option("force-audit", &option) =>
\end{DoxyVerb}
 option=YH\+\_\+\+OPTION\+\_\+\+FORCE\+\_\+\+AUDIT
\end{DoxyParagraph}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Options.html}{\texttt{ Options}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04463}{4463}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04464\ }
\DoxyCodeLine{04465\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{string}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}}\ ==\ NULL)\ \{}
\DoxyCodeLine{04466\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04467\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04468\ \ \ \}}
\DoxyCodeLine{04469\ }
\DoxyCodeLine{04470\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(yh\_options)\ /\ \textcolor{keyword}{sizeof}(yh\_options[0]);\ i++)\ \{}
\DoxyCodeLine{04471\ \ \ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(\textcolor{keywordtype}{string},\ yh\_options[i].\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}})\ ==\ 0)\ \{}
\DoxyCodeLine{04472\ \ \ \ \ \ \ *\mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}}\ =\ yh\_options[i].option;}
\DoxyCodeLine{04473\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04474\ \ \ \ \ \}}
\DoxyCodeLine{04475\ \ \ \}}
\DoxyCodeLine{04476\ }
\DoxyCodeLine{04477\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04478\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=279pt]{yubihsm_8c_a5464c7a6ad858c1e4e42e588b406c2d3_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5464c7a6ad858c1e4e42e588b406c2d3_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a57cdfa4b6224bd2c4a8bab24513475d8}\index{yubihsm.c@{yubihsm.c}!yh\_string\_to\_type@{yh\_string\_to\_type}}
\index{yh\_string\_to\_type@{yh\_string\_to\_type}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_string\_to\_type()}{yh\_string\_to\_type()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a57cdfa4b6224bd2c4a8bab24513475d8} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+string\+\_\+to\+\_\+type (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{string}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} \texorpdfstring{$\ast$}{*}}]{type}{}\end{DoxyParamCaption})}

Convert a string to a type\textquotesingle{}s numeric value


\begin{DoxyParams}{Parameters}
{\em string} & Type as a String. See \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type} \\
\hline
{\em type} & Type numeric value\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if the type was not recognized.
\end{DoxyReturn}
\begin{DoxyParagraph}{Code sample}
\begin{DoxyVerb}yh_object_type type;
//yh_string_to_type(NULL, &type) => YHR_INVALID_PARAMETERS
//yh_string_to_type("something", NULL) => YHR_INVALID_PARAMETERS
//yh_string_to_type("something", &type) => YHR_INVALID_PARAMETERS
//yh_string_to_type("opaque", &type) => type=YH_OPAQUE
//yh_string_to_type("authentication-key", &type) =>
\end{DoxyVerb}
 type=YH\+\_\+\+AUTHENTICATION\+\_\+\+KEY
\end{DoxyParagraph}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Object}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04442}{4442}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04443\ }
\DoxyCodeLine{04444\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{string}\ ==\ NULL\ ||\ type\ ==\ NULL)\ \{}
\DoxyCodeLine{04445\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04446\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04447\ \ \ \}}
\DoxyCodeLine{04448\ }
\DoxyCodeLine{04449\ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(\textcolor{keywordtype}{string},\ \textcolor{stringliteral}{"{}any"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{04450\ \ \ \ \ *type\ =\ 0;}
\DoxyCodeLine{04451\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04452\ \ \ \}}
\DoxyCodeLine{04453\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(yh\_types)\ /\ \textcolor{keyword}{sizeof}(yh\_types[0]);\ i++)\ \{}
\DoxyCodeLine{04454\ \ \ \ \ \textcolor{keywordflow}{if}\ (strcasecmp(\textcolor{keywordtype}{string},\ yh\_types[i].\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}})\ ==\ 0)\ \{}
\DoxyCodeLine{04455\ \ \ \ \ \ \ *type\ =\ yh\_types[i].type;}
\DoxyCodeLine{04456\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04457\ \ \ \ \ \}}
\DoxyCodeLine{04458\ \ \ \}}
\DoxyCodeLine{04459\ }
\DoxyCodeLine{04460\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04461\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=272pt]{yubihsm_8c_a57cdfa4b6224bd2c4a8bab24513475d8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a57cdfa4b6224bd2c4a8bab24513475d8_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_afe3d701f7470c1d7b05480e4b6728bf7}\index{yubihsm.c@{yubihsm.c}!yh\_type\_to\_string@{yh\_type\_to\_string}}
\index{yh\_type\_to\_string@{yh\_type\_to\_string}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_type\_to\_string()}{yh\_type\_to\_string()}}
{\footnotesize\ttfamily \label{yubihsm_8c_afe3d701f7470c1d7b05480e4b6728bf7} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+type\+\_\+to\+\_\+string (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}}}]{type}{, }\item[{char const \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{result}{}\end{DoxyParamCaption})}

Convert a \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type} to its string representation


\begin{DoxyParams}{Parameters}
{\em type} & Type to convert. See \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type} \\
\hline
{\em result} & The type as a String. "{}\+Unknown"{} if the type was not recognized\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if {\ttfamily result} is NULL.
\end{DoxyReturn}
\begin{DoxyParagraph}{Code sample}
\begin{DoxyVerb}const char *string;
//yh_type_to_string(0, NULL) => YHR_INVALID_PARAMETERS
//yh_type_to_string(99, &string) => string="Unknown"
//yh_type_to_string(YH_OPAQUE, &string) => string="opaque"
//yh_type_to_string(YH_AUTHENTICATION_KEY, &string) =>
\end{DoxyVerb}
 string="{}authentication-\/key"{}
\end{DoxyParagraph}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Object}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04424}{4424}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04425\ }
\DoxyCodeLine{04426\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ NULL)\ \{}
\DoxyCodeLine{04427\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{04428\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{04429\ \ \ \}}
\DoxyCodeLine{04430\ }
\DoxyCodeLine{04431\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(yh\_types)\ /\ \textcolor{keyword}{sizeof}(yh\_types[0]);\ i++)\ \{}
\DoxyCodeLine{04432\ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ yh\_types[i].type)\ \{}
\DoxyCodeLine{04433\ \ \ \ \ \ \ *result\ =\ yh\_types[i].name;}
\DoxyCodeLine{04434\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04435\ \ \ \ \ \}}
\DoxyCodeLine{04436\ \ \ \}}
\DoxyCodeLine{04437\ }
\DoxyCodeLine{04438\ \ \ *result\ =\ \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{04439\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{04440\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=272pt]{yubihsm_8c_afe3d701f7470c1d7b05480e4b6728bf7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_afe3d701f7470c1d7b05480e4b6728bf7_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ad112fe09ee88d595333fa87e8059717b}\index{yubihsm.c@{yubihsm.c}!yh\_util\_blink\_device@{yh\_util\_blink\_device}}
\index{yh\_util\_blink\_device@{yh\_util\_blink\_device}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_blink\_device()}{yh\_util\_blink\_device()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ad112fe09ee88d595333fa87e8059717b} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+blink\+\_\+device (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}}}]{seconds}{}\end{DoxyParamCaption})}

Blink the LED of the device to identify it


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em seconds} & Number of seconds to blink\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03766}{3766}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03767\ }
\DoxyCodeLine{03768\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03769\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03770\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03771\ \ \ \}}
\DoxyCodeLine{03772\ }
\DoxyCodeLine{03773\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03774\ }
\DoxyCodeLine{03775\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[5];}
\DoxyCodeLine{03776\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03777\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03778\ }
\DoxyCodeLine{03779\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_BLINK\_DEVICE,\ \&seconds,\ \textcolor{keyword}{sizeof}(seconds),}
\DoxyCodeLine{03780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response,\ \&response\_len);}
\DoxyCodeLine{03781\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03782\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ BLINK\ DEVICE\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03783\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03784\ \ \ \}}
\DoxyCodeLine{03785\ }
\DoxyCodeLine{03786\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03787\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{03788\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ blink\ the\ device:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03789\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{03790\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03791\ \ \ \}}
\DoxyCodeLine{03792\ }
\DoxyCodeLine{03793\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03794\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ad112fe09ee88d595333fa87e8059717b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ad112fe09ee88d595333fa87e8059717b_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a8f229874e387887d7c5b4c7e6e07db8e}\index{yubihsm.c@{yubihsm.c}!yh\_util\_change\_authentication\_key@{yh\_util\_change\_authentication\_key}}
\index{yh\_util\_change\_authentication\_key@{yh\_util\_change\_authentication\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_change\_authentication\_key()}{yh\_util\_change\_authentication\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a8f229874e387887d7c5b4c7e6e07db8e} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+change\+\_\+authentication\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+enc}{, }\item[{size\+\_\+t}]{key\+\_\+enc\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+mac}{, }\item[{size\+\_\+t}]{key\+\_\+mac\+\_\+len}{}\end{DoxyParamCaption})}

Replace the long lived encryption key and MAC key associated with an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583acee44b775b3c5b6157f0732699935074}{YH\+\_\+\+AUTHENTICATION\+\_\+\+KEY} in the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key to replace \\
\hline
{\em key\+\_\+enc} & New long lived encryption key \\
\hline
{\em key\+\_\+enc\+\_\+len} & Length of the new encryption key. Must be \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN} \\
\hline
{\em key\+\_\+mac} & New long lived MAC key \\
\hline
{\em key\+\_\+mac\+\_\+len} & Length of the new MAC key. Must be \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if {\ttfamily key\+\_\+enc\+\_\+len} or {\ttfamily key\+\_\+mac\+\_\+len} are not the expected values. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Authentication Key}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03094}{3094}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03099\ }
\DoxyCodeLine{03100\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ key\_enc\ ==\ NULL\ ||}
\DoxyCodeLine{03101\ \ \ \ \ \ \ key\_enc\_len\ !=\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}\ ||\ key\_mac\ ==\ NULL\ ||}
\DoxyCodeLine{03102\ \ \ \ \ \ \ key\_mac\_len\ !=\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}})\ \{}
\DoxyCodeLine{03103\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03104\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03105\ \ \ \}}
\DoxyCodeLine{03106\ }
\DoxyCodeLine{03107\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03108\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03109\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03110\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03111\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{03112\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_enc[\mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}];}
\DoxyCodeLine{03113\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_mac[\mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}];}
\DoxyCodeLine{03114\ \ \ \ \ \};}
\DoxyCodeLine{03115\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03116\ \ \ \}\ data;}
\DoxyCodeLine{03117\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03118\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03119\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03120\ \ \ \ \ \};}
\DoxyCodeLine{03121\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03122\ \ \ \}\ response;}
\DoxyCodeLine{03123\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03124\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03125\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03126\ }
\DoxyCodeLine{03127\ \ \ data.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03128\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa461952ba18e7fcd792e480f71c853513}{YH\_ALGO\_AES128\_YUBICO\_AUTHENTICATION}};}
\DoxyCodeLine{03129\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.key\_enc,\ key\_enc,\ key\_enc\_len);}
\DoxyCodeLine{03130\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.key\_mac,\ key\_mac,\ key\_mac\_len);}
\DoxyCodeLine{03131\ }
\DoxyCodeLine{03132\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_CHANGE\_AUTHENTICATION\_KEY,}
\DoxyCodeLine{03133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data.buf,\ \textcolor{keyword}{sizeof}(data),\ \&response\_cmd,}
\DoxyCodeLine{03134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response.buf,\ \&response\_len);}
\DoxyCodeLine{03135\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ \textcolor{keyword}{sizeof}(data));}
\DoxyCodeLine{03136\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03137\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ CHANGE\ AUTHENTICATION\ KEY\ command:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{03138\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03139\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03140\ \ \ \}}
\DoxyCodeLine{03141\ }
\DoxyCodeLine{03142\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03143\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{03144\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ change\ authentication\ key:\ \%s\ (\%x)\(\backslash\)n"{}},}
\DoxyCodeLine{03145\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ response.buf[0]);}
\DoxyCodeLine{03146\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03147\ \ \ \}}
\DoxyCodeLine{03148\ }
\DoxyCodeLine{03149\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{03150\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Changed\ Authentication\ key\ 0x\%04x"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03151\ }
\DoxyCodeLine{03152\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03153\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a8f229874e387887d7c5b4c7e6e07db8e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a8f229874e387887d7c5b4c7e6e07db8e_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a8761bd8bcffcee4af737bda255ce5e53}\index{yubihsm.c@{yubihsm.c}!yh\_util\_change\_authentication\_key\_derived@{yh\_util\_change\_authentication\_key\_derived}}
\index{yh\_util\_change\_authentication\_key\_derived@{yh\_util\_change\_authentication\_key\_derived}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_change\_authentication\_key\_derived()}{yh\_util\_change\_authentication\_key\_derived()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a8761bd8bcffcee4af737bda255ce5e53} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+change\+\_\+authentication\+\_\+key\+\_\+derived (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{password}{, }\item[{size\+\_\+t}]{password\+\_\+len}{}\end{DoxyParamCaption})}

Replace the long lived encryption key and MAC key associated with an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583acee44b775b3c5b6157f0732699935074}{YH\+\_\+\+AUTHENTICATION\+\_\+\+KEY} in the device with keys derived from a password


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key to replace \\
\hline
{\em password} & Password to derive the new encryption key and MAC key \\
\hline
{\em password\+\_\+len} & Length of password\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Authentication Key}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03155}{3155}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03159\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ password\ ==\ NULL)\ \{}
\DoxyCodeLine{03160\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03161\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03162\ \ \ \}}
\DoxyCodeLine{03163\ }
\DoxyCodeLine{03164\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_enc[\mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}];}
\DoxyCodeLine{03165\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_mac[\mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}];}
\DoxyCodeLine{03166\ }
\DoxyCodeLine{03167\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ derive\_keys(password,\ password\_len,\ key\_enc,\ key\_mac);}
\DoxyCodeLine{03168\ }
\DoxyCodeLine{03169\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ ==\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03170\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a8f229874e387887d7c5b4c7e6e07db8e}{yh\_util\_change\_authentication\_key}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ key\_enc,}
\DoxyCodeLine{03171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(key\_enc),\ key\_mac,}
\DoxyCodeLine{03172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(key\_mac));}
\DoxyCodeLine{03173\ \ \ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(key\_enc,\ \textcolor{keyword}{sizeof}(key\_enc));}
\DoxyCodeLine{03174\ \ \ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(key\_mac,\ \textcolor{keyword}{sizeof}(key\_mac));}
\DoxyCodeLine{03175\ \ \ \}}
\DoxyCodeLine{03176\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03177\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a8761bd8bcffcee4af737bda255ce5e53_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a8761bd8bcffcee4af737bda255ce5e53_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a61ab8dbab67b1cceb49cd306f8c3f4b1}\index{yubihsm.c@{yubihsm.c}!yh\_util\_close\_session@{yh\_util\_close\_session}}
\index{yh\_util\_close\_session@{yh\_util\_close\_session}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_close\_session()}{yh\_util\_close\_session()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a61ab8dbab67b1cceb49cd306f8c3f4b1} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+close\+\_\+session (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{}\end{DoxyParamCaption})}

Close a session


\begin{DoxyParams}{Parameters}
{\em session} & Session to close\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01257}{1257}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01258\ }
\DoxyCodeLine{01259\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01260\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01261\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01262\ \ \ \}}
\DoxyCodeLine{01263\ }
\DoxyCodeLine{01264\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01265\ }
\DoxyCodeLine{01266\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[5];}
\DoxyCodeLine{01267\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{01268\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01269\ }
\DoxyCodeLine{01270\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_CLOSE\_SESSION,\ NULL,\ 0,\ \&response\_cmd,}
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response,\ \&response\_len);}
\DoxyCodeLine{01272\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01273\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ CLOSE\ SESSION\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01274\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01275\ \ \ \}}
\DoxyCodeLine{01276\ }
\DoxyCodeLine{01277\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01278\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{01279\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ close\ session:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{01281\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01282\ \ \ \}}
\DoxyCodeLine{01283\ }
\DoxyCodeLine{01284\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01285\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a61ab8dbab67b1cceb49cd306f8c3f4b1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a61ab8dbab67b1cceb49cd306f8c3f4b1_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a82d295a02d9eb628f6dea4b4c01fdec4}\index{yubihsm.c@{yubihsm.c}!yh\_util\_create\_otp\_aead@{yh\_util\_create\_otp\_aead}}
\index{yh\_util\_create\_otp\_aead@{yh\_util\_create\_otp\_aead}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_create\_otp\_aead()}{yh\_util\_create\_otp\_aead()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a82d295a02d9eb628f6dea4b4c01fdec4} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+create\+\_\+otp\+\_\+aead (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{private\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Create a Yubico OTP AEAD using the provided data


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the Otp-\/aead Key to use \\
\hline
{\em key} & OTP key \\
\hline
{\em private\+\_\+id} & OTP private id \\
\hline
{\em out} & The created AEAD \\
\hline
{\em out\+\_\+len} & Length of the created AEAD\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03179}{3179}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03182\ }
\DoxyCodeLine{03183\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ key\ ==\ NULL\ ||\ private\_id\ ==\ NULL\ ||\ out\ ==\ NULL\ ||}
\DoxyCodeLine{03184\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03185\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03186\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03187\ \ \ \}}
\DoxyCodeLine{03188\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03189\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03190\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03191\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03192\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key[16];}
\DoxyCodeLine{03193\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ private\_id[6];}
\DoxyCodeLine{03194\ \ \ \ \ \};}
\DoxyCodeLine{03195\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03196\ \ \ \}\ data;}
\DoxyCodeLine{03197\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03198\ }
\DoxyCodeLine{03199\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03200\ }
\DoxyCodeLine{03201\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03202\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.key,\ key,\ \textcolor{keyword}{sizeof}(data.key));}
\DoxyCodeLine{03203\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.private\_id,\ private\_id,\ \textcolor{keyword}{sizeof}(data.private\_id));}
\DoxyCodeLine{03204\ }
\DoxyCodeLine{03205\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_CREATE\_OTP\_AEAD,\ data.buf,}
\DoxyCodeLine{03206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(data),\ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{03207\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ \textcolor{keyword}{sizeof}(data));}
\DoxyCodeLine{03208\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03209\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ CREATE\ OTP\ AEAD\ command:\ \%s\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03210\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03211\ \ \ \}}
\DoxyCodeLine{03212\ }
\DoxyCodeLine{03213\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03214\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{03215\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ OTP\ AEAD:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03216\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{03217\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03218\ \ \ \}}
\DoxyCodeLine{03219\ }
\DoxyCodeLine{03220\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03221\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a82d295a02d9eb628f6dea4b4c01fdec4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a82d295a02d9eb628f6dea4b4c01fdec4_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aa939f8764ed0cca27884d9c8f640ac14}\index{yubihsm.c@{yubihsm.c}!yh\_util\_decrypt\_oaep@{yh\_util\_decrypt\_oaep}}
\index{yh\_util\_decrypt\_oaep@{yh\_util\_decrypt\_oaep}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_decrypt\_oaep()}{yh\_util\_decrypt\_oaep()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aa939f8764ed0cca27884d9c8f640ac14} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+decrypt\+\_\+oaep (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{size\+\_\+t}]{label\+\_\+len}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{mgf1\+Algo}{}\end{DoxyParamCaption})}

Decrypt data using RSA-\/\+OAEP


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the RSA key to use for decryption \\
\hline
{\em in} & Encrypted data \\
\hline
{\em in\+\_\+len} & Length of encrypted data. Must be 256, 384 or 512 \\
\hline
{\em out} & Decrypted data \\
\hline
{\em out\+\_\+len} & Length of decrypted data \\
\hline
{\em label} & OAEP label \\
\hline
{\em label\+\_\+len} & Length of OAEP label. Must be 20, 32, 48 or 64 \\
\hline
{\em mgf1\+Algo} & MGF1 algorithm\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\+\_\+\+WRONG\+\_\+\+LENGTH} if {\ttfamily in\+\_\+len} or {\ttfamily label\+\_\+len} are not what expected. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02107}{2107}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02111\ }
\DoxyCodeLine{02112\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL\ ||}
\DoxyCodeLine{02113\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02114\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02115\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02116\ \ \ \}}
\DoxyCodeLine{02117\ }
\DoxyCodeLine{02118\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02119\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02120\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02121\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02122\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ mgf1Algo;}
\DoxyCodeLine{02123\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{02124\ \ \ \ \ \};}
\DoxyCodeLine{02125\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02126\ \ \ \}\ data;}
\DoxyCodeLine{02127\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02128\ }
\DoxyCodeLine{02129\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02130\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02131\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ =\ 0;}
\DoxyCodeLine{02132\ }
\DoxyCodeLine{02133\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02134\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ +=\ \textcolor{keyword}{sizeof}(data.key\_id);}
\DoxyCodeLine{02135\ }
\DoxyCodeLine{02136\ \ \ data.mgf1Algo\ =\ mgf1Algo;}
\DoxyCodeLine{02137\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ +=\ \textcolor{keyword}{sizeof}(data.mgf1Algo);}
\DoxyCodeLine{02138\ }
\DoxyCodeLine{02139\ \ \ \textcolor{comment}{//\ in\_len\ has\ to\ match\ the\ rsa\ key\ size}}
\DoxyCodeLine{02140\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ !=\ 256\ \&\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ !=\ 384\ \&\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ !=\ 512)\ \{}
\DoxyCodeLine{02141\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Wrong\ input\ length"{}});}
\DoxyCodeLine{02142\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\_WRONG\_LENGTH}};}
\DoxyCodeLine{02143\ \ \ \}}
\DoxyCodeLine{02144\ }
\DoxyCodeLine{02145\ \ \ \textcolor{comment}{//\ label\_len\ is\ hashed\ and\ specified\ the\ mgf\ hash}}
\DoxyCodeLine{02146\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_ae76ac4adc41ec92427b4a14cd3385c1b}{label\_len}}\ !=\ 20\ \&\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae76ac4adc41ec92427b4a14cd3385c1b}{label\_len}}\ !=\ 32\ \&\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae76ac4adc41ec92427b4a14cd3385c1b}{label\_len}}\ !=\ 48\ \&\&}
\DoxyCodeLine{02147\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae76ac4adc41ec92427b4a14cd3385c1b}{label\_len}}\ !=\ 64)\ \{}
\DoxyCodeLine{02148\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Wrong\ label\ length"{}});}
\DoxyCodeLine{02149\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\_WRONG\_LENGTH}};}
\DoxyCodeLine{02150\ \ \ \}}
\DoxyCodeLine{02151\ }
\DoxyCodeLine{02152\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{02153\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ +=\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}};}
\DoxyCodeLine{02154\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes\ +\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae76ac4adc41ec92427b4a14cd3385c1b}{label\_len}});}
\DoxyCodeLine{02155\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ +=\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae76ac4adc41ec92427b4a14cd3385c1b}{label\_len}};}
\DoxyCodeLine{02156\ }
\DoxyCodeLine{02157\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_DECRYPT\_OAEP,\ data.buf,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}},}
\DoxyCodeLine{02158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{02159\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02160\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ DECRYPT\ OAEP\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02161\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02162\ \ \ \}}
\DoxyCodeLine{02163\ }
\DoxyCodeLine{02164\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02165\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{02166\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ decrypted\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02167\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{02168\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02169\ \ \ \}}
\DoxyCodeLine{02170\ }
\DoxyCodeLine{02171\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02172\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa939f8764ed0cca27884d9c8f640ac14_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa939f8764ed0cca27884d9c8f640ac14_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a3677afe2209a1cae31f70a304e260e28}\index{yubihsm.c@{yubihsm.c}!yh\_util\_decrypt\_otp@{yh\_util\_decrypt\_otp}}
\index{yh\_util\_decrypt\_otp@{yh\_util\_decrypt\_otp}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_decrypt\_otp()}{yh\_util\_decrypt\_otp()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a3677afe2209a1cae31f70a304e260e28} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+decrypt\+\_\+otp (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{aead}{, }\item[{size\+\_\+t}]{aead\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{otp}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{use\+Ctr}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{session\+Ctr}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{tstph}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{tstpl}{}\end{DoxyParamCaption})}

Decrypt a Yubico OTP and return counters and time information.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key used for decryption \\
\hline
{\em aead} & AEAD as created by \doxylink{yubihsm_8h_a82d295a02d9eb628f6dea4b4c01fdec4}{yh\+\_\+util\+\_\+create\+\_\+otp\+\_\+aead()} or \doxylink{yubihsm_8h_a4bb1d420f681bc91bd36dc08695dbad6}{yh\+\_\+util\+\_\+randomize\+\_\+otp\+\_\+aead()} \\
\hline
{\em aead\+\_\+len} & Length of AEAD \\
\hline
{\em otp} & OTP \\
\hline
{\em use\+Ctr} & OTP use counter \\
\hline
{\em session\+Ctr} & OTP session counter \\
\hline
{\em tstph} & OTP timestamp high \\
\hline
{\em tstpl} & OTP timestamp low\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03261}{3261}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03266\ }
\DoxyCodeLine{03267\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03268\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03269\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03270\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03271\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ aead[6\ +\ 16\ +\ 6\ +\ 8];\ \textcolor{comment}{//\ FIXME:\ ya..\ magic\ numbers!}}
\DoxyCodeLine{03272\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubico__otp_8c_ab1e1d61db8c48d537faca71988a7c123}{otp}}[16];}
\DoxyCodeLine{03273\ \ \ \ \ \};}
\DoxyCodeLine{03274\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03275\ \ \ \}\ data;}
\DoxyCodeLine{03276\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03277\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03278\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ useCtr;}
\DoxyCodeLine{03279\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ sessionCtr;}
\DoxyCodeLine{03280\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ tstph;}
\DoxyCodeLine{03281\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ tstpl;}
\DoxyCodeLine{03282\ \ \ \ \ \};}
\DoxyCodeLine{03283\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03284\ \ \ \}\ response;}
\DoxyCodeLine{03285\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03286\ }
\DoxyCodeLine{03287\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ aead\ ==\ NULL\ ||\ \mbox{\hyperlink{yubico__otp_8c_ab1e1d61db8c48d537faca71988a7c123}{otp}}\ ==\ NULL\ ||}
\DoxyCodeLine{03288\ \ \ \ \ \ \ aead\_len\ !=\ \textcolor{keyword}{sizeof}(data.aead))\ \{}
\DoxyCodeLine{03289\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03290\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03291\ \ \ \}}
\DoxyCodeLine{03292\ }
\DoxyCodeLine{03293\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03294\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03295\ }
\DoxyCodeLine{03296\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03297\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.aead,\ aead,\ \textcolor{keyword}{sizeof}(data.aead));}
\DoxyCodeLine{03298\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.otp,\ \mbox{\hyperlink{yubico__otp_8c_ab1e1d61db8c48d537faca71988a7c123}{otp}},\ \textcolor{keyword}{sizeof}(data.otp));}
\DoxyCodeLine{03299\ }
\DoxyCodeLine{03300\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{03301\ \ \ \ \ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_DECRYPT\_OTP,\ data.buf,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{03302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{03303\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ \textcolor{keyword}{sizeof}(data));}
\DoxyCodeLine{03304\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03305\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ DECRYPT\ OTP\ command:\ \%s\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03306\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03307\ \ \ \}}
\DoxyCodeLine{03308\ }
\DoxyCodeLine{03309\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03310\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{03311\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ decrypt\ OTP:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03312\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{03313\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03314\ \ \ \}}
\DoxyCodeLine{03315\ }
\DoxyCodeLine{03316\ \ \ \textcolor{keywordflow}{if}\ (response\_len\ !=\ \textcolor{keyword}{sizeof}(response))\ \{}
\DoxyCodeLine{03317\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Wrong\ size\ returned"{}});}
\DoxyCodeLine{03318\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\_WRONG\_LENGTH}};}
\DoxyCodeLine{03319\ \ \ \}}
\DoxyCodeLine{03320\ }
\DoxyCodeLine{03321\ \ \ \textcolor{keywordflow}{if}\ (useCtr)\ \{}
\DoxyCodeLine{03322\ \ \ \ \ *useCtr\ =\ response.useCtr;}
\DoxyCodeLine{03323\ \ \ \}}
\DoxyCodeLine{03324\ \ \ \textcolor{keywordflow}{if}\ (sessionCtr)\ \{}
\DoxyCodeLine{03325\ \ \ \ \ *sessionCtr\ =\ response.sessionCtr;}
\DoxyCodeLine{03326\ \ \ \}}
\DoxyCodeLine{03327\ \ \ \textcolor{keywordflow}{if}\ (tstph)\ \{}
\DoxyCodeLine{03328\ \ \ \ \ *tstph\ =\ response.tstph;}
\DoxyCodeLine{03329\ \ \ \}}
\DoxyCodeLine{03330\ \ \ \textcolor{keywordflow}{if}\ (tstpl)\ \{}
\DoxyCodeLine{03331\ \ \ \ \ *tstpl\ =\ response.tstpl;}
\DoxyCodeLine{03332\ \ \ \}}
\DoxyCodeLine{03333\ }
\DoxyCodeLine{03334\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03335\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a3677afe2209a1cae31f70a304e260e28_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a3677afe2209a1cae31f70a304e260e28_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a5ebf6932cd2e68b9a23787c27fde3e26}\index{yubihsm.c@{yubihsm.c}!yh\_util\_decrypt\_pkcs1v1\_5@{yh\_util\_decrypt\_pkcs1v1\_5}}
\index{yh\_util\_decrypt\_pkcs1v1\_5@{yh\_util\_decrypt\_pkcs1v1\_5}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_decrypt\_pkcs1v1\_5()}{yh\_util\_decrypt\_pkcs1v1\_5()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a5ebf6932cd2e68b9a23787c27fde3e26} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+decrypt\+\_\+pkcs1v1\+\_\+5 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Decrypt data that was encrypted using RSA-\/\+PKCS\#1v1.\+5


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the RSA key to use for decryption \\
\hline
{\em in} & Encrypted data \\
\hline
{\em in\+\_\+len} & Length of encrypted data \\
\hline
{\em out} & Decrypted data \\
\hline
{\em out\+\_\+len} & Length of decrypted data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily in\+\_\+len} is bigger than \doxylink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\+\_\+\+MSG\+\_\+\+BUF\+\_\+\+SIZE}-\/2. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02059}{2059}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02062\ }
\DoxyCodeLine{02063\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02064\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02065\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02066\ \ \ \}}
\DoxyCodeLine{02067\ }
\DoxyCodeLine{02068\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{02069\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{02070\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02071\ \ \ \}}
\DoxyCodeLine{02072\ }
\DoxyCodeLine{02073\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02074\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02075\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02076\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02077\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{02078\ \ \ \ \ \};}
\DoxyCodeLine{02079\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02080\ \ \ \}\ data;}
\DoxyCodeLine{02081\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02082\ }
\DoxyCodeLine{02083\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02084\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02085\ }
\DoxyCodeLine{02086\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02087\ }
\DoxyCodeLine{02088\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{02089\ }
\DoxyCodeLine{02090\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_DECRYPT\_PKCS1,\ data.buf,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ +\ 2,}
\DoxyCodeLine{02091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{02092\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02093\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ DECRYPT\ PKCS1\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02094\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02095\ \ \ \}}
\DoxyCodeLine{02096\ }
\DoxyCodeLine{02097\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02098\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{02099\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ decrypted\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02100\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{02101\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02102\ \ \ \}}
\DoxyCodeLine{02103\ }
\DoxyCodeLine{02104\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02105\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5ebf6932cd2e68b9a23787c27fde3e26_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5ebf6932cd2e68b9a23787c27fde3e26_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ae736702f9463878db4adfd45b6a597f9}\index{yubihsm.c@{yubihsm.c}!yh\_util\_delete\_object@{yh\_util\_delete\_object}}
\index{yh\_util\_delete\_object@{yh\_util\_delete\_object}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_delete\_object()}{yh\_util\_delete\_object()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ae736702f9463878db4adfd45b6a597f9} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+delete\+\_\+object (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{id}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}}}]{type}{}\end{DoxyParamCaption})}

Delete an object in the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em id} & Object ID of the object to delete \\
\hline
{\em type} & Type of object to delete. See \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if session is NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02222}{2222}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02224\ }
\DoxyCodeLine{02225\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02226\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02227\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02228\ \ \ \}}
\DoxyCodeLine{02229\ }
\DoxyCodeLine{02230\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02231\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02232\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02233\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}};}
\DoxyCodeLine{02234\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a1d127017fb298b889f4ba24752d08b8e}{type}};}
\DoxyCodeLine{02235\ \ \ \ \ \};}
\DoxyCodeLine{02236\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02237\ \ \ \}\ data;}
\DoxyCodeLine{02238\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02239\ }
\DoxyCodeLine{02240\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02241\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02242\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{02243\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02244\ }
\DoxyCodeLine{02245\ \ \ data.type\ =\ \mbox{\hyperlink{yubihsm_8h_a1d127017fb298b889f4ba24752d08b8e}{type}};}
\DoxyCodeLine{02246\ \ \ data.id\ =\ htons(\textcolor{keywordtype}{id});}
\DoxyCodeLine{02247\ }
\DoxyCodeLine{02248\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_DELETE\_OBJECT,\ data.buf,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{02249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response,\ \&response\_len);}
\DoxyCodeLine{02250\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02251\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ DELETE\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02252\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02253\ \ \ \}}
\DoxyCodeLine{02254\ }
\DoxyCodeLine{02255\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02256\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{02257\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ delete\ object:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02258\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{02259\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02260\ \ \ \}}
\DoxyCodeLine{02261\ }
\DoxyCodeLine{02262\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02263\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae736702f9463878db4adfd45b6a597f9_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae736702f9463878db4adfd45b6a597f9_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a2900aee87732f9ec017bd1662bcef7e9}\index{yubihsm.c@{yubihsm.c}!yh\_util\_derive\_ecdh@{yh\_util\_derive\_ecdh}}
\index{yh\_util\_derive\_ecdh@{yh\_util\_derive\_ecdh}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_derive\_ecdh()}{yh\_util\_derive\_ecdh()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a2900aee87732f9ec017bd1662bcef7e9} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+derive\+\_\+ecdh (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Derive an ECDH key from a private EC key on the device and a provided public EC key


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the EC private key to use for ECDH derivation \\
\hline
{\em in} & Public key of another EC key-\/pair \\
\hline
{\em in\+\_\+len} & Length of public key \\
\hline
{\em out} & Shared secret ECDH key \\
\hline
{\em out\+\_\+len} & Length of the shared ECDH key\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily in\+\_\+len} is bigger than \doxylink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\+\_\+\+MSG\+\_\+\+BUF\+\_\+\+SIZE}-\/2. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02174}{2174}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02177\ }
\DoxyCodeLine{02178\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02179\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02180\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02181\ \ \ \}}
\DoxyCodeLine{02182\ }
\DoxyCodeLine{02183\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{02184\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{02185\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02186\ \ \ \}}
\DoxyCodeLine{02187\ }
\DoxyCodeLine{02188\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02189\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02190\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02191\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02192\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{02193\ \ \ \ \ \};}
\DoxyCodeLine{02194\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02195\ \ \ \}\ data;}
\DoxyCodeLine{02196\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02197\ }
\DoxyCodeLine{02198\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02199\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02200\ }
\DoxyCodeLine{02201\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02202\ }
\DoxyCodeLine{02203\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{02204\ }
\DoxyCodeLine{02205\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_DERIVE\_ECDH,\ data.buf,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ +\ 2,}
\DoxyCodeLine{02206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{02207\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02208\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ DERIVE\ ECDH\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02209\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02210\ \ \ \}}
\DoxyCodeLine{02211\ }
\DoxyCodeLine{02212\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02213\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{02214\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ decrypted\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02215\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{02216\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02217\ \ \ \}}
\DoxyCodeLine{02218\ }
\DoxyCodeLine{02219\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02220\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a2900aee87732f9ec017bd1662bcef7e9_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a2900aee87732f9ec017bd1662bcef7e9_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aa3f473e6dbb9188ad0269b40921c4f5f}\index{yubihsm.c@{yubihsm.c}!yh\_util\_export\_wrapped@{yh\_util\_export\_wrapped}}
\index{yh\_util\_export\_wrapped@{yh\_util\_export\_wrapped}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_export\_wrapped()}{yh\_util\_export\_wrapped()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aa3f473e6dbb9188ad0269b40921c4f5f} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+export\+\_\+wrapped (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{wrapping\+\_\+key\+\_\+id}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}}}]{target\+\_\+type}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{target\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Export an object under wrap from the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em wrapping\+\_\+key\+\_\+id} & Object ID of the Wrap Key to use to wrap the object \\
\hline
{\em target\+\_\+type} & Type of the object to be exported. See \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type} \\
\hline
{\em target\+\_\+id} & Object ID of the object to be exported \\
\hline
{\em out} & Wrapped data \\
\hline
{\em out\+\_\+len} & Length of wrapped data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02265}{2265}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02268\ }
\DoxyCodeLine{02269\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02270\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02271\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02272\ \ \ \}}
\DoxyCodeLine{02273\ }
\DoxyCodeLine{02274\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02275\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02276\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02277\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02278\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a1d127017fb298b889f4ba24752d08b8e}{type}};}
\DoxyCodeLine{02279\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ tgt\_id;}
\DoxyCodeLine{02280\ \ \ \ \ \};}
\DoxyCodeLine{02281\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02282\ \ \ \}\ data;}
\DoxyCodeLine{02283\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02284\ }
\DoxyCodeLine{02285\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02286\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02287\ }
\DoxyCodeLine{02288\ \ \ data.key\_id\ =\ htons(wrapping\_key\_id);}
\DoxyCodeLine{02289\ \ \ data.type\ =\ (\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}})\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a16deaf35253f2106ecf4fd8003b1284f}{target\_type}};}
\DoxyCodeLine{02290\ \ \ data.tgt\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ad82e96deab6d88b5e26f9f11da9d3fa3}{target\_id}});}
\DoxyCodeLine{02291\ }
\DoxyCodeLine{02292\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_EXPORT\_WRAPPED,\ data.buf,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{02293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{02294\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02295\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ EXPORT\ WRAPPED\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02296\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02297\ \ \ \}}
\DoxyCodeLine{02298\ }
\DoxyCodeLine{02299\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02300\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{02301\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ wrapped\ object:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02302\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{02303\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02304\ \ \ \}}
\DoxyCodeLine{02305\ }
\DoxyCodeLine{02306\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02307\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa3f473e6dbb9188ad0269b40921c4f5f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa3f473e6dbb9188ad0269b40921c4f5f_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a2db9bbd57a908c5c454fc6254f57dcff}\index{yubihsm.c@{yubihsm.c}!yh\_util\_generate\_ec\_key@{yh\_util\_generate\_ec\_key}}
\index{yh\_util\_generate\_ec\_key@{yh\_util\_generate\_ec\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_generate\_ec\_key()}{yh\_util\_generate\_ec\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a2db9bbd57a908c5c454fc6254f57dcff} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+generate\+\_\+ec\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Generate an Elliptic Curve key in the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm to use to generate the EC key. Supported algorithm\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P224}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+K256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP512} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P521}.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or the algorithm is not one of \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P224}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+K256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP512} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P521}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01913}{1913}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01916\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01917\ }
\DoxyCodeLine{01918\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yubihsm_8c_a3032a8f45bfad36ed6157b0158dd7921}{yh\_is\_ec}}(\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}))\ \{}
\DoxyCodeLine{01919\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Invalid\ algorithm\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}});}
\DoxyCodeLine{01920\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01921\ \ \ \}}
\DoxyCodeLine{01922\ }
\DoxyCodeLine{01923\ \ \ \textcolor{keywordflow}{return}\ generate\_key(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}});}
\DoxyCodeLine{01924\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=295pt]{yubihsm_8c_a2db9bbd57a908c5c454fc6254f57dcff_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a2db9bbd57a908c5c454fc6254f57dcff_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a41f4326fe736e99302442d6a6109edbc}\index{yubihsm.c@{yubihsm.c}!yh\_util\_generate\_ed\_key@{yh\_util\_generate\_ed\_key}}
\index{yh\_util\_generate\_ed\_key@{yh\_util\_generate\_ed\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_generate\_ed\_key()}{yh\_util\_generate\_ed\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a41f4326fe736e99302442d6a6109edbc} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+generate\+\_\+ed\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Generate an ED key in the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label for the key. Maximum length \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the ED key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm to use to generate the ED key. Supported algorithm\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+ED25519}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or the algorithm is not \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+ED25519}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01926}{1926}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01930\ }
\DoxyCodeLine{01931\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yubihsm_8c_a16fbf4426acbf42695c4ec4738b6ae8a}{yh\_is\_ed}}(\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}))\ \{}
\DoxyCodeLine{01932\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Invalid\ algorithm\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}});}
\DoxyCodeLine{01933\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01934\ \ \ \}}
\DoxyCodeLine{01935\ }
\DoxyCodeLine{01936\ \ \ \textcolor{keywordflow}{return}\ generate\_key(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}});}
\DoxyCodeLine{01937\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=295pt]{yubihsm_8c_a41f4326fe736e99302442d6a6109edbc_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a41f4326fe736e99302442d6a6109edbc_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a1eac22853548b7ceab92550c22233b18}\index{yubihsm.c@{yubihsm.c}!yh\_util\_generate\_hmac\_key@{yh\_util\_generate\_hmac\_key}}
\index{yh\_util\_generate\_hmac\_key@{yh\_util\_generate\_hmac\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_generate\_hmac\_key()}{yh\_util\_generate\_hmac\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a1eac22853548b7ceab92550c22233b18} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+generate\+\_\+hmac\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Generate an HMAC key in the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm to use to generate the HMAC key. Supported algorithims\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa942e65c8cd0034eebe9a20c2297c7b06}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA1}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab0a0e1eb424b61057f159f1e53311f5c}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa781e7ca62563917d2129bde8ec53401b}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA384} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa72d6c7ea77f10e39bbadc8b58d55b9ec}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA512}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01992}{1992}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01996\ }
\DoxyCodeLine{01997\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||}
\DoxyCodeLine{01998\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01999\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02000\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02001\ \ \ \}}
\DoxyCodeLine{02002\ }
\DoxyCodeLine{02003\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02004\ }
\DoxyCodeLine{02005\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02006\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02007\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02008\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02009\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{02010\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{02011\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{02012\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02013\ \ \ \ \ \};}
\DoxyCodeLine{02014\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02015\ \ \ \}\ data;}
\DoxyCodeLine{02016\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02017\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02018\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02019\ \ \ \ \ \};}
\DoxyCodeLine{02020\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02021\ \ \ \}\ response;}
\DoxyCodeLine{02022\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02023\ }
\DoxyCodeLine{02024\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02025\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02026\ }
\DoxyCodeLine{02027\ \ \ data.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02028\ }
\DoxyCodeLine{02029\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02030\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02031\ }
\DoxyCodeLine{02032\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{02033\ }
\DoxyCodeLine{02034\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{02035\ }
\DoxyCodeLine{02036\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02037\ }
\DoxyCodeLine{02038\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{02039\ \ \ \ \ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GENERATE\_HMAC\_KEY,\ data.buf,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{02040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{02041\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02042\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GENERATE\ HMAC\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02043\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02044\ \ \ \}}
\DoxyCodeLine{02045\ }
\DoxyCodeLine{02046\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02047\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{02048\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ generate\ key:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02049\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{02050\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02051\ \ \ \}}
\DoxyCodeLine{02052\ }
\DoxyCodeLine{02053\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{02054\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Generated\ HMAC\ key\ 0x\%04x"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02055\ }
\DoxyCodeLine{02056\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02057\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a1eac22853548b7ceab92550c22233b18_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a1eac22853548b7ceab92550c22233b18_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a9e130d225a8dc003d7a7c0ce4b8ea5e4}\index{yubihsm.c@{yubihsm.c}!yh\_util\_generate\_otp\_aead\_key@{yh\_util\_generate\_otp\_aead\_key}}
\index{yh\_util\_generate\_otp\_aead\_key@{yh\_util\_generate\_otp\_aead\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_generate\_otp\_aead\_key()}{yh\_util\_generate\_otp\_aead\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a9e130d225a8dc003d7a7c0ce4b8ea5e4} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+generate\+\_\+otp\+\_\+aead\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{nonce\+\_\+id}{}\end{DoxyParamCaption})}

Generate an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a02c5f683fde147de6a9e1043f971f5f0}{YH\+\_\+\+OTP\+\_\+\+AEAD\+\_\+\+KEY} for Yubico OTP decryption in the device.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the AEAD Key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the AEAD Key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains the AEAD Key will be operating within. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the AEAD Key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm used to generate the AEAD Key. Supported algorithms\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa62e7ba4126ae16faeafb28972a4e0959}{YH\+\_\+\+ALGO\+\_\+\+AES128\+\_\+\+YUBICO\+\_\+\+OTP}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa62dd31db747b4b7f81d9e30877a0b720}{YH\+\_\+\+ALGO\+\_\+\+AES192\+\_\+\+YUBICO\+\_\+\+OTP} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad1558532867577d1d77c84f1ae632acd}{YH\+\_\+\+ALGO\+\_\+\+AES256\+\_\+\+YUBICO\+\_\+\+OTP} \\
\hline
{\em nonce\+\_\+id} & Nonce ID\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03422}{3422}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03426\ }
\DoxyCodeLine{03427\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{03428\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03429\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03430\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03431\ \ \ \}}
\DoxyCodeLine{03432\ }
\DoxyCodeLine{03433\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03434\ }
\DoxyCodeLine{03435\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03436\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03437\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03438\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03439\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{03440\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{03441\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{03442\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{03443\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ nonce\_id;}
\DoxyCodeLine{03444\ \ \ \ \ \};}
\DoxyCodeLine{03445\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03446\ \ \ \}\ data;}
\DoxyCodeLine{03447\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \textcolor{keyword}{sizeof}(data);}
\DoxyCodeLine{03448\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03449\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03450\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03451\ \ \ \ \ \};}
\DoxyCodeLine{03452\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03453\ \ \ \}\ response;}
\DoxyCodeLine{03454\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03455\ }
\DoxyCodeLine{03456\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03457\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03458\ }
\DoxyCodeLine{03459\ \ \ data.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03460\ }
\DoxyCodeLine{03461\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{03462\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{03463\ }
\DoxyCodeLine{03464\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{03465\ }
\DoxyCodeLine{03466\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{03467\ }
\DoxyCodeLine{03468\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{03469\ }
\DoxyCodeLine{03470\ \ \ data.nonce\_id\ =\ nonce\_id;}
\DoxyCodeLine{03471\ }
\DoxyCodeLine{03472\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{03473\ \ \ \ \ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GENERATE\_OTP\_AEAD\_KEY,\ data.buf,\ data\_len,}
\DoxyCodeLine{03474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{03475\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ data\_len);}
\DoxyCodeLine{03476\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03477\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GENERATE\ OTP\ AEAD\ KEY\ command:\ \%s"{}},}
\DoxyCodeLine{03478\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03479\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03480\ \ \ \}}
\DoxyCodeLine{03481\ }
\DoxyCodeLine{03482\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03483\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{03484\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ generate\ key:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03485\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{03486\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03487\ \ \ \}}
\DoxyCodeLine{03488\ }
\DoxyCodeLine{03489\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{03490\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Generated\ OTP\ AEAD\ key\ 0x\%04x\(\backslash\)n"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03491\ }
\DoxyCodeLine{03492\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03493\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9e130d225a8dc003d7a7c0ce4b8ea5e4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9e130d225a8dc003d7a7c0ce4b8ea5e4_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ab1c62ef2643184a8ad44c569c87712d1}\index{yubihsm.c@{yubihsm.c}!yh\_util\_generate\_rsa\_key@{yh\_util\_generate\_rsa\_key}}
\index{yh\_util\_generate\_rsa\_key@{yh\_util\_generate\_rsa\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_generate\_rsa\_key()}{yh\_util\_generate\_rsa\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ab1c62ef2643184a8ad44c569c87712d1} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+generate\+\_\+rsa\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{}\end{DoxyParamCaption})}

Generate an RSA key in the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm to use to generate the RSA key. Supported algorithms\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+2048}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+3072} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+4096}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or the algorithm is not one of \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+2048}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+3072} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+4096}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01900}{1900}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01904\ }
\DoxyCodeLine{01905\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yubihsm_8c_a0a67155f2a7970ecb52e4f6aac6bbe84}{yh\_is\_rsa}}(\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}))\ \{}
\DoxyCodeLine{01906\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Invalid\ algorithm\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}});}
\DoxyCodeLine{01907\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01908\ \ \ \}}
\DoxyCodeLine{01909\ }
\DoxyCodeLine{01910\ \ \ \textcolor{keywordflow}{return}\ generate\_key(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}});}
\DoxyCodeLine{01911\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=301pt]{yubihsm_8c_ab1c62ef2643184a8ad44c569c87712d1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ab1c62ef2643184a8ad44c569c87712d1_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a1f749a696792e7911844629e056d9c15}\index{yubihsm.c@{yubihsm.c}!yh\_util\_generate\_wrap\_key@{yh\_util\_generate\_wrap\_key}}
\index{yh\_util\_generate\_wrap\_key@{yh\_util\_generate\_wrap\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_generate\_wrap\_key()}{yh\_util\_generate\_wrap\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a1f749a696792e7911844629e056d9c15} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+generate\+\_\+wrap\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{delegated\+\_\+capabilities}{}\end{DoxyParamCaption})}

Generate a Wrap Key that can be used for export, import, wrap data and unwrap data in the device.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the Wrap Key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the Wrap Key. Maximum length \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains where the Wrap Key will be operating within. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the Wrap Key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm used to generate the Wrap Key \\
\hline
{\em delegated\+\_\+capabilities} & Delegated capabilitites of the Wrap Key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02458}{2458}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02463\ }
\DoxyCodeLine{02464\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{02465\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}\ ==\ NULL\ ||}
\DoxyCodeLine{02466\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02467\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02468\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02469\ \ \ \}}
\DoxyCodeLine{02470\ }
\DoxyCodeLine{02471\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02472\ }
\DoxyCodeLine{02473\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02474\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02475\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02476\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02477\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{02478\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{02479\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{02480\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02481\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{02482\ \ \ \ \ \};}
\DoxyCodeLine{02483\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02484\ \ \ \}\ data;}
\DoxyCodeLine{02485\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \textcolor{keyword}{sizeof}(data);}
\DoxyCodeLine{02486\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02487\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02488\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02489\ \ \ \ \ \};}
\DoxyCodeLine{02490\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02491\ \ \ \}\ response;}
\DoxyCodeLine{02492\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02493\ }
\DoxyCodeLine{02494\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02495\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02496\ }
\DoxyCodeLine{02497\ \ \ data.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02498\ }
\DoxyCodeLine{02499\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02500\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02501\ }
\DoxyCodeLine{02502\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{02503\ }
\DoxyCodeLine{02504\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{02505\ }
\DoxyCodeLine{02506\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02507\ }
\DoxyCodeLine{02508\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.delegated\_capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}},}
\DoxyCodeLine{02509\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{02510\ }
\DoxyCodeLine{02511\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GENERATE\_WRAP\_KEY,\ data.buf,\ data\_len,}
\DoxyCodeLine{02512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{02513\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02514\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GENERATE\ WRAP\ KEY\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02515\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02516\ \ \ \}}
\DoxyCodeLine{02517\ }
\DoxyCodeLine{02518\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02519\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{02520\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ generate\ key:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02521\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{02522\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02523\ \ \ \}}
\DoxyCodeLine{02524\ }
\DoxyCodeLine{02525\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{02526\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Generated\ Wrap\ key\ 0x\%04x\(\backslash\)n"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02527\ }
\DoxyCodeLine{02528\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02529\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a1f749a696792e7911844629e056d9c15_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a1f749a696792e7911844629e056d9c15_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a6ab558e1426359cc78e7a362f8b3acd9}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_device\_info@{yh\_util\_get\_device\_info}}
\index{yh\_util\_get\_device\_info@{yh\_util\_get\_device\_info}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_device\_info()}{yh\_util\_get\_device\_info()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a6ab558e1426359cc78e7a362f8b3acd9} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+device\+\_\+info (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__connector}{yh\+\_\+connector}} \texorpdfstring{$\ast$}{*}}]{connector}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{major}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{minor}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{patch}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{serial}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{log\+\_\+total}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{log\+\_\+used}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \texorpdfstring{$\ast$}{*}}]{algorithms}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{n\+\_\+algorithms}{}\end{DoxyParamCaption})}

Get device version, device serial number, supported algorithms and available log entries.


\begin{DoxyParams}{Parameters}
{\em connector} & Connector to the device \\
\hline
{\em major} & Device major version number \\
\hline
{\em minor} & Device minor version number \\
\hline
{\em patch} & Device build version number \\
\hline
{\em serial} & Device serial number \\
\hline
{\em log\+\_\+total} & Total number of log entries \\
\hline
{\em log\+\_\+used} & Number of written log entries \\
\hline
{\em algorithms} & \doxylink{struct_list}{List} of supported algorithms \\
\hline
{\em n\+\_\+algorithms} & Number of supported algorithms\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the connector is NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if n\+\_\+algorithms is smaller than the number of actually supported algorithms. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Algorithms.html}{\texttt{ Algorithms}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00938}{938}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ \ \ \textcolor{keywordflow}{if}\ (connector\ ==\ NULL)\ \{}
\DoxyCodeLine{00944\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{00945\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{00946\ \ \ \}}
\DoxyCodeLine{00947\ }
\DoxyCodeLine{00948\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00949\ }
\DoxyCodeLine{00950\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{00951\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{00952\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5bd4e4c943762926c8f653b6224cced2}{major}};}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae2f416b0a34b7beb4ed3873d791ac393}{minor}};}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a00c54fad5fef8d31eb75c1163468005b}{patch}};}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a1149ca4bd0659030412db8e77bebdf88}{serial}};}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ log\_total;}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ log\_used;}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ algorithms[\mbox{\hyperlink{yubihsm_8h_a6f472329e64b5720ed637fa886aea8c8}{YH\_MAX\_ALGORITHM\_COUNT}}];}
\DoxyCodeLine{00960\ \ \ \ \ \};}
\DoxyCodeLine{00961\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{00962\ \ \ \}\ response;}
\DoxyCodeLine{00963\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{00964\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{00965\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a799e299be8d4c13dfa2112a60d05480d}{yh\_send\_plain\_msg}}(connector,\ YHC\_GET\_DEVICE\_INFO,\ NULL,\ 0,}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{00969\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{00970\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ DEVICE\ INFO\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{00971\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{00972\ \ \ \}}
\DoxyCodeLine{00973\ }
\DoxyCodeLine{00974\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{00975\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{00976\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{00977\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{00978\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{00979\ \ \ \}}
\DoxyCodeLine{00980\ }
\DoxyCodeLine{00981\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a5bd4e4c943762926c8f653b6224cced2}{major}}\ !=\ NULL)\ \{}
\DoxyCodeLine{00982\ \ \ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a5bd4e4c943762926c8f653b6224cced2}{major}}\ =\ response.major;}
\DoxyCodeLine{00983\ \ \ \}}
\DoxyCodeLine{00984\ }
\DoxyCodeLine{00985\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_ae2f416b0a34b7beb4ed3873d791ac393}{minor}}\ !=\ NULL)\ \{}
\DoxyCodeLine{00986\ \ \ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ae2f416b0a34b7beb4ed3873d791ac393}{minor}}\ =\ response.minor;}
\DoxyCodeLine{00987\ \ \ \}}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a00c54fad5fef8d31eb75c1163468005b}{patch}}\ !=\ NULL)\ \{}
\DoxyCodeLine{00990\ \ \ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a00c54fad5fef8d31eb75c1163468005b}{patch}}\ =\ response.patch;}
\DoxyCodeLine{00991\ \ \ \}}
\DoxyCodeLine{00992\ }
\DoxyCodeLine{00993\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a1149ca4bd0659030412db8e77bebdf88}{serial}}\ !=\ NULL)\ \{}
\DoxyCodeLine{00994\ \ \ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a1149ca4bd0659030412db8e77bebdf88}{serial}}\ =\ ntohl(response.serial);}
\DoxyCodeLine{00995\ \ \ \}}
\DoxyCodeLine{00996\ }
\DoxyCodeLine{00997\ \ \ \textcolor{keywordflow}{if}\ (log\_total\ !=\ NULL)\ \{}
\DoxyCodeLine{00998\ \ \ \ \ *log\_total\ =\ response.log\_total;}
\DoxyCodeLine{00999\ \ \ \}}
\DoxyCodeLine{01000\ }
\DoxyCodeLine{01001\ \ \ \textcolor{keywordflow}{if}\ (log\_used\ !=\ NULL)\ \{}
\DoxyCodeLine{01002\ \ \ \ \ *log\_used\ =\ response.log\_used;}
\DoxyCodeLine{01003\ \ \ \}}
\DoxyCodeLine{01004\ }
\DoxyCodeLine{01005\ \ \ \textcolor{keywordflow}{if}\ (algorithms\ !=\ NULL\ \&\&\ n\_algorithms)\ \{}
\DoxyCodeLine{01006\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ items\ =\ response\_len\ -\/\ \textcolor{keyword}{sizeof}(response.major)\ -\/}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(response.minor)\ -\/\ \textcolor{keyword}{sizeof}(response.patch)\ -\/}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(response.serial)\ -\/\ \textcolor{keyword}{sizeof}(response.log\_total)\ -\/}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(response.log\_used);}
\DoxyCodeLine{01010\ \ \ \ \ \textcolor{keywordflow}{if}\ (*n\_algorithms\ <\ items)\ \{}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Algorithms\ buffer\ too\ small"{}});}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{01013\ \ \ \ \ \}}
\DoxyCodeLine{01014\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ items;\ i++)\ \{}
\DoxyCodeLine{01015\ \ \ \ \ \ \ algorithms[i]\ =\ response.algorithms[i];}
\DoxyCodeLine{01016\ \ \ \ \ \}}
\DoxyCodeLine{01017\ \ \ \ \ *n\_algorithms\ =\ items;}
\DoxyCodeLine{01018\ \ \ \}}
\DoxyCodeLine{01019\ }
\DoxyCodeLine{01020\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01021\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a6ab558e1426359cc78e7a362f8b3acd9_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a6ab558e1426359cc78e7a362f8b3acd9_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a5ae52ad56b7e83baeb33b46104263aa6}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_log\_entries@{yh\_util\_get\_log\_entries}}
\index{yh\_util\_get\_log\_entries@{yh\_util\_get\_log\_entries}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_log\_entries()}{yh\_util\_get\_log\_entries()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a5ae52ad56b7e83baeb33b46104263aa6} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+log\+\_\+entries (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{unlogged\+\_\+boot}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{unlogged\+\_\+auth}{, }\item[{\mbox{\hyperlink{structyh__log__entry}{yh\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{n\+\_\+items}{}\end{DoxyParamCaption})}

Get audit logs from the device.

When audit enforce is set, if the log buffer is full, no new operations (other than authentication operations) can be performed unless the log entries are read by this command and then the log index is set by calling \doxylink{yubihsm_8h_a9d844855c9066bbea0e4344978dd7fdc}{yh\+\_\+util\+\_\+set\+\_\+log\+\_\+index()}.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em unlogged\+\_\+boot} & Number of unlogged boot events. Used if the log buffer is full and audit enforce is set \\
\hline
{\em unlogged\+\_\+auth} & Number of unlogged authentication events. Used if the log buffer is full and audit enforce is set \\
\hline
{\em out} & \doxylink{namespace_log}{Log} entries on the device \\
\hline
{\em n\+\_\+items} & Number of log entries\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if {\ttfamily n\+\_\+items} is smaller than the actual number of retrieved log entries. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02531}{2531}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02534\ }
\DoxyCodeLine{02535\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ n\_items\ ==\ NULL)\ \{}
\DoxyCodeLine{02536\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02537\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02538\ \ \ \}}
\DoxyCodeLine{02539\ }
\DoxyCodeLine{02540\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02541\ }
\DoxyCodeLine{02542\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02543\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02544\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ log\_overflow\_boot;}
\DoxyCodeLine{02545\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ log\_overflow\_auth;}
\DoxyCodeLine{02546\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ items;}
\DoxyCodeLine{02547\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ data[1];}
\DoxyCodeLine{02548\ \ \ \ \ \};}
\DoxyCodeLine{02549\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{02550\ \ \ \}\ response;}
\DoxyCodeLine{02551\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02552\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02553\ }
\DoxyCodeLine{02554\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_LOG\_ENTRIES,\ NULL,\ 0,\ \&response\_cmd,}
\DoxyCodeLine{02555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response.buf,\ \&response\_len);}
\DoxyCodeLine{02556\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02557\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ LOGS\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02558\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02559\ \ \ \}}
\DoxyCodeLine{02560\ }
\DoxyCodeLine{02561\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02562\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{02563\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ logs:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02564\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{02565\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02566\ \ \ \}}
\DoxyCodeLine{02567\ }
\DoxyCodeLine{02568\ \ \ \textcolor{keywordflow}{if}\ (unlogged\_boot)\ \{}
\DoxyCodeLine{02569\ \ \ \ \ *unlogged\_boot\ =\ ntohs(response.log\_overflow\_boot);}
\DoxyCodeLine{02570\ \ \ \}}
\DoxyCodeLine{02571\ }
\DoxyCodeLine{02572\ \ \ \textcolor{keywordflow}{if}\ (unlogged\_auth)\ \{}
\DoxyCodeLine{02573\ \ \ \ \ *unlogged\_auth\ =\ ntohs(response.log\_overflow\_auth);}
\DoxyCodeLine{02574\ \ \ \}}
\DoxyCodeLine{02575\ }
\DoxyCodeLine{02576\ \ \ \textcolor{keywordflow}{if}\ (response.items\ >\ \mbox{\hyperlink{yubihsm_8h_ae10a65a4b5dfaac7c3d64c1ec7b99e82}{YH\_MAX\_LOG\_ENTRIES}})\ \{}
\DoxyCodeLine{02577\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(}
\DoxyCodeLine{02578\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Response\ contain\ more\ items\ than\ the\ maximum\ number\ of\ log\ entries"{}});}
\DoxyCodeLine{02579\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ab7388c97719517ba2f7e43d3d16850e1}{YHR\_DEVICE\_INVALID\_DATA}};}
\DoxyCodeLine{02580\ \ \ \}}
\DoxyCodeLine{02581\ }
\DoxyCodeLine{02582\ \ \ \textcolor{keywordflow}{if}\ (response.items\ >\ *n\_items)\ \{}
\DoxyCodeLine{02583\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Log\ buffer\ too\ small,\ needed\ at\ lest\ \%d,\ got\ \%zu"{}},\ response.items,}
\DoxyCodeLine{02584\ \ \ \ \ \ \ \ \ \ \ \ \ *n\_items);}
\DoxyCodeLine{02585\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{02586\ \ \ \}}
\DoxyCodeLine{02587\ }
\DoxyCodeLine{02588\ \ \ *n\_items\ =\ response.items;}
\DoxyCodeLine{02589\ }
\DoxyCodeLine{02590\ \ \ \mbox{\hyperlink{structyh__log__entry}{yh\_log\_entry}}\ *ptr\ =\ (\mbox{\hyperlink{structyh__log__entry}{yh\_log\_entry}}\ *)\ response.data;}
\DoxyCodeLine{02591\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ i\ =\ 0;\ i\ <\ *n\_items;\ i++)\ \{}
\DoxyCodeLine{02592\ \ \ \ \ out[i].number\ =\ ntohs(ptr[i].number);}
\DoxyCodeLine{02593\ \ \ \ \ out[i].command\ =\ ptr[i].command;}
\DoxyCodeLine{02594\ \ \ \ \ out[i].length\ =\ ntohs(ptr[i].length);}
\DoxyCodeLine{02595\ \ \ \ \ out[i].session\_key\ =\ ntohs(ptr[i].session\_key);}
\DoxyCodeLine{02596\ \ \ \ \ out[i].target\_key\ =\ ntohs(ptr[i].target\_key);}
\DoxyCodeLine{02597\ \ \ \ \ out[i].second\_key\ =\ ntohs(ptr[i].second\_key);}
\DoxyCodeLine{02598\ \ \ \ \ out[i].result\ =\ ptr[i].result;}
\DoxyCodeLine{02599\ \ \ \ \ out[i].systick\ =\ ntohl(ptr[i].systick);}
\DoxyCodeLine{02600\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(out[i].digest,\ ptr[i].digest,\ \mbox{\hyperlink{yubihsm_8h_a289ca46f5ef481980f0fad98d727e87a}{YH\_LOG\_DIGEST\_SIZE}});}
\DoxyCodeLine{02601\ \ \ \}}
\DoxyCodeLine{02602\ }
\DoxyCodeLine{02603\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02604\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5ae52ad56b7e83baeb33b46104263aa6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5ae52ad56b7e83baeb33b46104263aa6_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a7b5f1f0c1cbca11fbe21e7e4e6b29a1b}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_object\_info@{yh\_util\_get\_object\_info}}
\index{yh\_util\_get\_object\_info@{yh\_util\_get\_object\_info}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_object\_info()}{yh\_util\_get\_object\_info()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a7b5f1f0c1cbca11fbe21e7e4e6b29a1b} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+object\+\_\+info (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{id}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}}}]{type}{, }\item[{\mbox{\hyperlink{structyh__object__descriptor}{yh\+\_\+object\+\_\+descriptor}} \texorpdfstring{$\ast$}{*}}]{object}{}\end{DoxyParamCaption})}

Get metadata of the object with the specified Object ID and Type


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em id} & Object ID of the object to get \\
\hline
{\em type} & Object type. See \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type} \\
\hline
{\em object} & Object information\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Objects}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01128}{1128}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01131\ }
\DoxyCodeLine{01132\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01133\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01134\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01135\ \ \ \}}
\DoxyCodeLine{01136\ }
\DoxyCodeLine{01137\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ data[3];}
\DoxyCodeLine{01138\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ *dataptr\ =\ data;}
\DoxyCodeLine{01139\ }
\DoxyCodeLine{01140\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{01141\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01142\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}};}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}};}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a1d127017fb298b889f4ba24752d08b8e}{type}};}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ sequence;}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ origin;}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{01152\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{01153\ \ \ \ \ \};}
\DoxyCodeLine{01154\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{01155\ \ \ \}\ response;}
\DoxyCodeLine{01156\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{01157\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{01158\ }
\DoxyCodeLine{01159\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01160\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01161\ }
\DoxyCodeLine{01162\ \ \ *dataptr++\ =\ \textcolor{keywordtype}{id}\ >>\ 8\ \&\ 0xff;}
\DoxyCodeLine{01163\ \ \ *dataptr++\ =\ \textcolor{keywordtype}{id}\ \&\ 0xff;}
\DoxyCodeLine{01164\ }
\DoxyCodeLine{01165\ \ \ *dataptr++\ =\ (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}})\ type;}
\DoxyCodeLine{01166\ }
\DoxyCodeLine{01167\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_OBJECT\_INFO,\ data,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{01169\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01170\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ OBJECT\ INFO\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01171\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01172\ \ \ \}}
\DoxyCodeLine{01173\ }
\DoxyCodeLine{01174\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01175\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{01176\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ object\ info:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{01178\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01179\ \ \ \}}
\DoxyCodeLine{01180\ }
\DoxyCodeLine{01181\ \ \ \textcolor{keywordflow}{if}\ (response\_len\ ==\ \textcolor{keyword}{sizeof}(response))\ \{}
\DoxyCodeLine{01182\ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{object})\ \{}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a85d991d90970121ba1480cd98d93aab9}{object}}-\/>\mbox{\hyperlink{structyh__object__descriptor_a94fcb9bbe5ffacadafc207c166f6239f}{capabilities}}.\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}},\ response.capabilities,}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{01185\ }
\DoxyCodeLine{01186\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>id\ =\ htons(response.id);}
\DoxyCodeLine{01187\ }
\DoxyCodeLine{01188\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>len\ =\ htons(response.len);}
\DoxyCodeLine{01189\ }
\DoxyCodeLine{01190\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>domains\ =\ htons(response.domains);}
\DoxyCodeLine{01191\ }
\DoxyCodeLine{01192\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>type\ =\ response.type;}
\DoxyCodeLine{01193\ }
\DoxyCodeLine{01194\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>algorithm\ =\ response.algorithm;}
\DoxyCodeLine{01195\ }
\DoxyCodeLine{01196\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>sequence\ =\ response.sequence;}
\DoxyCodeLine{01197\ }
\DoxyCodeLine{01198\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>origin\ =\ response.origin;}
\DoxyCodeLine{01199\ }
\DoxyCodeLine{01200\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a85d991d90970121ba1480cd98d93aab9}{object}}-\/>\mbox{\hyperlink{structyh__object__descriptor_ab63cc80a958a1debc4ac0ee255810fa5}{label}},\ response.label,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}});}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \textcolor{keywordtype}{object}-\/>label[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}]\ =\ 0;}
\DoxyCodeLine{01202\ }
\DoxyCodeLine{01203\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a85d991d90970121ba1480cd98d93aab9}{object}}-\/>\mbox{\hyperlink{structyh__object__descriptor_a98e1c698e0d1344c4fe4a215d2d633ec}{delegated\_capabilities}}.\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}},}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \ \ \ \ \ response.delegated\_capabilities,\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{01205\ \ \ \ \ \}}
\DoxyCodeLine{01206\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01207\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Wrong\ response\ length,\ expecting\ \%lu\ or\ 0,\ received\ \%lu"{}},}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structyh__object__descriptor}{yh\_object\_descriptor}}),}
\DoxyCodeLine{01209\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\ response\_len);}
\DoxyCodeLine{01210\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\_WRONG\_LENGTH}};}
\DoxyCodeLine{01211\ \ \ \}}
\DoxyCodeLine{01212\ }
\DoxyCodeLine{01213\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01214\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7b5f1f0c1cbca11fbe21e7e4e6b29a1b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7b5f1f0c1cbca11fbe21e7e4e6b29a1b_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a56e060e71fb8baa0531b3a20848abf37}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_opaque@{yh\_util\_get\_opaque}}
\index{yh\_util\_get\_opaque@{yh\_util\_get\_opaque}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_opaque()}{yh\_util\_get\_opaque()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a56e060e71fb8baa0531b3a20848abf37} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+opaque (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{object\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Get an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a5d37b7418d50b420621e6a6eb2700de4}{YH\+\_\+\+OPAQUE} object (like an X.\+509 certificate) from the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em object\+\_\+id} & Object ID of the \doxylink{struct_opaque}{Opaque} object \\
\hline
{\em out} & the retrieved \doxylink{struct_opaque}{Opaque} object \\
\hline
{\em out\+\_\+len} & Length of the retrieved \doxylink{struct_opaque}{Opaque} object\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02636}{2636}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02638\ }
\DoxyCodeLine{02639\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02640\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02641\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02642\ \ \ \}}
\DoxyCodeLine{02643\ }
\DoxyCodeLine{02644\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ data[2];}
\DoxyCodeLine{02645\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02646\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02647\ }
\DoxyCodeLine{02648\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ object\_id\_h\ =\ htons(object\_id);}
\DoxyCodeLine{02649\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data,\ \&object\_id\_h,\ \textcolor{keyword}{sizeof}(object\_id\_h));}
\DoxyCodeLine{02650\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_OPAQUE,\ data,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{02651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{02652\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02653\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ OPAQUE\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02654\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02655\ \ \ \}}
\DoxyCodeLine{02656\ }
\DoxyCodeLine{02657\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02658\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{02659\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ object:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ out[0]);}
\DoxyCodeLine{02660\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02661\ \ \ \}}
\DoxyCodeLine{02662\ }
\DoxyCodeLine{02663\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02664\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a56e060e71fb8baa0531b3a20848abf37_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a56e060e71fb8baa0531b3a20848abf37_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a11871e03c808e2d25737f893e58ed094}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_option@{yh\_util\_get\_option}}
\index{yh\_util\_get\_option@{yh\_util\_get\_option}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_option()}{yh\_util\_get\_option()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a11871e03c808e2d25737f893e58ed094} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+option (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option}}}]{option}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Get a device-\/global option


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em option} & Option to get. See \doxylink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option} \\
\hline
{\em out} & Option value \\
\hline
{\em out\+\_\+len} & Length of option value\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03584}{3584}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03586\ }
\DoxyCodeLine{03587\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03588\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03589\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03590\ \ \ \}}
\DoxyCodeLine{03591\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1]\ =\ \{\mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}}\};}
\DoxyCodeLine{03592\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03593\ }
\DoxyCodeLine{03594\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_OPTION,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}),}
\DoxyCodeLine{03595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{03596\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03597\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ OPTION\ command:\ \%s\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03598\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03599\ \ \ \}}
\DoxyCodeLine{03600\ }
\DoxyCodeLine{03601\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03602\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{03603\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ option:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ out[0]);}
\DoxyCodeLine{03604\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03605\ \ \ \}}
\DoxyCodeLine{03606\ }
\DoxyCodeLine{03607\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03608\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a11871e03c808e2d25737f893e58ed094_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a11871e03c808e2d25737f893e58ed094_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_af1bc8ed34687d83701eb3cc673ad4b96}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_pseudo\_random@{yh\_util\_get\_pseudo\_random}}
\index{yh\_util\_get\_pseudo\_random@{yh\_util\_get\_pseudo\_random}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_pseudo\_random()}{yh\_util\_get\_pseudo\_random()}}
{\footnotesize\ttfamily \label{yubihsm_8c_af1bc8ed34687d83701eb3cc673ad4b96} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+pseudo\+\_\+random (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{size\+\_\+t}]{len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Get a fixed number of pseudo-\/random bytes from the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em len} & Length of pseudo-\/random data to get \\
\hline
{\em out} & Pseudo-\/random data out \\
\hline
{\em out\+\_\+len} & Length of pseudo-\/random data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01560}{1560}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01562\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01563\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01564\ }
\DoxyCodeLine{01565\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01566\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01567\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01568\ \ \ \}}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01570\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01571\ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}};}
\DoxyCodeLine{01572\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[2];}
\DoxyCodeLine{01573\ \ \ \}\ data;}
\DoxyCodeLine{01574\ \ \ data.len\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}});}
\DoxyCodeLine{01575\ }
\DoxyCodeLine{01576\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_PSEUDO\_RANDOM,\ data.buf,}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(data),\ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{01578\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01579\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ PSEUDO\ RANDOM\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01580\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01581\ \ \ \}}
\DoxyCodeLine{01582\ }
\DoxyCodeLine{01583\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01584\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{01585\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ out[0]);}
\DoxyCodeLine{01586\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01587\ \ \ \}}
\DoxyCodeLine{01588\ }
\DoxyCodeLine{01589\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01590\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_af1bc8ed34687d83701eb3cc673ad4b96_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_af1bc8ed34687d83701eb3cc673ad4b96_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aa7b8b42156c4bdaf41d8b9758a2fd73f}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_public\_key@{yh\_util\_get\_public\_key}}
\index{yh\_util\_get\_public\_key@{yh\_util\_get\_public\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_public\_key()}{yh\_util\_get\_public\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aa7b8b42156c4bdaf41d8b9758a2fd73f} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+public\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{data}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{data\+\_\+len}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}} \texorpdfstring{$\ast$}{*}}]{algorithm}{}\end{DoxyParamCaption})}

Get the value of the public key with the specified Object ID


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em id} & Object ID of the public key \\
\hline
{\em data} & Value of the public key \\
\hline
{\em data\+\_\+len} & Length of the public key in bytes \\
\hline
{\em algorithm} & Algorithm of the key\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if the actual key length was bigger than data\+\_\+len. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01216}{1216}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01218\ }
\DoxyCodeLine{01219\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ data\ ==\ NULL\ ||\ data\_len\ ==\ NULL)\ \{}
\DoxyCodeLine{01220\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01221\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01222\ \ \ \}}
\DoxyCodeLine{01223\ }
\DoxyCodeLine{01224\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ cmd[2]\ =\ \{\textcolor{keywordtype}{id}\ >>\ 8,\ \textcolor{keywordtype}{id}\ \&\ 0xff\};}
\DoxyCodeLine{01225\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01226\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01227\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{01228\ }
\DoxyCodeLine{01229\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_PUBLIC\_KEY,\ cmd,\ \textcolor{keyword}{sizeof}(cmd),}
\DoxyCodeLine{01230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response,\ \&response\_len);}
\DoxyCodeLine{01231\ }
\DoxyCodeLine{01232\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01233\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ PUBLIC\ KEY\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01234\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01235\ \ \ \}}
\DoxyCodeLine{01236\ }
\DoxyCodeLine{01237\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01238\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{01239\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ public\ key:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{01241\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01242\ \ \ \}}
\DoxyCodeLine{01243\ }
\DoxyCodeLine{01244\ \ \ \textcolor{keywordflow}{if}\ (response\_len\ >\ *data\_len)\ \{}
\DoxyCodeLine{01245\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{01246\ \ \ \}}
\DoxyCodeLine{01247\ }
\DoxyCodeLine{01248\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{01249\ \ \ \ \ *\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}\ =\ *response;}
\DoxyCodeLine{01250\ \ \ \}}
\DoxyCodeLine{01251\ \ \ *data\_len\ =\ response\_len\ -\/\ 1;}
\DoxyCodeLine{01252\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data,\ response\ +\ 1,\ *data\_len);}
\DoxyCodeLine{01253\ }
\DoxyCodeLine{01254\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01255\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa7b8b42156c4bdaf41d8b9758a2fd73f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa7b8b42156c4bdaf41d8b9758a2fd73f_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ae87d5578703775b9d4151a14435f4a73}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_storage\_info@{yh\_util\_get\_storage\_info}}
\index{yh\_util\_get\_storage\_info@{yh\_util\_get\_storage\_info}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_storage\_info()}{yh\_util\_get\_storage\_info()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ae87d5578703775b9d4151a14435f4a73} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+storage\+\_\+info (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{total\+\_\+records}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{free\+\_\+records}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{total\+\_\+pages}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{free\+\_\+pages}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{page\+\_\+size}{}\end{DoxyParamCaption})}

Report currently free storage. This is reported as free records, free pages and page size.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em total\+\_\+records} & Total number of records \\
\hline
{\em free\+\_\+records} & Number of free records \\
\hline
{\em total\+\_\+pages} & Total number of pages \\
\hline
{\em free\+\_\+pages} & Number of free pages \\
\hline
{\em page\+\_\+size} & Page size in bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03610}{3610}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03613\ }
\DoxyCodeLine{03614\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03615\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03616\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03617\ \ \ \}}
\DoxyCodeLine{03618\ }
\DoxyCodeLine{03619\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03620\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03621\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03622\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03623\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ total\_records;}
\DoxyCodeLine{03624\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ free\_records;}
\DoxyCodeLine{03625\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ total\_pages;}
\DoxyCodeLine{03626\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ free\_pages;}
\DoxyCodeLine{03627\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{namespacesysio_1_1vm_a0ae6751a77293216df4656dee5081eb2a10108b6260714ad13914454c1dd1ec8f}{page\_size}};}
\DoxyCodeLine{03628\ \ \ \ \ \};}
\DoxyCodeLine{03629\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03630\ \ \ \}\ response;}
\DoxyCodeLine{03631\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03632\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03633\ }
\DoxyCodeLine{03634\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_STORAGE\_INFO,\ NULL,\ 0,}
\DoxyCodeLine{03635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{03636\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03637\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ STORAGE\ INFO\ command:\ \%s\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03638\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03639\ \ \ \}}
\DoxyCodeLine{03640\ }
\DoxyCodeLine{03641\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03642\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{03643\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ storage\ stats:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03644\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{03645\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03646\ \ \ \}}
\DoxyCodeLine{03647\ }
\DoxyCodeLine{03648\ \ \ \textcolor{keywordflow}{if}\ (total\_records)\ \{}
\DoxyCodeLine{03649\ \ \ \ \ *total\_records\ =\ ntohs(response.total\_records);}
\DoxyCodeLine{03650\ \ \ \}}
\DoxyCodeLine{03651\ \ \ \textcolor{keywordflow}{if}\ (free\_records)\ \{}
\DoxyCodeLine{03652\ \ \ \ \ *free\_records\ =\ ntohs(response.free\_records);}
\DoxyCodeLine{03653\ \ \ \}}
\DoxyCodeLine{03654\ \ \ \textcolor{keywordflow}{if}\ (total\_pages)\ \{}
\DoxyCodeLine{03655\ \ \ \ \ *total\_pages\ =\ ntohs(response.total\_pages);}
\DoxyCodeLine{03656\ \ \ \}}
\DoxyCodeLine{03657\ \ \ \textcolor{keywordflow}{if}\ (free\_pages)\ \{}
\DoxyCodeLine{03658\ \ \ \ \ *free\_pages\ =\ ntohs(response.free\_pages);}
\DoxyCodeLine{03659\ \ \ \}}
\DoxyCodeLine{03660\ \ \ \textcolor{keywordflow}{if}\ (page\_size)\ \{}
\DoxyCodeLine{03661\ \ \ \ \ *\mbox{\hyperlink{namespacesysio_1_1vm_a0ae6751a77293216df4656dee5081eb2a10108b6260714ad13914454c1dd1ec8f}{page\_size}}\ =\ ntohs(response.page\_size);}
\DoxyCodeLine{03662\ \ \ \}}
\DoxyCodeLine{03663\ }
\DoxyCodeLine{03664\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03665\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae87d5578703775b9d4151a14435f4a73_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae87d5578703775b9d4151a14435f4a73_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a47768ae0e72beba49f02db1baddf4823}\index{yubihsm.c@{yubihsm.c}!yh\_util\_get\_template@{yh\_util\_get\_template}}
\index{yh\_util\_get\_template@{yh\_util\_get\_template}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_get\_template()}{yh\_util\_get\_template()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a47768ae0e72beba49f02db1baddf4823} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+get\+\_\+template (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{object\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Get a \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a96244762de5ce4175e60157239e7a097}{YH\+\_\+\+TEMPLATE} object from the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em object\+\_\+id} & Object ID of the Template to get \\
\hline
{\em out} & The retrieved Template \\
\hline
{\em out\+\_\+len} & Length of the retrieved Template\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02805}{2805}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02807\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL)\ \{}
\DoxyCodeLine{02808\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02809\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02810\ \ \ \}}
\DoxyCodeLine{02811\ }
\DoxyCodeLine{02812\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ data[2];}
\DoxyCodeLine{02813\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02814\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02815\ }
\DoxyCodeLine{02816\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ object\_id\_h\ =\ htons(object\_id);}
\DoxyCodeLine{02817\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data,\ \&object\_id\_h,\ \textcolor{keyword}{sizeof}(object\_id\_h));}
\DoxyCodeLine{02818\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_GET\_TEMPLATE,\ data,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{02819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{02820\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02821\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ GET\ TEMPLATE\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02822\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02823\ \ \ \}}
\DoxyCodeLine{02824\ }
\DoxyCodeLine{02825\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02826\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{02827\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ template\ object:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02828\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{02829\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02830\ \ \ \}}
\DoxyCodeLine{02831\ }
\DoxyCodeLine{02832\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02833\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a47768ae0e72beba49f02db1baddf4823_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a47768ae0e72beba49f02db1baddf4823_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ac154da7ac6dc0a7b4b3a6cdff9433da8}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_authentication\_key@{yh\_util\_import\_authentication\_key}}
\index{yh\_util\_import\_authentication\_key@{yh\_util\_import\_authentication\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_authentication\_key()}{yh\_util\_import\_authentication\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ac154da7ac6dc0a7b4b3a6cdff9433da8} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+authentication\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{delegated\+\_\+capabilities}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+enc}{, }\item[{size\+\_\+t}]{key\+\_\+enc\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+mac}{, }\item[{size\+\_\+t}]{key\+\_\+mac\+\_\+len}{}\end{DoxyParamCaption})}

Import an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583acee44b775b3c5b6157f0732699935074}{YH\+\_\+\+AUTHENTICATION\+\_\+\+KEY} into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the imported key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em delegated\+\_\+capabilities} & Delegated capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em key\+\_\+enc} & Long lived encryption key of the Authentication Key to import \\
\hline
{\em key\+\_\+enc\+\_\+len} & Length of the encryption key. Must be \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN} \\
\hline
{\em key\+\_\+mac} & Long lived MAC key of the Authentication Key to import \\
\hline
{\em key\+\_\+mac\+\_\+len} & Length of the MAC key. Must be \doxylink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\+\_\+\+KEY\+\_\+\+LEN}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if {\ttfamily key\+\_\+enc\+\_\+len} or {\ttfamily key\+\_\+mac\+\_\+len} are not the expected values. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Authentication Key}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02985}{2985}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02990\ }
\DoxyCodeLine{02991\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{02992\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}\ ==\ NULL\ ||}
\DoxyCodeLine{02993\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}\ ==\ NULL\ ||\ key\_enc\ ==\ NULL\ ||}
\DoxyCodeLine{02994\ \ \ \ \ \ \ key\_enc\_len\ !=\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}\ ||\ key\_mac\ ==\ NULL\ ||}
\DoxyCodeLine{02995\ \ \ \ \ \ \ key\_mac\_len\ !=\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}})\ \{}
\DoxyCodeLine{02996\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02997\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02998\ \ \ \}}
\DoxyCodeLine{02999\ }
\DoxyCodeLine{03000\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03001\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03002\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03003\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03004\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{03005\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{03006\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{03007\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{03008\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{03009\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_enc[\mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}];}
\DoxyCodeLine{03010\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_mac[\mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}}];}
\DoxyCodeLine{03011\ \ \ \ \ \};}
\DoxyCodeLine{03012\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03013\ \ \ \}\ data;}
\DoxyCodeLine{03014\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03015\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03016\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03017\ \ \ \ \ \};}
\DoxyCodeLine{03018\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03019\ \ \ \}\ response;}
\DoxyCodeLine{03020\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03021\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03022\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03023\ }
\DoxyCodeLine{03024\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.key\_enc,\ key\_enc,\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}});}
\DoxyCodeLine{03025\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.key\_mac,\ key\_mac,\ \mbox{\hyperlink{yubihsm_8h_ac2737b2a34c26d0258d25e34993df391}{YH\_KEY\_LEN}});}
\DoxyCodeLine{03026\ }
\DoxyCodeLine{03027\ \ \ data.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03028\ }
\DoxyCodeLine{03029\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{03030\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{03031\ }
\DoxyCodeLine{03032\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{03033\ }
\DoxyCodeLine{03034\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{03035\ }
\DoxyCodeLine{03036\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa461952ba18e7fcd792e480f71c853513}{YH\_ALGO\_AES128\_YUBICO\_AUTHENTICATION}};}
\DoxyCodeLine{03037\ }
\DoxyCodeLine{03038\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.delegated\_capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}},}
\DoxyCodeLine{03039\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{03040\ }
\DoxyCodeLine{03041\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_PUT\_AUTHENTICATION\_KEY,\ data.buf,}
\DoxyCodeLine{03042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(data),\ \&response\_cmd,\ response.buf,}
\DoxyCodeLine{03043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_len);}
\DoxyCodeLine{03044\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ \textcolor{keyword}{sizeof}(data));}
\DoxyCodeLine{03045\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03046\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ PUT\ AUTHENTICATION\ KEY\ command:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{03047\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03048\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03049\ \ \ \}}
\DoxyCodeLine{03050\ }
\DoxyCodeLine{03051\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03052\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{03053\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ store\ authentication\ key:\ \%s\ (\%x)\(\backslash\)n"{}},}
\DoxyCodeLine{03054\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ response.buf[0]);}
\DoxyCodeLine{03055\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03056\ \ \ \}}
\DoxyCodeLine{03057\ }
\DoxyCodeLine{03058\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{03059\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Stored\ Authentication\ key\ 0x\%04x"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03060\ }
\DoxyCodeLine{03061\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03062\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ac154da7ac6dc0a7b4b3a6cdff9433da8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ac154da7ac6dc0a7b4b3a6cdff9433da8_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a80b4c4caeb9c768737c2dbf46d9352e4}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_authentication\_key\_derived@{yh\_util\_import\_authentication\_key\_derived}}
\index{yh\_util\_import\_authentication\_key\_derived@{yh\_util\_import\_authentication\_key\_derived}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_authentication\_key\_derived()}{yh\_util\_import\_authentication\_key\_derived()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a80b4c4caeb9c768737c2dbf46d9352e4} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+authentication\+\_\+key\+\_\+derived (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{delegated\+\_\+capabilities}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{password}{, }\item[{size\+\_\+t}]{password\+\_\+len}{}\end{DoxyParamCaption})}

Import an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583acee44b775b3c5b6157f0732699935074}{YH\+\_\+\+AUTHENTICATION\+\_\+\+KEY} with long lived keys derived from a password


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em delegated\+\_\+capabilities} & Delegated capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em password} & Password used to derive the long lived encryption key and MAC key of the Athentication Key \\
\hline
{\em password\+\_\+len} & Length of password\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Authentication Key}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03064}{3064}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03069\ }
\DoxyCodeLine{03070\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{03071\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}\ ==\ NULL\ ||}
\DoxyCodeLine{03072\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}\ ==\ NULL\ ||\ password\ ==\ NULL)\ \{}
\DoxyCodeLine{03073\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03074\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03075\ \ \ \}}
\DoxyCodeLine{03076\ }
\DoxyCodeLine{03077\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_enc[\mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}];}
\DoxyCodeLine{03078\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key\_mac[\mbox{\hyperlink{scp_8h_a25905234f13446437b28c85d0504216d}{SCP\_KEY\_LEN}}];}
\DoxyCodeLine{03079\ }
\DoxyCodeLine{03080\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ derive\_keys(password,\ password\_len,\ key\_enc,\ key\_mac);}
\DoxyCodeLine{03081\ }
\DoxyCodeLine{03082\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ ==\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03083\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{03084\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8c_ac154da7ac6dc0a7b4b3a6cdff9433da8}{yh\_util\_import\_authentication\_key}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},}
\DoxyCodeLine{03085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}},}
\DoxyCodeLine{03086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\_enc,\ \textcolor{keyword}{sizeof}(key\_enc),\ key\_mac,}
\DoxyCodeLine{03087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(key\_mac));}
\DoxyCodeLine{03088\ \ \ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(key\_enc,\ \textcolor{keyword}{sizeof}(key\_enc));}
\DoxyCodeLine{03089\ \ \ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(key\_mac,\ \textcolor{keyword}{sizeof}(key\_mac));}
\DoxyCodeLine{03090\ \ \ \}}
\DoxyCodeLine{03091\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03092\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a80b4c4caeb9c768737c2dbf46d9352e4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a80b4c4caeb9c768737c2dbf46d9352e4_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_adc142d8f397eee024b3c145fa8abad85}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_ec\_key@{yh\_util\_import\_ec\_key}}
\index{yh\_util\_import\_ec\_key@{yh\_util\_import\_ec\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_ec\_key()}{yh\_util\_import\_ec\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_adc142d8f397eee024b3c145fa8abad85} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+ec\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{s}{}\end{DoxyParamCaption})}

Import an Elliptic Curve key into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs specified as an unsigned int. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm of the key to import. Must be one of\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P224}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+K256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP512} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P521} \\
\hline
{\em s} & the EC key to import\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or the algorithm is not one of \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P224}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+K256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP384}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+BP512} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+P521}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01689}{1689}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01693\ }
\DoxyCodeLine{01694\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{01695\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01696\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01697\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01698\ \ \ \}}
\DoxyCodeLine{01699\ }
\DoxyCodeLine{01700\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ component\_len;}
\DoxyCodeLine{01701\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{01702\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaedcbc07d82b18ca5c21eb3379a6cc010}{YH\_ALGO\_EC\_P224}}:}
\DoxyCodeLine{01703\ \ \ \ \ \ \ component\_len\ =\ 28;}
\DoxyCodeLine{01704\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01705\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae4b191baf5c65f9234120080264d129b}{YH\_ALGO\_EC\_P256}}:}
\DoxyCodeLine{01706\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad423056b13955068935dc8b3ac0e65d1}{YH\_ALGO\_EC\_K256}}:}
\DoxyCodeLine{01707\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caabd995726d45b6dd2388775db4767c80d}{YH\_ALGO\_EC\_BP256}}:}
\DoxyCodeLine{01708\ \ \ \ \ \ \ component\_len\ =\ 32;}
\DoxyCodeLine{01709\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01710\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa31094c17c66e4c365ca3dad353bc8bda}{YH\_ALGO\_EC\_P384}}:}
\DoxyCodeLine{01711\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa228fd3332b55c60438dfea6a1b09af36}{YH\_ALGO\_EC\_BP384}}:}
\DoxyCodeLine{01712\ \ \ \ \ \ \ component\_len\ =\ 48;}
\DoxyCodeLine{01713\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01714\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab9c1be17b7b3f755346ff8c3cca3ed25}{YH\_ALGO\_EC\_BP512}}:}
\DoxyCodeLine{01715\ \ \ \ \ \ \ component\_len\ =\ 64;}
\DoxyCodeLine{01716\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01717\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa05aec903fd67851f968aaa606fe2138a}{YH\_ALGO\_EC\_P521}}:}
\DoxyCodeLine{01718\ \ \ \ \ \ \ component\_len\ =\ 66;}
\DoxyCodeLine{01719\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01720\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01722\ \ \ \}}
\DoxyCodeLine{01723\ \ \ \textcolor{keywordflow}{return}\ import\_asymmetric(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ component\_len);}
\DoxyCodeLine{01725\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=292pt]{yubihsm_8c_adc142d8f397eee024b3c145fa8abad85_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_adc142d8f397eee024b3c145fa8abad85_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a7a886e052bc1571f24c6b7f0c57e2d8c}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_ed\_key@{yh\_util\_import\_ed\_key}}
\index{yh\_util\_import\_ed\_key@{yh\_util\_import\_ed\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_ed\_key()}{yh\_util\_import\_ed\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a7a886e052bc1571f24c6b7f0c57e2d8c} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+ed\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{k}{}\end{DoxyParamCaption})}

Import an ED key into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key will have. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm of the key to import. Must be \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+ED25519} \\
\hline
{\em k} & the ED key to import\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or the algorithm is not \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\+\_\+\+ALGO\+\_\+\+EC\+\_\+\+ED25519}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01727}{1727}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01731\ }
\DoxyCodeLine{01732\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{01733\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ k\ ==\ NULL)\ \{}
\DoxyCodeLine{01734\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01735\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01736\ \ \ \}}
\DoxyCodeLine{01737\ }
\DoxyCodeLine{01738\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ component\_len;}
\DoxyCodeLine{01739\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{01740\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa68c2c97f16c36f727e41a899d8a7e8bd}{YH\_ALGO\_EC\_ED25519}}:}
\DoxyCodeLine{01741\ \ \ \ \ \ \ component\_len\ =\ 32;}
\DoxyCodeLine{01742\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01743\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01744\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01745\ \ \ \}}
\DoxyCodeLine{01746\ \ \ \textcolor{keywordflow}{return}\ import\_asymmetric(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},}
\DoxyCodeLine{01747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}},\ k,\ component\_len);}
\DoxyCodeLine{01748\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=292pt]{yubihsm_8c_a7a886e052bc1571f24c6b7f0c57e2d8c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7a886e052bc1571f24c6b7f0c57e2d8c_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a19c79faaf10c405864f0179821d551a5}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_hmac\_key@{yh\_util\_import\_hmac\_key}}
\index{yh\_util\_import\_hmac\_key@{yh\_util\_import\_hmac\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_hmac\_key()}{yh\_util\_import\_hmac\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a19c79faaf10c405864f0179821d551a5} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+hmac\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key}{, }\item[{size\+\_\+t}]{key\+\_\+len}{}\end{DoxyParamCaption})}

Import an HMAC key into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maxium length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm of the key to import. Must be one of\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa942e65c8cd0034eebe9a20c2297c7b06}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA1}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab0a0e1eb424b61057f159f1e53311f5c}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA256}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa781e7ca62563917d2129bde8ec53401b}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA384} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa72d6c7ea77f10e39bbadc8b58d55b9ec}{YH\+\_\+\+ALGO\+\_\+\+HMAC\+\_\+\+SHA512} \\
\hline
{\em key} & The HMAC key to import \\
\hline
{\em key\+\_\+len} & Length of the HMAC key to import\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01750}{1750}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01755\ }
\DoxyCodeLine{01756\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{01757\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ key\ ==\ NULL)\ \{}
\DoxyCodeLine{01758\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01759\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01760\ \ \ \}}
\DoxyCodeLine{01761\ }
\DoxyCodeLine{01762\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{01763\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01764\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{01765\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{01766\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{01767\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{01768\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{01770\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key[128];}
\DoxyCodeLine{01771\ \ \ \ \ \};}
\DoxyCodeLine{01772\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{01773\ \ \ \}\ k;}
\DoxyCodeLine{01774\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01775\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{01777\ \ \ \ \ \};}
\DoxyCodeLine{01778\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{01779\ \ \ \}\ response;}
\DoxyCodeLine{01780\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{01781\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01782\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{01783\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01784\ \ \ \textcolor{keywordtype}{size\_t}\ max\_len\ =\ 64;}
\DoxyCodeLine{01785\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ =\ \textcolor{keyword}{sizeof}(k)\ -\/\ \textcolor{keyword}{sizeof}(k.key);}
\DoxyCodeLine{01786\ }
\DoxyCodeLine{01787\ \ \ k.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{01788\ }
\DoxyCodeLine{01789\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(k.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{01790\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(k.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{01791\ }
\DoxyCodeLine{01792\ \ \ k.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{01793\ }
\DoxyCodeLine{01794\ \ \ k.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{01795\ }
\DoxyCodeLine{01796\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(k.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{01797\ }
\DoxyCodeLine{01798\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}\ ==\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa781e7ca62563917d2129bde8ec53401b}{YH\_ALGO\_HMAC\_SHA384}}\ ||\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}\ ==\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa72d6c7ea77f10e39bbadc8b58d55b9ec}{YH\_ALGO\_HMAC\_SHA512}})\ \{}
\DoxyCodeLine{01799\ \ \ \ \ max\_len\ =\ 128;}
\DoxyCodeLine{01800\ \ \ \}}
\DoxyCodeLine{01801\ }
\DoxyCodeLine{01802\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}}\ >\ max\_len)\ \{}
\DoxyCodeLine{01803\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ long\ key\ supplied,\ max\ \%lu\ bytes\ allowed"{}},}
\DoxyCodeLine{01804\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\ max\_len);}
\DoxyCodeLine{01805\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ae0b26dcb22aa228ab08c9e59a8975952}{YHR\_WRONG\_LENGTH}};}
\DoxyCodeLine{01806\ \ \ \}}
\DoxyCodeLine{01807\ }
\DoxyCodeLine{01808\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(k.key,\ key,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}});}
\DoxyCodeLine{01809\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ +=\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}};}
\DoxyCodeLine{01810\ }
\DoxyCodeLine{01811\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_PUT\_HMAC\_KEY,\ k.buf,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}},\ \&response\_cmd,}
\DoxyCodeLine{01812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response.buf,\ \&response\_len);}
\DoxyCodeLine{01813\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(k.buf,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}});}
\DoxyCodeLine{01814\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01815\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ PUT\ HMAC\ KEY\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01816\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01817\ \ \ \}}
\DoxyCodeLine{01818\ }
\DoxyCodeLine{01819\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01820\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{01821\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ put\ key:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01822\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{01823\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01824\ \ \ \}}
\DoxyCodeLine{01825\ }
\DoxyCodeLine{01826\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{01827\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Stored\ HMAC\ key\ 0x\%04x"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{01828\ }
\DoxyCodeLine{01829\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01830\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a19c79faaf10c405864f0179821d551a5_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a19c79faaf10c405864f0179821d551a5_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a1249c920eec24f634d04eaafb90a1ca2}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_opaque@{yh\_util\_import\_opaque}}
\index{yh\_util\_import\_opaque@{yh\_util\_import\_opaque}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_opaque()}{yh\_util\_import\_opaque()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a1249c920eec24f634d04eaafb90a1ca2} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+opaque (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{object\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{}\end{DoxyParamCaption})}

Import an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a5d37b7418d50b420621e6a6eb2700de4}{YH\+\_\+\+OPAQUE} object into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em object\+\_\+id} & Object ID of the \doxylink{struct_opaque}{Opaque} object. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the \doxylink{struct_opaque}{Opaque} object. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains the \doxylink{struct_opaque}{Opaque} object will be operating within. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the \doxylink{struct_opaque}{Opaque} object. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm of the \doxylink{struct_opaque}{Opaque} object \\
\hline
{\em in} & the \doxylink{struct_opaque}{Opaque} object to import \\
\hline
{\em in\+\_\+len} & Length of the \doxylink{struct_opaque}{Opaque} object to import\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or {\ttfamily in\+\_\+len} is too big. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02666}{2666}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02671\ }
\DoxyCodeLine{02672\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ object\_id\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{02673\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ in\ ==\ NULL)\ \{}
\DoxyCodeLine{02674\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02675\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02676\ \ \ \}}
\DoxyCodeLine{02677\ }
\DoxyCodeLine{02678\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02679\ }
\DoxyCodeLine{02680\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02681\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02682\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02683\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ object\_id;}
\DoxyCodeLine{02684\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{02685\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{02686\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{02687\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02688\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ \textcolor{keyword}{sizeof}(object\_id)\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}})\ -\/}
\DoxyCodeLine{02689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}\ -\/\ 2];}
\DoxyCodeLine{02690\ \ \ \ \ \};}
\DoxyCodeLine{02691\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02692\ \ \ \}\ data;}
\DoxyCodeLine{02693\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len;}
\DoxyCodeLine{02694\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02695\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02696\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ object\_id;}
\DoxyCodeLine{02697\ \ \ \ \ \};}
\DoxyCodeLine{02698\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02699\ \ \ \}\ response;}
\DoxyCodeLine{02700\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02701\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02702\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02703\ }
\DoxyCodeLine{02704\ \ \ data.object\_id\ =\ htons(*object\_id);}
\DoxyCodeLine{02705\ }
\DoxyCodeLine{02706\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02707\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02708\ }
\DoxyCodeLine{02709\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{02710\ }
\DoxyCodeLine{02711\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{02712\ }
\DoxyCodeLine{02713\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02714\ }
\DoxyCodeLine{02715\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \textcolor{keyword}{sizeof}(data.bytes))\ \{}
\DoxyCodeLine{02716\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Data\ length\ must\ be\ in\ [0,\ \%lu]\(\backslash\)n"{}},}
\DoxyCodeLine{02717\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\ \textcolor{keyword}{sizeof}(data.bytes));}
\DoxyCodeLine{02718\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02719\ \ \ \}}
\DoxyCodeLine{02720\ }
\DoxyCodeLine{02721\ \ \ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ +\ \textcolor{keyword}{sizeof}(data)\ -\/\ \textcolor{keyword}{sizeof}(data.bytes);}
\DoxyCodeLine{02722\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{02723\ }
\DoxyCodeLine{02724\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_PUT\_OPAQUE,\ data.buf,\ data\_len,}
\DoxyCodeLine{02725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{02726\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ data\_len);}
\DoxyCodeLine{02727\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02728\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ PUT\ OPAQUE\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02729\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02730\ \ \ \}}
\DoxyCodeLine{02731\ }
\DoxyCodeLine{02732\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02733\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{02734\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ store\ opaque\ object:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02735\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{02736\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02737\ \ \ \}}
\DoxyCodeLine{02738\ }
\DoxyCodeLine{02739\ \ \ *object\_id\ =\ ntohs(response.object\_id);}
\DoxyCodeLine{02740\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Stored\ Opaque\ Object\ 0x\%04x"{}},\ *object\_id);}
\DoxyCodeLine{02741\ }
\DoxyCodeLine{02742\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02743\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a1249c920eec24f634d04eaafb90a1ca2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a1249c920eec24f634d04eaafb90a1ca2_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_addc22271306d847f53321984f41d818b}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_otp\_aead\_key@{yh\_util\_import\_otp\_aead\_key}}
\index{yh\_util\_import\_otp\_aead\_key@{yh\_util\_import\_otp\_aead\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_otp\_aead\_key()}{yh\_util\_import\_otp\_aead\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_addc22271306d847f53321984f41d818b} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+otp\+\_\+aead\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{nonce\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{}\end{DoxyParamCaption})}

Import an \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a02c5f683fde147de6a9e1043f971f5f0}{YH\+\_\+\+OTP\+\_\+\+AEAD\+\_\+\+KEY} used for Yubico OTP Decryption


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the AEAD Key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the AEAD Key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains the AEAD Key will be operating within. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the AEAD Key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em nonce\+\_\+id} & Nonce ID \\
\hline
{\em in} & AEAD Key to import \\
\hline
{\em in\+\_\+len} & Length of AEAD Key to import. Must be 16, 24 or 32\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if {\ttfamily in\+\_\+len} is not one of 16, 24 or 32. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03337}{3337}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03342\ }
\DoxyCodeLine{03343\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{03344\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}\ ==\ NULL\ ||\ in\ ==\ NULL)\ \{}
\DoxyCodeLine{03345\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03346\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03347\ \ \ \}}
\DoxyCodeLine{03348\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03349\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03350\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03351\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03352\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{03353\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{03354\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{03355\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{03356\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ nonce\_id;}
\DoxyCodeLine{03357\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key[32];}
\DoxyCodeLine{03358\ \ \ \ \ \};}
\DoxyCodeLine{03359\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03360\ \ \ \}\ data;}
\DoxyCodeLine{03361\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03362\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03363\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03364\ \ \ \ \ \};}
\DoxyCodeLine{03365\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03366\ \ \ \}\ response;}
\DoxyCodeLine{03367\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03368\ }
\DoxyCodeLine{03369\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \textcolor{keyword}{sizeof}(data);}
\DoxyCodeLine{03370\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03371\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03372\ }
\DoxyCodeLine{03373\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03374\ }
\DoxyCodeLine{03375\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ ==\ 16)\ \{}
\DoxyCodeLine{03376\ \ \ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa62e7ba4126ae16faeafb28972a4e0959}{YH\_ALGO\_AES128\_YUBICO\_OTP}};}
\DoxyCodeLine{03377\ \ \ \ \ data\_len\ -\/=\ 16;}
\DoxyCodeLine{03378\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ ==\ 24)\ \{}
\DoxyCodeLine{03379\ \ \ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa62dd31db747b4b7f81d9e30877a0b720}{YH\_ALGO\_AES192\_YUBICO\_OTP}};}
\DoxyCodeLine{03380\ \ \ \ \ data\_len\ -\/=\ 8;}
\DoxyCodeLine{03381\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ ==\ 32)\ \{}
\DoxyCodeLine{03382\ \ \ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caad1558532867577d1d77c84f1ae632acd}{YH\_ALGO\_AES256\_YUBICO\_OTP}};}
\DoxyCodeLine{03383\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03384\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Key\ length\ has\ to\ be\ 16,\ 24\ or\ 32\ bytes."{}});}
\DoxyCodeLine{03385\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03386\ \ \ \}}
\DoxyCodeLine{03387\ }
\DoxyCodeLine{03388\ \ \ data.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03389\ }
\DoxyCodeLine{03390\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{03391\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{03392\ }
\DoxyCodeLine{03393\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{03394\ }
\DoxyCodeLine{03395\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{03396\ }
\DoxyCodeLine{03397\ \ \ data.nonce\_id\ =\ nonce\_id;}
\DoxyCodeLine{03398\ }
\DoxyCodeLine{03399\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.key,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{03400\ }
\DoxyCodeLine{03401\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_PUT\_OTP\_AEAD\_KEY,\ data.buf,\ data\_len,}
\DoxyCodeLine{03402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{03403\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ data\_len);}
\DoxyCodeLine{03404\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03405\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ PUT\ OTP\ AEAD\ KEY\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03406\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03407\ \ \ \}}
\DoxyCodeLine{03408\ }
\DoxyCodeLine{03409\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03410\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{03411\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ store\ OTP\ AEAD\ key:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03412\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{03413\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03414\ \ \ \}}
\DoxyCodeLine{03415\ }
\DoxyCodeLine{03416\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{03417\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Imported\ OTP\ AEAD\ key\ 0x\%04x"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03418\ }
\DoxyCodeLine{03419\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03420\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_addc22271306d847f53321984f41d818b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_addc22271306d847f53321984f41d818b_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ab0ca24007ce6942d2185859560c43e8a}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_rsa\_key@{yh\_util\_import\_rsa\_key}}
\index{yh\_util\_import\_rsa\_key@{yh\_util\_import\_rsa\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_rsa\_key()}{yh\_util\_import\_rsa\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ab0ca24007ce6942d2185859560c43e8a} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+rsa\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{p}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{q}{}\end{DoxyParamCaption})}

Import an RSA key into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID the key. 0 if Object ID should be generated by the device \\
\hline
{\em label} & Label of the key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains to which the key belongs specified as an unsigned int. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm of the key to import. Must be one of\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+2048}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+3072} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+4096} \\
\hline
{\em p} & P component of the RSA key to import \\
\hline
{\em q} & Q component of the RSA key to import\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or the algorithm is not one of \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+2048}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+3072} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\+\_\+\+ALGO\+\_\+\+RSA\+\_\+4096}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01655}{1655}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01660\ }
\DoxyCodeLine{01661\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{01662\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}\ ==\ NULL\ ||\ q\ ==\ NULL)\ \{}
\DoxyCodeLine{01663\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01664\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01665\ \ \ \}}
\DoxyCodeLine{01666\ }
\DoxyCodeLine{01667\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ keybuf[256\ *\ 2];}
\DoxyCodeLine{01668\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ component\_len;}
\DoxyCodeLine{01669\ }
\DoxyCodeLine{01670\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}\ ==\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caaafe94e6a770edb51c6db84f77d98d2c6}{YH\_ALGO\_RSA\_2048}})\ \{}
\DoxyCodeLine{01671\ \ \ \ \ component\_len\ =\ 128;}
\DoxyCodeLine{01672\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}\ ==\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caafd3fbd9ed86caf267ccc77cb24d44426}{YH\_ALGO\_RSA\_3072}})\ \{}
\DoxyCodeLine{01673\ \ \ \ \ component\_len\ =\ 192;}
\DoxyCodeLine{01674\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}}\ ==\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae5963322a0a0f43a1b74faa78e3a7329}{YH\_ALGO\_RSA\_4096}})\ \{}
\DoxyCodeLine{01675\ \ \ \ \ component\_len\ =\ 256;}
\DoxyCodeLine{01676\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01677\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01678\ \ \ \}}
\DoxyCodeLine{01679\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(keybuf,\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}},\ component\_len);}
\DoxyCodeLine{01680\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(keybuf\ +\ component\_len,\ q,\ component\_len);}
\DoxyCodeLine{01681\ }
\DoxyCodeLine{01682\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ import\_asymmetric(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},}
\DoxyCodeLine{01683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}},\ keybuf,\ component\_len\ *\ 2);}
\DoxyCodeLine{01684\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(keybuf,\ \textcolor{keyword}{sizeof}(keybuf));}
\DoxyCodeLine{01685\ }
\DoxyCodeLine{01686\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01687\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=295pt]{yubihsm_8c_ab0ca24007ce6942d2185859560c43e8a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ab0ca24007ce6942d2185859560c43e8a_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ae0fc8d6520950868365011d1a9f450f1}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_template@{yh\_util\_import\_template}}
\index{yh\_util\_import\_template@{yh\_util\_import\_template}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_template()}{yh\_util\_import\_template()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ae0fc8d6520950868365011d1a9f450f1} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+template (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{object\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{}\end{DoxyParamCaption})}

Import a \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a96244762de5ce4175e60157239e7a097}{YH\+\_\+\+TEMPLATE} object into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em object\+\_\+id} & Object ID of the Template. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the Template. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains the Template will be operating within. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the Template. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities} \\
\hline
{\em algorithm} & Algorithm of the Template \\
\hline
{\em in} & Template to import \\
\hline
{\em in\+\_\+len} & Length of the Template to import\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if {\ttfamily in\+\_\+len} is too big. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02835}{2835}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02840\ }
\DoxyCodeLine{02841\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ object\_id\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{02842\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ in\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ ==\ 0)\ \{}
\DoxyCodeLine{02843\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02844\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02845\ \ \ \}}
\DoxyCodeLine{02846\ }
\DoxyCodeLine{02847\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02848\ }
\DoxyCodeLine{02849\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02850\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02851\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02852\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ object\_id;}
\DoxyCodeLine{02853\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{02854\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{02855\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{02856\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02857\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ \textcolor{keyword}{sizeof}(object\_id)\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}})\ -\/}
\DoxyCodeLine{02858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}\ -\/\ 2];}
\DoxyCodeLine{02859\ \ \ \ \ \};}
\DoxyCodeLine{02860\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02861\ \ \ \}\ data;}
\DoxyCodeLine{02862\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len;}
\DoxyCodeLine{02863\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02864\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02865\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ object\_id;}
\DoxyCodeLine{02866\ \ \ \ \ \};}
\DoxyCodeLine{02867\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02868\ \ \ \}\ response;}
\DoxyCodeLine{02869\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02870\ }
\DoxyCodeLine{02871\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02872\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02873\ }
\DoxyCodeLine{02874\ \ \ data.object\_id\ =\ htons(*object\_id);}
\DoxyCodeLine{02875\ }
\DoxyCodeLine{02876\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02877\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02878\ }
\DoxyCodeLine{02879\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{02880\ }
\DoxyCodeLine{02881\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{02882\ }
\DoxyCodeLine{02883\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02884\ }
\DoxyCodeLine{02885\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \textcolor{keyword}{sizeof}(data.bytes))\ \{}
\DoxyCodeLine{02886\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Data\ length\ must\ be\ in\ [0,\ \%lu]\(\backslash\)n"{}},}
\DoxyCodeLine{02887\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\ \textcolor{keyword}{sizeof}(data.bytes));}
\DoxyCodeLine{02888\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02889\ \ \ \}}
\DoxyCodeLine{02890\ }
\DoxyCodeLine{02891\ \ \ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ +\ \textcolor{keyword}{sizeof}(data.object\_id)\ +\ \textcolor{keyword}{sizeof}(data.domains)\ +}
\DoxyCodeLine{02892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}\ +\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ +\ \textcolor{keyword}{sizeof}(data.algorithm);}
\DoxyCodeLine{02893\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{02894\ }
\DoxyCodeLine{02895\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_PUT\_TEMPLATE,\ data.buf,\ data\_len,}
\DoxyCodeLine{02896\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{02897\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02898\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ PUT\ TEMPLATE\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02899\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02900\ \ \ \}}
\DoxyCodeLine{02901\ }
\DoxyCodeLine{02902\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02903\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{02904\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ store\ template\ object:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02905\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{02906\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02907\ \ \ \}}
\DoxyCodeLine{02908\ }
\DoxyCodeLine{02909\ \ \ *object\_id\ =\ ntohs(response.object\_id);}
\DoxyCodeLine{02910\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Stored\ Opaque\ Object\ 0x\%04x"{}},\ *object\_id);}
\DoxyCodeLine{02911\ }
\DoxyCodeLine{02912\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02913\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae0fc8d6520950868365011d1a9f450f1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae0fc8d6520950868365011d1a9f450f1_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a3a9729ea5b2e299a735b43f2b23e50a7}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_wrap\_key@{yh\_util\_import\_wrap\_key}}
\index{yh\_util\_import\_wrap\_key@{yh\_util\_import\_wrap\_key}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_wrap\_key()}{yh\_util\_import\_wrap\_key()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a3a9729ea5b2e299a735b43f2b23e50a7} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+wrap\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{key\+\_\+id}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{delegated\+\_\+capabilities}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{}\end{DoxyParamCaption})}

Import a Wrap Key into the device


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID the Wrap Key. 0 if the Object ID should be generated by the device \\
\hline
{\em label} & Label of the Wrap Key. Maximum length is \doxylink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\+\_\+\+OBJ\+\_\+\+LABEL\+\_\+\+LEN} \\
\hline
{\em domains} & Domains where the Wrap Key will be operating within. See \doxylink{yubihsm_8h_a96a4c751a281515d5610adb8fd779438}{yh\+\_\+string\+\_\+to\+\_\+domains()} \\
\hline
{\em capabilities} & Capabilities of the Wrap Key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em algorithm} & Algorithm of the Wrap Key. Supported algorithms\+: \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae22b228e457c9bdccb5a93d81730b1b1}{YH\+\_\+\+ALGO\+\_\+\+AES128\+\_\+\+CCM\+\_\+\+WRAP}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab739a1d142dacaf37ba13a73e2d83fab}{YH\+\_\+\+ALGO\+\_\+\+AES192\+\_\+\+CCM\+\_\+\+WRAP} and \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa927e2246e5657f946b4da4b71092b022}{YH\+\_\+\+ALGO\+\_\+\+AES256\+\_\+\+CCM\+\_\+\+WRAP} \\
\hline
{\em delegated\+\_\+capabilities} & Delegated capabilities of the Wrap Key. See \doxylink{yubihsm_8h_aab440e1cb671d9ba7a2e7d1243960e42}{yh\+\_\+string\+\_\+to\+\_\+capabilities()} \\
\hline
{\em in} & the Wrap Key to import \\
\hline
{\em in\+\_\+len} & Length of the Wrap Key to import\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL, {\ttfamily in\+\_\+len} is not what expected based on the algorithm and if the algorithms is not one of \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae22b228e457c9bdccb5a93d81730b1b1}{YH\+\_\+\+ALGO\+\_\+\+AES128\+\_\+\+CCM\+\_\+\+WRAP}, \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab739a1d142dacaf37ba13a73e2d83fab}{YH\+\_\+\+ALGO\+\_\+\+AES192\+\_\+\+CCM\+\_\+\+WRAP} or \doxylink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa927e2246e5657f946b4da4b71092b022}{YH\+\_\+\+ALGO\+\_\+\+AES256\+\_\+\+CCM\+\_\+\+WRAP}. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02363}{2363}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02369\ }
\DoxyCodeLine{02370\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ ==\ NULL\ ||}
\DoxyCodeLine{02371\ \ \ \ \ \ \ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}\ ==\ NULL\ ||}
\DoxyCodeLine{02372\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}\ ==\ NULL\ ||\ in\ ==\ NULL)\ \{}
\DoxyCodeLine{02373\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02374\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02375\ \ \ \}}
\DoxyCodeLine{02376\ }
\DoxyCodeLine{02377\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02378\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02379\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02380\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02381\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}[\mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}];}
\DoxyCodeLine{02382\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}};}
\DoxyCodeLine{02383\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{02384\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02385\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}}[\mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}}];}
\DoxyCodeLine{02386\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ key[32];}
\DoxyCodeLine{02387\ \ \ \ \ \};}
\DoxyCodeLine{02388\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02389\ \ \ \}\ data;}
\DoxyCodeLine{02390\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \textcolor{keyword}{sizeof}(data);}
\DoxyCodeLine{02391\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02392\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02393\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02394\ \ \ \ \ \};}
\DoxyCodeLine{02395\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02396\ \ \ \}\ response;}
\DoxyCodeLine{02397\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02398\ }
\DoxyCodeLine{02399\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02400\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02401\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}};}
\DoxyCodeLine{02402\ }
\DoxyCodeLine{02403\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02404\ }
\DoxyCodeLine{02405\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{02406\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caae22b228e457c9bdccb5a93d81730b1b1}{YH\_ALGO\_AES128\_CCM\_WRAP}}:}
\DoxyCodeLine{02407\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}}\ =\ 16;}
\DoxyCodeLine{02408\ \ \ \ \ \ \ data\_len\ -\/=\ 16;}
\DoxyCodeLine{02409\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02410\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caab739a1d142dacaf37ba13a73e2d83fab}{YH\_ALGO\_AES192\_CCM\_WRAP}}:}
\DoxyCodeLine{02411\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}}\ =\ 24;}
\DoxyCodeLine{02412\ \ \ \ \ \ \ data\_len\ -\/=\ 8;}
\DoxyCodeLine{02413\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02414\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55caa927e2246e5657f946b4da4b71092b022}{YH\_ALGO\_AES256\_CCM\_WRAP}}:}
\DoxyCodeLine{02415\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}}\ =\ 32;}
\DoxyCodeLine{02416\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02417\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{02418\ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Bad\ algorithm\ specified:\ \%x"{}},\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}});}
\DoxyCodeLine{02419\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02420\ \ \ \}}
\DoxyCodeLine{02421\ }
\DoxyCodeLine{02422\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ !=\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}})\ \{}
\DoxyCodeLine{02423\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Key\ length\ not\ matching,\ should\ be\ \%d"{}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}});}
\DoxyCodeLine{02424\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02425\ \ \ \}}
\DoxyCodeLine{02426\ }
\DoxyCodeLine{02427\ \ \ data.key\_id\ =\ htons(*\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02428\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.label,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02429\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(data.label\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{02430\ \ \ data.domains\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}});}
\DoxyCodeLine{02431\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}},\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{02432\ \ \ data.algorithm\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{02433\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.delegated\_capabilities,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_afa62e10709d52e5162a732e81369a7ec}{delegated\_capabilities}},}
\DoxyCodeLine{02434\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}});}
\DoxyCodeLine{02435\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.key,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a8b142e2a51f6b9b8760f9132119673b6}{key\_len}});}
\DoxyCodeLine{02436\ }
\DoxyCodeLine{02437\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_PUT\_WRAP\_KEY,\ data.buf,\ data\_len,}
\DoxyCodeLine{02438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response.buf,\ \&response\_len);}
\DoxyCodeLine{02439\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ data\_len);}
\DoxyCodeLine{02440\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02441\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ PUT\ WRAP\ KEY\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02442\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02443\ \ \ \}}
\DoxyCodeLine{02444\ }
\DoxyCodeLine{02445\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02446\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response.buf[0]);}
\DoxyCodeLine{02447\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ store\ wrapping\ key:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02448\ \ \ \ \ \ \ \ \ \ \ \ \ response.buf[0]);}
\DoxyCodeLine{02449\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02450\ \ \ \}}
\DoxyCodeLine{02451\ }
\DoxyCodeLine{02452\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ ntohs(response.key\_id);}
\DoxyCodeLine{02453\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Imported\ Wrap\ key\ 0x\%04x"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02454\ }
\DoxyCodeLine{02455\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02456\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a3a9729ea5b2e299a735b43f2b23e50a7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a3a9729ea5b2e299a735b43f2b23e50a7_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ae5bf13f9558bb0340468b722accf94d3}\index{yubihsm.c@{yubihsm.c}!yh\_util\_import\_wrapped@{yh\_util\_import\_wrapped}}
\index{yh\_util\_import\_wrapped@{yh\_util\_import\_wrapped}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_import\_wrapped()}{yh\_util\_import\_wrapped()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ae5bf13f9558bb0340468b722accf94d3} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+import\+\_\+wrapped (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{wrapping\+\_\+key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}} \texorpdfstring{$\ast$}{*}}]{target\+\_\+type}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{target\+\_\+id}{}\end{DoxyParamCaption})}

Import a wrapped object into the device. The object should have been previously exported by \doxylink{yubihsm_8h_aa3f473e6dbb9188ad0269b40921c4f5f}{yh\+\_\+util\+\_\+export\+\_\+wrapped()}


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em wrapping\+\_\+key\+\_\+id} & Object ID of the Wrap Key to use to unwrap the object \\
\hline
{\em in} & Wrapped data \\
\hline
{\em in\+\_\+len} & Length of wrapped data \\
\hline
{\em target\+\_\+type} & Type of the imported object \\
\hline
{\em target\+\_\+id} & Object ID of the imported object\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02309}{2309}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02312\ }
\DoxyCodeLine{02313\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a16deaf35253f2106ecf4fd8003b1284f}{target\_type}}\ ==\ NULL\ ||}
\DoxyCodeLine{02314\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ad82e96deab6d88b5e26f9f11da9d3fa3}{target\_id}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02315\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02316\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02317\ \ \ \}}
\DoxyCodeLine{02318\ }
\DoxyCodeLine{02319\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{02320\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{02321\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02322\ \ \ \}}
\DoxyCodeLine{02323\ }
\DoxyCodeLine{02324\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02325\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02326\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02327\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02328\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2];}
\DoxyCodeLine{02329\ \ \ \ \ \};}
\DoxyCodeLine{02330\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02331\ \ \ \}\ data;}
\DoxyCodeLine{02332\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02333\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ 2\ +\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}};}
\DoxyCodeLine{02334\ }
\DoxyCodeLine{02335\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{02336\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02337\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02338\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02339\ }
\DoxyCodeLine{02340\ \ \ data.key\_id\ =\ htons(wrapping\_key\_id);}
\DoxyCodeLine{02341\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{02342\ }
\DoxyCodeLine{02343\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_IMPORT\_WRAPPED,\ data.buf,\ data\_len,}
\DoxyCodeLine{02344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response,\ \&response\_len);}
\DoxyCodeLine{02345\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02346\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ IMPORT\ WRAPPED\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02347\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02348\ \ \ \}}
\DoxyCodeLine{02349\ }
\DoxyCodeLine{02350\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02351\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{02352\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02353\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{02354\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02355\ \ \ \}}
\DoxyCodeLine{02356\ }
\DoxyCodeLine{02357\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a16deaf35253f2106ecf4fd8003b1284f}{target\_type}}\ =\ response[0];}
\DoxyCodeLine{02358\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_ad82e96deab6d88b5e26f9f11da9d3fa3}{target\_id}}\ =\ ntohs(*((\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ *)\ (response\ +\ 1)));}
\DoxyCodeLine{02359\ }
\DoxyCodeLine{02360\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02361\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae5bf13f9558bb0340468b722accf94d3_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ae5bf13f9558bb0340468b722accf94d3_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a7cbea7103efff8473ccfaaa35bfc6346}\index{yubihsm.c@{yubihsm.c}!yh\_util\_list\_objects@{yh\_util\_list\_objects}}
\index{yh\_util\_list\_objects@{yh\_util\_list\_objects}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_list\_objects()}{yh\_util\_list\_objects()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a7cbea7103efff8473ccfaaa35bfc6346} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+list\+\_\+objects (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{id}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type}}}]{type}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{domains}{, }\item[{const \mbox{\hyperlink{structyh__capabilities}{yh\+\_\+capabilities}} \texorpdfstring{$\ast$}{*}}]{capabilities}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{algorithm}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{label}{, }\item[{\mbox{\hyperlink{structyh__object__descriptor}{yh\+\_\+object\+\_\+descriptor}} \texorpdfstring{$\ast$}{*}}]{objects}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{n\+\_\+objects}{}\end{DoxyParamCaption})}

\doxylink{struct_list}{List} objects accessible from the session


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em id} & Object ID to filter by (0 to not filter by ID) \\
\hline
{\em type} & Object type to filter by (0 to not filter by type). See \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583}{yh\+\_\+object\+\_\+type} \\
\hline
{\em domains} & Domains to filter by (0 to not filter by domain) \\
\hline
{\em capabilities} & Capabilities to filter by (0 to not filter by capabilities). See \doxylink{structyh__capabilities}{yh\+\_\+capabilities} \\
\hline
{\em algorithm} & Algorithm to filter by (0 to not filter by algorithm) \\
\hline
{\em label} & Label to filter by \\
\hline
{\em objects} & Array of objects returned \\
\hline
{\em n\+\_\+objects} & Max number of objects (will be set to number found on return)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\+\_\+\+BUFFER\+\_\+\+TOO\+\_\+\+SMALL} if n\+\_\+objects is smaller than the number of objects found. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Object.html}{\texttt{ Objects}}, \href{https://developers.yubico.com/YubiHSM2/Concepts/Domain.html}{\texttt{ Domains}}, \href{https://developers.yubico.com/YubiHSM2/Concepts/Capability.html}{\texttt{ Capabilities}}, \href{https://developers.yubico.com/YubiHSM2/Concepts/Algorithms.html}{\texttt{ Algorithms}}, \href{https://developers.yubico.com/YubiHSM2/Concepts/Label.html}{\texttt{ Labels}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01030}{1030}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01035\ }
\DoxyCodeLine{01036\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ objects\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a351300ca15aa70c149f1301f89bcbe9b}{n\_objects}}\ ==\ NULL\ ||}
\DoxyCodeLine{01037\ \ \ \ \ \ \ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ !=\ NULL\ \&\&\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}})\ >\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}))\ \{}
\DoxyCodeLine{01038\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01039\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01040\ \ \ \}}
\DoxyCodeLine{01041\ }
\DoxyCodeLine{01042\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ data[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01043\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ *dataptr\ =\ data;}
\DoxyCodeLine{01044\ }
\DoxyCodeLine{01045\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01046\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{01047\ }
\DoxyCodeLine{01048\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01049\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01050\ }
\DoxyCodeLine{01051\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{01052\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8c_a0b9ea5683398966b2db794d1a5a78005}{LIST\_ID}};}
\DoxyCodeLine{01053\ \ \ \ \ *dataptr++\ =\ \textcolor{keywordtype}{id}\ >>\ 8\ \&\ 0xff;}
\DoxyCodeLine{01054\ \ \ \ \ *dataptr++\ =\ \textcolor{keywordtype}{id}\ \&\ 0xff;}
\DoxyCodeLine{01055\ \ \ \}}
\DoxyCodeLine{01056\ }
\DoxyCodeLine{01057\ \ \ \textcolor{keywordflow}{if}\ (type)\ \{}
\DoxyCodeLine{01058\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8c_aa606355c30aa4b5f0ad83d25ed069b25}{LIST\_TYPE}};}
\DoxyCodeLine{01059\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8h_a1d127017fb298b889f4ba24752d08b8e}{type}};}
\DoxyCodeLine{01060\ \ \ \}}
\DoxyCodeLine{01061\ }
\DoxyCodeLine{01062\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}})\ \{}
\DoxyCodeLine{01063\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8c_a2eea78213279842d562d311a118c4e64}{LIST\_DOMAINS}};}
\DoxyCodeLine{01064\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}\ >>\ 8\ \&\ 0xff;}
\DoxyCodeLine{01065\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a5420fd4d2f76428942c2716b1cb7e863}{domains}}\ \&\ 0xff;}
\DoxyCodeLine{01066\ \ \ \}}
\DoxyCodeLine{01067\ }
\DoxyCodeLine{01068\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}})\ \{}
\DoxyCodeLine{01069\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8c_a4144e686fa1e1d546a89875fb152ed4b}{LIST\_ALGORITHM}};}
\DoxyCodeLine{01070\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8h_a67bb26eddc39413f8e94c98aedbbd391}{algorithm}};}
\DoxyCodeLine{01071\ \ \ \}}
\DoxyCodeLine{01072\ }
\DoxyCodeLine{01073\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}\ \&\&\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}))\ \{}
\DoxyCodeLine{01074\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8c_a0b34189280c5fe21d735f5bd67ce2c1e}{LIST\_LABEL}};}
\DoxyCodeLine{01075\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(dataptr,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}},\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{01076\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(dataptr\ +\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}),\ 0,\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}}\ -\/\ strlen(\mbox{\hyperlink{yubihsm__pkcs11_8c_a22f45a3cb4f074e609f58ebaeef0ecf9}{label}}));}
\DoxyCodeLine{01077\ \ \ \ \ dataptr\ +=\ \mbox{\hyperlink{yubihsm_8h_a431f8b753552a8b2f5f980e871b6d019}{YH\_OBJ\_LABEL\_LEN}};}
\DoxyCodeLine{01078\ \ \ \}}
\DoxyCodeLine{01079\ }
\DoxyCodeLine{01080\ \ \ \textcolor{keywordtype}{bool}\ send\_capabilities\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01081\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}};\ i++)\ \{}
\DoxyCodeLine{01082\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}-\/>\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}}[i])\ \{}
\DoxyCodeLine{01083\ \ \ \ \ \ \ send\_capabilities\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01084\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01085\ \ \ \ \ \}}
\DoxyCodeLine{01086\ \ \ \}}
\DoxyCodeLine{01087\ }
\DoxyCodeLine{01088\ \ \ \textcolor{keywordflow}{if}\ (send\_capabilities\ ==\ \textcolor{keyword}{true})\ \{}
\DoxyCodeLine{01089\ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm_8c_ad2887e3e4dd005035b369ba8a9ec94b7}{LIST\_CAPABILITIES}};}
\DoxyCodeLine{01090\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{yubihsm_8h_ad3c904849d17cae0a6f426e8007731d7}{YH\_CAPABILITIES\_LEN}};\ i++)\ \{}
\DoxyCodeLine{01091\ \ \ \ \ \ \ *dataptr++\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a08393519edfd7c59fb01fb8db97514b5}{capabilities}}-\/>\mbox{\hyperlink{structyh__capabilities_a5398bad7e61385aa127265ba0a053079}{capabilities}}[i];}
\DoxyCodeLine{01092\ \ \ \ \ \}}
\DoxyCodeLine{01093\ \ \ \}}
\DoxyCodeLine{01094\ }
\DoxyCodeLine{01095\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_LIST\_OBJECTS,\ data,\ dataptr\ -\/\ data,}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response,\ \&response\_len);}
\DoxyCodeLine{01097\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01098\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ LIST\ OBJECTS\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01099\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01100\ \ \ \}}
\DoxyCodeLine{01101\ }
\DoxyCodeLine{01102\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01103\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{01104\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ list\ objects:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{01106\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01107\ \ \ \}}
\DoxyCodeLine{01108\ }
\DoxyCodeLine{01109\ \ \ \textcolor{keywordflow}{if}\ ((response\_len\ /\ 4)\ >\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a351300ca15aa70c149f1301f89bcbe9b}{n\_objects}})\ \{}
\DoxyCodeLine{01110\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Objects\ buffer\ too\ small"{}});}
\DoxyCodeLine{01111\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366ad8971a0b9647564b76b3f4e4b662c965}{YHR\_BUFFER\_TOO\_SMALL}};}
\DoxyCodeLine{01112\ \ \ \}}
\DoxyCodeLine{01113\ }
\DoxyCodeLine{01114\ \ \ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a351300ca15aa70c149f1301f89bcbe9b}{n\_objects}}\ =\ response\_len\ /\ 4;}
\DoxyCodeLine{01115\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ i\ =\ 0;\ i\ <\ response\_len;\ i\ +=\ 4)\ \{}
\DoxyCodeLine{01116\ \ \ \ \ \textcolor{comment}{//\ NOTE:\ clear\ the\ fields\ that\ we\ didn't\ set}}
\DoxyCodeLine{01117\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_adc4bd59a60361844aa0e852efa210105}{memset}}(\&objects[i\ /\ 4],\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structyh__object__descriptor}{yh\_object\_descriptor}}));}
\DoxyCodeLine{01118\ \ \ \ \ objects[i\ /\ 4].\mbox{\hyperlink{structyh__object__descriptor_a8683d3f22f1e8ba56e3caea8ed8504ec}{id}}\ =\ ntohs(*((\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ *)\ (response\ +\ i)));}
\DoxyCodeLine{01119\ \ \ \ \ objects[i\ /\ 4].\mbox{\hyperlink{structyh__object__descriptor_ab8c1b3cc5b859e3c89eb228fa0763165}{type}}\ =\ response[i\ +\ 2];}
\DoxyCodeLine{01120\ \ \ \ \ objects[i\ /\ 4].\mbox{\hyperlink{structyh__object__descriptor_a84e5c94f9a0a39eb7ed39444c48ab4b5}{sequence}}\ =\ response[i\ +\ 3];}
\DoxyCodeLine{01121\ \ \ \}}
\DoxyCodeLine{01122\ }
\DoxyCodeLine{01123\ \ \ \mbox{\hyperlink{debug__lib_8h_a8c4742440a149ad8bcb5d58ae76c5ed3}{DBG\_INFO}}(\textcolor{stringliteral}{"{}Found\ \%zu\ objects"{}},\ *\mbox{\hyperlink{yubihsm__pkcs11_8c_a351300ca15aa70c149f1301f89bcbe9b}{n\_objects}});}
\DoxyCodeLine{01124\ }
\DoxyCodeLine{01125\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01126\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7cbea7103efff8473ccfaaa35bfc6346_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7cbea7103efff8473ccfaaa35bfc6346_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a4bb1d420f681bc91bd36dc08695dbad6}\index{yubihsm.c@{yubihsm.c}!yh\_util\_randomize\_otp\_aead@{yh\_util\_randomize\_otp\_aead}}
\index{yh\_util\_randomize\_otp\_aead@{yh\_util\_randomize\_otp\_aead}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_randomize\_otp\_aead()}{yh\_util\_randomize\_otp\_aead()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a4bb1d420f681bc91bd36dc08695dbad6} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+randomize\+\_\+otp\+\_\+aead (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Create OTP AEAD from random data


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the Otp-\/aead Key to use \\
\hline
{\em out} & The created AEAD \\
\hline
{\em out\+\_\+len} & Length of the created AEAD\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03223}{3223}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03225\ }
\DoxyCodeLine{03226\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03227\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03228\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03229\ \ \ \}}
\DoxyCodeLine{03230\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03231\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03232\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03233\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03234\ \ \ \ \ \};}
\DoxyCodeLine{03235\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03236\ \ \ \}\ data;}
\DoxyCodeLine{03237\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03238\ }
\DoxyCodeLine{03239\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03240\ }
\DoxyCodeLine{03241\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03242\ }
\DoxyCodeLine{03243\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_RANDOMIZE\_OTP\_AEAD,\ data.buf,}
\DoxyCodeLine{03244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(data),\ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{03245\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03246\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ RANDOMIZE\ OTP\ AEAD\ command:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{03247\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03248\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03249\ \ \ \}}
\DoxyCodeLine{03250\ }
\DoxyCodeLine{03251\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03252\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{03253\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ OTP\ AEAD:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03254\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{03255\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03256\ \ \ \}}
\DoxyCodeLine{03257\ }
\DoxyCodeLine{03258\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03259\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a4bb1d420f681bc91bd36dc08695dbad6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a4bb1d420f681bc91bd36dc08695dbad6_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a5c153fe27877bcc7927d391fb55550af}\index{yubihsm.c@{yubihsm.c}!yh\_util\_reset\_device@{yh\_util\_reset\_device}}
\index{yh\_util\_reset\_device@{yh\_util\_reset\_device}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_reset\_device()}{yh\_util\_reset\_device()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a5c153fe27877bcc7927d391fb55550af} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+reset\+\_\+device (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{}\end{DoxyParamCaption})}

Factory reset the device. Resets and reboots the device, deletes all Objects and restores the default \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583acee44b775b3c5b6157f0732699935074}{YH\+\_\+\+AUTHENTICATION\+\_\+\+KEY}.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03796}{3796}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03797\ }
\DoxyCodeLine{03798\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03799\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03800\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03801\ \ \ \}}
\DoxyCodeLine{03802\ }
\DoxyCodeLine{03803\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03804\ }
\DoxyCodeLine{03805\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03806\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[1];}
\DoxyCodeLine{03807\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{03808\ }
\DoxyCodeLine{03809\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_RESET\_DEVICE,\ NULL,\ 0,\ \&response\_cmd,}
\DoxyCodeLine{03810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response,\ \&response\_len);}
\DoxyCodeLine{03811\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03812\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ RESET\ DEVICE\ command:\ \%s\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03813\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03814\ \ \ \}}
\DoxyCodeLine{03815\ }
\DoxyCodeLine{03816\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03817\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{03818\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ reset:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ response[0]);}
\DoxyCodeLine{03819\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03820\ \ \ \}}
\DoxyCodeLine{03821\ }
\DoxyCodeLine{03822\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03823\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5c153fe27877bcc7927d391fb55550af_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5c153fe27877bcc7927d391fb55550af_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a9d844855c9066bbea0e4344978dd7fdc}\index{yubihsm.c@{yubihsm.c}!yh\_util\_set\_log\_index@{yh\_util\_set\_log\_index}}
\index{yh\_util\_set\_log\_index@{yh\_util\_set\_log\_index}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_set\_log\_index()}{yh\_util\_set\_log\_index()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a9d844855c9066bbea0e4344978dd7fdc} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+set\+\_\+log\+\_\+index (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{index}{}\end{DoxyParamCaption})}

Set the index of the last extracted log entry.

This function should be called after \doxylink{yubihsm_8h_a5ae52ad56b7e83baeb33b46104263aa6}{yh\+\_\+util\+\_\+get\+\_\+log\+\_\+entries()} to inform the device what the last extracted log entry is so new logs can be written. This is used when forced auditing is enabled.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em index} & index to set. Should be the same index as the last entry extracted using \doxylink{yubihsm_8h_a5ae52ad56b7e83baeb33b46104263aa6}{yh\+\_\+util\+\_\+get\+\_\+log\+\_\+entries()}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if the session is NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02606}{2606}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02607\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL)\ \{}
\DoxyCodeLine{02608\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02609\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02610\ \ \ \}}
\DoxyCodeLine{02611\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ data[2];}
\DoxyCodeLine{02612\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02613\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02614\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{02615\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{02616\ }
\DoxyCodeLine{02617\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ index\_h\ =\ htons(index);}
\DoxyCodeLine{02618\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data,\ \&index\_h,\ \textcolor{keyword}{sizeof}(index\_h));}
\DoxyCodeLine{02619\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SET\_LOG\_INDEX,\ data,\ \textcolor{keyword}{sizeof}(data),}
\DoxyCodeLine{02620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response,\ \&response\_len);}
\DoxyCodeLine{02621\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02622\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SET\ LOG\ INDEX\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02623\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02624\ \ \ \}}
\DoxyCodeLine{02625\ }
\DoxyCodeLine{02626\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02627\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{02628\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ set\ log\ index:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02629\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{02630\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02631\ \ \ \}}
\DoxyCodeLine{02632\ }
\DoxyCodeLine{02633\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02634\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9d844855c9066bbea0e4344978dd7fdc_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9d844855c9066bbea0e4344978dd7fdc_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a85ac840aec77cb1ca3c3ce1f2ab26282}\index{yubihsm.c@{yubihsm.c}!yh\_util\_set\_option@{yh\_util\_set\_option}}
\index{yh\_util\_set\_option@{yh\_util\_set\_option}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_set\_option()}{yh\_util\_set\_option()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a85ac840aec77cb1ca3c3ce1f2ab26282} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+set\+\_\+option (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option}}}]{option}{, }\item[{size\+\_\+t}]{len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{val}{}\end{DoxyParamCaption})}

Set a device-\/global option


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em option} & Option to set. See \doxylink{yubihsm_8h_acc8090ce0ec5029b376803e44b1cb4aa}{yh\+\_\+option} \\
\hline
{\em len} & Length of option value \\
\hline
{\em val} & Option value\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if {\ttfamily session} or {\ttfamily val} are NULL or if {\ttfamily len} is too long. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03537}{3537}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03539\ }
\DoxyCodeLine{03540\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ val\ ==\ NULL)\ \{}
\DoxyCodeLine{03541\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03542\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03543\ \ \ \}}
\DoxyCodeLine{03544\ }
\DoxyCodeLine{03545\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 3)\ \{}
\DoxyCodeLine{03546\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 3);}
\DoxyCodeLine{03547\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03548\ \ \ \}}
\DoxyCodeLine{03549\ }
\DoxyCodeLine{03550\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03551\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03552\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03553\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}};}
\DoxyCodeLine{03554\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}};}
\DoxyCodeLine{03555\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[1];}
\DoxyCodeLine{03556\ \ \ \ \ \};}
\DoxyCodeLine{03557\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{03558\ \ \ \}\ data;}
\DoxyCodeLine{03559\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03560\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ out[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{03561\ \ \ \textcolor{keywordtype}{size\_t}\ outlen\ =\ \textcolor{keyword}{sizeof}(out);}
\DoxyCodeLine{03562\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03563\ }
\DoxyCodeLine{03564\ \ \ data.option\ =\ \mbox{\hyperlink{yubihsm_8h_a023826538a428f5f8c53aaef5e9aec02}{option}};}
\DoxyCodeLine{03565\ \ \ data.len\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}});}
\DoxyCodeLine{03566\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ val,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}});}
\DoxyCodeLine{03567\ }
\DoxyCodeLine{03568\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SET\_OPTION,\ data.buf,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a7360b55975153b822efc5217b7734e6a}{len}}\ +\ 3,}
\DoxyCodeLine{03569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \&outlen);}
\DoxyCodeLine{03570\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03571\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SET\ OPTION\ command:\ \%s\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03572\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03573\ \ \ \}}
\DoxyCodeLine{03574\ }
\DoxyCodeLine{03575\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03576\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{03577\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ put\ option:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ out[0]);}
\DoxyCodeLine{03578\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03579\ \ \ \}}
\DoxyCodeLine{03580\ }
\DoxyCodeLine{03581\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03582\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a85ac840aec77cb1ca3c3ce1f2ab26282_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a85ac840aec77cb1ca3c3ce1f2ab26282_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a5988faffd97366b188728ff1a7fb6e89}\index{yubihsm.c@{yubihsm.c}!yh\_util\_sign\_attestation\_certificate@{yh\_util\_sign\_attestation\_certificate}}
\index{yh\_util\_sign\_attestation\_certificate@{yh\_util\_sign\_attestation\_certificate}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_sign\_attestation\_certificate()}{yh\_util\_sign\_attestation\_certificate()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a5988faffd97366b188728ff1a7fb6e89} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+sign\+\_\+attestation\+\_\+certificate (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{attest\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Get attestation of an Asymmetric Key in the form of an X.\+509 certificate


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the Asymmetric Key to attest \\
\hline
{\em attest\+\_\+id} & Object ID for the key used to sign the attestation certificate \\
\hline
{\em out} & The attestation certificate \\
\hline
{\em out\+\_\+len} & Length of the attestation certificate\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03495}{3495}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03498\ }
\DoxyCodeLine{03499\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03500\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03501\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03502\ \ \ \}}
\DoxyCodeLine{03503\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03504\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03505\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03506\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03507\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ attest\_id;}
\DoxyCodeLine{03508\ \ \ \ \ \};}
\DoxyCodeLine{03509\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03510\ \ \ \}\ data;}
\DoxyCodeLine{03511\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03512\ }
\DoxyCodeLine{03513\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03514\ }
\DoxyCodeLine{03515\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03516\ \ \ data.attest\_id\ =\ htons(attest\_id);}
\DoxyCodeLine{03517\ }
\DoxyCodeLine{03518\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =}
\DoxyCodeLine{03519\ \ \ \ \ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SIGN\_ATTESTATION\_CERTIFICATE,\ data.buf,}
\DoxyCodeLine{03520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(data),\ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{03521\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03522\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SIGN\ ATTESTATION\ CERTIFICATE\ command:\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{03523\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03524\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03525\ \ \ \}}
\DoxyCodeLine{03526\ }
\DoxyCodeLine{03527\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03528\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{03529\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ attestation:\ \%s\ (\%x)\(\backslash\)n"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03530\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{03531\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03532\ \ \ \}}
\DoxyCodeLine{03533\ }
\DoxyCodeLine{03534\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03535\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5988faffd97366b188728ff1a7fb6e89_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5988faffd97366b188728ff1a7fb6e89_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a5121c90d3bd745afd8264fef2ef39ace}\index{yubihsm.c@{yubihsm.c}!yh\_util\_sign\_ecdsa@{yh\_util\_sign\_ecdsa}}
\index{yh\_util\_sign\_ecdsa@{yh\_util\_sign\_ecdsa}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_sign\_ecdsa()}{yh\_util\_sign\_ecdsa()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a5121c90d3bd745afd8264fef2ef39ace} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+sign\+\_\+ecdsa (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Sign data using ECDSA

{\ttfamily in} is a raw hashed message, a truncated hash to the curve length or a padded hash to the curve length


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the signing key \\
\hline
{\em in} & \doxylink{struct_data}{Data} to sign \\
\hline
{\em in\+\_\+len} & Length of data to sign \\
\hline
{\em out} & Signed data \\
\hline
{\em out\+\_\+len} & Length of signed data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily in\+\_\+len} is not 20, 28, 34, 48, 64 or 66. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01411}{1411}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01414\ }
\DoxyCodeLine{01415\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01416\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01417\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01418\ \ \ \}}
\DoxyCodeLine{01419\ }
\DoxyCodeLine{01420\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}})\ \{}
\DoxyCodeLine{01421\ \ \ \ \ \textcolor{keywordflow}{case}\ 20:}
\DoxyCodeLine{01422\ \ \ \ \ \textcolor{keywordflow}{case}\ 28:\ \textcolor{comment}{//\ p224..}}
\DoxyCodeLine{01423\ \ \ \ \ \textcolor{keywordflow}{case}\ 32:}
\DoxyCodeLine{01424\ \ \ \ \ \textcolor{keywordflow}{case}\ 48:}
\DoxyCodeLine{01425\ \ \ \ \ \textcolor{keywordflow}{case}\ 64:}
\DoxyCodeLine{01426\ \ \ \ \ \textcolor{keywordflow}{case}\ 66:\ \textcolor{comment}{//\ p521\ needs\ 66\ bytes\ input}}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01428\ }
\DoxyCodeLine{01429\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01430\ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Data\ length\ must\ be\ 20,\ 28,\ 32,\ 48,\ 64\ or\ 66"{}});}
\DoxyCodeLine{01431\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01432\ \ \ \}}
\DoxyCodeLine{01433\ }
\DoxyCodeLine{01434\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01435\ }
\DoxyCodeLine{01436\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{01437\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01438\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01441\ \ \ \ \ \};}
\DoxyCodeLine{01442\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{01443\ \ \ \}\ data;}
\DoxyCodeLine{01444\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{01445\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}};}
\DoxyCodeLine{01446\ }
\DoxyCodeLine{01447\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01448\ }
\DoxyCodeLine{01449\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{01450\ }
\DoxyCodeLine{01451\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{01452\ }
\DoxyCodeLine{01453\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SIGN\_ECDSA,\ data.buf,\ data\_len\ +\ 2,}
\DoxyCodeLine{01454\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{01455\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01456\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SIGN\ ECDSA\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01457\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01458\ \ \ \}}
\DoxyCodeLine{01459\ }
\DoxyCodeLine{01460\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01461\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{01462\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ signature:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01463\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{01464\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01465\ \ \ \}}
\DoxyCodeLine{01466\ }
\DoxyCodeLine{01467\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01468\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5121c90d3bd745afd8264fef2ef39ace_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a5121c90d3bd745afd8264fef2ef39ace_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a690a5585de21ce82495e139ec1dfdf9d}\index{yubihsm.c@{yubihsm.c}!yh\_util\_sign\_eddsa@{yh\_util\_sign\_eddsa}}
\index{yh\_util\_sign\_eddsa@{yh\_util\_sign\_eddsa}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_sign\_eddsa()}{yh\_util\_sign\_eddsa()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a690a5585de21ce82495e139ec1dfdf9d} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+sign\+\_\+eddsa (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Sign data using Ed\+DSA


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the signing key \\
\hline
{\em in} & \doxylink{struct_data}{Data} to sign \\
\hline
{\em in\+\_\+len} & Length of data to sign \\
\hline
{\em out} & Signed data \\
\hline
{\em out\+\_\+len} & Length of signed data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily in\+\_\+len} is bigger than YH\+\_\+\+MSG\+\_\+\+BUF\+\_\+\+SIZE-\/2. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01470}{1470}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01473\ }
\DoxyCodeLine{01474\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01475\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01476\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01477\ \ \ \}}
\DoxyCodeLine{01478\ }
\DoxyCodeLine{01479\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{01480\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{01481\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01482\ \ \ \}}
\DoxyCodeLine{01483\ }
\DoxyCodeLine{01484\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01485\ }
\DoxyCodeLine{01486\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{01487\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01488\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{01489\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01491\ \ \ \ \ \};}
\DoxyCodeLine{01492\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{01493\ \ \ \}\ data;}
\DoxyCodeLine{01494\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{01495\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}};}
\DoxyCodeLine{01496\ }
\DoxyCodeLine{01497\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01498\ }
\DoxyCodeLine{01499\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{01500\ }
\DoxyCodeLine{01501\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{01502\ }
\DoxyCodeLine{01503\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SIGN\_EDDSA,\ data.buf,\ data\_len\ +\ 2,}
\DoxyCodeLine{01504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{01505\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01506\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SIGN\ EDDSA\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01507\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01508\ \ \ \}}
\DoxyCodeLine{01509\ }
\DoxyCodeLine{01510\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01511\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{01512\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ signature:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{01514\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01515\ \ \ \}}
\DoxyCodeLine{01516\ }
\DoxyCodeLine{01517\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01518\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a690a5585de21ce82495e139ec1dfdf9d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a690a5585de21ce82495e139ec1dfdf9d_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a9000d43fe8cf7313b319f316521eb0c4}\index{yubihsm.c@{yubihsm.c}!yh\_util\_sign\_hmac@{yh\_util\_sign\_hmac}}
\index{yh\_util\_sign\_hmac@{yh\_util\_sign\_hmac}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_sign\_hmac()}{yh\_util\_sign\_hmac()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a9000d43fe8cf7313b319f316521eb0c4} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+sign\+\_\+hmac (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Sign data using HMAC


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the signing key \\
\hline
{\em in} & \doxylink{struct_data}{Data} to HMAC \\
\hline
{\em in\+\_\+len} & Length of data to hmac \\
\hline
{\em out} & HMAC \\
\hline
{\em out\+\_\+len} & Length of HMAC\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily in\+\_\+len} is bigger than YH\+\_\+\+MSG\+\_\+\+BUF\+\_\+\+SIZE-\/2. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01520}{1520}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01522\ }
\DoxyCodeLine{01523\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01524\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01525\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01526\ \ \ \}}
\DoxyCodeLine{01527\ }
\DoxyCodeLine{01528\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{01529\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{01530\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01531\ \ \ \}}
\DoxyCodeLine{01532\ }
\DoxyCodeLine{01533\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ data[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01534\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ 2;}
\DoxyCodeLine{01535\ }
\DoxyCodeLine{01536\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01537\ }
\DoxyCodeLine{01538\ \ \ data[0]\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}})\ \&\ 0xff;}
\DoxyCodeLine{01539\ \ \ data[1]\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}})\ >>\ 8;}
\DoxyCodeLine{01540\ }
\DoxyCodeLine{01541\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data\ +\ 2,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{01542\ \ \ data\_len\ +=\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}};}
\DoxyCodeLine{01543\ }
\DoxyCodeLine{01544\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SIGN\_HMAC,\ data,\ data\_len,}
\DoxyCodeLine{01545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{01546\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01547\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SIGN\ HMAC\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01548\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01549\ \ \ \}}
\DoxyCodeLine{01550\ }
\DoxyCodeLine{01551\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01552\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{01553\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),\ out[0]);}
\DoxyCodeLine{01554\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01555\ \ \ \}}
\DoxyCodeLine{01556\ }
\DoxyCodeLine{01557\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01558\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9000d43fe8cf7313b319f316521eb0c4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a9000d43fe8cf7313b319f316521eb0c4_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_aa0a7644b7b368d6aaf8b4aff5e3d19b8}\index{yubihsm.c@{yubihsm.c}!yh\_util\_sign\_pkcs1v1\_5@{yh\_util\_sign\_pkcs1v1\_5}}
\index{yh\_util\_sign\_pkcs1v1\_5@{yh\_util\_sign\_pkcs1v1\_5}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_sign\_pkcs1v1\_5()}{yh\_util\_sign\_pkcs1v1\_5()}}
{\footnotesize\ttfamily \label{yubihsm_8c_aa0a7644b7b368d6aaf8b4aff5e3d19b8} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+sign\+\_\+pkcs1v1\+\_\+5 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{bool}]{hashed}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Sign data using RSA-\/\+PKCS\#1v1.\+5

{\ttfamily in} is either a raw hashed message (sha1, sha256, sha384 or sha512) or that with correct digestinfo pre-\/pended


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the signing key \\
\hline
{\em hashed} & true if data is only hashed \\
\hline
{\em in} & data to sign \\
\hline
{\em in\+\_\+len} & length of data to sign \\
\hline
{\em out} & signed data \\
\hline
{\em out\+\_\+len} & length of signed data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily in\+\_\+len} is not 20, 34, 48 or 64. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01287}{1287}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01290\ }
\DoxyCodeLine{01291\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01292\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01293\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01294\ \ \ \}}
\DoxyCodeLine{01295\ }
\DoxyCodeLine{01296\ \ \ \textcolor{keywordflow}{if}\ (hashed)}
\DoxyCodeLine{01297\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}})\ \{}
\DoxyCodeLine{01298\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 20:}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 32:}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 48:}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 64:}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01303\ }
\DoxyCodeLine{01304\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Data\ length\ must\ be\ 20,\ 32,\ 48\ or\ 64"{}});}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01307\ \ \ \ \ \}}
\DoxyCodeLine{01308\ }
\DoxyCodeLine{01309\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01310\ }
\DoxyCodeLine{01311\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{01312\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01313\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01316\ \ \ \ \ \};}
\DoxyCodeLine{01317\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{01318\ \ \ \}\ data;}
\DoxyCodeLine{01319\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{01320\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len;}
\DoxyCodeLine{01321\ }
\DoxyCodeLine{01322\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01323\ }
\DoxyCodeLine{01324\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{01325\ }
\DoxyCodeLine{01326\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{01327\ \ \ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}};}
\DoxyCodeLine{01328\ }
\DoxyCodeLine{01329\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SIGN\_PKCS1,\ data.buf,\ data\_len\ +\ 2,}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{01331\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01332\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SIGN\ PKCS1\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01333\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01334\ \ \ \}}
\DoxyCodeLine{01335\ }
\DoxyCodeLine{01336\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01337\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{01338\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ signature:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{01340\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01341\ \ \ \}}
\DoxyCodeLine{01342\ }
\DoxyCodeLine{01343\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01344\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa0a7644b7b368d6aaf8b4aff5e3d19b8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_aa0a7644b7b368d6aaf8b4aff5e3d19b8_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a944e6f31487857709f032598fd43fef5}\index{yubihsm.c@{yubihsm.c}!yh\_util\_sign\_pss@{yh\_util\_sign\_pss}}
\index{yh\_util\_sign\_pss@{yh\_util\_sign\_pss}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_sign\_pss()}{yh\_util\_sign\_pss()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a944e6f31487857709f032598fd43fef5} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+sign\+\_\+pss (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{, }\item[{size\+\_\+t}]{salt\+\_\+len}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{mgf1\+Algo}{}\end{DoxyParamCaption})}

Sign data using RSA-\/\+PSS

{\ttfamily in} is a raw hashed message (sha1, sha256, sha384 or sha512)


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the signing key \\
\hline
{\em in} & \doxylink{struct_data}{Data} to sign \\
\hline
{\em in\+\_\+len} & Length of data to sign \\
\hline
{\em out} & Signed data \\
\hline
{\em out\+\_\+len} & Length of signed data \\
\hline
{\em salt\+\_\+len} & Length of salt \\
\hline
{\em mgf1\+Algo} & Algorithm for mgf1 (mask generation function for PSS)\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily in\+\_\+len} is not 20, 34, 48 or 64. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://tools.ietf.org/html/rfc8017\#section-9.1}{\texttt{ PSS specifications}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01346}{1346}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01349\ }
\DoxyCodeLine{01350\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{01351\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01352\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01353\ \ \ \}}
\DoxyCodeLine{01354\ }
\DoxyCodeLine{01355\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}})\ \{}
\DoxyCodeLine{01356\ \ \ \ \ \textcolor{keywordflow}{case}\ 20:}
\DoxyCodeLine{01357\ \ \ \ \ \textcolor{keywordflow}{case}\ 32:}
\DoxyCodeLine{01358\ \ \ \ \ \textcolor{keywordflow}{case}\ 48:}
\DoxyCodeLine{01359\ \ \ \ \ \textcolor{keywordflow}{case}\ 64:}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01361\ }
\DoxyCodeLine{01362\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Data\ length\ must\ be\ 20,\ 32,\ 48\ or\ 64"{}});}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01365\ \ \ \}}
\DoxyCodeLine{01366\ }
\DoxyCodeLine{01367\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{01370\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{01371\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ mgf1Algo;}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ salt\_len;}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01376\ \ \ \ \ \};}
\DoxyCodeLine{01377\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{01378\ \ \ \}\ data;}
\DoxyCodeLine{01379\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{01380\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}};}
\DoxyCodeLine{01381\ }
\DoxyCodeLine{01382\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01383\ }
\DoxyCodeLine{01384\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{01385\ }
\DoxyCodeLine{01386\ \ \ data.mgf1Algo\ =\ mgf1Algo;}
\DoxyCodeLine{01387\ }
\DoxyCodeLine{01388\ \ \ \textcolor{comment}{//\ NOTE(adma):\ 'in'\ is\ already\ a\ hash\ of\ the\ data,\ which\ type\ is\ inferred\ from}}
\DoxyCodeLine{01389\ \ \ \textcolor{comment}{//\ the\ length}}
\DoxyCodeLine{01390\ \ \ data.salt\_len\ =\ htons(salt\_len);}
\DoxyCodeLine{01391\ }
\DoxyCodeLine{01392\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{01393\ }
\DoxyCodeLine{01394\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SIGN\_PSS,\ data.buf,\ data\_len\ +\ 5,}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{01396\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01397\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SIGN\ PSS\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01398\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01399\ \ \ \}}
\DoxyCodeLine{01400\ }
\DoxyCodeLine{01401\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01402\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{01403\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ signature:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{01405\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01406\ \ \ \}}
\DoxyCodeLine{01407\ }
\DoxyCodeLine{01408\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01409\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a944e6f31487857709f032598fd43fef5_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a944e6f31487857709f032598fd43fef5_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a45c32b993856be818a70c0ffad589cbd}\index{yubihsm.c@{yubihsm.c}!yh\_util\_sign\_ssh\_certificate@{yh\_util\_sign\_ssh\_certificate}}
\index{yh\_util\_sign\_ssh\_certificate@{yh\_util\_sign\_ssh\_certificate}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_sign\_ssh\_certificate()}{yh\_util\_sign\_ssh\_certificate()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a45c32b993856be818a70c0ffad589cbd} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+sign\+\_\+ssh\+\_\+certificate (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{template\+\_\+id}{, }\item[{\mbox{\hyperlink{yubihsm_8h_a498937b5a72accbb0ef21bb1dcdd55ca}{yh\+\_\+algorithm}}}]{sig\+\_\+algo}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Sign an SSH Certificate request. The function produces a signature that can then be used to produce the SSH Certificate


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the key used to sign the request \\
\hline
{\em template\+\_\+id} & Object ID of the template to use as a certificate template \\
\hline
{\em sig\+\_\+algo} & Signature algorithm to use to sign the certificate request \\
\hline
{\em in} & Certificate request \\
\hline
{\em in\+\_\+len} & Length of the certificate request \\
\hline
{\em out} & Signature \\
\hline
{\em out\+\_\+len} & Length of the signature\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or {\ttfamily in\+\_\+len} is too big. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l02745}{2745}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02749\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL\ ||}
\DoxyCodeLine{02750\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ ==\ 0)\ \{}
\DoxyCodeLine{02751\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{02752\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02753\ \ \ \}}
\DoxyCodeLine{02754\ }
\DoxyCodeLine{02755\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02756\ }
\DoxyCodeLine{02757\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{02758\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{02759\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{02760\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{02761\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ template\_id;}
\DoxyCodeLine{02762\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ algo;}
\DoxyCodeLine{02763\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}})\ -\/\ \textcolor{keyword}{sizeof}(template\_id)\ -\/\ 2];}
\DoxyCodeLine{02764\ \ \ \ \ \};}
\DoxyCodeLine{02765\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{02766\ \ \ \}\ data;}
\DoxyCodeLine{02767\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len;}
\DoxyCodeLine{02768\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{02769\ }
\DoxyCodeLine{02770\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{02771\ }
\DoxyCodeLine{02772\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{02773\ }
\DoxyCodeLine{02774\ \ \ data.template\_id\ =\ htons(template\_id);}
\DoxyCodeLine{02775\ }
\DoxyCodeLine{02776\ \ \ data.algo\ =\ sig\_algo;}
\DoxyCodeLine{02777\ }
\DoxyCodeLine{02778\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \textcolor{keyword}{sizeof}(data.bytes))\ \{}
\DoxyCodeLine{02779\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Data\ length\ must\ be\ in\ [0,\ \%lu]\(\backslash\)n"{}},}
\DoxyCodeLine{02780\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\ \textcolor{keyword}{sizeof}(data.bytes));}
\DoxyCodeLine{02781\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{02782\ \ \ \}}
\DoxyCodeLine{02783\ }
\DoxyCodeLine{02784\ \ \ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ +\ 5;}
\DoxyCodeLine{02785\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{02786\ }
\DoxyCodeLine{02787\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_SIGN\_SSH\_CERTIFICATE,\ data.buf,}
\DoxyCodeLine{02788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\_len,\ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{02789\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{02790\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ SIGN\ SSH\ CERTIFICATE\ command:\ \%s"{}},}
\DoxyCodeLine{02791\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{02792\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{02793\ \ \ \}}
\DoxyCodeLine{02794\ }
\DoxyCodeLine{02795\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{02796\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{02797\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ certificate:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{02798\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{02799\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{02800\ \ \ \}}
\DoxyCodeLine{02801\ }
\DoxyCodeLine{02802\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{02803\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a45c32b993856be818a70c0ffad589cbd_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a45c32b993856be818a70c0ffad589cbd_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a550567a0f56d8536b9b5f34e905da7ec}\index{yubihsm.c@{yubihsm.c}!yh\_util\_unwrap\_data@{yh\_util\_unwrap\_data}}
\index{yh\_util\_unwrap\_data@{yh\_util\_unwrap\_data}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_unwrap\_data()}{yh\_util\_unwrap\_data()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a550567a0f56d8536b9b5f34e905da7ec} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+unwrap\+\_\+data (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Decrypt (unwrap) data using a \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a16f0118db1dac3d0732e7d66630e1dba}{YH\+\_\+\+WRAP\+\_\+\+KEY}.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the Wrap Key to use \\
\hline
{\em in} & Wrapped data \\
\hline
{\em in\+\_\+len} & Length of wrapped data \\
\hline
{\em out} & Unwrapped data \\
\hline
{\em out\+\_\+len} & Length of unwrapped data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if {\ttfamily in\+\_\+len} is too big. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03716}{3716}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03719\ }
\DoxyCodeLine{03720\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03721\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03722\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03723\ \ \ \}}
\DoxyCodeLine{03724\ }
\DoxyCodeLine{03725\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{03726\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{03727\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03728\ \ \ \}}
\DoxyCodeLine{03729\ }
\DoxyCodeLine{03730\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03731\ }
\DoxyCodeLine{03732\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03733\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03734\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03735\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03736\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{03737\ \ \ \ \ \};}
\DoxyCodeLine{03738\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03739\ \ \ \}\ data;}
\DoxyCodeLine{03740\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03741\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ +\ 2;}
\DoxyCodeLine{03742\ }
\DoxyCodeLine{03743\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03744\ }
\DoxyCodeLine{03745\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03746\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{03747\ }
\DoxyCodeLine{03748\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_UNWRAP\_DATA,\ data.buf,\ data\_len,}
\DoxyCodeLine{03749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{03750\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ data\_len);}
\DoxyCodeLine{03751\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03752\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ UNWRAP\ DATA\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03753\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03754\ \ \ \}}
\DoxyCodeLine{03755\ }
\DoxyCodeLine{03756\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03757\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{03758\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ unwrapped\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03759\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{03760\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03761\ \ \ \}}
\DoxyCodeLine{03762\ }
\DoxyCodeLine{03763\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03764\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a550567a0f56d8536b9b5f34e905da7ec_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a550567a0f56d8536b9b5f34e905da7ec_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_ab37ae2f7fc6857b420e173284130686d}\index{yubihsm.c@{yubihsm.c}!yh\_util\_verify\_hmac@{yh\_util\_verify\_hmac}}
\index{yh\_util\_verify\_hmac@{yh\_util\_verify\_hmac}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_verify\_hmac()}{yh\_util\_verify\_hmac()}}
{\footnotesize\ttfamily \label{yubihsm_8c_ab37ae2f7fc6857b420e173284130686d} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+verify\+\_\+hmac (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{signature}{, }\item[{size\+\_\+t}]{signature\+\_\+len}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{data}{, }\item[{size\+\_\+t}]{data\+\_\+len}{, }\item[{bool \texorpdfstring{$\ast$}{*}}]{verified}{}\end{DoxyParamCaption})}

Verify a generated HMAC


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the HMAC key \\
\hline
{\em signature} & HMAC signature (20, 32, 48 or 64 bytes) \\
\hline
{\em signature\+\_\+len} & length of HMAC signature \\
\hline
{\em data} & data to verify \\
\hline
{\em data\+\_\+len} & length of data to verify \\
\hline
{\em verified} & true if verification succeeded\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} input parameters are NULL or if {\ttfamily signature\+\_\+len} + {\ttfamily data\+\_\+len} is too long. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l01939}{1939}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01943\ }
\DoxyCodeLine{01944\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ signature\ ==\ NULL\ ||\ data\ ==\ NULL\ ||}
\DoxyCodeLine{01945\ \ \ \ \ \ \ verified\ ==\ NULL)\ \{}
\DoxyCodeLine{01946\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{01947\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01948\ \ \ \}}
\DoxyCodeLine{01949\ }
\DoxyCodeLine{01950\ \ \ \textcolor{keywordflow}{if}\ (data\_len\ +\ signature\_len\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{01951\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{01952\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{01953\ \ \ \}}
\DoxyCodeLine{01954\ }
\DoxyCodeLine{01955\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01956\ }
\DoxyCodeLine{01957\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ cmd\_data[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{01958\ \ \ \textcolor{keywordtype}{int}\ cmd\_data\_len;}
\DoxyCodeLine{01959\ }
\DoxyCodeLine{01960\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ response[3];}
\DoxyCodeLine{01961\ \ \ \textcolor{keywordtype}{size\_t}\ response\_len\ =\ \textcolor{keyword}{sizeof}(response);}
\DoxyCodeLine{01962\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{01963\ }
\DoxyCodeLine{01964\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}}\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{01965\ }
\DoxyCodeLine{01966\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(cmd\_data,\ (\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ *)\ \&\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}},\ 2);}
\DoxyCodeLine{01967\ \ \ cmd\_data\_len\ =\ 2;}
\DoxyCodeLine{01968\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(cmd\_data\ +\ cmd\_data\_len,\ signature,\ signature\_len);}
\DoxyCodeLine{01969\ \ \ cmd\_data\_len\ +=\ signature\_len;}
\DoxyCodeLine{01970\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(cmd\_data\ +\ cmd\_data\_len,\ data,\ data\_len);}
\DoxyCodeLine{01971\ \ \ cmd\_data\_len\ +=\ data\_len;}
\DoxyCodeLine{01972\ }
\DoxyCodeLine{01973\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_VERIFY\_HMAC,\ cmd\_data,\ cmd\_data\_len,}
\DoxyCodeLine{01974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ response,\ \&response\_len);}
\DoxyCodeLine{01975\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{01976\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ HMAC\ VERIFY\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{01977\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{01978\ \ \ \}}
\DoxyCodeLine{01979\ }
\DoxyCodeLine{01980\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{01981\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(response[0]);}
\DoxyCodeLine{01982\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ verify\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{01983\ \ \ \ \ \ \ \ \ \ \ \ \ response[0]);}
\DoxyCodeLine{01984\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{01985\ \ \ \}}
\DoxyCodeLine{01986\ }
\DoxyCodeLine{01987\ \ \ *verified\ =\ response[0];}
\DoxyCodeLine{01988\ }
\DoxyCodeLine{01989\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{01990\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_ab37ae2f7fc6857b420e173284130686d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=297pt]{yubihsm_8c_ab37ae2f7fc6857b420e173284130686d_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a7c2e101be04ad1546d99d5600e732eca}\index{yubihsm.c@{yubihsm.c}!yh\_util\_wrap\_data@{yh\_util\_wrap\_data}}
\index{yh\_util\_wrap\_data@{yh\_util\_wrap\_data}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_util\_wrap\_data()}{yh\_util\_wrap\_data()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a7c2e101be04ad1546d99d5600e732eca} 
\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc}} yh\+\_\+util\+\_\+wrap\+\_\+data (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__session}{yh\+\_\+session}} \texorpdfstring{$\ast$}{*}}]{session}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{key\+\_\+id}{, }\item[{const \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{in}{, }\item[{size\+\_\+t}]{in\+\_\+len}{, }\item[{\mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{out}{, }\item[{size\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+len}{}\end{DoxyParamCaption})}

Encrypt (wrap) data using a \doxylink{yubihsm_8h_a2fe39512cb4df34b270a67dbb8e13583a16f0118db1dac3d0732e7d66630e1dba}{YH\+\_\+\+WRAP\+\_\+\+KEY}.


\begin{DoxyParams}{Parameters}
{\em session} & Authenticated session to use \\
\hline
{\em key\+\_\+id} & Object ID of the Wrap Key to use \\
\hline
{\em in} & \doxylink{struct_data}{Data} to wrap \\
\hline
{\em in\+\_\+len} & Length of data to wrap \\
\hline
{\em out} & Wrapped data \\
\hline
{\em out\+\_\+len} & Length of the wrapped data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\+\_\+\+SUCCESS} if successful. \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\+\_\+\+INVALID\+\_\+\+PARAMETERS} if input parameters are NULL or if {\ttfamily in\+\_\+len} is too big. See \doxylink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\+\_\+rc} for other possible errors 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l03667}{3667}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{03669\ }
\DoxyCodeLine{03670\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}}\ ==\ NULL\ ||\ in\ ==\ NULL\ ||\ out\ ==\ NULL\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}}\ ==\ NULL)\ \{}
\DoxyCodeLine{03671\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}\%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}}));}
\DoxyCodeLine{03672\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03673\ \ \ \}}
\DoxyCodeLine{03674\ }
\DoxyCodeLine{03675\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ >\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2)\ \{}
\DoxyCodeLine{03676\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Too\ much\ data,\ must\ be\ <\ \%d"{}},\ \mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}\ -\/\ 2);}
\DoxyCodeLine{03677\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a731b3992b45fde61b6760d92de4dbbf5}{YHR\_INVALID\_PARAMETERS}};}
\DoxyCodeLine{03678\ \ \ \}}
\DoxyCodeLine{03679\ }
\DoxyCodeLine{03680\ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03681\ }
\DoxyCodeLine{03682\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)}}
\DoxyCodeLine{03683\ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{03684\ \ \ \ \ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{03685\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}};}
\DoxyCodeLine{03686\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ac6f5a1f1e061f000983f5d5f3ac25dfa}{bytes}}[\mbox{\hyperlink{yubihsm_8h_a706bd8e7adf0de85e6cfb0efc8981d3f}{YH\_MSG\_BUF\_SIZE}}];}
\DoxyCodeLine{03687\ \ \ \ \ \};}
\DoxyCodeLine{03688\ \ \ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a855e99b645b13e7905d074d02fe0bff5}{buf}}[1];}
\DoxyCodeLine{03689\ \ \ \}\ data;}
\DoxyCodeLine{03690\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{03691\ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ data\_len\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}}\ +\ 2;}
\DoxyCodeLine{03692\ }
\DoxyCodeLine{03693\ \ \ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7e}{yh\_cmd}}\ response\_cmd;}
\DoxyCodeLine{03694\ }
\DoxyCodeLine{03695\ \ \ data.key\_id\ =\ htons(\mbox{\hyperlink{yubihsm__pkcs11_8c_ada12860f8f9f5f3cac5b179ef352434c}{key\_id}});}
\DoxyCodeLine{03696\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(data.bytes,\ in,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_af352138fec1245efdaee143f770c01ef}{in\_len}});}
\DoxyCodeLine{03697\ }
\DoxyCodeLine{03698\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ =\ \mbox{\hyperlink{yubihsm_8c_a4c26f003b72e800e9c934bca922a404a}{yh\_send\_secure\_msg}}(\mbox{\hyperlink{ecdh__derive__test_8c_a0a2c7706d971796d7dc84fee36d6c84f}{session}},\ YHC\_WRAP\_DATA,\ data.buf,\ data\_len,}
\DoxyCodeLine{03699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&response\_cmd,\ out,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a565e4b6f63fecad4c290b50ee6684ee3}{out\_len}});}
\DoxyCodeLine{03700\ \ \ \mbox{\hyperlink{insecure__memzero_8h_a0794f9275fd1036ecba6ff0a901a320b}{insecure\_memzero}}(data.buf,\ data\_len);}
\DoxyCodeLine{03701\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}\ !=\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}})\ \{}
\DoxyCodeLine{03702\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Failed\ to\ send\ WRAP\ DATA\ command:\ \%s"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}}));}
\DoxyCodeLine{03703\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a9c8d6a4a7a87f74f070e816dca1a547b}{yrc}};}
\DoxyCodeLine{03704\ \ \ \}}
\DoxyCodeLine{03705\ }
\DoxyCodeLine{03706\ \ \ \textcolor{keywordflow}{if}\ (response\_cmd\ ==\ \mbox{\hyperlink{yubihsm_8h_aa5415bafa9c48dfef0e183d8df504b7ea51cdf2ccd6995498e589e8ea6ce2a1f2}{YHC\_ERROR}})\ \{}
\DoxyCodeLine{03707\ \ \ \ \ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366}{yh\_rc}}\ translated\ =\ translate\_device\_error(out[0]);}
\DoxyCodeLine{03708\ \ \ \ \ \mbox{\hyperlink{debug__lib_8h_a2e3ed21e5ffba18d940d164aaec64a2a}{DBG\_ERR}}(\textcolor{stringliteral}{"{}Unable\ to\ get\ wrapped\ data:\ \%s\ (\%x)"{}},\ \mbox{\hyperlink{lib_2error_8c_a238eedb1e27dbff2a0ab9a3932eb3f8b}{yh\_strerror}}(translated),}
\DoxyCodeLine{03709\ \ \ \ \ \ \ \ \ \ \ \ \ out[0]);}
\DoxyCodeLine{03710\ \ \ \ \ \textcolor{keywordflow}{return}\ translated;}
\DoxyCodeLine{03711\ \ \ \}}
\DoxyCodeLine{03712\ }
\DoxyCodeLine{03713\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm_8h_ae4f602d2343d01b1727dfd633169d366a405155512dc2284dc210ed15be1d0815}{YHR\_SUCCESS}};}
\DoxyCodeLine{03714\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7c2e101be04ad1546d99d5600e732eca_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a7c2e101be04ad1546d99d5600e732eca_icgraph}
\end{center}
\end{figure}
\Hypertarget{yubihsm_8c_a00b81c3c9ca2964a672b7b0b725925e4}\index{yubihsm.c@{yubihsm.c}!yh\_verify\_logs@{yh\_verify\_logs}}
\index{yh\_verify\_logs@{yh\_verify\_logs}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{yh\_verify\_logs()}{yh\_verify\_logs()}}
{\footnotesize\ttfamily \label{yubihsm_8c_a00b81c3c9ca2964a672b7b0b725925e4} 
bool yh\+\_\+verify\+\_\+logs (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structyh__log__entry}{yh\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*}}]{logs}{, }\item[{size\+\_\+t}]{n\+\_\+items}{, }\item[{\mbox{\hyperlink{structyh__log__entry}{yh\+\_\+log\+\_\+entry}} \texorpdfstring{$\ast$}{*}}]{last\+\_\+previous\+\_\+log}{}\end{DoxyParamCaption})}

Verify an array of log entries


\begin{DoxyParams}{Parameters}
{\em logs} & Array of log entries \\
\hline
{\em n\+\_\+items} & number of log entries \\
\hline
{\em last\+\_\+previous\+\_\+log} & Optional pointer to the entry before the first entry in logs\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if verification succeeds. False otherwise
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{https://developers.yubico.com/YubiHSM2/Concepts/Logs.html}{\texttt{ Logs}} 
\end{DoxySeeAlso}


Definition at line \mbox{\hyperlink{yubihsm_8c_source_l04480}{4480}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{04481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{04482\ \ \ \textcolor{keywordflow}{if}\ (logs\ ==\ NULL\ ||\ n\_items\ ==\ 0)\ \{}
\DoxyCodeLine{04483\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04484\ \ \ \}}
\DoxyCodeLine{04485\ }
\DoxyCodeLine{04486\ \ \ \mbox{\hyperlink{struct__hash__ctx}{hash\_ctx}}\ hashctx\ =\ NULL;}
\DoxyCodeLine{04487\ \ \ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ previous\_hash[32];}
\DoxyCodeLine{04488\ \ \ \textcolor{keywordtype}{size\_t}\ previous\_hash\_len\ =\ 32;}
\DoxyCodeLine{04489\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}};}
\DoxyCodeLine{04490\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{04491\ }
\DoxyCodeLine{04492\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{hash_8c_a3cc1419f3a2f6401e22e8b339b73c609}{hash\_create}}(\&hashctx,\ \mbox{\hyperlink{yubihsm_2common_2hash_8h_a488906826f8aaf7e850c35889d560089af0ab1a9d65ceafa4ba1f6f177e379258}{\_SHA256}}))\ \{}
\DoxyCodeLine{04493\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04494\ \ \ \}}
\DoxyCodeLine{04495\ }
\DoxyCodeLine{04496\ \ \ \textcolor{keywordflow}{if}\ (last\_previous\_log\ !=\ NULL)\ \{}
\DoxyCodeLine{04497\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(previous\_hash,\ last\_previous\_log-\/>\mbox{\hyperlink{structyh__log__entry_a0e8ca2892b29342aa721e5a9917fabed}{digest}},\ \mbox{\hyperlink{yubihsm_8h_a289ca46f5ef481980f0fad98d727e87a}{YH\_LOG\_DIGEST\_SIZE}});}
\DoxyCodeLine{04498\ \ \ \ \ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}}\ =\ 0;}
\DoxyCodeLine{04499\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{04500\ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(previous\_hash,\ logs[0].digest,\ \mbox{\hyperlink{yubihsm_8h_a289ca46f5ef481980f0fad98d727e87a}{YH\_LOG\_DIGEST\_SIZE}});}
\DoxyCodeLine{04501\ \ \ \ \ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}}\ =\ 1;}
\DoxyCodeLine{04502\ \ \ \}}
\DoxyCodeLine{04503\ }
\DoxyCodeLine{04504\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ i\ =\ start;\ i\ <\ n\_items;\ i++)\ \{}
\DoxyCodeLine{04505\ \ \ \ \ \mbox{\hyperlink{structyh__log__entry}{yh\_log\_entry}}\ inverted;}
\DoxyCodeLine{04506\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_adbdbdd10828646a96f67438062c909c8}{number}}\ =\ htons(logs[i].number);}
\DoxyCodeLine{04507\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_ad1932210758f5649c94e0a7758040b48}{command}}\ =\ logs[i].\mbox{\hyperlink{structyh__log__entry_ad1932210758f5649c94e0a7758040b48}{command}};}
\DoxyCodeLine{04508\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_abd847b85c49faf8f3bb88876fe56cf2f}{length}}\ =\ htons(logs[i].length);}
\DoxyCodeLine{04509\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_a925f85bbcea7077e632e1699d32dfbe2}{session\_key}}\ =\ htons(logs[i].session\_key);}
\DoxyCodeLine{04510\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_ab866b36403547d518733745c090f69cc}{target\_key}}\ =\ htons(logs[i].target\_key);}
\DoxyCodeLine{04511\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_a248294c48b017749865e97c22fee57ce}{second\_key}}\ =\ htons(logs[i].second\_key);}
\DoxyCodeLine{04512\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_a31bb67d7241b0cdd25d36cee65d4b6da}{result}}\ =\ logs[i].\mbox{\hyperlink{structyh__log__entry_a31bb67d7241b0cdd25d36cee65d4b6da}{result}};}
\DoxyCodeLine{04513\ \ \ \ \ inverted.\mbox{\hyperlink{structyh__log__entry_a32bf3bd463165110201f585222616ee4}{systick}}\ =\ htonl(logs[i].systick);}
\DoxyCodeLine{04514\ }
\DoxyCodeLine{04515\ \ \ \ \ \mbox{\hyperlink{hash_8c_a6146398e6f54347faf3e9c4e6c7cde7b}{hash\_init}}(hashctx);}
\DoxyCodeLine{04516\ \ \ \ \ \mbox{\hyperlink{hash_8c_a00c3b2f60d87f408d16804b22c4fd2c2}{hash\_update}}(hashctx,\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ *)\ \&inverted,}
\DoxyCodeLine{04517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structyh__log__entry}{yh\_log\_entry}})\ -\/\ \mbox{\hyperlink{yubihsm_8h_a289ca46f5ef481980f0fad98d727e87a}{YH\_LOG\_DIGEST\_SIZE}});}
\DoxyCodeLine{04518\ \ \ \ \ \mbox{\hyperlink{hash_8c_a00c3b2f60d87f408d16804b22c4fd2c2}{hash\_update}}(hashctx,\ previous\_hash,\ \mbox{\hyperlink{yubihsm_8h_a289ca46f5ef481980f0fad98d727e87a}{YH\_LOG\_DIGEST\_SIZE}});}
\DoxyCodeLine{04519\ \ \ \ \ \mbox{\hyperlink{hash_8c_aa23c36aa0b4bb19de4bbeaa64720e494}{hash\_final}}(hashctx,\ previous\_hash,\ \&previous\_hash\_len);}
\DoxyCodeLine{04520\ }
\DoxyCodeLine{04521\ \ \ \ \ \textcolor{keywordflow}{if}\ (memcmp(logs[i].digest,\ previous\_hash,\ \mbox{\hyperlink{yubihsm_8h_a289ca46f5ef481980f0fad98d727e87a}{YH\_LOG\_DIGEST\_SIZE}})\ !=\ 0)\ \{}
\DoxyCodeLine{04522\ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ out;}
\DoxyCodeLine{04523\ \ \ \ \ \}}
\DoxyCodeLine{04524\ \ \ \}}
\DoxyCodeLine{04525\ }
\DoxyCodeLine{04526\ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{04527\ }
\DoxyCodeLine{04528\ out:}
\DoxyCodeLine{04529\ \ \ \mbox{\hyperlink{hash_8c_a9d8dba1d151d3db0137137a845bccc8b}{hash\_destroy}}(hashctx);}
\DoxyCodeLine{04530\ \ \ hashctx\ =\ NULL;}
\DoxyCodeLine{04531\ }
\DoxyCodeLine{04532\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}};}
\DoxyCodeLine{04533\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{yubihsm_8c_a00b81c3c9ca2964a672b7b0b725925e4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=232pt]{yubihsm_8c_a00b81c3c9ca2964a672b7b0b725925e4_icgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\Hypertarget{yubihsm_8c_a53dbe31d2d75719fb2b97437fcb42f2a}\index{yubihsm.c@{yubihsm.c}!YH\_INTERNAL@{YH\_INTERNAL}}
\index{YH\_INTERNAL@{YH\_INTERNAL}!yubihsm.c@{yubihsm.c}}
\doxysubsubsection{\texorpdfstring{YH\_INTERNAL}{YH\_INTERNAL}}
{\footnotesize\ttfamily \label{yubihsm_8c_a53dbe31d2d75719fb2b97437fcb42f2a} 
FILE\texorpdfstring{$\ast$}{*} \mbox{\hyperlink{debug__lib_8h_a76ba6bc136c2b38b71a9e3c56282cd3a}{\+\_\+yh\+\_\+output}} YH\+\_\+\+INTERNAL = 0}



Definition at line \mbox{\hyperlink{yubihsm_8c_source_l00057}{57}} of file \mbox{\hyperlink{yubihsm_8c_source}{yubihsm.\+c}}.

