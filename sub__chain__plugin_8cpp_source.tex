\doxysection{sub\+\_\+chain\+\_\+plugin.\+cpp}
\hypertarget{sub__chain__plugin_8cpp_source}{}\label{sub__chain__plugin_8cpp_source}\index{plugins/sub\_chain\_plugin/sub\_chain\_plugin.cpp@{plugins/sub\_chain\_plugin/sub\_chain\_plugin.cpp}}
\mbox{\hyperlink{sub__chain__plugin_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{sub__chain__plugin_8hpp}{sysio/sub\_chain\_plugin/sub\_chain\_plugin.hpp}}>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{http__plugin_8hpp}{sysio/http\_plugin/http\_plugin.hpp}}>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger_8hpp}{fc/log/logger.hpp}}>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <variant>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{merkle_8hpp}{sysio/chain/merkle.hpp}}>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{raw_8hpp}{fc/io/raw.hpp}}>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger__config_8hpp}{fc/log/logger\_config.hpp}}>}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00010}00010\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio}{sysio}}\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00011}00011\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classappbase_1_1abstract__plugin}{appbase::abstract\_plugin}}\&\ \_sub\_chain\_plugin\ =\ \mbox{\hyperlink{namespaceappbase_a99374dc23934f008a09f2f79be9eae40}{app}}().\mbox{\hyperlink{classappbase_1_1application_a87e84549150056c56c0327cc4976cc2a}{register\_plugin}}<sub\_chain\_plugin>();}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00013}00013\ \textcolor{keyword}{using\ namespace\ }chain;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00015}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_ab89f5e58a8ba29b2da7fd8f3f1f9580f}{00015}}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_ab89f5e58a8ba29b2da7fd8f3f1f9580f}{sub\_chain\_plugin::sub\_chain\_plugin}}():\ my(new\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin__impl}{sub\_chain\_plugin\_impl}}())\ \{\}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00016}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a76ed451659f2eb0125e51f0cb0d1b87b}{00016}}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a76ed451659f2eb0125e51f0cb0d1b87b}{sub\_chain\_plugin::\string~sub\_chain\_plugin}}()\ \{\}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00018}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a6e2741ccffb9b3d1c62642e8d01469c2}{00018}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a6e2741ccffb9b3d1c62642e8d01469c2}{sub\_chain\_plugin::set\_program\_options}}(options\_description\&,\ options\_description\&\ cfg)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00019}00019\ \ \ \ \ cfg.add\_options()}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00020}00020\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}s-\/chain-\/contract"{}},\ bpo::value<std::string>()-\/>default\_value(\textcolor{stringliteral}{"{}settle.wns"{}}),\ \textcolor{stringliteral}{"{}Contract\ name\ for\ identifying\ relevant\ S-\/transactions."{}})}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00021}00021\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}s-\/chain-\/actions"{}},\ bpo::value<std::vector<std::string>>()-\/>composing(),\ \textcolor{stringliteral}{"{}List\ of\ action\ names\ for\ relevant\ S-\/transactions\ for\ a\ given\ s-\/chain-\/contract"{}});}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00022}00022\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00023}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a6dd5ccc3932d3f377871be7f3405999a}{00023}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a6dd5ccc3932d3f377871be7f3405999a}{sub\_chain\_plugin::plugin\_initialize}}(\textcolor{keyword}{const}\ variables\_map\&\ options)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00024}00024\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00025}00025\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!options.count(\textcolor{stringliteral}{"{}s-\/chain-\/contract"{}})\ ||\ !options.count(\textcolor{stringliteral}{"{}s-\/chain-\/actions"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\textcolor{keyword}{false},\ plugin\_config\_exception,\ \textcolor{stringliteral}{"{}sub\_chain\_plugin\ requires\ both\ -\/-\/s-\/chain-\/contract\ and\ -\/-\/s-\/chain-\/actions\ to\ be\ set"{}});}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00027}00027\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00028}00028\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00029}00029\ \ \ \ \ \ \ \ \ \ std::string\ contract\_name\_str\ =\ options.at(\textcolor{stringliteral}{"{}s-\/chain-\/contract"{}}).as<std::string>();}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00030}00030\ \ \ \ \ \ \ \ \ \ my-\/>contract\_name\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{sysio::chain::name}}(contract\_name\_str);\ \ \textcolor{comment}{//\ Convert\ std::string\ to\ sysio::chain::name}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00032}00032\ \ \ \ \ \ \ \ \ \ std::vector<std::string>\ actions\ =\ options.at(\textcolor{stringliteral}{"{}s-\/chain-\/actions"{}}).as<std::vector<std::string>>();}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00033}00033\ \ \ \ \ \ \ \ \ \ my-\/>action\_names.clear();}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00034}00034\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}\ :\ actions)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00035}00035\ \ \ \ \ \ \ \ \ \ \ \ \ my-\/>action\_names.push\_back(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{sysio::chain::name}}(\mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}));\ \ \textcolor{comment}{//\ Convert\ std::string\ to\ action\_name}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00036}00036\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00037}00037\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00038}00038\ \ \ \ \ \ \ \textcolor{comment}{//\ my-\/>chain\_plug\ =\ app().find\_plugin<chain\_plugin>();}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00039}00039\ \ \ \ \ \ \ \textcolor{comment}{//\ SYS\_ASSERT(\ my-\/>chain\_plug,\ chain::missing\_chain\_plugin\_exception,\ "{}"{}\ \ );}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00041}00041\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}()}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00042}00042\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00043}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a9f4bb7aed179e23b6a4fd82f1f5abecf}{00043}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a9f4bb7aed179e23b6a4fd82f1f5abecf}{sub\_chain\_plugin::plugin\_startup}}()\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00044}00044\ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}sub\_chain\_plugin\ starting\ up,\ adding\ /v3/sub\_chain/get\_last\_s\_id"{}});}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00046}00046\ \ \ \ \ \mbox{\hyperlink{namespaceappbase_a99374dc23934f008a09f2f79be9eae40}{app}}().\mbox{\hyperlink{classappbase_1_1application_a3c4b68a0667942b58f1369f454ce0ce3}{get\_plugin}}<\mbox{\hyperlink{classsysio_1_1http__plugin}{http\_plugin}}>().add\_api(\{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00047}00047\ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}/v3/sub\_chain/get\_last\_s\_id"{}},\ [\textcolor{keyword}{this}](\mbox{\hyperlink{namespacefc_a0f3d84fe9e7adcd2d1e0bb7b60b49aa0}{string}},\ \textcolor{keywordtype}{string}\ body,\ \textcolor{keyword}{auto}\ cb)\ \{\ \textcolor{comment}{//\ Ensure\ correct\ use\ of\ auto\ for\ callback\ type\ inference}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\ last\_s\_id\ =\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a859210844da256487c6ca3b93cfc028c}{get\_prev\_s\_id}}();}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cb(200,\ last\_s\_id.\mbox{\hyperlink{classfc_1_1sha256_a71ac4efc1d964d24fdf00aeffcf0a9c9}{str}}());\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cb(500,\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}error\(\backslash\)"{}:\ \(\backslash\)"{}internal\_error\(\backslash\)"{},\ \(\backslash\)"{}details\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}()\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}});}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00054}00054\ \ \ \ \ \ \ \ \ \}\}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00055}00055\ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00056}00056\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00057}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a3874baf0a8be3ff358ecf00fb64c239f}{00057}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a3874baf0a8be3ff358ecf00fb64c239f}{sub\_chain\_plugin::plugin\_shutdown}}()\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00058}00058\ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}sub\_chain\_plugin\ shutting\ down"{}});}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00059}00059\ \ \ \ \ \textcolor{comment}{//\ Cleanup\ code}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00060}00060\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00061}00061\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00062}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a336cfd3a895443141f1df5d6578b8afe}{00062}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\&\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a336cfd3a895443141f1df5d6578b8afe}{sub\_chain\_plugin::get\_contract\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00063}00063\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>contract\_name;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00064}00064\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00065}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a859210844da256487c6ca3b93cfc028c}{00065}}\ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\&\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a859210844da256487c6ca3b93cfc028c}{sub\_chain\_plugin::get\_prev\_s\_id}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00066}00066\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>prev\_s\_id;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00067}00067\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00068}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a9a8596ad0ebba9548494df94c00e0a99}{00068}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a9a8596ad0ebba9548494df94c00e0a99}{sub\_chain\_plugin::update\_prev\_s\_id}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\&\ new\_s\_id)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00069}00069\ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Updating\ OLD\ prev\_s\_id:\ \(\backslash\)t\$\{prev\_s\_id\}"{}},\ (\textcolor{stringliteral}{"{}prev\_s\_id"{}},\ my-\/>prev\_s\_id));}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00070}00070\ \ \ \ my-\/>prev\_s\_id\ =\ new\_s\_id;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00071}00071\ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Updated\ \ NEW\ prev\_s\_id:\ \(\backslash\)t\$\{prev\_s\_id\}"{}},\ (\textcolor{stringliteral}{"{}prev\_s\_id"{}},\ my-\/>prev\_s\_id));}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00072}00072\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00084}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_ae0ac286e18b19c360cd78c244967994d}{00084}}\ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_ae0ac286e18b19c360cd78c244967994d}{sub\_chain\_plugin::calculate\_s\_root}}(\textcolor{keyword}{const}\ std::vector<transaction>\&\ transactions)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00085}00085\ \ \ \ \textcolor{comment}{//\ Build\ s-\/leaves\ from\ relevant\ s-\/transactions}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00086}00086\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\ s\_leaves;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00087}00087\ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\ :\ transactions\ )\{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00088}00088\ \ \ \ \ \ \ s\_leaves.emplace\_back(\ trx.id()\ );}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00089}00089\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00090}00090\ \ \ \ \textcolor{comment}{//\ Create\ and\ return\ the\ merkle\ S-\/Root\ }}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00091}00091\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_a80d7ea5476f97bf51a25149b55469c40}{merkle}}(\ move(s\_leaves)\ );}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00092}00092\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00100}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_aa1aadd4174d2f23fd38bc235d14dc413}{00100}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_aa1aadd4174d2f23fd38bc235d14dc413}{sub\_chain\_plugin::extract\_s\_block\_number}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\&\ s\_id)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00101}00101\ \textcolor{comment}{//\ \ \ \ auto\ s\_id\_data\ =\ s\_id.data();}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00102}00102\ \textcolor{comment}{//\ \ \ \ return\ fc::endian\_reverse\_u32(s\_id\_data[0]);}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00104}00104\ \ \ \ \ \textcolor{comment}{//\ Extract\ the\ pointer\ to\ the\ data\ from\ the\ checksum.}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00105}00105\ \ \ \ \ \textcolor{keyword}{auto}\ s\_id\_data\ =\ s\_id.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}();}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00106}00106\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00107}00107\ \ \ \ \ \textcolor{comment}{//\ Since\ we\ are\ dealing\ with\ a\ checksum256\_type,\ which\ is\ typically\ an\ array\ of\ bytes,}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00108}00108\ \ \ \ \ \textcolor{comment}{//\ we\ need\ to\ correctly\ handle\ the\ conversion\ to\ uint32\_t\ considering\ endianess.}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00109}00109\ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ s\_block\_number;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00110}00110\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00111}00111\ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ first\ 4\ bytes\ of\ the\ data\ into\ a\ uint32\_t\ variable.}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00112}00112\ \ \ \ \ \textcolor{comment}{//\ memcpy\ ensures\ that\ we\ handle\ any\ alignment\ issues.}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00113}00113\ \ \ \ \ std::memcpy(\&s\_block\_number,\ s\_id\_data,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}));}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00115}00115\ \ \ \ \ \textcolor{comment}{//\ Reverse\ the\ endianess\ if\ necessary.}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00116}00116\ \ \ \ \ \textcolor{comment}{//\ You\ might\ need\ to\ adjust\ this\ based\ on\ how\ the\ data\ is\ stored\ (big-\/endian\ vs\ little-\/endian).}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00117}00117\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacefc_afb668c55fd6ee73e1fcd67e77d8f6009}{fc::endian\_reverse\_u32}}(s\_block\_number);}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00118}00118\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00127}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_aa4668706e102033c7b63c08be2b834ef}{00127}}\ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_aa4668706e102033c7b63c08be2b834ef}{sub\_chain\_plugin::compute\_curr\_s\_id}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\&\ curr\_s\_root)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00128}00128\ \ \ \ \ \textcolor{comment}{//\ ilog("{}Computing\ new\ S-\/ID\ from\ \(\backslash\)n\(\backslash\)tcurr\_s\_root:\ \$\{curr\_s\_root\}\(\backslash\)n\(\backslash\)t\$\{prev\_s\_id\}"{},\ ("{}curr\_s\_root"{},\ curr\_s\_root)("{}prev\_s\_id"{},\ my-\/>prev\_s\_id));}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00130}00130\ \ \ \ \ \textcolor{comment}{//\ Serialize\ both\ the\ previous\ S-\/ID\ and\ the\ current\ S-\/Root}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00131}00131\ \ \ \ \ \textcolor{keyword}{auto}\ data\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(std::make\_pair(my-\/>prev\_s\_id,\ curr\_s\_root));}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00132}00132\ \ \ \ \ \textcolor{comment}{//\ Hash\ the\ serialized\ data\ to\ generate\ the\ new\ S-\/ID}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00133}00133\ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\ curr\_s\_id\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{checksum256\_type::hash}}(data);}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00134}00134\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00135}00135\ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Computed\ interim\ S-\/ID:\ \$\{curr\_s\_id\}"{}},\ (\textcolor{stringliteral}{"{}curr\_s\_id"{}},\ curr\_s\_id));}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00136}00136\ \ \ \ \ \textcolor{comment}{//\ Extract\ the\ block\ number\ from\ the\ previous\ S-\/ID\ and\ increment\ it\ by\ 1}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00137}00137\ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ prev\_s\_block\_number\ =\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_aa1aadd4174d2f23fd38bc235d14dc413}{sub\_chain\_plugin::extract\_s\_block\_number}}(my-\/>prev\_s\_id);}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00138}00138\ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ next\_s\_block\_number\ =\ prev\_s\_block\_number\ +\ 1;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00140}00140\ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Extracted\ prev\_s\_block\_number\ from\ prev\_s\_id:\ \$\{prev\_s\_block\_number\},\ next:\ \$\{next\_s\_block\_number\}"{}},\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00141}00141\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}prev\_s\_block\_number"{}},\ prev\_s\_block\_number)(\textcolor{stringliteral}{"{}next\_s\_block\_number"{}},\ next\_s\_block\_number));}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00143}00143\ \ \ \ \ \textcolor{comment}{//\ Modify\ the\ first\ 4\ bytes\ directly}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00144}00144\ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ next\_s\_block\_number\_reversed\ =\ \mbox{\hyperlink{namespacefc_afb668c55fd6ee73e1fcd67e77d8f6009}{fc::endian\_reverse\_u32}}(next\_s\_block\_number);}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00145}00145\ \ \ \ \ std::memcpy(curr\_s\_id.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \&next\_s\_block\_number\_reversed,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}));\ \textcolor{comment}{//\ Modify\ the\ first\ 4\ bytes}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00147}00147\ \ \ \ \ \textcolor{comment}{//\ ilog("{}Computed\ curr\_s\_id\ with\ block\ number\ embedded:\ \$\{c\}"{},\ ("{}c"{},\ curr\_s\_id.str()));}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00148}00148\ \ \ \ \ \textcolor{keywordflow}{return}\ curr\_s\_id;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00149}00149\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00156}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_aaac3c80301ede51c90d925992bc14c7c}{00156}}\ std::vector<sysio::chain::transaction>\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_aaac3c80301ede51c90d925992bc14c7c}{sub\_chain\_plugin::find\_relevant\_transactions}}(\mbox{\hyperlink{classsysio_1_1chain_1_1controller}{sysio::chain::controller}}\&\ curr\_chain)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00157}00157\ \ \ \ \ std::vector<sysio::chain::transaction>\ relevant\_transactions;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00158}00158\ \ \ \ \ \textcolor{keyword}{auto}\&\ pending\_trx\_receipts\ =\ curr\_chain.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad6f4e938fb4b051c1d6b6c5cede09c76}{get\_pending\_trx\_receipts}}();\ \textcolor{comment}{//\ Access\ pending\ transactions\ directly}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00159}00159\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_receipt\ :\ pending\_trx\_receipts)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00160}00160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::holds\_alternative<sysio::chain::packed\_transaction>(trx\_receipt.trx))\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ packed\_trx\ =\ std::get<sysio::chain::packed\_transaction>(trx\_receipt.trx);}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00162}00162\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\ =\ packed\_trx.get\_transaction();}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a797b6336604834b7adcec0c1d865dc4f}{is\_relevant\_s\_root\_transaction}}(trx))\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ relevant\_transactions.push\_back(trx);}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00166}00166\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00167}00167\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00168}00168\ \ \ \ \ \textcolor{keywordflow}{return}\ relevant\_transactions;}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00169}00169\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00176}\mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a797b6336604834b7adcec0c1d865dc4f}{00176}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1sub__chain__plugin_a797b6336604834b7adcec0c1d865dc4f}{sub\_chain\_plugin::is\_relevant\_s\_root\_transaction}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction}{transaction}}\&\ trx)\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00177}00177\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}\ :\ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction_a407fcf1868b81bb30b85f80d388bbac2}{actions}})\ \{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00178}00178\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}.\mbox{\hyperlink{structsysio_1_1chain_1_1action__base_a3598da3f8df67037e69dab758ce168be}{account}}\ ==\ my-\/>contract\_name\ \&\&\ std::find(my-\/>action\_names.begin(),\ my-\/>action\_names.end(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}.\mbox{\hyperlink{structsysio_1_1chain_1_1action__base_a013fae07403bd6deffcade4fd5be095c}{name}})\ !=\ my-\/>action\_names.end())\{}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00180}00180\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00181}00181\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00182}00182\ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00183}00183\ \}}
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00184}00184\ }
\DoxyCodeLine{\Hypertarget{sub__chain__plugin_8cpp_source_l00185}00185\ \}\ \textcolor{comment}{//\ namespace\ sysio}}

\end{DoxyCode}
