<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wire Sysio: sysio::sync_manager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Wire Sysio<span id="projectnumber">&#160;Wire Sysion 1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classsysio_1_1sync__manager.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classsysio_1_1sync__manager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">sysio::sync_manager Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3446e9dbeea966108e51f7ace13efd34" id="r_a3446e9dbeea966108e51f7ace13efd34"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3446e9dbeea966108e51f7ace13efd34">sync_manager</a> (<a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="namespacesysio_1_1chain.html#a68ee5032824b9877df35eec12344398d">span</a>)</td></tr>
<tr class="separator:a3446e9dbeea966108e51f7ace13efd34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaee19ed7ea8e42c21e1a70b1f7ac625" id="r_aeaee19ed7ea8e42c21e1a70b1f7ac625"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeaee19ed7ea8e42c21e1a70b1f7ac625">syncing_with_peer</a> () const</td></tr>
<tr class="separator:aeaee19ed7ea8e42c21e1a70b1f7ac625"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab81caff4e1eae073cee42d0a16600fb0" id="r_ab81caff4e1eae073cee42d0a16600fb0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab81caff4e1eae073cee42d0a16600fb0">sync_reset_lib_num</a> (const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;conn, bool closing)</td></tr>
<tr class="separator:ab81caff4e1eae073cee42d0a16600fb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6acfea4380e06a48ff83764b2a779a96" id="r_a6acfea4380e06a48ff83764b2a779a96"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6acfea4380e06a48ff83764b2a779a96">sync_reassign_fetch</a> (const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;c, <a class="el" href="namespacesysio.html#a5c18cd9d34b8c5d3af8e2de75577673f">go_away_reason</a> reason)</td></tr>
<tr class="separator:a6acfea4380e06a48ff83764b2a779a96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51eb06caeee4ecfe79679e4dfca5240e" id="r_a51eb06caeee4ecfe79679e4dfca5240e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a51eb06caeee4ecfe79679e4dfca5240e">rejected_block</a> (const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;c, <a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> blk_num)</td></tr>
<tr class="separator:a51eb06caeee4ecfe79679e4dfca5240e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbcb08cf70b4e5cb2416b1fd59be9787" id="r_afbcb08cf70b4e5cb2416b1fd59be9787"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afbcb08cf70b4e5cb2416b1fd59be9787">sync_recv_block</a> (const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;c, const <a class="el" href="namespacesysio_1_1chain.html#a4b8e4b7ed9dcd18ee75d0de62e88aa17">block_id_type</a> &amp;blk_id, <a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> blk_num, bool blk_applied)</td></tr>
<tr class="separator:afbcb08cf70b4e5cb2416b1fd59be9787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af128876bbe4648c785d7a0905110186e" id="r_af128876bbe4648c785d7a0905110186e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af128876bbe4648c785d7a0905110186e">sync_update_expected</a> (const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;c, const <a class="el" href="namespacesysio_1_1chain.html#a4b8e4b7ed9dcd18ee75d0de62e88aa17">block_id_type</a> &amp;blk_id, <a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> blk_num, bool blk_applied)</td></tr>
<tr class="separator:af128876bbe4648c785d7a0905110186e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4df766ac98a672861e3f9e2a7ca715e6" id="r_a4df766ac98a672861e3f9e2a7ca715e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4df766ac98a672861e3f9e2a7ca715e6">recv_handshake</a> (const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;c, const <a class="el" href="structsysio_1_1handshake__message.html">handshake_message</a> &amp;msg)</td></tr>
<tr class="separator:a4df766ac98a672861e3f9e2a7ca715e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4947bb9b1146d531ae706d4fc9d57025" id="r_a4947bb9b1146d531ae706d4fc9d57025"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4947bb9b1146d531ae706d4fc9d57025">sync_recv_notice</a> (const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;c, const <a class="el" href="structsysio_1_1notice__message.html">notice_message</a> &amp;msg)</td></tr>
<tr class="separator:a4947bb9b1146d531ae706d4fc9d57025"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59c2a3a3594344b9ce771954d4115a70" id="r_a59c2a3a3594344b9ce771954d4115a70"><td class="memItemLeft" align="right" valign="top">std::unique_lock&lt; std::mutex &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a59c2a3a3594344b9ce771954d4115a70">locked_sync_mutex</a> ()</td></tr>
<tr class="separator:a59c2a3a3594344b9ce771954d4115a70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a671900953bfaa2a06219f40687df4388" id="r_a671900953bfaa2a06219f40687df4388"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a671900953bfaa2a06219f40687df4388">reset_last_requested_num</a> (const std::unique_lock&lt; std::mutex &gt; &amp;lock)</td></tr>
<tr class="separator:a671900953bfaa2a06219f40687df4388"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:afe3debb36f6f73dbbf6a3bbb8c4ef734" id="r_afe3debb36f6f73dbbf6a3bbb8c4ef734"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe3debb36f6f73dbbf6a3bbb8c4ef734">send_handshakes</a> ()</td></tr>
<tr class="separator:afe3debb36f6f73dbbf6a3bbb8c4ef734"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l00119">119</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3446e9dbeea966108e51f7ace13efd34" name="a3446e9dbeea966108e51f7ace13efd34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3446e9dbeea966108e51f7ace13efd34">&#9670;&#160;</a></span>sync_manager()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">sysio::sync_manager::sync_manager </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>span</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01537">1537</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1538</span>      :sync_known_lib_num( 0 )</div>
<div class="line"><span class="lineno"> 1539</span>      ,sync_last_requested_num( 0 )</div>
<div class="line"><span class="lineno"> 1540</span>      ,sync_next_expected_num( 1 )</div>
<div class="line"><span class="lineno"> 1541</span>      ,sync_req_span( req_span )</div>
<div class="line"><span class="lineno"> 1542</span>      ,sync_source()</div>
<div class="line"><span class="lineno"> 1543</span>      ,sync_state(in_sync)</div>
<div class="line"><span class="lineno"> 1544</span>   {</div>
<div class="line"><span class="lineno"> 1545</span>   }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a59c2a3a3594344b9ce771954d4115a70" name="a59c2a3a3594344b9ce771954d4115a70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59c2a3a3594344b9ce771954d4115a70">&#9670;&#160;</a></span>locked_sync_mutex()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_lock&lt; std::mutex &gt; sysio::sync_manager::locked_sync_mutex </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l00157">157</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  157</span>                                                          {</div>
<div class="line"><span class="lineno">  158</span>         <span class="keywordflow">return</span> std::unique_lock&lt;std::mutex&gt;(sync_mtx);</div>
<div class="line"><span class="lineno">  159</span>      }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4df766ac98a672861e3f9e2a7ca715e6" name="a4df766ac98a672861e3f9e2a7ca715e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4df766ac98a672861e3f9e2a7ca715e6">&#9670;&#160;</a></span>recv_handshake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::recv_handshake </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>c</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structsysio_1_1handshake__message.html">handshake_message</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>msg</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01774">1774</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1774</span>                                                                                            {</div>
<div class="line"><span class="lineno"> 1775</span> </div>
<div class="line"><span class="lineno"> 1776</span>      <span class="keywordflow">if</span>( c-&gt;is_transactions_only_connection() ) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1777</span> </div>
<div class="line"><span class="lineno"> 1778</span>      <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> lib_num = 0;</div>
<div class="line"><span class="lineno"> 1779</span>      <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> peer_lib = msg.last_irreversible_block_num;</div>
<div class="line"><span class="lineno"> 1780</span>      <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> head = 0;</div>
<div class="line"><span class="lineno"> 1781</span>      <a class="code hl_class" href="classfc_1_1sha256.html">block_id_type</a> head_id;</div>
<div class="line"><span class="lineno"> 1782</span>      std::tie( lib_num, std::ignore, head,</div>
<div class="line"><span class="lineno"> 1783</span>                std::ignore, std::ignore, head_id ) = my_impl-&gt;<a class="code hl_function" href="classsysio_1_1net__plugin__impl.html#ab7de62c1cba9cb5a30060a687ef913e2">get_chain_info</a>();</div>
<div class="line"><span class="lineno"> 1784</span> </div>
<div class="line"><span class="lineno"> 1785</span>      <a class="code hl_function" href="#ab81caff4e1eae073cee42d0a16600fb0">sync_reset_lib_num</a>(c, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1786</span> </div>
<div class="line"><span class="lineno"> 1787</span>      <span class="keyword">auto</span> current_time_ns = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(std::chrono::system_clock::now().time_since_epoch()).count();</div>
<div class="line"><span class="lineno"> 1788</span>      <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> network_latency_ns = current_time_ns - msg.time; <span class="comment">// net latency in nanoseconds</span></div>
<div class="line"><span class="lineno"> 1789</span>      <span class="keywordflow">if</span>( network_latency_ns &lt; 0 ) {</div>
<div class="line"><span class="lineno"> 1790</span>         <a class="code hl_define" href="net__plugin_8cpp.html#af53787454493a30650fdab0193037465">peer_wlog</a>(c, <span class="stringliteral">&quot;Peer sent a handshake with a timestamp skewed by at least ${t}ms&quot;</span>, (<span class="stringliteral">&quot;t&quot;</span>, network_latency_ns/1000000));</div>
<div class="line"><span class="lineno"> 1791</span>         network_latency_ns = 0;</div>
<div class="line"><span class="lineno"> 1792</span>      }</div>
<div class="line"><span class="lineno"> 1793</span>      <span class="comment">// number of blocks syncing node is behind from a peer node</span></div>
<div class="line"><span class="lineno"> 1794</span>      <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> nblk_behind_by_net_latency = <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a><span class="keyword">&gt;</span>(network_latency_ns / block_interval_ns);</div>
<div class="line"><span class="lineno"> 1795</span>      <span class="comment">// 2x for time it takes for message to reach back to peer node, +1 to compensate for integer division truncation</span></div>
<div class="line"><span class="lineno"> 1796</span>      <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> nblk_combined_latency = 2 * nblk_behind_by_net_latency + 1;</div>
<div class="line"><span class="lineno"> 1797</span>      <span class="comment">// message in the log below is used in p2p_high_latency_test.py test</span></div>
<div class="line"><span class="lineno"> 1798</span>      <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>(c, <span class="stringliteral">&quot;Network latency is ${lat}ms, ${num} blocks discrepancy by network latency, ${tot_num} blocks discrepancy expected once message received&quot;</span>,</div>
<div class="line"><span class="lineno"> 1799</span>                (<span class="stringliteral">&quot;lat&quot;</span>, network_latency_ns/1000000)(<span class="stringliteral">&quot;num&quot;</span>, nblk_behind_by_net_latency)(<span class="stringliteral">&quot;tot_num&quot;</span>, nblk_combined_latency));</div>
<div class="line"><span class="lineno"> 1800</span> </div>
<div class="line"><span class="lineno"> 1801</span>      <span class="comment">//--------------------------------</span></div>
<div class="line"><span class="lineno"> 1802</span>      <span class="comment">// sync need checks; (lib == last irreversible block)</span></div>
<div class="line"><span class="lineno"> 1803</span>      <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1804</span>      <span class="comment">// 0. my head block id == peer head id means we are all caught up block wise</span></div>
<div class="line"><span class="lineno"> 1805</span>      <span class="comment">// 1. my head block num &lt; peer lib - start sync locally</span></div>
<div class="line"><span class="lineno"> 1806</span>      <span class="comment">// 2. my lib &gt; peer head num + nblk_combined_latency - send last_irr_catch_up notice if not the first generation</span></div>
<div class="line"><span class="lineno"> 1807</span>      <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1808</span>      <span class="comment">// 3  my head block num + nblk_combined_latency &lt; peer head block num - update sync state and send a catchup request</span></div>
<div class="line"><span class="lineno"> 1809</span>      <span class="comment">// 4  my head block num &gt;= peer block num + nblk_combined_latency send a notice catchup if this is not the first generation</span></div>
<div class="line"><span class="lineno"> 1810</span>      <span class="comment">//    4.1 if peer appears to be on a different fork ( our_id_for( msg.head_num ) != msg.head_id )</span></div>
<div class="line"><span class="lineno"> 1811</span>      <span class="comment">//        then request peer&#39;s blocks</span></div>
<div class="line"><span class="lineno"> 1812</span>      <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1813</span>      <span class="comment">//-----------------------------</span></div>
<div class="line"><span class="lineno"> 1814</span> </div>
<div class="line"><span class="lineno"> 1815</span>      <span class="keywordflow">if</span> (head_id == msg.head_id) {</div>
<div class="line"><span class="lineno"> 1816</span>         <a class="code hl_define" href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a>( c, <span class="stringliteral">&quot;handshake lib ${lib}, head ${head}, head id ${id}.. sync 0&quot;</span>,</div>
<div class="line"><span class="lineno"> 1817</span>                    (<span class="stringliteral">&quot;lib&quot;</span>, msg.last_irreversible_block_num)(<span class="stringliteral">&quot;head&quot;</span>, msg.head_num)(<span class="stringliteral">&quot;id&quot;</span>, msg.head_id.str().substr(8,16)) );</div>
<div class="line"><span class="lineno"> 1818</span>         c-&gt;syncing = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1819</span>         notice_message note;</div>
<div class="line"><span class="lineno"> 1820</span>         note.known_blocks.mode = <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea3820b1d3d12c986267353dcda2fdf2d6">none</a>;</div>
<div class="line"><span class="lineno"> 1821</span>         note.known_trx.mode = <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea9b09221c2cc0fc2ea1d69a00b99ea58f">catch_up</a>;</div>
<div class="line"><span class="lineno"> 1822</span>         note.known_trx.pending = 0;</div>
<div class="line"><span class="lineno"> 1823</span>         c-&gt;enqueue( note );</div>
<div class="line"><span class="lineno"> 1824</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1825</span>      }</div>
<div class="line"><span class="lineno"> 1826</span>      <span class="keywordflow">if</span> (head &lt; peer_lib) {</div>
<div class="line"><span class="lineno"> 1827</span>         <a class="code hl_define" href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a>( c, <span class="stringliteral">&quot;handshake lib ${lib}, head ${head}, head id ${id}.. sync 1&quot;</span>,</div>
<div class="line"><span class="lineno"> 1828</span>                    (<span class="stringliteral">&quot;lib&quot;</span>, msg.last_irreversible_block_num)(<span class="stringliteral">&quot;head&quot;</span>, msg.head_num)(<span class="stringliteral">&quot;id&quot;</span>, msg.head_id.str().substr(8,16)) );</div>
<div class="line"><span class="lineno"> 1829</span>         c-&gt;syncing = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1830</span>         <span class="keywordflow">if</span> (c-&gt;sent_handshake_count &gt; 0) {</div>
<div class="line"><span class="lineno"> 1831</span>            c-&gt;send_handshake();</div>
<div class="line"><span class="lineno"> 1832</span>         }</div>
<div class="line"><span class="lineno"> 1833</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1834</span>      }</div>
<div class="line"><span class="lineno"> 1835</span>      <span class="keywordflow">if</span> (lib_num &gt; msg.head_num + nblk_combined_latency) {</div>
<div class="line"><span class="lineno"> 1836</span>         <a class="code hl_define" href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a>( c, <span class="stringliteral">&quot;handshake lib ${lib}, head ${head}, head id ${id}.. sync 2&quot;</span>,</div>
<div class="line"><span class="lineno"> 1837</span>                    (<span class="stringliteral">&quot;lib&quot;</span>, msg.last_irreversible_block_num)(<span class="stringliteral">&quot;head&quot;</span>, msg.head_num)(<span class="stringliteral">&quot;id&quot;</span>, msg.head_id.str().substr(8,16)) );</div>
<div class="line"><span class="lineno"> 1838</span>         <span class="keywordflow">if</span> (msg.generation &gt; 1 || c-&gt;protocol_version &gt; <a class="code hl_variable" href="namespacesysio.html#a29c84c78972f13f77601781f98d2283b">proto_base</a>) {</div>
<div class="line"><span class="lineno"> 1839</span>            notice_message note;</div>
<div class="line"><span class="lineno"> 1840</span>            note.known_trx.pending = lib_num;</div>
<div class="line"><span class="lineno"> 1841</span>            note.known_trx.mode = <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea528a803ed30b308213498b10d8048e62">last_irr_catch_up</a>;</div>
<div class="line"><span class="lineno"> 1842</span>            note.known_blocks.mode = <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea528a803ed30b308213498b10d8048e62">last_irr_catch_up</a>;</div>
<div class="line"><span class="lineno"> 1843</span>            note.known_blocks.pending = head;</div>
<div class="line"><span class="lineno"> 1844</span>            c-&gt;enqueue( note );</div>
<div class="line"><span class="lineno"> 1845</span>         }</div>
<div class="line"><span class="lineno"> 1846</span>         c-&gt;syncing = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1847</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1848</span>      }</div>
<div class="line"><span class="lineno"> 1849</span> </div>
<div class="line"><span class="lineno"> 1850</span>      <span class="keywordflow">if</span> (head + nblk_combined_latency &lt; msg.head_num ) {</div>
<div class="line"><span class="lineno"> 1851</span>         <a class="code hl_define" href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a>( c, <span class="stringliteral">&quot;handshake lib ${lib}, head ${head}, head id ${id}.. sync 3&quot;</span>,</div>
<div class="line"><span class="lineno"> 1852</span>                    (<span class="stringliteral">&quot;lib&quot;</span>, msg.last_irreversible_block_num)(<span class="stringliteral">&quot;head&quot;</span>, msg.head_num)(<span class="stringliteral">&quot;id&quot;</span>, msg.head_id.str().substr(8,16)) );</div>
<div class="line"><span class="lineno"> 1853</span>         c-&gt;syncing = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1854</span>         verify_catchup(c, msg.head_num, msg.head_id);</div>
<div class="line"><span class="lineno"> 1855</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1856</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(head &gt;= msg.head_num + nblk_combined_latency) {</div>
<div class="line"><span class="lineno"> 1857</span>         <a class="code hl_define" href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a>( c, <span class="stringliteral">&quot;handshake lib ${lib}, head ${head}, head id ${id}.. sync 4&quot;</span>,</div>
<div class="line"><span class="lineno"> 1858</span>                  (<span class="stringliteral">&quot;lib&quot;</span>, msg.last_irreversible_block_num)(<span class="stringliteral">&quot;head&quot;</span>, msg.head_num)(<span class="stringliteral">&quot;id&quot;</span>, msg.head_id.str().substr(8,16)) );</div>
<div class="line"><span class="lineno"> 1859</span>         <span class="keywordflow">if</span> (msg.generation &gt; 1 ||  c-&gt;protocol_version &gt; <a class="code hl_variable" href="namespacesysio.html#a29c84c78972f13f77601781f98d2283b">proto_base</a>) {</div>
<div class="line"><span class="lineno"> 1860</span>            notice_message note;</div>
<div class="line"><span class="lineno"> 1861</span>            note.known_trx.mode = <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea3820b1d3d12c986267353dcda2fdf2d6">none</a>;</div>
<div class="line"><span class="lineno"> 1862</span>            note.known_blocks.mode = <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea9b09221c2cc0fc2ea1d69a00b99ea58f">catch_up</a>;</div>
<div class="line"><span class="lineno"> 1863</span>            note.known_blocks.pending = head;</div>
<div class="line"><span class="lineno"> 1864</span>            note.known_blocks.ids.push_back(head_id);</div>
<div class="line"><span class="lineno"> 1865</span>            c-&gt;enqueue( note );</div>
<div class="line"><span class="lineno"> 1866</span>         }</div>
<div class="line"><span class="lineno"> 1867</span>         c-&gt;syncing = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1868</span>         <a class="code hl_function" href="namespaceappbase.html#a99374dc23934f008a09f2f79be9eae40">app</a>().<a class="code hl_function" href="classappbase_1_1application.html#a77aff91b861010fd61a616c59b310dcc">post</a>( <a class="code hl_variable" href="structappbase_1_1priority.html#a89fc0f21b0f87574f0299932fc1724b4">priority::medium</a>, [chain_plug = my_impl-&gt;<a class="code hl_variable" href="classsysio_1_1net__plugin__impl.html#a932907eaa912c9420b96ea45103b66b8">chain_plug</a>, c,</div>
<div class="line"><span class="lineno"> 1869</span>                                        msg_head_num = msg.head_num, msg_head_id = msg.head_id]() {</div>
<div class="line"><span class="lineno"> 1870</span>            bool on_fork = true;</div>
<div class="line"><span class="lineno"> 1871</span>            try {</div>
<div class="line"><span class="lineno"> 1872</span>               controller&amp; cc = chain_plug-&gt;chain();</div>
<div class="line"><span class="lineno"> 1873</span>               on_fork = cc.get_block_id_for_num( msg_head_num ) != msg_head_id;</div>
<div class="line"><span class="lineno"> 1874</span>            } <span class="keywordflow">catch</span>( ... ) {}</div>
<div class="line"><span class="lineno"> 1875</span>            <span class="keywordflow">if</span>( on_fork ) {</div>
<div class="line"><span class="lineno"> 1876</span>               c-&gt;strand.post( [c]() {</div>
<div class="line"><span class="lineno"> 1877</span>                  request_message req;</div>
<div class="line"><span class="lineno"> 1878</span>                  req.req_blocks.mode = catch_up;</div>
<div class="line"><span class="lineno"> 1879</span>                  req.req_trx.mode = none;</div>
<div class="line"><span class="lineno"> 1880</span>                  c-&gt;enqueue( req );</div>
<div class="line"><span class="lineno"> 1881</span>               } );</div>
<div class="line"><span class="lineno"> 1882</span>            }</div>
<div class="line"><span class="lineno"> 1883</span>         } );</div>
<div class="line"><span class="lineno"> 1884</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1885</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1886</span>         <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;Block discrepancy is within network latency range.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1887</span>      }</div>
<div class="line"><span class="lineno"> 1888</span>   }</div>
<div class="ttc" id="aclassappbase_1_1application_html_a77aff91b861010fd61a616c59b310dcc"><div class="ttname"><a href="classappbase_1_1application.html#a77aff91b861010fd61a616c59b310dcc">appbase::application::post</a></div><div class="ttdeci">auto post(int priority, Func &amp;&amp;func)</div><div class="ttdef"><b>Definition</b> <a href="application_8hpp_source.html#l00215">application.hpp:215</a></div></div>
<div class="ttc" id="aclassfc_1_1sha256_html"><div class="ttname"><a href="classfc_1_1sha256.html">fc::sha256</a></div><div class="ttdef"><b>Definition</b> <a href="sha256_8hpp_source.html#l00011">sha256.hpp:12</a></div></div>
<div class="ttc" id="aclasssysio_1_1net__plugin__impl_html_a932907eaa912c9420b96ea45103b66b8"><div class="ttname"><a href="classsysio_1_1net__plugin__impl.html#a932907eaa912c9420b96ea45103b66b8">sysio::net_plugin_impl::chain_plug</a></div><div class="ttdeci">chain_plugin * chain_plug</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00264">net_plugin.cpp:264</a></div></div>
<div class="ttc" id="aclasssysio_1_1net__plugin__impl_html_ab7de62c1cba9cb5a30060a687ef913e2"><div class="ttname"><a href="classsysio_1_1net__plugin__impl.html#ab7de62c1cba9cb5a30060a687ef913e2">sysio::net_plugin_impl::get_chain_info</a></div><div class="ttdeci">std::tuple&lt; uint32_t, uint32_t, uint32_t, block_id_type, block_id_type, block_id_type &gt; get_chain_info() const</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l02713">net_plugin.cpp:2713</a></div></div>
<div class="ttc" id="aclasssysio_1_1sync__manager_html_ab81caff4e1eae073cee42d0a16600fb0"><div class="ttname"><a href="#ab81caff4e1eae073cee42d0a16600fb0">sysio::sync_manager::sync_reset_lib_num</a></div><div class="ttdeci">void sync_reset_lib_num(const connection_ptr &amp;conn, bool closing)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l01566">net_plugin.cpp:1566</a></div></div>
<div class="ttc" id="anamespaceappbase_html_a99374dc23934f008a09f2f79be9eae40"><div class="ttname"><a href="namespaceappbase.html#a99374dc23934f008a09f2f79be9eae40">appbase::app</a></div><div class="ttdeci">application &amp; app()</div><div class="ttdef"><b>Definition</b> <a href="application_8cpp_source.html#l00210">application.cpp:210</a></div></div>
<div class="ttc" id="anamespacesysio_html_a29c84c78972f13f77601781f98d2283b"><div class="ttname"><a href="namespacesysio.html#a29c84c78972f13f77601781f98d2283b">sysio::proto_base</a></div><div class="ttdeci">constexpr uint16_t proto_base</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00421">net_plugin.cpp:421</a></div></div>
<div class="ttc" id="anamespacesysio_html_a3a283f786468e0f0e35b0177214ca59ea3820b1d3d12c986267353dcda2fdf2d6"><div class="ttname"><a href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea3820b1d3d12c986267353dcda2fdf2d6">sysio::none</a></div><div class="ttdeci">@ none</div><div class="ttdef"><b>Definition</b> <a href="plugins_2net__plugin_2include_2sysio_2net__plugin_2protocol_8hpp_source.html#l00093">protocol.hpp:93</a></div></div>
<div class="ttc" id="anamespacesysio_html_a3a283f786468e0f0e35b0177214ca59ea528a803ed30b308213498b10d8048e62"><div class="ttname"><a href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea528a803ed30b308213498b10d8048e62">sysio::last_irr_catch_up</a></div><div class="ttdeci">@ last_irr_catch_up</div><div class="ttdef"><b>Definition</b> <a href="plugins_2net__plugin_2include_2sysio_2net__plugin_2protocol_8hpp_source.html#l00095">protocol.hpp:95</a></div></div>
<div class="ttc" id="anamespacesysio_html_a3a283f786468e0f0e35b0177214ca59ea9b09221c2cc0fc2ea1d69a00b99ea58f"><div class="ttname"><a href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea9b09221c2cc0fc2ea1d69a00b99ea58f">sysio::catch_up</a></div><div class="ttdeci">@ catch_up</div><div class="ttdef"><b>Definition</b> <a href="plugins_2net__plugin_2include_2sysio_2net__plugin_2protocol_8hpp_source.html#l00094">protocol.hpp:94</a></div></div>
<div class="ttc" id="anet__plugin_8cpp_html_a051c62a0ec99dcd3e7a38fd03bec1fe0"><div class="ttname"><a href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a></div><div class="ttdeci">#define peer_dlog(PEER, FORMAT,...)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00359">net_plugin.cpp:359</a></div></div>
<div class="ttc" id="anet__plugin_8cpp_html_ad909b2ce03eb19202983c88ae2abe9bd"><div class="ttname"><a href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a></div><div class="ttdeci">#define peer_ilog(PEER, FORMAT,...)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00367">net_plugin.cpp:367</a></div></div>
<div class="ttc" id="anet__plugin_8cpp_html_af53787454493a30650fdab0193037465"><div class="ttname"><a href="net__plugin_8cpp.html#af53787454493a30650fdab0193037465">peer_wlog</a></div><div class="ttdeci">#define peer_wlog(PEER, FORMAT,...)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00375">net_plugin.cpp:375</a></div></div>
<div class="ttc" id="astdint_8h_html_a414156feea104f8f75b4ed9e3121b2f6"><div class="ttname"><a href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a></div><div class="ttdeci">signed __int64 int64_t</div><div class="ttdef"><b>Definition</b> <a href="stdint_8h_source.html#l00135">stdint.h:135</a></div></div>
<div class="ttc" id="astdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition</b> <a href="stdint_8h_source.html#l00126">stdint.h:126</a></div></div>
<div class="ttc" id="astructappbase_1_1priority_html_a89fc0f21b0f87574f0299932fc1724b4"><div class="ttname"><a href="structappbase_1_1priority.html#a89fc0f21b0f87574f0299932fc1724b4">appbase::priority::medium</a></div><div class="ttdeci">static constexpr int medium</div><div class="ttdef"><b>Definition</b> <a href="execution__priority__queue_8hpp_source.html#l00013">execution_priority_queue.hpp:13</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_a4df766ac98a672861e3f9e2a7ca715e6_cgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_a4df766ac98a672861e3f9e2a7ca715e6_cgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_a4df766ac98a672861e3f9e2a7ca715e6_cgraph" id="aclasssysio_1_1sync__manager_a4df766ac98a672861e3f9e2a7ca715e6_cgraph">
<area shape="rect" title=" " alt="" coords="5,152,151,193"/>
<area shape="rect" href="namespaceappbase.html#a99374dc23934f008a09f2f79be9eae40" title=" " alt="" coords="222,24,321,49"/>
<area shape="poly" title=" " alt="" coords="99,150,143,110,197,69,223,54,226,59,200,73,146,114,102,153"/>
<area shape="rect" href="classsysio_1_1net__plugin__impl.html#ab7de62c1cba9cb5a30060a687ef913e2" title=" " alt="" coords="408,209,558,250"/>
<area shape="poly" title=" " alt="" coords="152,186,199,195,393,219,392,224,198,200,151,191"/>
<area shape="rect" href="classappbase_1_1application.html#a77aff91b861010fd61a616c59b310dcc" title=" " alt="" coords="201,83,342,123"/>
<area shape="poly" title=" " alt="" coords="136,149,197,127,199,132,138,154"/>
<area shape="rect" href="classfc_1_1sha256.html#a71ac4efc1d964d24fdf00aeffcf0a9c9" title=" " alt="" coords="219,160,324,185"/>
<area shape="poly" title=" " alt="" coords="151,170,203,170,203,175,151,175"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#ab81caff4e1eae073cee42d0a16600fb0" title=" " alt="" coords="199,268,344,309"/>
<area shape="poly" title=" " alt="" coords="115,191,200,243,223,257,221,262,197,248,112,196"/>
<area shape="rect" href="classappbase_1_1application.html#ac874b2659b400fe254f1ae4260d06ecf" title=" " alt="" coords="413,5,553,46"/>
<area shape="poly" title=" " alt="" coords="321,31,397,27,398,33,321,37"/>
<area shape="rect" href="classappbase_1_1execution__priority__queue.html#acfa0c68e913a02f179e52ed758451a69" title=" " alt="" coords="410,71,556,111"/>
<area shape="poly" title=" " alt="" coords="342,96,395,93,395,99,342,102"/>
<area shape="rect" href="namespacefc.html#aab567c89004d329f560014d9943afcd6" title=" " alt="" coords="444,160,523,185"/>
<area shape="poly" title=" " alt="" coords="324,170,428,170,428,175,324,175"/>
<area shape="poly" title=" " alt="" coords="448,161,441,151,445,141,460,135,483,133,509,136,522,142,520,147,508,141,483,138,461,140,449,145,446,150,452,158"/>
<area shape="poly" title=" " alt="" coords="344,266,392,252,394,257,345,271"/>
<area shape="rect" href="namespacesysio.html#a0369be74f29dbab1c8afd88c3f6d2858" title=" " alt="" coords="409,275,557,315"/>
<area shape="poly" title=" " alt="" coords="345,288,394,290,394,295,345,293"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a671900953bfaa2a06219f40687df4388" title=" " alt="" coords="392,340,574,381"/>
<area shape="poly" title=" " alt="" coords="334,307,408,332,406,337,332,312"/>
</map>
</div>

</div>
</div>
<a id="a51eb06caeee4ecfe79679e4dfca5240e" name="a51eb06caeee4ecfe79679e4dfca5240e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51eb06caeee4ecfe79679e4dfca5240e">&#9670;&#160;</a></span>rejected_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::rejected_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>c</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>blk_num</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01966">1966</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1966</span>                                                                                {</div>
<div class="line"><span class="lineno"> 1967</span>      c-&gt;block_status_monitor_.rejected();</div>
<div class="line"><span class="lineno"> 1968</span>      std::unique_lock&lt;std::mutex&gt; g( sync_mtx );</div>
<div class="line"><span class="lineno"> 1969</span>      <a class="code hl_function" href="#a671900953bfaa2a06219f40687df4388">reset_last_requested_num</a>(g);</div>
<div class="line"><span class="lineno"> 1970</span>      <span class="keywordflow">if</span>( c-&gt;block_status_monitor_.max_events_violated()) {</div>
<div class="line"><span class="lineno"> 1971</span>         <a class="code hl_define" href="net__plugin_8cpp.html#af53787454493a30650fdab0193037465">peer_wlog</a>( c, <span class="stringliteral">&quot;block ${bn} not accepted, closing connection&quot;</span>, (<span class="stringliteral">&quot;bn&quot;</span>, blk_num) );</div>
<div class="line"><span class="lineno"> 1972</span>         sync_source.reset();</div>
<div class="line"><span class="lineno"> 1973</span>         g.unlock();</div>
<div class="line"><span class="lineno"> 1974</span>         c-&gt;close();</div>
<div class="line"><span class="lineno"> 1975</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1976</span>         g.unlock();</div>
<div class="line"><span class="lineno"> 1977</span>         c-&gt;send_handshake();</div>
<div class="line"><span class="lineno"> 1978</span>      }</div>
<div class="line"><span class="lineno"> 1979</span>   }</div>
<div class="ttc" id="aclasssysio_1_1sync__manager_html_a671900953bfaa2a06219f40687df4388"><div class="ttname"><a href="#a671900953bfaa2a06219f40687df4388">sysio::sync_manager::reset_last_requested_num</a></div><div class="ttdeci">void reset_last_requested_num(const std::unique_lock&lt; std::mutex &gt; &amp;lock)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00160">net_plugin.cpp:160</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_a51eb06caeee4ecfe79679e4dfca5240e_cgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_a51eb06caeee4ecfe79679e4dfca5240e_cgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_a51eb06caeee4ecfe79679e4dfca5240e_cgraph" id="aclasssysio_1_1sync__manager_a51eb06caeee4ecfe79679e4dfca5240e_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,151,46"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a671900953bfaa2a06219f40687df4388" title=" " alt="" coords="199,5,381,46"/>
<area shape="poly" title=" " alt="" coords="151,23,183,23,183,28,151,28"/>
</map>
</div>

</div>
</div>
<a id="a671900953bfaa2a06219f40687df4388" name="a671900953bfaa2a06219f40687df4388"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a671900953bfaa2a06219f40687df4388">&#9670;&#160;</a></span>reset_last_requested_num()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::reset_last_requested_num </td>
          <td>(</td>
          <td class="paramtype">const std::unique_lock&lt; std::mutex &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>lock</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l00160">160</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  160</span>                                                                                 {</div>
<div class="line"><span class="lineno">  161</span>         sync_last_requested_num = 0;</div>
<div class="line"><span class="lineno">  162</span>      }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_a671900953bfaa2a06219f40687df4388_icgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_a671900953bfaa2a06219f40687df4388_icgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_a671900953bfaa2a06219f40687df4388_icgraph" id="aclasssysio_1_1sync__manager_a671900953bfaa2a06219f40687df4388_icgraph">
<area shape="rect" title=" " alt="" coords="396,71,578,111"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a51eb06caeee4ecfe79679e4dfca5240e" title=" " alt="" coords="201,5,346,46"/>
<area shape="poly" title=" " alt="" coords="403,68,342,49,343,44,405,63"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a6acfea4380e06a48ff83764b2a779a96" title=" " alt="" coords="199,71,348,111"/>
<area shape="poly" title=" " alt="" coords="380,94,349,94,349,88,380,88"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#ab81caff4e1eae073cee42d0a16600fb0" title=" " alt="" coords="201,136,346,177"/>
<area shape="poly" title=" " alt="" coords="405,119,343,138,342,133,403,114"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a4df766ac98a672861e3f9e2a7ca715e6" title=" " alt="" coords="5,103,151,143"/>
<area shape="poly" title=" " alt="" coords="185,144,151,138,152,133,186,139"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a4947bb9b1146d531ae706d4fc9d57025" title=" " alt="" coords="5,168,151,209"/>
<area shape="poly" title=" " alt="" coords="186,173,152,179,151,174,185,168"/>
</map>
</div>

</div>
</div>
<a id="afe3debb36f6f73dbbf6a3bbb8c4ef734" name="afe3debb36f6f73dbbf6a3bbb8c4ef734"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe3debb36f6f73dbbf6a3bbb8c4ef734">&#9670;&#160;</a></span>send_handshakes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::send_handshakes </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01711">1711</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1711</span>                                      {</div>
<div class="line"><span class="lineno"> 1712</span>      <a class="code hl_function" href="namespacesysio.html#af36f44203d6675615cf012396bcef424">for_each_connection</a>( []( <span class="keyword">auto</span>&amp; ci ) {</div>
<div class="line"><span class="lineno"> 1713</span>         <span class="keywordflow">if</span>( ci-&gt;current() ) {</div>
<div class="line"><span class="lineno"> 1714</span>            ci-&gt;send_handshake();</div>
<div class="line"><span class="lineno"> 1715</span>         }</div>
<div class="line"><span class="lineno"> 1716</span>         <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1717</span>      } );</div>
<div class="line"><span class="lineno"> 1718</span>   }</div>
<div class="ttc" id="anamespacesysio_html_af36f44203d6675615cf012396bcef424"><div class="ttname"><a href="namespacesysio.html#af36f44203d6675615cf012396bcef424">sysio::for_each_connection</a></div><div class="ttdeci">void for_each_connection(Function f)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00860">net_plugin.cpp:860</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_cgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_cgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_cgraph" id="aclasssysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,151,46"/>
<area shape="rect" href="namespacesysio.html#af36f44203d6675615cf012396bcef424" title=" " alt="" coords="199,13,379,38"/>
<area shape="poly" title=" " alt="" coords="151,23,183,23,183,28,151,28"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_icgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_icgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_icgraph" id="aclasssysio_1_1sync__manager_afe3debb36f6f73dbbf6a3bbb8c4ef734_icgraph">
<area shape="rect" title=" " alt="" coords="199,5,344,46"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#afbcb08cf70b4e5cb2416b1fd59be9787" title=" " alt="" coords="5,5,151,46"/>
<area shape="poly" title=" " alt="" coords="183,28,151,28,151,23,183,23"/>
</map>
</div>

</div>
</div>
<a id="a6acfea4380e06a48ff83764b2a779a96" name="a6acfea4380e06a48ff83764b2a779a96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6acfea4380e06a48ff83764b2a779a96">&#9670;&#160;</a></span>sync_reassign_fetch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::sync_reassign_fetch </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>c</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacesysio.html#a5c18cd9d34b8c5d3af8e2de75577673f">go_away_reason</a></td>          <td class="paramname"><span class="paramname"><em>reason</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01761">1761</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1761</span>                                                                                        {</div>
<div class="line"><span class="lineno"> 1762</span>      std::unique_lock&lt;std::mutex&gt; g( sync_mtx );</div>
<div class="line"><span class="lineno"> 1763</span>      <a class="code hl_define" href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a>( c, <span class="stringliteral">&quot;reassign_fetch, our last req is ${cc}, next expected is ${ne}&quot;</span>,</div>
<div class="line"><span class="lineno"> 1764</span>               (<span class="stringliteral">&quot;cc&quot;</span>, sync_last_requested_num)(<span class="stringliteral">&quot;ne&quot;</span>, sync_next_expected_num) );</div>
<div class="line"><span class="lineno"> 1765</span> </div>
<div class="line"><span class="lineno"> 1766</span>      <span class="keywordflow">if</span>( c == sync_source ) {</div>
<div class="line"><span class="lineno"> 1767</span>         c-&gt;cancel_sync(reason);</div>
<div class="line"><span class="lineno"> 1768</span>         <a class="code hl_function" href="#a671900953bfaa2a06219f40687df4388">reset_last_requested_num</a>(g);</div>
<div class="line"><span class="lineno"> 1769</span>         request_next_chunk( std::move(g) );</div>
<div class="line"><span class="lineno"> 1770</span>      }</div>
<div class="line"><span class="lineno"> 1771</span>   }</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_a6acfea4380e06a48ff83764b2a779a96_cgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_a6acfea4380e06a48ff83764b2a779a96_cgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_a6acfea4380e06a48ff83764b2a779a96_cgraph" id="aclasssysio_1_1sync__manager_a6acfea4380e06a48ff83764b2a779a96_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,155,46"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a671900953bfaa2a06219f40687df4388" title=" " alt="" coords="203,5,385,46"/>
<area shape="poly" title=" " alt="" coords="155,23,187,23,187,28,155,28"/>
</map>
</div>

</div>
</div>
<a id="afbcb08cf70b4e5cb2416b1fd59be9787" name="afbcb08cf70b4e5cb2416b1fd59be9787"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbcb08cf70b4e5cb2416b1fd59be9787">&#9670;&#160;</a></span>sync_recv_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::sync_recv_block </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>c</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacesysio_1_1chain.html#a4b8e4b7ed9dcd18ee75d0de62e88aa17">block_id_type</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>blk_id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>blk_num</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>blk_applied</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01998">1998</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1998</span>                                                                                                                              {</div>
<div class="line"><span class="lineno"> 1999</span>      <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;got block ${bn}&quot;</span>, (<span class="stringliteral">&quot;bn&quot;</span>, blk_num) );</div>
<div class="line"><span class="lineno"> 2000</span>      <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceappbase.html#a99374dc23934f008a09f2f79be9eae40">app</a>().is_quiting() ) {</div>
<div class="line"><span class="lineno"> 2001</span>         c-&gt;close( <span class="keyword">false</span>, <span class="keyword">true</span> );</div>
<div class="line"><span class="lineno"> 2002</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 2003</span>      }</div>
<div class="line"><span class="lineno"> 2004</span>      c-&gt;block_status_monitor_.accepted();</div>
<div class="line"><span class="lineno"> 2005</span>      <a class="code hl_function" href="#af128876bbe4648c785d7a0905110186e">sync_update_expected</a>( c, blk_id, blk_num, blk_applied );</div>
<div class="line"><span class="lineno"> 2006</span>      std::unique_lock&lt;std::mutex&gt; g_sync( sync_mtx );</div>
<div class="line"><span class="lineno"> 2007</span>      stages <a class="code hl_struct" href="structstate.html">state</a> = sync_state;</div>
<div class="line"><span class="lineno"> 2008</span>      <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;state ${s}&quot;</span>, (<span class="stringliteral">&quot;s&quot;</span>, stage_str( <a class="code hl_struct" href="structstate.html">state</a> )) );</div>
<div class="line"><span class="lineno"> 2009</span>      <span class="keywordflow">if</span>( <a class="code hl_struct" href="structstate.html">state</a> == head_catchup ) {</div>
<div class="line"><span class="lineno"> 2010</span>         <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;sync_manager in head_catchup state&quot;</span> );</div>
<div class="line"><span class="lineno"> 2011</span>         sync_source.reset();</div>
<div class="line"><span class="lineno"> 2012</span>         g_sync.unlock();</div>
<div class="line"><span class="lineno"> 2013</span> </div>
<div class="line"><span class="lineno"> 2014</span>         <a class="code hl_class" href="classfc_1_1sha256.html">block_id_type</a> null_id;</div>
<div class="line"><span class="lineno"> 2015</span>         <span class="keywordtype">bool</span> set_state_to_head_catchup = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 2016</span>         <a class="code hl_function" href="namespacesysio.html#a0369be74f29dbab1c8afd88c3f6d2858">for_each_block_connection</a>( [&amp;null_id, blk_num, &amp;blk_id, &amp;c, &amp;set_state_to_head_catchup]( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; cp ) {</div>
<div class="line"><span class="lineno"> 2017</span>            std::unique_lock&lt;std::mutex&gt; g_cp_conn( cp-&gt;conn_mtx );</div>
<div class="line"><span class="lineno"> 2018</span>            <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> fork_head_num = cp-&gt;fork_head_num;</div>
<div class="line"><span class="lineno"> 2019</span>            <a class="code hl_class" href="classfc_1_1sha256.html">block_id_type</a> fork_head_id = cp-&gt;fork_head;</div>
<div class="line"><span class="lineno"> 2020</span>            g_cp_conn.unlock();</div>
<div class="line"><span class="lineno"> 2021</span>            <span class="keywordflow">if</span>( fork_head_id == null_id ) {</div>
<div class="line"><span class="lineno"> 2022</span>               <span class="comment">// continue</span></div>
<div class="line"><span class="lineno"> 2023</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fork_head_num &lt; blk_num || fork_head_id == blk_id ) {</div>
<div class="line"><span class="lineno"> 2024</span>               std::lock_guard&lt;std::mutex&gt; g_conn( c-&gt;conn_mtx );</div>
<div class="line"><span class="lineno"> 2025</span>               c-&gt;fork_head = null_id;</div>
<div class="line"><span class="lineno"> 2026</span>               c-&gt;fork_head_num = 0;</div>
<div class="line"><span class="lineno"> 2027</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2028</span>               set_state_to_head_catchup = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2029</span>            }</div>
<div class="line"><span class="lineno"> 2030</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2031</span>         } );</div>
<div class="line"><span class="lineno"> 2032</span> </div>
<div class="line"><span class="lineno"> 2033</span>         <span class="keywordflow">if</span>( set_state_to_head_catchup ) {</div>
<div class="line"><span class="lineno"> 2034</span>            <span class="keywordflow">if</span>( set_state( head_catchup ) ) {</div>
<div class="line"><span class="lineno"> 2035</span>                <a class="code hl_function" href="#afe3debb36f6f73dbbf6a3bbb8c4ef734">send_handshakes</a>();</div>
<div class="line"><span class="lineno"> 2036</span>            }</div>
<div class="line"><span class="lineno"> 2037</span>         } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2038</span>            set_state( in_sync );</div>
<div class="line"><span class="lineno"> 2039</span>            <a class="code hl_function" href="#afe3debb36f6f73dbbf6a3bbb8c4ef734">send_handshakes</a>();</div>
<div class="line"><span class="lineno"> 2040</span>         }</div>
<div class="line"><span class="lineno"> 2041</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_struct" href="structstate.html">state</a> == lib_catchup ) {</div>
<div class="line"><span class="lineno"> 2042</span>         <span class="keywordflow">if</span>( blk_num &gt;= sync_known_lib_num ) {</div>
<div class="line"><span class="lineno"> 2043</span>            <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;All caught up with last known last irreversible block resending handshake&quot;</span> );</div>
<div class="line"><span class="lineno"> 2044</span>            set_state( in_sync );</div>
<div class="line"><span class="lineno"> 2045</span>            g_sync.unlock();</div>
<div class="line"><span class="lineno"> 2046</span>            <a class="code hl_function" href="#afe3debb36f6f73dbbf6a3bbb8c4ef734">send_handshakes</a>();</div>
<div class="line"><span class="lineno"> 2047</span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( blk_num &gt;= sync_last_requested_num ) {</div>
<div class="line"><span class="lineno"> 2048</span>            request_next_chunk( std::move( g_sync) );</div>
<div class="line"><span class="lineno"> 2049</span>         } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2050</span>            g_sync.unlock();</div>
<div class="line"><span class="lineno"> 2051</span>            <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;calling sync_wait&quot;</span> );</div>
<div class="line"><span class="lineno"> 2052</span>            c-&gt;sync_wait();</div>
<div class="line"><span class="lineno"> 2053</span>         }</div>
<div class="line"><span class="lineno"> 2054</span>      }</div>
<div class="line"><span class="lineno"> 2055</span>   }</div>
<div class="ttc" id="aclasssysio_1_1sync__manager_html_af128876bbe4648c785d7a0905110186e"><div class="ttname"><a href="#af128876bbe4648c785d7a0905110186e">sysio::sync_manager::sync_update_expected</a></div><div class="ttdeci">void sync_update_expected(const connection_ptr &amp;c, const block_id_type &amp;blk_id, uint32_t blk_num, bool blk_applied)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l01982">net_plugin.cpp:1982</a></div></div>
<div class="ttc" id="aclasssysio_1_1sync__manager_html_afe3debb36f6f73dbbf6a3bbb8c4ef734"><div class="ttname"><a href="#afe3debb36f6f73dbbf6a3bbb8c4ef734">sysio::sync_manager::send_handshakes</a></div><div class="ttdeci">static void send_handshakes()</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l01711">net_plugin.cpp:1711</a></div></div>
<div class="ttc" id="anamespacesysio_html_a0369be74f29dbab1c8afd88c3f6d2858"><div class="ttname"><a href="namespacesysio.html#a0369be74f29dbab1c8afd88c3f6d2858">sysio::for_each_block_connection</a></div><div class="ttdeci">void for_each_block_connection(Function f)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00868">net_plugin.cpp:868</a></div></div>
<div class="ttc" id="astructstate_html"><div class="ttname"><a href="structstate.html">state</a></div><div class="ttdef"><b>Definition</b> <a href="yubihsm__curl_8c_source.html#l00028">yubihsm_curl.c:28</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_afbcb08cf70b4e5cb2416b1fd59be9787_cgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_afbcb08cf70b4e5cb2416b1fd59be9787_cgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_afbcb08cf70b4e5cb2416b1fd59be9787_cgraph" id="aclasssysio_1_1sync__manager_afbcb08cf70b4e5cb2416b1fd59be9787_cgraph">
<area shape="rect" title=" " alt="" coords="5,96,151,137"/>
<area shape="rect" href="namespaceappbase.html#a99374dc23934f008a09f2f79be9eae40" title=" " alt="" coords="231,13,330,38"/>
<area shape="poly" title=" " alt="" coords="112,93,198,49,216,42,218,46,200,53,115,98"/>
<area shape="rect" href="namespacesysio.html#a0369be74f29dbab1c8afd88c3f6d2858" title=" " alt="" coords="206,63,354,103"/>
<area shape="poly" title=" " alt="" coords="150,102,190,95,191,100,151,107"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#afe3debb36f6f73dbbf6a3bbb8c4ef734" title=" " alt="" coords="208,128,353,169"/>
<area shape="poly" title=" " alt="" coords="151,125,193,132,192,137,150,130"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#af128876bbe4648c785d7a0905110186e" title=" " alt="" coords="199,193,362,234"/>
<area shape="poly" title=" " alt="" coords="117,135,200,178,213,184,211,189,197,183,115,140"/>
<area shape="rect" href="classappbase_1_1application.html#ac874b2659b400fe254f1ae4260d06ecf" title=" " alt="" coords="430,5,570,46"/>
<area shape="poly" title=" " alt="" coords="330,23,415,23,415,28,330,28"/>
<area shape="rect" href="namespacesysio.html#af36f44203d6675615cf012396bcef424" title=" " alt="" coords="410,136,590,161"/>
<area shape="poly" title=" " alt="" coords="353,146,394,146,394,151,353,151"/>
</map>
</div>

</div>
</div>
<a id="a4947bb9b1146d531ae706d4fc9d57025" name="a4947bb9b1146d531ae706d4fc9d57025"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4947bb9b1146d531ae706d4fc9d57025">&#9670;&#160;</a></span>sync_recv_notice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::sync_recv_notice </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>c</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structsysio_1_1notice__message.html">notice_message</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>msg</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01937">1937</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1937</span>                                                                                          {</div>
<div class="line"><span class="lineno"> 1938</span>      <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;sync_manager got ${m} block notice&quot;</span>, (<span class="stringliteral">&quot;m&quot;</span>, <a class="code hl_function" href="namespacesysio.html#a454edd6d34c5564da3a8c796090837fe">modes_str</a>( msg.known_blocks.mode )) );</div>
<div class="line"><span class="lineno"> 1939</span>      <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( msg.known_blocks.mode == <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea9b09221c2cc0fc2ea1d69a00b99ea58f">catch_up</a> || msg.known_blocks.mode == <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea528a803ed30b308213498b10d8048e62">last_irr_catch_up</a>, plugin_exception,</div>
<div class="line"><span class="lineno"> 1940</span>                  <span class="stringliteral">&quot;sync_recv_notice only called on catch_up&quot;</span> );</div>
<div class="line"><span class="lineno"> 1941</span>      <span class="keywordflow">if</span> (msg.known_blocks.mode == <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea9b09221c2cc0fc2ea1d69a00b99ea58f">catch_up</a>) {</div>
<div class="line"><span class="lineno"> 1942</span>         <span class="keywordflow">if</span> (msg.known_blocks.ids.size() == 0) {</div>
<div class="line"><span class="lineno"> 1943</span>            <a class="code hl_define" href="net__plugin_8cpp.html#a0237ff767d828f6a423a4728c65b11b8">peer_elog</a>( c, <span class="stringliteral">&quot;got a catch up with ids size = 0&quot;</span> );</div>
<div class="line"><span class="lineno"> 1944</span>         } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1945</span>            <span class="keyword">const</span> <a class="code hl_class" href="classfc_1_1sha256.html">block_id_type</a>&amp; <span class="keywordtype">id</span> = msg.known_blocks.ids.back();</div>
<div class="line"><span class="lineno"> 1946</span>            <a class="code hl_define" href="net__plugin_8cpp.html#ad909b2ce03eb19202983c88ae2abe9bd">peer_ilog</a>( c, <span class="stringliteral">&quot;notice_message, pending ${p}, blk_num ${n}, id ${id}...&quot;</span>,</div>
<div class="line"><span class="lineno"> 1947</span>                     (<span class="stringliteral">&quot;p&quot;</span>, msg.known_blocks.pending)(<span class="stringliteral">&quot;n&quot;</span>, <a class="code hl_function" href="structsysio_1_1chain_1_1block__header.html#a39d57e33ef8d3f6ba59b4c458f0ae375">block_header::num_from_id</a>(<span class="keywordtype">id</span>))(<span class="stringliteral">&quot;id&quot;</span>,<span class="keywordtype">id</span>.str().substr(8,16)) );</div>
<div class="line"><span class="lineno"> 1948</span>            <span class="keywordflow">if</span>( !my_impl-&gt;<a class="code hl_variable" href="classsysio_1_1net__plugin__impl.html#a5b302f8ed2594b44aa126082cd07d941">dispatcher</a>-&gt;have_block( <span class="keywordtype">id</span> ) ) {</div>
<div class="line"><span class="lineno"> 1949</span>               verify_catchup( c, msg.known_blocks.pending, <span class="keywordtype">id</span> );</div>
<div class="line"><span class="lineno"> 1950</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1951</span>               <span class="comment">// we already have the block, so update peer with our view of the world</span></div>
<div class="line"><span class="lineno"> 1952</span>               c-&gt;send_handshake();</div>
<div class="line"><span class="lineno"> 1953</span>            }</div>
<div class="line"><span class="lineno"> 1954</span>         }</div>
<div class="line"><span class="lineno"> 1955</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg.known_blocks.mode == <a class="code hl_enumvalue" href="namespacesysio.html#a3a283f786468e0f0e35b0177214ca59ea528a803ed30b308213498b10d8048e62">last_irr_catch_up</a>) {</div>
<div class="line"><span class="lineno"> 1956</span>         {</div>
<div class="line"><span class="lineno"> 1957</span>            std::lock_guard&lt;std::mutex&gt; g_conn( c-&gt;conn_mtx );</div>
<div class="line"><span class="lineno"> 1958</span>            c-&gt;last_handshake_recv.last_irreversible_block_num = msg.known_trx.pending;</div>
<div class="line"><span class="lineno"> 1959</span>         }</div>
<div class="line"><span class="lineno"> 1960</span>         <a class="code hl_function" href="#ab81caff4e1eae073cee42d0a16600fb0">sync_reset_lib_num</a>(c, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1961</span>         start_sync(c, msg.known_trx.pending);</div>
<div class="line"><span class="lineno"> 1962</span>      }</div>
<div class="line"><span class="lineno"> 1963</span>   }</div>
<div class="ttc" id="achain_2include_2sysio_2chain_2exceptions_8hpp_html_a40c2826a6fba35c1ffbf912bdf559792"><div class="ttname"><a href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a></div><div class="ttdeci">#define SYS_ASSERT(expr, exc_type, FORMAT,...)</div><div class="ttdef"><b>Definition</b> <a href="chain_2include_2sysio_2chain_2exceptions_8hpp_source.html#l00007">exceptions.hpp:7</a></div></div>
<div class="ttc" id="aclasssysio_1_1net__plugin__impl_html_a5b302f8ed2594b44aa126082cd07d941"><div class="ttname"><a href="classsysio_1_1net__plugin__impl.html#a5b302f8ed2594b44aa126082cd07d941">sysio::net_plugin_impl::dispatcher</a></div><div class="ttdeci">unique_ptr&lt; dispatch_manager &gt; dispatcher</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00224">net_plugin.cpp:224</a></div></div>
<div class="ttc" id="anamespacesysio_html_a454edd6d34c5564da3a8c796090837fe"><div class="ttname"><a href="namespacesysio.html#a454edd6d34c5564da3a8c796090837fe">sysio::modes_str</a></div><div class="ttdeci">constexpr auto modes_str(id_list_modes m)</div><div class="ttdef"><b>Definition</b> <a href="plugins_2net__plugin_2include_2sysio_2net__plugin_2protocol_8hpp_source.html#l00099">protocol.hpp:99</a></div></div>
<div class="ttc" id="anet__plugin_8cpp_html_a0237ff767d828f6a423a4728c65b11b8"><div class="ttname"><a href="net__plugin_8cpp.html#a0237ff767d828f6a423a4728c65b11b8">peer_elog</a></div><div class="ttdeci">#define peer_elog(PEER, FORMAT,...)</div><div class="ttdef"><b>Definition</b> <a href="net__plugin_8cpp_source.html#l00383">net_plugin.cpp:383</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1block__header_html_a39d57e33ef8d3f6ba59b4c458f0ae375"><div class="ttname"><a href="structsysio_1_1chain_1_1block__header.html#a39d57e33ef8d3f6ba59b4c458f0ae375">sysio::chain::block_header::num_from_id</a></div><div class="ttdeci">static uint32_t num_from_id(const block_id_type &amp;id)</div><div class="ttdef"><b>Definition</b> <a href="block__header_8cpp_source.html#l00013">block_header.cpp:13</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_a4947bb9b1146d531ae706d4fc9d57025_cgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_a4947bb9b1146d531ae706d4fc9d57025_cgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_a4947bb9b1146d531ae706d4fc9d57025_cgraph" id="aclasssysio_1_1sync__manager_a4947bb9b1146d531ae706d4fc9d57025_cgraph">
<area shape="rect" title=" " alt="" coords="5,55,151,96"/>
<area shape="rect" href="namespacesysio.html#a454edd6d34c5564da3a8c796090837fe" title=" " alt="" coords="213,5,334,31"/>
<area shape="poly" title=" " alt="" coords="149,52,212,33,213,39,150,57"/>
<area shape="rect" href="structsysio_1_1chain_1_1block__header.html#a39d57e33ef8d3f6ba59b4c458f0ae375" title=" " alt="" coords="199,55,349,96"/>
<area shape="poly" title=" " alt="" coords="151,73,183,73,183,78,151,78"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#ab81caff4e1eae073cee42d0a16600fb0" title=" " alt="" coords="201,135,346,176"/>
<area shape="poly" title=" " alt="" coords="131,94,209,126,207,131,129,99"/>
<area shape="rect" href="namespacefc.html#afb668c55fd6ee73e1fcd67e77d8f6009" title=" " alt="" coords="410,48,566,74"/>
<area shape="poly" title=" " alt="" coords="349,68,394,65,395,70,349,73"/>
<area shape="rect" href="namespacesysio.html#a0369be74f29dbab1c8afd88c3f6d2858" title=" " alt="" coords="414,98,562,138"/>
<area shape="poly" title=" " alt="" coords="346,140,398,131,399,136,347,145"/>
<area shape="rect" href="classsysio_1_1net__plugin__impl.html#ab7de62c1cba9cb5a30060a687ef913e2" title=" " alt="" coords="413,163,563,204"/>
<area shape="poly" title=" " alt="" coords="347,162,398,169,397,174,346,168"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a671900953bfaa2a06219f40687df4388" title=" " alt="" coords="397,228,579,269"/>
<area shape="poly" title=" " alt="" coords="316,174,398,213,415,220,413,225,396,218,314,179"/>
</map>
</div>

</div>
</div>
<a id="ab81caff4e1eae073cee42d0a16600fb0" name="ab81caff4e1eae073cee42d0a16600fb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab81caff4e1eae073cee42d0a16600fb0">&#9670;&#160;</a></span>sync_reset_lib_num()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::sync_reset_lib_num </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>conn</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>closing</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01566">1566</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1566</span>                                                                              {</div>
<div class="line"><span class="lineno"> 1567</span>      std::unique_lock&lt;std::mutex&gt; g( sync_mtx );</div>
<div class="line"><span class="lineno"> 1568</span>      <span class="keywordflow">if</span>( sync_state == in_sync ) {</div>
<div class="line"><span class="lineno"> 1569</span>         sync_source.reset();</div>
<div class="line"><span class="lineno"> 1570</span>      }</div>
<div class="line"><span class="lineno"> 1571</span>      <span class="keywordflow">if</span>( !c ) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1572</span>      <span class="keywordflow">if</span>( !closing ) {</div>
<div class="line"><span class="lineno"> 1573</span>         std::lock_guard&lt;std::mutex&gt; g_conn( c-&gt;conn_mtx );</div>
<div class="line"><span class="lineno"> 1574</span>         <span class="keywordflow">if</span>( c-&gt;last_handshake_recv.last_irreversible_block_num &gt; sync_known_lib_num ) {</div>
<div class="line"><span class="lineno"> 1575</span>            sync_known_lib_num = c-&gt;last_handshake_recv.last_irreversible_block_num;</div>
<div class="line"><span class="lineno"> 1576</span>         }</div>
<div class="line"><span class="lineno"> 1577</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1578</span>         <span class="comment">// Closing connection, therefore its view of LIB can no longer be considered as we will no longer be connected.</span></div>
<div class="line"><span class="lineno"> 1579</span>         <span class="comment">// Determine current LIB of remaining peers as our sync_known_lib_num.</span></div>
<div class="line"><span class="lineno"> 1580</span>         <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> highest_lib_num = 0;</div>
<div class="line"><span class="lineno"> 1581</span>         <a class="code hl_function" href="namespacesysio.html#a0369be74f29dbab1c8afd88c3f6d2858">for_each_block_connection</a>( [&amp;highest_lib_num]( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; cc ) {</div>
<div class="line"><span class="lineno"> 1582</span>            std::lock_guard&lt;std::mutex&gt; g_conn( cc-&gt;conn_mtx );</div>
<div class="line"><span class="lineno"> 1583</span>            <span class="keywordflow">if</span>( cc-&gt;current() &amp;&amp; cc-&gt;last_handshake_recv.last_irreversible_block_num &gt; highest_lib_num ) {</div>
<div class="line"><span class="lineno"> 1584</span>               highest_lib_num = cc-&gt;last_handshake_recv.last_irreversible_block_num;</div>
<div class="line"><span class="lineno"> 1585</span>            }</div>
<div class="line"><span class="lineno"> 1586</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1587</span>         } );</div>
<div class="line"><span class="lineno"> 1588</span>         sync_known_lib_num = highest_lib_num;</div>
<div class="line"><span class="lineno"> 1589</span> </div>
<div class="line"><span class="lineno"> 1590</span>         <span class="comment">// if closing the connection we are currently syncing from, then reset our last requested and next expected.</span></div>
<div class="line"><span class="lineno"> 1591</span>         <span class="keywordflow">if</span>( c == sync_source ) {</div>
<div class="line"><span class="lineno"> 1592</span>            <a class="code hl_function" href="#a671900953bfaa2a06219f40687df4388">reset_last_requested_num</a>(g);</div>
<div class="line"><span class="lineno"> 1593</span>            <span class="comment">// if starting to sync need to always start from lib as we might be on our own fork</span></div>
<div class="line"><span class="lineno"> 1594</span>            <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> lib_num = 0;</div>
<div class="line"><span class="lineno"> 1595</span>            std::tie( lib_num, std::ignore, std::ignore, std::ignore, std::ignore, std::ignore ) = my_impl-&gt;<a class="code hl_function" href="classsysio_1_1net__plugin__impl.html#ab7de62c1cba9cb5a30060a687ef913e2">get_chain_info</a>();</div>
<div class="line"><span class="lineno"> 1596</span>            sync_next_expected_num = lib_num + 1;</div>
<div class="line"><span class="lineno"> 1597</span>            request_next_chunk( std::move(g) );</div>
<div class="line"><span class="lineno"> 1598</span>         }</div>
<div class="line"><span class="lineno"> 1599</span>      }</div>
<div class="line"><span class="lineno"> 1600</span>   }</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_cgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_cgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_cgraph" id="aclasssysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_cgraph">
<area shape="rect" title=" " alt="" coords="5,71,151,111"/>
<area shape="rect" href="namespacesysio.html#a0369be74f29dbab1c8afd88c3f6d2858" title=" " alt="" coords="216,5,364,46"/>
<area shape="poly" title=" " alt="" coords="145,68,206,49,208,54,147,73"/>
<area shape="rect" href="classsysio_1_1net__plugin__impl.html#ab7de62c1cba9cb5a30060a687ef913e2" title=" " alt="" coords="215,71,365,111"/>
<area shape="poly" title=" " alt="" coords="151,88,199,88,199,94,151,94"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a671900953bfaa2a06219f40687df4388" title=" " alt="" coords="199,136,381,177"/>
<area shape="poly" title=" " alt="" coords="147,109,208,128,206,133,145,114"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_icgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_icgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_icgraph" id="aclasssysio_1_1sync__manager_ab81caff4e1eae073cee42d0a16600fb0_icgraph">
<area shape="rect" title=" " alt="" coords="199,39,344,79"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a4df766ac98a672861e3f9e2a7ca715e6" title=" " alt="" coords="5,5,151,46"/>
<area shape="poly" title=" " alt="" coords="183,46,151,41,152,36,184,41"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#a4947bb9b1146d531ae706d4fc9d57025" title=" " alt="" coords="5,71,151,111"/>
<area shape="poly" title=" " alt="" coords="184,76,152,82,151,76,183,71"/>
</map>
</div>

</div>
</div>
<a id="af128876bbe4648c785d7a0905110186e" name="af128876bbe4648c785d7a0905110186e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af128876bbe4648c785d7a0905110186e">&#9670;&#160;</a></span>sync_update_expected()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::sync_manager::sync_update_expected </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio.html#aefc0023f14362306826da768553b8daf">connection_ptr</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>c</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacesysio_1_1chain.html#a4b8e4b7ed9dcd18ee75d0de62e88aa17">block_id_type</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>blk_id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>blk_num</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>blk_applied</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l01982">1982</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1982</span>                                                                                                                                     {</div>
<div class="line"><span class="lineno"> 1983</span>      std::unique_lock&lt;std::mutex&gt; g_sync( sync_mtx );</div>
<div class="line"><span class="lineno"> 1984</span>      <span class="keywordflow">if</span>( blk_num &lt;= sync_last_requested_num ) {</div>
<div class="line"><span class="lineno"> 1985</span>         <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;sync_last_requested_num: ${r}, sync_next_expected_num: ${e}, sync_known_lib_num: ${k}, sync_req_span: ${s}&quot;</span>,</div>
<div class="line"><span class="lineno"> 1986</span>                  (<span class="stringliteral">&quot;r&quot;</span>, sync_last_requested_num)(<span class="stringliteral">&quot;e&quot;</span>, sync_next_expected_num)(<span class="stringliteral">&quot;k&quot;</span>, sync_known_lib_num)(<span class="stringliteral">&quot;s&quot;</span>, sync_req_span) );</div>
<div class="line"><span class="lineno"> 1987</span>         <span class="keywordflow">if</span> (blk_num != sync_next_expected_num &amp;&amp; !blk_applied) {</div>
<div class="line"><span class="lineno"> 1988</span>            <span class="keyword">auto</span> sync_next_expected = sync_next_expected_num;</div>
<div class="line"><span class="lineno"> 1989</span>            g_sync.unlock();</div>
<div class="line"><span class="lineno"> 1990</span>            <a class="code hl_define" href="net__plugin_8cpp.html#a051c62a0ec99dcd3e7a38fd03bec1fe0">peer_dlog</a>( c, <span class="stringliteral">&quot;expected block ${ne} but got ${bn}&quot;</span>, (<span class="stringliteral">&quot;ne&quot;</span>, sync_next_expected)(<span class="stringliteral">&quot;bn&quot;</span>, blk_num) );</div>
<div class="line"><span class="lineno"> 1991</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1992</span>         }</div>
<div class="line"><span class="lineno"> 1993</span>         sync_next_expected_num = blk_num + 1;</div>
<div class="line"><span class="lineno"> 1994</span>      }</div>
<div class="line"><span class="lineno"> 1995</span>   }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classsysio_1_1sync__manager_af128876bbe4648c785d7a0905110186e_icgraph.png" border="0" usemap="#aclasssysio_1_1sync__manager_af128876bbe4648c785d7a0905110186e_icgraph" alt=""/></div>
<map name="aclasssysio_1_1sync__manager_af128876bbe4648c785d7a0905110186e_icgraph" id="aclasssysio_1_1sync__manager_af128876bbe4648c785d7a0905110186e_icgraph">
<area shape="rect" title=" " alt="" coords="199,5,362,46"/>
<area shape="rect" href="classsysio_1_1sync__manager.html#afbcb08cf70b4e5cb2416b1fd59be9787" title=" " alt="" coords="5,5,151,46"/>
<area shape="poly" title=" " alt="" coords="183,28,151,28,151,23,183,23"/>
</map>
</div>

</div>
</div>
<a id="aeaee19ed7ea8e42c21e1a70b1f7ac625" name="aeaee19ed7ea8e42c21e1a70b1f7ac625"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeaee19ed7ea8e42c21e1a70b1f7ac625">&#9670;&#160;</a></span>syncing_with_peer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool sysio::sync_manager::syncing_with_peer </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="net__plugin_8cpp_source.html#l00149">149</a> of file <a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  149</span>{ <span class="keywordflow">return</span> sync_state == lib_catchup; }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>plugins/net_plugin/<a class="el" href="net__plugin_8cpp_source.html">net_plugin.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacesysio.html">sysio</a></li><li class="navelem"><a class="el" href="classsysio_1_1sync__manager.html">sync_manager</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
