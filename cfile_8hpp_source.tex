\doxysection{cfile.\+hpp}
\hypertarget{cfile_8hpp_source}{}\label{cfile_8hpp_source}\index{libraries/fc/include/fc/io/cfile.hpp@{libraries/fc/include/fc/io/cfile.hpp}}
\mbox{\hyperlink{cfile_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00001}00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{filesystem_8hpp}{fc/filesystem.hpp}}>}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{datastream_8hpp}{fc/io/datastream.hpp}}>}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <cstdio>}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <ios>}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <fcntl.h>}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <sys/stat.h>}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <boost/interprocess/file\_mapping.hpp>}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00011}00011\ \textcolor{preprocessor}{\#ifndef\ \_WIN32}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00012}\mbox{\hyperlink{cfile_8hpp_a61f5167b6b67be986af6e081a925267f}{00012}}\ \textcolor{preprocessor}{\#define\ FC\_FOPEN(p,\ m)\ fopen(p,\ m)}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00013}00013\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00014}00014\ \textcolor{preprocessor}{\#define\ FC\_CAT(s1,\ s2)\ s1\ \#\#\ s2}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00015}00015\ \textcolor{preprocessor}{\#define\ FC\_PREL(s)\ FC\_CAT(L,\ s)}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00016}00016\ \textcolor{preprocessor}{\#define\ FC\_FOPEN(p,\ m)\ \_wfopen(p,\ FC\_PREL(m))}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00017}00017\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00019}00019\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacefc}{fc}}\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00021}00021\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedetail}{detail}}\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00022}\mbox{\hyperlink{namespacefc_1_1detail_a0b895e56d816b54371406077aafe4272}{00022}}\ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacefc_1_1detail_a0b895e56d816b54371406077aafe4272}{unique\_file}}\ =\ std::unique\_ptr<FILE,\ \textcolor{keyword}{decltype}(\ \&fclose\ )>;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00023}00023\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00025}00025\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfc_1_1cfile__datastream}{cfile\_datastream}};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00031}\mbox{\hyperlink{classfc_1_1cfile}{00031}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfc_1_1cfile}{cfile}}\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00032}00032\ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00033}\mbox{\hyperlink{classfc_1_1cfile_a4d2f8675ed5ebbe367d25ad685acfe7c}{00033}}\ \ \ \ \mbox{\hyperlink{classfc_1_1cfile_a4d2f8675ed5ebbe367d25ad685acfe7c}{cfile}}()}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00034}00034\ \ \ \ \ \ :\ \_file(nullptr,\ \&fclose)}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00035}00035\ \ \ \ \{\}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00037}\mbox{\hyperlink{classfc_1_1cfile_ac4a0191d7846c07a907d3c7eb35e848d}{00037}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_ac4a0191d7846c07a907d3c7eb35e848d}{set\_file\_path}}(\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\ file\_path\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00038}00038\ \ \ \ \ \ \ \_file\_path\ =\ std::move(\ file\_path\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00039}00039\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00041}\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{00041}}\ \ \ \ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\ \mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00042}00042\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_file\_path;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00043}00043\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00045}\mbox{\hyperlink{classfc_1_1cfile_ae5cdb4f43248d08842f7420b48534863}{00045}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1cfile_ae5cdb4f43248d08842f7420b48534863}{is\_open}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_open;\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00047}\mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{00047}}\ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{fileno}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00048}00048\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ fd\ =\ \mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{::fileno}}(\_file.get());}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00049}00049\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ -\/1\ ==\ fd\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ convert\ file\ pointer\ to\ file\ descriptor,\ error:\ "{}}\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::to\_string(\ errno\ )\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00053}00053\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00054}00054\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ fd;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00055}00055\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00057}\mbox{\hyperlink{classfc_1_1cfile_a7a3023c63962b85efb8129379442234b}{00057}}\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classfc_1_1cfile_a7a3023c63962b85efb8129379442234b}{create\_or\_update\_rw\_mode}}\ =\ \textcolor{stringliteral}{"{}ab+"{}};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00058}\mbox{\hyperlink{classfc_1_1cfile_a486ef6e86b5b889d2ebb2e4ed34ddd78}{00058}}\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classfc_1_1cfile_a486ef6e86b5b889d2ebb2e4ed34ddd78}{update\_rw\_mode}}\ =\ \textcolor{stringliteral}{"{}rb+"{}};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00059}\mbox{\hyperlink{classfc_1_1cfile_a2dbf3113db83934d8036cd6e2245cb75}{00059}}\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classfc_1_1cfile_a2dbf3113db83934d8036cd6e2245cb75}{truncate\_rw\_mode}}\ =\ \textcolor{stringliteral}{"{}wb+"{}};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00065}\mbox{\hyperlink{classfc_1_1cfile_a9e01adaeee108420312ed271133a2d7d}{00065}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a9e01adaeee108420312ed271133a2d7d}{open}}(\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ mode\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00066}00066\ \ \ \ \ \ \ \_file.reset(\ \mbox{\hyperlink{block__log_8cpp_a61f5167b6b67be986af6e081a925267f}{FC\_FOPEN}}(\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}().c\_str(),\ mode\ )\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00067}00067\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\_file\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile\ unable\ to\ open:\ "{}}\ +\ \ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +\ \textcolor{stringliteral}{"{}\ in\ mode:\ "{}}\ +\ std::string(\ mode\ )\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00069}00069\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00070}00070\ \textcolor{preprocessor}{\#ifndef\ \_WIN32}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00071}00071\ \ \ \ \ \ \ \textcolor{keyword}{struct\ }stat\ st;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00072}00072\ \ \ \ \ \ \ \_file\_blk\_size\ =\ 4096;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00073}00073\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ fstat(\mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{fileno}}(),\ \&st)\ ==\ 0\ )}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \_file\_blk\_size\ =\ st.st\_blksize;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00075}00075\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00076}00076\ \ \ \ \ \ \ \_open\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00077}00077\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00079}\mbox{\hyperlink{classfc_1_1cfile_abc92fc8d64550b772a69ca1b63f75bfb}{00079}}\ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classfc_1_1cfile_abc92fc8d64550b772a69ca1b63f75bfb}{tellp}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00080}00080\ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ result\ =\ ftell(\ \_file.get()\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00081}00081\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ -\/1)}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}().generic\_string()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ get\ the\ current\ position\ of\ the\ file,\ error:\ "{}}\ +\ std::to\_string(\ errno\ ));}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00084}00084\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(result);}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00085}00085\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00087}\mbox{\hyperlink{classfc_1_1cfile_a6eb4fe4530480f13c6cf773a7f1e3847}{00087}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a6eb4fe4530480f13c6cf773a7f1e3847}{seek}}(\ \textcolor{keywordtype}{long}\ loc\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00088}00088\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ 0\ !=\ fseek(\ \_file.get(),\ loc,\ SEEK\_SET\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ ferror(\_file.get());}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ SEEK\_SET\ to:\ "{}}\ +\ std::to\_string(loc)\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ ferror:\ "{}}\ +\ std::to\_string(err)\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00093}00093\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00094}00094\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00096}\mbox{\hyperlink{classfc_1_1cfile_a29badc2b6c1f589d0c79b20ce31cacf0}{00096}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a29badc2b6c1f589d0c79b20ce31cacf0}{seek\_end}}(\ \textcolor{keywordtype}{long}\ loc\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00097}00097\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ 0\ !=\ fseek(\ \_file.get(),\ loc,\ SEEK\_END\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ ferror(\_file.get());}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ SEEK\_END\ to:\ "{}}\ +\ std::to\_string(loc)\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ ferror:\ "{}}\ +\ std::to\_string(err)\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00102}00102\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00103}00103\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00105}\mbox{\hyperlink{classfc_1_1cfile_a960bb1297aecf2300137c29dcc4f1150}{00105}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a960bb1297aecf2300137c29dcc4f1150}{skip}}(\ \textcolor{keywordtype}{long}\ loc)\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00106}00106\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ 0\ !=\ fseek(\ \_file.get(),\ loc,\ SEEK\_CUR\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ ferror(\_file.get());}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ SEEK\_CUR\ to:\ "{}}\ +\ std::to\_string(loc)\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ ferror:\ "{}}\ +\ std::to\_string(err)\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00111}00111\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00112}00112\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00114}\mbox{\hyperlink{classfc_1_1cfile_a247250a28d17544a57dfafe07012d27b}{00114}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a247250a28d17544a57dfafe07012d27b}{read}}(\ \textcolor{keywordtype}{char}*\ d,\ \textcolor{keywordtype}{size\_t}\ n\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00115}00115\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ result\ =\ fread(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}},\ 1,\ n,\ \_file.get()\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00116}00116\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ result\ !=\ n\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ ferror(\_file.get());}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classfc_1_1cfile_a4220f191fda28a149727bc15c34c8bc5}{eof}}\ =\ feof(\_file.get());}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ read\ "{}}\ +\ std::to\_string(\ n\ )\ +\ \textcolor{stringliteral}{"{}\ bytes;"{}}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ only\ read\ "{}}\ +\ std::to\_string(\ result\ )\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ eof:\ "{}}\ +\ (\mbox{\hyperlink{classfc_1_1cfile_a4220f191fda28a149727bc15c34c8bc5}{eof}}\ ==\ 0\ ?\ \textcolor{stringliteral}{"{}false"{}}\ :\ \textcolor{stringliteral}{"{}true"{}})\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ ferror:\ "{}}\ +\ std::to\_string(err)\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00124}00124\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00125}00125\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00127}\mbox{\hyperlink{classfc_1_1cfile_af6ad44b8179f355db75a9d01de931235}{00127}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_af6ad44b8179f355db75a9d01de931235}{write}}(\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ d,\ \textcolor{keywordtype}{size\_t}\ n\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00128}00128\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ result\ =\ fwrite(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}},\ 1,\ n,\ \_file.get()\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00129}00129\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ result\ !=\ n\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ write\ "{}}\ +\ std::to\_string(\ n\ )\ +\ \textcolor{stringliteral}{"{}\ bytes;\ only\ wrote\ "{}}\ +\ std::to\_string(\ result\ )\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00132}00132\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00133}00133\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00134}00134\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00135}\mbox{\hyperlink{classfc_1_1cfile_a2e03001fc7d98a010f98c56fb7c62a69}{00135}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a2e03001fc7d98a010f98c56fb7c62a69}{flush}}()\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00136}00136\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ 0\ !=\ fflush(\ \_file.get()\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ ferror(\ \_file.get()\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ flush\ file,\ ferror:\ "{}}\ +\ std::to\_string(\ err\ )\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00140}00140\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00141}00141\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00143}\mbox{\hyperlink{classfc_1_1cfile_a28af656923422919ab5e1edcd7be51c2}{00143}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a28af656923422919ab5e1edcd7be51c2}{sync}}()\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00144}00144\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ fd\ =\ \mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{fileno}}();}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00145}00145\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ -\/1\ ==\ fsync(\ fd\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ sync\ file,\ error:\ "{}}\ +\ std::to\_string(\ errno\ )\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00148}00148\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00149}00149\ \textcolor{preprocessor}{\#ifdef\ \_\_APPLE\_\_}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00150}00150\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ -\/1\ ==\ fcntl(\ fd,\ F\_FULLFSYNC\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00151}00151\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ F\_FULLFSYNC\ file,\ error:\ "{}}\ +\ std::to\_string(\ errno\ )\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00153}00153\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00154}00154\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00155}00155\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00157}00157\ \ \ \ \textcolor{comment}{//rounds\ to\ filesystem\ block\ boundaries;\ e.g.\ punch\_hole(5000,\ 14000)\ when\ blocksz=4096\ punches\ from\ 8192\ to\ 12288}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00158}00158\ \ \ \ \textcolor{comment}{//end\ is\ not\ inclusive;\ eg\ punch\_hole(4096,\ 8192)\ will\ punch\ 4096\ bytes\ (assuming\ blocksz=4096)}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00159}\mbox{\hyperlink{classfc_1_1cfile_a9727290ea0b449e34d6978a60ec22698}{00159}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a9727290ea0b449e34d6978a60ec22698}{punch\_hole}}(\textcolor{keywordtype}{size\_t}\ begin,\ \textcolor{keywordtype}{size\_t}\ end)\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00160}00160\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(begin\ \%\ \_file\_blk\_size)\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00161}00161\ \ \ \ \ \ \ \ \ \ begin\ \&=\ \string~(\_file\_blk\_size-\/1);}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00162}00162\ \ \ \ \ \ \ \ \ \ begin\ +=\ \_file\_blk\_size;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00163}00163\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00164}00164\ \ \ \ \ \ \ end\ \&=\ \string~(\_file\_blk\_size-\/1);}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00166}00166\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(begin\ >=\ end)}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00168}00168\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00169}00169\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00170}00170\ \textcolor{preprocessor}{\#if\ defined(\_\_linux\_\_)}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00171}00171\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ =\ fallocate(\mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{fileno}}(),\ FALLOC\_FL\_PUNCH\_HOLE|FALLOC\_FL\_KEEP\_SIZE,\ begin,\ end-\/begin);}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00172}00172\ \textcolor{preprocessor}{\#elif\ defined(\_\_APPLE\_\_)}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00173}00173\ \ \ \ \ \ \ \textcolor{keyword}{struct\ }fpunchhole\ puncher\ =\ \{0,\ 0,\ \textcolor{keyword}{static\_cast<}off\_t\textcolor{keyword}{>}(begin),\ \textcolor{keyword}{static\_cast<}off\_t\textcolor{keyword}{>}(end-\/begin)\};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00174}00174\ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ =\ fcntl(\mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{fileno}}(),\ F\_PUNCHHOLE,\ \&puncher);}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00175}00175\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00176}00176\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ ==\ -\/1)}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\textcolor{stringliteral}{"{}Failed\ to\ punch\ hole\ in\ file\ \$\{f\}:\ \$\{e\}"{}},\ (\textcolor{stringliteral}{"{}f"{}},\ \_file\_path)(\textcolor{stringliteral}{"{}e"{}},\ strerror(errno)));}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00179}00179\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile_a2e03001fc7d98a010f98c56fb7c62a69}{flush}}();}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00180}00180\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00181}00181\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00182}\mbox{\hyperlink{classfc_1_1cfile_a36ffef39be181b5580952817617ccf24}{00182}}\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1cfile_a36ffef39be181b5580952817617ccf24}{supports\_hole\_punching}}()\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00183}00183\ \textcolor{preprocessor}{\#if\ defined(\_\_linux\_\_)\ ||\ defined(\_\_APPLE\_\_)}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00184}00184\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00185}00185\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00186}00186\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00187}00187\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00188}00188\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00189}\mbox{\hyperlink{classfc_1_1cfile_a1a7fc670fbc0e24ac58d5ee341ad0182}{00189}}\ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classfc_1_1cfile_a1a7fc670fbc0e24ac58d5ee341ad0182}{filesystem\_block\_size}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \_file\_blk\_size;\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00190}00190\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00191}\mbox{\hyperlink{classfc_1_1cfile_a4220f191fda28a149727bc15c34c8bc5}{00191}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1cfile_a4220f191fda28a149727bc15c34c8bc5}{eof}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ feof(\_file.get())\ !=\ 0;\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00193}\mbox{\hyperlink{classfc_1_1cfile_afcd3bdfce810b9ceb7e5a09396a68ed2}{00193}}\ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classfc_1_1cfile_afcd3bdfce810b9ceb7e5a09396a68ed2}{getc}}()\ \{\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00194}00194\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ =\ fgetc(\_file.get());\ \ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00195}00195\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}}\ ==\ EOF)\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00196}00196\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::ios\_base::failure(\ \textcolor{stringliteral}{"{}cfile:\ "{}}\ +\ \_file\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ +}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00197}00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ unable\ to\ read\ 1\ byte"{}});}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00198}00198\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00199}00199\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00200}00200\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00202}\mbox{\hyperlink{classfc_1_1cfile_a25b3bbb8ed2f690b750a197380153985}{00202}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile_a25b3bbb8ed2f690b750a197380153985}{close}}()\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00203}00203\ \ \ \ \ \ \ \_file.reset();}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00204}00204\ \ \ \ \ \ \ \_open\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00205}00205\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00206}00206\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00207}\mbox{\hyperlink{classfc_1_1cfile_a5f9754e5897232c67f8f7fd6fe744371}{00207}}\ \ \ \ boost::interprocess::mapping\_handle\_t\ \mbox{\hyperlink{classfc_1_1cfile_a5f9754e5897232c67f8f7fd6fe744371}{get\_mapping\_handle}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00208}00208\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{classfc_1_1cfile_a3b11f29f74860527a8bba66e4ae0317d}{fileno}}(),\ \textcolor{keyword}{false}\};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00209}00209\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00210}00210\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00211}00211\ \ \ \ \mbox{\hyperlink{classfc_1_1cfile__datastream}{cfile\_datastream}}\ \mbox{\hyperlink{classfc_1_1cfile_a801dd3c493741ff16ef5cf609cc5f9c5}{create\_datastream}}();}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00213}00213\ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00214}00214\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_open\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00215}00215\ \ \ \ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \_file\_path;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00216}00216\ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_file\_blk\_size\ =\ 4096;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00217}00217\ \ \ \ \mbox{\hyperlink{namespacefc_1_1detail_a0b895e56d816b54371406077aafe4272}{detail::unique\_file}}\ \ \ \_file;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00218}00218\ \};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00220}00220\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00221}00221\ \textcolor{comment}{\ *\ \ @brief\ datastream\ adapter\ that\ adapts\ cfile\ for\ use\ with\ fc\ unpack}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00222}00222\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00223}00223\ \textcolor{comment}{\ *\ \ This\ class\ supports\ unpack\ functionality\ but\ not\ pack.}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00224}00224\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00225}\mbox{\hyperlink{classfc_1_1cfile__datastream}{00225}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfc_1_1cfile__datastream}{cfile\_datastream}}\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00226}00226\ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00227}\mbox{\hyperlink{classfc_1_1cfile__datastream_a2b722abd6695ec40c47efd3e638cdcc1}{00227}}\ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_a2b722abd6695ec40c47efd3e638cdcc1}{cfile\_datastream}}(\ \mbox{\hyperlink{classfc_1_1cfile}{cfile}}\&\ cf\ )\ :\ cf(cf)\ \{\}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00228}00228\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00229}\mbox{\hyperlink{classfc_1_1cfile__datastream_ae6f1ad5473ace81a1548c8e8460e2c37}{00229}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_ae6f1ad5473ace81a1548c8e8460e2c37}{skip}}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00230}00230\ \ \ \ \ \ \ std::vector<char>\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00231}00231\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile__datastream_a6cb58e20d4c5243d719040b19a0a1161}{read}}(\ \&\mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}[0],\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00232}00232\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00233}00233\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00234}\mbox{\hyperlink{classfc_1_1cfile__datastream_a6cb58e20d4c5243d719040b19a0a1161}{00234}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_a6cb58e20d4c5243d719040b19a0a1161}{read}}(\ \textcolor{keywordtype}{char}*\ d,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00235}00235\ \ \ \ \ \ \ cf.\mbox{\hyperlink{classfc_1_1cfile_a247250a28d17544a57dfafe07012d27b}{read}}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}},\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ );}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00236}00236\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00237}00237\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00238}00238\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00239}\mbox{\hyperlink{classfc_1_1cfile__datastream_a8f4661fd77c5a6b04b0422a7da33d7ba}{00239}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_a8f4661fd77c5a6b04b0422a7da33d7ba}{get}}(\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\&\ c\ )\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_a8f4661fd77c5a6b04b0422a7da33d7ba}{get}}(\ *(\textcolor{keywordtype}{char}*)\&c\ );\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00240}00240\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00241}\mbox{\hyperlink{classfc_1_1cfile__datastream_a40d05820e080308df4c1b5a858d9926d}{00241}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_a40d05820e080308df4c1b5a858d9926d}{get}}(\ \textcolor{keywordtype}{char}\&\ c\ )\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_a6cb58e20d4c5243d719040b19a0a1161}{read}}(\&c,\ 1);\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00242}00242\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00243}\mbox{\hyperlink{classfc_1_1cfile__datastream_ad1d4d86497097b4cb473f4137c6e2ed3}{00243}}\ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classfc_1_1cfile__datastream_ad1d4d86497097b4cb473f4137c6e2ed3}{tellp}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ cf.\mbox{\hyperlink{classfc_1_1cfile_abc92fc8d64550b772a69ca1b63f75bfb}{tellp}}();\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00244}00244\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00245}00245\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00246}00246\ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{cfile}}\&\ cf;}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00247}00247\ \};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00248}00248\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00249}\mbox{\hyperlink{classfc_1_1cfile_a801dd3c493741ff16ef5cf609cc5f9c5}{00249}}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classfc_1_1cfile__datastream}{cfile\_datastream}}\ \mbox{\hyperlink{classfc_1_1cfile_a801dd3c493741ff16ef5cf609cc5f9c5}{cfile::create\_datastream}}()\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00250}00250\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classfc_1_1cfile__datastream}{cfile\_datastream}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00251}00251\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00252}00252\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00253}00253\ \textcolor{keyword}{template}\ <>}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00254}\mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4}{00254}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfc_1_1datastream}{datastream}}<\mbox{\hyperlink{namespacefc}{fc}}::\mbox{\hyperlink{classfc_1_1cfile}{cfile}},\ void>\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00255}00255\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00256}00256\ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classfc_1_1cfile_a4d2f8675ed5ebbe367d25ad685acfe7c}{fc::cfile::cfile}};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00257}00257\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00258}\mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_a793a75072225e716b1140b60bd2c5164}{00258}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_a793a75072225e716b1140b60bd2c5164}{seekp}}(\textcolor{keywordtype}{size\_t}\ pos)\ \{\ \textcolor{keywordflow}{return}\ this-\/>seek(pos),\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00259}00259\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00260}\mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_ac7de562eef11d557787a4851b132a5e4}{00260}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_ac7de562eef11d557787a4851b132a5e4}{get}}(\textcolor{keywordtype}{char}\&\ c)\ \{}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00261}00261\ \ \ \ \ \ \ c\ =\ this-\/>getc();}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00262}00262\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00263}00263\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00264}00264\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00265}\mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_ab5324fb71b5924a64e832c081b112d2d}{00265}}\ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_ab5324fb71b5924a64e832c081b112d2d}{storage}}()\ \{\ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00266}\mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_a15405b2b534f410b1f2d3074def1d260}{00266}}\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ \mbox{\hyperlink{classfc_1_1datastream_3_01fc_1_1cfile_00_01void_01_4_a15405b2b534f410b1f2d3074def1d260}{storage}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};\ \}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00267}00267\ \};}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00268}00268\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00269}00269\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00270}00270\ \}\ \textcolor{comment}{//\ namespace\ fc}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00272}00272\ \textcolor{preprocessor}{\#ifndef\ \_WIN32}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00273}00273\ \textcolor{preprocessor}{\#undef\ FC\_FOPEN}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00274}00274\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00275}00275\ \textcolor{preprocessor}{\#undef\ FC\_CAT}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00276}00276\ \textcolor{preprocessor}{\#undef\ FC\_PREL}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00277}00277\ \textcolor{preprocessor}{\#undef\ FC\_FOPEN}}
\DoxyCodeLine{\Hypertarget{cfile_8hpp_source_l00278}00278\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
