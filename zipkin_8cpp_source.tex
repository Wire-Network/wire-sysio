\doxysection{zipkin.\+cpp}
\hypertarget{zipkin_8cpp_source}{}\label{zipkin_8cpp_source}\index{libraries/fc/src/log/zipkin.cpp@{libraries/fc/src/log/zipkin.cpp}}
\mbox{\hyperlink{zipkin_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{zipkin_8hpp}{fc/log/zipkin.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{exception_8hpp}{fc/exception/exception.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger__config_8hpp}{fc/log/logger\_config.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{http__client_8hpp}{fc/network/http/http\_client.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{fc_2include_2fc_2reflect_2variant_8hpp}{fc/reflect/variant.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{hex_8hpp}{fc/crypto/hex.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{sha256_8hpp}{fc/crypto/sha256.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{fc_2include_2fc_2variant_8hpp}{fc/variant.hpp}}>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <boost/asio.hpp>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <random>}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00015}00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacefc}{fc}}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00017}00017\ zipkin\_config\&\ zipkin\_config::get()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00018}00018\ \ \ \ \textcolor{keyword}{static}\ zipkin\_config\ the\_one;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00019}00019\ \ \ \ \textcolor{keywordflow}{return}\ the\_one;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00020}00020\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00022}\mbox{\hyperlink{classfc_1_1zipkin__config_affc268b7ec02e9c1a59f62bc627287f7}{00022}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin__config_affc268b7ec02e9c1a59f62bc627287f7}{zipkin\_config::init}}(\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classfc_1_1url}{url}},\ \textcolor{keyword}{const}\ std::string\&\ service\_name,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ timeout\_us\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00023}00023\ \ \ \ get().zip\ =\ std::make\_unique<zipkin>(\ \mbox{\hyperlink{classfc_1_1url}{url}},\ service\_name,\ timeout\_us\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00024}00024\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00026}\mbox{\hyperlink{classfc_1_1zipkin__config_ae0348c29d052b3060150e3b379e8e9ce}{00026}}\ \mbox{\hyperlink{classfc_1_1zipkin}{zipkin}}\&\ \mbox{\hyperlink{classfc_1_1zipkin__config_ae0348c29d052b3060150e3b379e8e9ce}{zipkin\_config::get\_zipkin}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00027}00027\ \ \ \ \textcolor{keywordflow}{if}(\ !get().zip\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00028}00028\ \ \ \ \ \ \ \mbox{\hyperlink{exception_8hpp_a7590ddac4f181b661c3eeaf5feccc6ac}{FC\_THROW\_EXCEPTION}}(\ fc::assert\_exception,\ \textcolor{stringliteral}{"{}uninitialized\ zipkin"{}}\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00029}00029\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00030}00030\ \ \ \ \textcolor{keywordflow}{return}\ *get().zip;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00031}00031\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00033}\mbox{\hyperlink{classfc_1_1zipkin__config_a0e20fd8eda4ad99190e5330645ab4890}{00033}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin__config_a0e20fd8eda4ad99190e5330645ab4890}{zipkin\_config::shutdown}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00034}00034\ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classfc_1_1zipkin}{zipkin}}*\ z\ =\ get\_zipkin\_()\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00035}00035\ \ \ \ \ \ \ z-\/>shutdown();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00036}00036\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00037}00037\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00039}\mbox{\hyperlink{classfc_1_1zipkin__config_a7fafc95d1ae8f71f714e1b444d6cbc87}{00039}}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{classfc_1_1zipkin__config_a7fafc95d1ae8f71f714e1b444d6cbc87}{zipkin\_config::get\_next\_unique\_id}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00040}00040\ \ \ \ \textcolor{keywordflow}{if}(\ !get().zip\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00041}00041\ \ \ \ \ \ \ \mbox{\hyperlink{exception_8hpp_a7590ddac4f181b661c3eeaf5feccc6ac}{FC\_THROW\_EXCEPTION}}(\ fc::assert\_exception,\ \textcolor{stringliteral}{"{}uninitialized\ zipkin"{}}\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00042}00042\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00043}00043\ \ \ \ \textcolor{keywordflow}{return}\ get().zip-\/>\mbox{\hyperlink{classfc_1_1zipkin_a2bdc0402247151c979cca1632fb7f32d}{get\_next\_unique\_id}}();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00044}00044\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00046}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl}{00046}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfc_1_1zipkin_1_1impl}{zipkin::impl}}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00047}00047\ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00048}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a588b262356616e2bdafd91dea21a2ad8}{00048}}\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a588b262356616e2bdafd91dea21a2ad8}{max\_consecutive\_errors}}\ =\ 9;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00050}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a96bc61eab436b9ec8e6a39150741e574}{00050}}\ \ \ \ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a96bc61eab436b9ec8e6a39150741e574}{zipkin\_url}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00051}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2e178767ac2d7dd0a4c6810566bdbaf9}{00051}}\ \ \ \ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2e178767ac2d7dd0a4c6810566bdbaf9}{service\_name}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00052}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a12e350904c8280b886c787a28665f320}{00052}}\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a12e350904c8280b886c787a28665f320}{timeout\_us}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00053}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a661725a819134efd4e439859a46c1bcd}{00053}}\ \ \ \ std::mutex\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a661725a819134efd4e439859a46c1bcd}{mtx}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00054}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_aec2af768c43ffd4820b65a0f864c6853}{00054}}\ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_aec2af768c43ffd4820b65a0f864c6853}{next\_id}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00055}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a1f3e4a3239b44f62c22a5e1bbb7df77f}{00055}}\ \ \ \ \mbox{\hyperlink{classfc_1_1http__client}{http\_client}}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a1f3e4a3239b44f62c22a5e1bbb7df77f}{http}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00056}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a606ff48e0af7cd8e85d314172e944c18}{00056}}\ \ \ \ std::atomic<uint32\_t>\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a606ff48e0af7cd8e85d314172e944c18}{consecutive\_errors}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00057}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a30b1dc2a804ca57cb6d6f6a6449d3ce5}{00057}}\ \ \ \ std::atomic<unsigned\ char>\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a30b1dc2a804ca57cb6d6f6a6449d3ce5}{stopped}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00058}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a0c4b5b473605a3bb39db309ae8bdf209}{00058}}\ \ \ \ std::optional<url>\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a0c4b5b473605a3bb39db309ae8bdf209}{endpoint}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00059}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_ad34c3e8a516559da6bf5bf786be84424}{00059}}\ \ \ \ std::thread\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_ad34c3e8a516559da6bf5bf786be84424}{thread}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00060}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a1b7e9b480213afbaf5d435fb4d6ca56a}{00060}}\ \ \ \ boost::asio::io\_context\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a1b7e9b480213afbaf5d435fb4d6ca56a}{ctx}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00061}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_adb5a96149480a83c933c367e4dc064a0}{00061}}\ \ \ \ boost::asio::io\_context::strand\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_adb5a96149480a83c933c367e4dc064a0}{work\_strand}}\{\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a1b7e9b480213afbaf5d435fb4d6ca56a}{ctx}}\};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00062}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a87c73fb3b14896bb1846c563e2c90024}{00062}}\ \ \ \ boost::asio::executor\_work\_guard<boost::asio::io\_context::executor\_type>\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a87c73fb3b14896bb1846c563e2c90024}{work\_guard}}\ =\ boost::asio::make\_work\_guard(\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a1b7e9b480213afbaf5d435fb4d6ca56a}{ctx}});}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00064}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a21d912a49a851958b81d7199e8727007}{00064}}\ \ \ \ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a21d912a49a851958b81d7199e8727007}{impl}}(\ std::string\ \mbox{\hyperlink{classfc_1_1url}{url}},\ std::string\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2e178767ac2d7dd0a4c6810566bdbaf9}{service\_name}},\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a12e350904c8280b886c787a28665f320}{timeout\_us}}\ )}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00065}00065\ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a96bc61eab436b9ec8e6a39150741e574}{zipkin\_url}}(\ \mbox{\hyperlink{namespacestd}{std}}::move(\mbox{\hyperlink{classfc_1_1url}{url}})\ )}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00066}00066\ \ \ \ \ \ \ \ \ \ ,\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2e178767ac2d7dd0a4c6810566bdbaf9}{service\_name}}(\ \mbox{\hyperlink{namespacestd}{std}}::move(\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2e178767ac2d7dd0a4c6810566bdbaf9}{service\_name}})\ )}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00067}00067\ \ \ \ \ \ \ \ \ \ ,\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a12e350904c8280b886c787a28665f320}{timeout\_us}}(\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a12e350904c8280b886c787a28665f320}{timeout\_us}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00068}00068\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00070}00070\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a5e8f2cb25258af6f392ccd8226457856}{init}}();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00071}00071\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a8c6b3ad41eb01b7092465c2bb427bbad}{shutdown}}();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00073}00073\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a15b9c59b7c6d0e08cd958dbf31ff3ee5}{log}}(\ \mbox{\hyperlink{structfc_1_1zipkin__span_1_1span__data}{zipkin\_span::span\_data}}\&\&\ span\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00075}00075\ \ \ \ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2b2b0354c53e967d428480eca92f6a2b}{\string~impl}}();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00076}00076\ \};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00078}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a5e8f2cb25258af6f392ccd8226457856}{00078}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a5e8f2cb25258af6f392ccd8226457856}{zipkin::impl::init}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00079}00079\ \ \ \ thread\ =\ std::thread(\ [\textcolor{keyword}{this}]()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00080}00080\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_ab58a7f71e88d7d4d5761bbd24837c595}{fc::set\_os\_thread\_name}}(\ \textcolor{stringliteral}{"{}zipkin"{}}\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00081}00081\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \textcolor{keyword}{true}\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a1b7e9b480213afbaf5d435fb4d6ca56a}{ctx}}.run();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00086}00086\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00087}00087\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00088}00088\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00090}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2b2b0354c53e967d428480eca92f6a2b}{00090}}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2b2b0354c53e967d428480eca92f6a2b}{zipkin::impl::\string~impl}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00091}00091\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00092}00092\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1zipkin_a52c10520244a0443f30961ef040baf1d}{shutdown}}();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00093}00093\ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (...)\ \{\}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00094}00094\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00096}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a8c6b3ad41eb01b7092465c2bb427bbad}{00096}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a8c6b3ad41eb01b7092465c2bb427bbad}{zipkin::impl::shutdown}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00097}00097\ \ \ \ \textcolor{keywordflow}{if}(\ stopped\ \string^=\ 1\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00098}00098\ \ \ \ work\_guard.reset();\ \textcolor{comment}{//\ drain\ the\ queue}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00099}00099\ \ \ \ thread.join();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00100}00100\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00102}\mbox{\hyperlink{classfc_1_1zipkin_a5a7ddffbc11b0e87d400d10598d20068}{00102}}\ \mbox{\hyperlink{classfc_1_1zipkin_a5a7ddffbc11b0e87d400d10598d20068}{zipkin::zipkin}}(\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classfc_1_1url}{url}},\ \textcolor{keyword}{const}\ std::string\&\ service\_name,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ timeout\_us\ )\ :}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00103}00103\ \ \ \ \ \ \ my(\ new\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl}{impl}}(\ \mbox{\hyperlink{classfc_1_1url}{url}},\ service\_name,\ timeout\_us\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00104}00104\ \ \ \ my-\/>init();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00105}00105\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00106}00106\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00107}\mbox{\hyperlink{classfc_1_1zipkin_a2bdc0402247151c979cca1632fb7f32d}{00107}}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{classfc_1_1zipkin_a2bdc0402247151c979cca1632fb7f32d}{zipkin::get\_next\_unique\_id}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00108}00108\ \ \ \ std::scoped\_lock\ g(\ my-\/>mtx\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00109}00109\ \ \ \ \textcolor{keywordflow}{if}(\ my-\/>next\_id\ ==\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00110}00110\ \ \ \ \ \ \ std::mt19937\_64\ engine(\ std::random\_device\{\}()\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00111}00111\ \ \ \ \ \ \ std::uniform\_int\_distribution<uint64\_t>\ distribution(1);}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00112}00112\ \ \ \ \ \ \ my-\/>next\_id\ =\ distribution(\ engine\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00113}00113\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00114}00114\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>next\_id++;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00115}00115\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00117}\mbox{\hyperlink{classfc_1_1zipkin_a52c10520244a0443f30961ef040baf1d}{00117}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_a52c10520244a0443f30961ef040baf1d}{zipkin::shutdown}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00118}00118\ \ \ \ my-\/>shutdown();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00119}00119\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00121}\mbox{\hyperlink{namespacefc_a25b099f3f046ce5ea9b41a9e26086d71}{00121}}\ \mbox{\hyperlink{classfc_1_1variant}{fc::variant}}\ \mbox{\hyperlink{namespacefc_a25b099f3f046ce5ea9b41a9e26086d71}{create\_zipkin\_variant}}(\ \mbox{\hyperlink{structfc_1_1zipkin__span_1_1span__data}{zipkin\_span::span\_data}}\&\&\ span,\ \textcolor{keyword}{const}\ std::string\&\ service\_name\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00122}00122\ \ \ \ \textcolor{comment}{//\ https://zipkin.io/zipkin-\/api/}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00123}00123\ \ \ \ \textcolor{comment}{//\ \ \ std::string\ traceId;\ \ //\ [a-\/f0-\/9]\{16,32\}\ unique\ id\ for\ trace,\ all\ children\ spans\ shared\ same\ id}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00124}00124\ \ \ \ \textcolor{comment}{//\ \ \ std::string\ name;\ \ \ \ \ //\ logical\ operation,\ should\ have\ low\ cardinality}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00125}00125\ \ \ \ \textcolor{comment}{//\ \ \ std::string\ parentId;\ //\ The\ parent\ span\ id,\ or\ absent\ if\ root\ span}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00126}00126\ \ \ \ \textcolor{comment}{//\ \ \ std::string\ id\ \ \ \ \ \ \ \ //\ a-\/f0-\/9]\{16\}}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00127}00127\ \ \ \ \textcolor{comment}{//\ \ \ int64\_t\ \ \ \ \ timestamp\ //\ epoch\ microseconds\ of\ start\ of\ span}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00128}00128\ \ \ \ \textcolor{comment}{//\ \ \ int64\_t\ \ \ \ \ duration\ \ //\ microseconds\ of\ span}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00130}00130\ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ trace\_id;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00131}00131\ \ \ \ \textcolor{keywordflow}{if}(\ span.parent\_id\ !=\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00132}00132\ \ \ \ \ \ \ trace\_id\ =\ span.parent\_id;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00133}00133\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00134}00134\ \ \ \ \ \ \ trace\_id\ =\ span.id;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00135}00135\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00137}00137\ \ \ \ \mbox{\hyperlink{classfc_1_1mutable__variant__object}{fc::mutable\_variant\_object}}\ mvo;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00138}00138\ \ \ \ mvo(\ \textcolor{stringliteral}{"{}id"{}},\ \mbox{\hyperlink{namespacefc_aab567c89004d329f560014d9943afcd6}{fc::to\_hex}}(\ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&span.id),\ \textcolor{keyword}{sizeof}(\ span.id\ )\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00139}00139\ \ \ \ mvo(\ \textcolor{stringliteral}{"{}traceId"{}},\ \mbox{\hyperlink{namespacefc_aab567c89004d329f560014d9943afcd6}{fc::to\_hex}}(\ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&trace\_id),\ \textcolor{keyword}{sizeof}(\ trace\_id\ )\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00140}00140\ \ \ \ \textcolor{keywordflow}{if}(\ span.parent\_id\ !=\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00141}00141\ \ \ \ \ \ \ mvo(\ \textcolor{stringliteral}{"{}parentId"{}},\ \mbox{\hyperlink{namespacefc_aab567c89004d329f560014d9943afcd6}{fc::to\_hex}}(\ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&span.parent\_id),\ \textcolor{keyword}{sizeof}(\ span.parent\_id\ )\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00142}00142\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00143}00143\ \ \ \ mvo(\ \textcolor{stringliteral}{"{}name"{}},\ std::move(\ span.name\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00144}00144\ \ \ \ mvo(\ \textcolor{stringliteral}{"{}timestamp"{}},\ span.start.time\_since\_epoch().count()\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00145}00145\ \ \ \ mvo(\ \textcolor{stringliteral}{"{}duration"{}},\ (span.stop\ -\/\ span.start).count()\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00146}00146\ \ \ \ mvo(\ \textcolor{stringliteral}{"{}localEndpoint"{}},\ \mbox{\hyperlink{classfc_1_1variant__object}{fc::variant\_object}}(\ \textcolor{stringliteral}{"{}serviceName"{}},\ service\_name\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00147}00147\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00148}00148\ \ \ \ mvo(\ \textcolor{stringliteral}{"{}tags"{}},\ std::move(\ span.tags\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00149}00149\ \ \ \ span.id\ =\ 0;\ \textcolor{comment}{//\ stop\ destructor\ of\ span\ from\ calling\ log\ again}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00151}00151\ \ \ \ \textcolor{comment}{//\ /api/v2/spans\ takes\ an\ array\ of\ spans}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00152}00152\ \ \ \ \mbox{\hyperlink{namespacefc_a9148361f6aaa3d739990a75ac557fe59}{fc::variants}}\ result;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00153}00153\ \ \ \ result.emplace\_back(\ std::move(\ mvo\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00154}00154\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00155}00155\ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00156}00156\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00157}00157\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00158}\mbox{\hyperlink{classfc_1_1zipkin_a0f15921f7cb4ccefe0684bf656dbe6e6}{00158}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_a0f15921f7cb4ccefe0684bf656dbe6e6}{zipkin::log}}(\ \mbox{\hyperlink{structfc_1_1zipkin__span_1_1span__data}{zipkin\_span::span\_data}}\&\&\ span\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00159}00159\ \ \ \ \textcolor{keywordflow}{if}(\ my-\/>consecutive\_errors\ >\ my-\/>max\_consecutive\_errors\ ||\ my-\/>stopped\ )}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00160}00160\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00161}00161\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00162}00162\ \ \ \ boost::asio::post(my-\/>work\_strand,\ [\textcolor{keyword}{this},\ span\{std::move(span)\}]()\ \textcolor{keyword}{mutable}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00163}00163\ \ \ \ \ \ \ my-\/>log(\ std::move(\ span\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00164}00164\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00165}00165\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00167}\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a15b9c59b7c6d0e08cd958dbf31ff3ee5}{00167}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a15b9c59b7c6d0e08cd958dbf31ff3ee5}{zipkin::impl::log}}(\ \mbox{\hyperlink{structfc_1_1zipkin__span_1_1span__data}{zipkin\_span::span\_data}}\&\&\ span\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00168}00168\ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a606ff48e0af7cd8e85d314172e944c18}{consecutive\_errors}}\ >\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a588b262356616e2bdafd91dea21a2ad8}{max\_consecutive\_errors}}\ )}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00169}00169\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00171}00171\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00172}00172\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ deadline\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ +\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}(\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a12e350904c8280b886c787a28665f320}{timeout\_us}}\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00173}00173\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a0c4b5b473605a3bb39db309ae8bdf209}{endpoint}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a0c4b5b473605a3bb39db309ae8bdf209}{endpoint}}\ =\ \mbox{\hyperlink{programs_2clio_2main_8cpp_aa03c1ef4c41f36b048cf58d5aade7653}{url}}(\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a96bc61eab436b9ec8e6a39150741e574}{zipkin\_url}}\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a3da1571bad6ca6c94df9a3660b2115ee}{dlog}}(\ \textcolor{stringliteral}{"{}connecting\ to\ zipkin:\ \$\{p\}"{}},\ (\textcolor{stringliteral}{"{}p"{}},\ *\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a0c4b5b473605a3bb39db309ae8bdf209}{endpoint}})\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00176}00176\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00177}00177\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00178}00178\ \ \ \ \ \ \ http.post\_sync(\ *\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a0c4b5b473605a3bb39db309ae8bdf209}{endpoint}},\ \mbox{\hyperlink{namespacefc_a25b099f3f046ce5ea9b41a9e26086d71}{create\_zipkin\_variant}}(\ std::move(\ span\ ),\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a2e178767ac2d7dd0a4c6810566bdbaf9}{service\_name}}\ ),\ deadline\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00180}00180\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a606ff48e0af7cd8e85d314172e944c18}{consecutive\_errors}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00181}00181\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00182}00182\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00183}00183\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}unable\ to\ connect\ to\ zipkin:\ \$\{u\},\ error:\ \$\{e\}"{}},\ (\textcolor{stringliteral}{"{}u"{}},\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a96bc61eab436b9ec8e6a39150741e574}{zipkin\_url}})(\textcolor{stringliteral}{"{}e"{}},\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}())\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00184}00184\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00185}00185\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}unable\ to\ connect\ to\ zipkin:\ \$\{u\},\ error:\ \$\{e\}"{}},\ (\textcolor{stringliteral}{"{}u"{}},\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a96bc61eab436b9ec8e6a39150741e574}{zipkin\_url}})(\textcolor{stringliteral}{"{}e"{}},\ e.\mbox{\hyperlink{classfc_1_1exception_ab1104818bf0d9b6a29f0dfe036cf97f6}{what}}())\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00186}00186\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ ...\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00187}00187\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}unable\ to\ connect\ to\ zipkin:\ \$\{u\},\ error:\ unknown"{}},\ (\textcolor{stringliteral}{"{}u"{}},\ \mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a96bc61eab436b9ec8e6a39150741e574}{zipkin\_url}})\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00188}00188\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00189}00189\ \ \ \ ++\mbox{\hyperlink{classfc_1_1zipkin_1_1impl_a606ff48e0af7cd8e85d314172e944c18}{consecutive\_errors}};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00190}00190\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00192}\mbox{\hyperlink{structfc_1_1zipkin__span_a1e1aa1cb977283138fa30280158384a7}{00192}}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{structfc_1_1zipkin__span_a1e1aa1cb977283138fa30280158384a7}{zipkin\_span::to\_id}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{fc::sha256}}\&\ \textcolor{keywordtype}{id}\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00193}00193\ \ \ \ \textcolor{comment}{//\ avoid\ 0\ since\ id\ of\ 0\ is\ used\ as\ a\ flag}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00194}00194\ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{id}.\_hash[3]\ ==\ 0\ ?\ 1\ :\ \textcolor{keywordtype}{id}.\_hash[3];}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00195}00195\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00196}00196\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00197}\mbox{\hyperlink{structfc_1_1zipkin__span_ae3fef6e20268796fac93c736a3e51a57}{00197}}\ \mbox{\hyperlink{structfc_1_1zipkin__span_ae3fef6e20268796fac93c736a3e51a57}{zipkin\_span::\string~zipkin\_span}}()\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00198}00198\ \ \ \ \textcolor{keywordflow}{if}(\ data.id\ ==\ 0\ )}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00199}00199\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00200}00200\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00201}00201\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classfc_1_1zipkin__config_a9556dacb1a00643aecbf33b1f1e889d0}{zipkin\_config::is\_enabled}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00202}00202\ \ \ \ \ \ \ \ \ \ data.stop\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{time\_point::now}}();}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1zipkin__config_ae0348c29d052b3060150e3b379e8e9ce}{zipkin\_config::get\_zipkin}}().\mbox{\hyperlink{classfc_1_1zipkin_a0f15921f7cb4ccefe0684bf656dbe6e6}{log}}(\ std::move(\ data\ )\ );}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00204}00204\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00205}00205\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ ...\ )\ \{\}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00206}00206\ \}}
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{zipkin_8cpp_source_l00208}00208\ \}\ \textcolor{comment}{//\ fc}}

\end{DoxyCode}
