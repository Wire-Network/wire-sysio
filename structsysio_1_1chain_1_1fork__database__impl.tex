\doxysection{sysio\+::chain\+::fork\+\_\+database\+\_\+impl Struct Reference}
\hypertarget{structsysio_1_1chain_1_1fork__database__impl}{}\label{structsysio_1_1chain_1_1fork__database__impl}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}


Collaboration diagram for sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a778b2e0e8d3457e5cfc2d2780ebd49ba}{fork\+\_\+database\+\_\+impl}} (const \mbox{\hyperlink{classfc_1_1path}{fc\+::path}} \&data\+\_\+dir)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab8bde04ebc49f6731e46ab330812bd00}{open\+\_\+impl}} (const std\+::function$<$ void(\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}}, const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&, const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&)$>$ \&validator)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a5c512f93416acdb500bf1814401b8282}{close\+\_\+impl}} ()
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_a918963c39fa6317556dca73276274e64}{block\+\_\+header\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a65a4578964babf603443cdf3c0726908}{get\+\_\+block\+\_\+header\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}) const
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\+\_\+block\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}) const
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a0acb7aa1a0689cb15fb93145f9e5293c}{reset\+\_\+impl}} (const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\+\_\+header\+\_\+state}} \&root\+\_\+bhs)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_adce8101013b4aa8279b778de6ba96a5e}{rollback\+\_\+head\+\_\+to\+\_\+root\+\_\+impl}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a72f5006e98746559133d45653ba38afa}{advance\+\_\+root\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}})
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_aded14555f97fc186af50537babc4995e}{remove\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}})
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{branch\+\_\+type}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ac5cff58b9a2a775c9a96a17ba4638dfb}{fetch\+\_\+branch\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&h, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} trim\+\_\+after\+\_\+block\+\_\+num) const
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a514dc4c7bd5146928e30e32d7ebc918f}{search\+\_\+on\+\_\+branch\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&h, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} block\+\_\+num) const
\item 
pair$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{branch\+\_\+type}}, \mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{branch\+\_\+type}} $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2b64c6ee2f61647756dfa79e450a412b}{fetch\+\_\+branch\+\_\+from\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&first, const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&second) const
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ad569f7a3388b5a8e35f8c4ccb4a1c311}{mark\+\_\+valid\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&h)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a04a30379f1937bd83b8ced954d7a4ef7}{add\+\_\+impl}} (const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&n, bool ignore\+\_\+duplicate, bool \mbox{\hyperlink{namespacesysio_1_1chain_aa56956ceeec88a964737228174aec6d6}{validate}}, const std\+::function$<$ void(\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}}, const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&, const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&)$>$ \&validator)
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::shared\+\_\+mutex \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2799d519da9d0e00d12dd368b04f8b41}{mtx}}
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_a41ae8badf840b6de83fb1a7697c0b583}{fork\+\_\+multi\+\_\+index\+\_\+type}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_afce88b79ad80446e7393c5f7a5f428ef}{index}}
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32}{root}}
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}
\item 
\mbox{\hyperlink{classfc_1_1path}{fc\+::path}} \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad}{datadir}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00063}{63}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a778b2e0e8d3457e5cfc2d2780ebd49ba}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!fork\_database\_impl@{fork\_database\_impl}}
\index{fork\_database\_impl@{fork\_database\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{fork\_database\_impl()}{fork\_database\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a778b2e0e8d3457e5cfc2d2780ebd49ba} 
sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::fork\+\_\+database\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classfc_1_1path}{fc\+::path}} \&}]{data\+\_\+dir}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [explicit]}}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00064}{64}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00065\ \ \ \ \ \ \ :\mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad}{datadir}}(data\_dir)}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \{\}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a04a30379f1937bd83b8ced954d7a4ef7}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!add\_impl@{add\_impl}}
\index{add\_impl@{add\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{add\_impl()}{add\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a04a30379f1937bd83b8ced954d7a4ef7} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::add\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&}]{n}{, }\item[{bool}]{ignore\+\_\+duplicate}{, }\item[{bool}]{validate}{, }\item[{const std\+::function$<$ void(\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}}, const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&, const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&)$>$ \&}]{validator}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00348}{348}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00353\ \ \ \ \{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ root,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}root\ not\ yet\ set"{}}\ );}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ n,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}attempt\ to\ add\ null\ block\ state"{}}\ );}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ prev\_bh\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a65a4578964babf603443cdf3c0726908}{get\_block\_header\_impl}}(\ n-\/>header.previous\ );}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ prev\_bh,\ unlinkable\_block\_exception,}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}unlinkable\ block"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ n-\/>id)(\textcolor{stringliteral}{"{}previous"{}},\ n-\/>header.previous)\ );}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacesysio_1_1chain_aa56956ceeec88a964737228174aec6d6}{validate}}\ )\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ exts\ =\ n-\/>header\_exts;}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ exts.count(\mbox{\hyperlink{structsysio_1_1chain_1_1protocol__feature__activation_a9b74efdc3ccf711443174ff0c9b535e3}{protocol\_feature\_activation::extension\_id}}())\ >\ 0\ )\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ new\_protocol\_features\ =\ std::get<protocol\_feature\_activation>(exts.lower\_bound(\mbox{\hyperlink{structsysio_1_1chain_1_1protocol__feature__activation_a9b74efdc3ccf711443174ff0c9b535e3}{protocol\_feature\_activation::extension\_id}}())-\/>second).protocol\_features;}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ validator(\ n-\/>header.timestamp,\ prev\_bh-\/>activated\_protocol\_features-\/>protocol\_features,\ new\_protocol\_features\ );}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \}\ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a43bd817895cb757183fcecafc6ae7dc1}{SYS\_RETHROW\_EXCEPTIONS}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}serialized\ fork\ database\ is\ incompatible\ with\ configured\ protocol\ features"{}}\ \ )}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ inserted\ =\ index.insert(n);}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !inserted.second\ )\ \{}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ ignore\_duplicate\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}duplicate\ block\ added"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ n-\/>id)\ );}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ candidate\ =\ index.get<by\_lib\_block\_num>().begin();}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (*candidate)-\/>is\_valid()\ )\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ =\ *candidate;}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00383\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_a04a30379f1937bd83b8ced954d7a4ef7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_a04a30379f1937bd83b8ced954d7a4ef7_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a72f5006e98746559133d45653ba38afa}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!advance\_root\_impl@{advance\_root\_impl}}
\index{advance\_root\_impl@{advance\_root\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{advance\_root\_impl()}{advance\_root\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a72f5006e98746559133d45653ba38afa} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::advance\+\_\+root\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00298}{298}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ root,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}root\ not\ yet\ set"{}}\ );}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ new\_root\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ new\_root,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cannot\ advance\ root\ to\ a\ block\ that\ does\ not\ exist\ in\ the\ fork\ database"{}}\ );}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ new\_root-\/>is\_valid(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cannot\ advance\ root\ to\ a\ block\ that\ has\ not\ yet\ been\ validated"{}}\ );}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ \ \ \ \ deque<block\_id\_type>\ blocks\_to\_remove;}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ b\ =\ new\_root;\ b;\ )\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ blocks\_to\_remove.emplace\_back(\ b-\/>header.previous\ );}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ b\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ blocks\_to\_remove.back()\ );}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b\ ||\ blocks\_to\_remove.back()\ ==\ root-\/>id,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}invariant\ violation:\ orphaned\ branch\ was\ present\ in\ forked\ database"{}}\ );}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ root\ block\ should\ be\ erased\ from\ the\ fork\ database\ index\ individually\ rather\ than\ with\ the\ remove\ method,}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \textcolor{comment}{//\ because\ we\ do\ not\ want\ the\ blocks\ branching\ off\ of\ it\ to\ be\ removed\ from\ the\ fork\ database.}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ index.erase(\ index.find(\ \textcolor{keywordtype}{id}\ )\ );}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ other\ blocks\ to\ be\ removed\ are\ removed\ using\ the\ remove\ method\ so\ that\ orphaned\ branches\ do\ not\ remain\ in\ the\ fork\ database.}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\_id\ :\ blocks\_to\_remove\ )\ \{}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_aded14555f97fc186af50537babc4995e}{remove\_impl}}(\ block\_id\ );}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \ \ \textcolor{comment}{//\ Even\ though\ fork\ database\ no\ longer\ needs\ block\ or\ trxs\ when\ a\ block\ state\ becomes\ a\ root\ of\ the\ tree,}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \textcolor{comment}{//\ avoid\ mutating\ the\ block\ state\ at\ all,\ for\ example\ clearing\ the\ block\ shared\ pointer,\ because\ other}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \textcolor{comment}{//\ parts\ of\ the\ code\ which\ run\ asynchronously\ may\ later\ expect\ it\ remain\ unmodified.}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \ \ \ \ root\ =\ new\_root;}
\DoxyCodeLine{00329\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_a72f5006e98746559133d45653ba38afa_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a5c512f93416acdb500bf1814401b8282}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!close\_impl@{close\_impl}}
\index{close\_impl@{close\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{close\_impl()}{close\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a5c512f93416acdb500bf1814401b8282} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::close\+\_\+impl (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00196}{196}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fork\_db\_dat\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad}{datadir}}\ /\ config::forkdb\_filename;}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !root\ )\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ index.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}fork\_database\ is\ in\ a\ bad\ state\ when\ closing;\ not\ writing\ out\ '\$\{filename\}'"{}},}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}filename"{}},\ fork\_db\_dat.generic\_string())\ );}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ std::ofstream\ out(\ fork\_db\_dat.generic\_string().c\_str(),\ std::ios::out\ |\ std::ios::binary\ |\ std::ofstream::trunc\ );}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\ out,\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a6649b0d3a5a88f5cea9d2f467601fe24}{fork\_database::magic\_number}}\ );}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\ out,\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a04a97bab59df6c56c06101d431f06e84}{fork\_database::max\_supported\_version}}\ );\ \textcolor{comment}{//\ write\ out\ current\ version\ which\ is\ always\ max\_supported\_version}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\ out,\ *\textcolor{keyword}{static\_cast<}block\_header\_state*\textcolor{keyword}{>}(\&*root)\ );}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ num\_blocks\_in\_fork\_db\ =\ index.size();}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\ out,\ unsigned\_int\{num\_blocks\_in\_fork\_db\}\ );}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ indx\ =\ index.get<by\_lib\_block\_num>();}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ unvalidated\_itr\ =\ indx.rbegin();}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ unvalidated\_end\ =\ boost::make\_reverse\_iterator(\ indx.lower\_bound(\ \textcolor{keyword}{false}\ )\ );}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ validated\_itr\ =\ unvalidated\_end;}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ validated\_end\ =\ indx.rend();}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \ \textcolor{keywordtype}{bool}\ unvalidated\_remaining\ =\ (unvalidated\_itr\ !=\ unvalidated\_end),}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ validated\_remaining\ \ \ =\ (validated\_itr\ !=\ validated\_end);}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ unvalidated\_remaining\ ||\ validated\_remaining;}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ unvalidated\_remaining\ =\ (unvalidated\_itr\ !=\ unvalidated\_end),}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ validated\_remaining\ \ \ =\ (validated\_itr\ !=\ validated\_end)}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ (validated\_remaining\ ?\ validated\_itr\ :\ unvalidated\_itr);}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ unvalidated\_remaining\ \&\&\ validated\_remaining\ )\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a4d023005b3b47d76c62beeaebc291fa3}{first\_preferred}}(\ **validated\_itr,\ **unvalidated\_itr\ )\ )\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ itr\ =\ unvalidated\_itr;}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++unvalidated\_itr;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++validated\_itr;}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ unvalidated\_remaining\ )\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ ++unvalidated\_itr;}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ ++validated\_itr;}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\ out,\ *(*itr)\ );}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ )\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\ out,\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}-\/>id\ );}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}head\ not\ set\ in\ fork\ database;\ '\$\{filename\}'\ will\ be\ corrupted"{}},}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}filename"{}},\ fork\_db\_dat.generic\_string())\ );}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \ \ index.clear();}
\DoxyCodeLine{00257\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=344pt]{structsysio_1_1chain_1_1fork__database__impl_a5c512f93416acdb500bf1814401b8282_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a2b64c6ee2f61647756dfa79e450a412b}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!fetch\_branch\_from\_impl@{fetch\_branch\_from\_impl}}
\index{fetch\_branch\_from\_impl@{fetch\_branch\_from\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{fetch\_branch\_from\_impl()}{fetch\_branch\_from\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a2b64c6ee2f61647756dfa79e450a412b} 
pair$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{branch\+\_\+type}}, \mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{branch\+\_\+type}} $>$ sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::fetch\+\_\+branch\+\_\+from\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{first}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{second}{}\end{DoxyParamCaption}) const}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00457}{457}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ pair<branch\_type,branch\_type>\ result;}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ first\_branch\ =\ (first\ ==\ root-\/>id)\ ?\ root\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(first);}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ second\_branch\ =\ (second\ ==\ root-\/>id)\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32}{root}}\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(second);}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(first\_branch,\ fork\_db\_block\_not\_found,\ \textcolor{stringliteral}{"{}block\ \$\{id\}\ does\ not\ exist"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ first));}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(second\_branch,\ fork\_db\_block\_not\_found,\ \textcolor{stringliteral}{"{}block\ \$\{id\}\ does\ not\ exist"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ second));}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ first\_branch-\/>block\_num\ >\ second\_branch-\/>block\_num\ )}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ result.first.push\_back(first\_branch);}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ prev\ =\ first\_branch-\/>header.previous;}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ first\_branch\ =\ (prev\ ==\ root-\/>id)\ ?\ root\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ prev\ );}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ first\_branch,\ fork\_db\_block\_not\_found,}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ \$\{id\}\ does\ not\ exist"{}},}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ prev)}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ second\_branch-\/>block\_num\ >\ first\_branch-\/>block\_num\ )}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ result.second.push\_back(\ second\_branch\ );}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ prev\ =\ second\_branch-\/>header.previous;}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ second\_branch\ =\ (prev\ ==\ root-\/>id)\ ?\ root\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ prev\ );}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ second\_branch,\ fork\_db\_block\_not\_found,}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ \$\{id\}\ does\ not\ exist"{}},}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ prev)}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (first\_branch-\/>id\ ==\ second\_branch-\/>id)\ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ first\_branch-\/>header.previous\ !=\ second\_branch-\/>header.previous\ )}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ result.first.push\_back(first\_branch);}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ result.second.push\_back(second\_branch);}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&first\_prev\ =\ first\_branch-\/>header.previous;}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ first\_branch\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ first\_prev\ );}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&second\_prev\ =\ second\_branch-\/>header.previous;}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ second\_branch\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ second\_prev\ );}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ first\_branch,\ fork\_db\_block\_not\_found,}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ \$\{id\}\ does\ not\ exist"{}},}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ first\_prev)}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ second\_branch,\ fork\_db\_block\_not\_found,}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ \$\{id\}\ does\ not\ exist"{}},}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ second\_prev)}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ first\_branch\ \&\&\ second\_branch\ )}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ result.first.push\_back(first\_branch);}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ result.second.push\_back(second\_branch);}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00514\ \ \ \ \}\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=332pt]{structsysio_1_1chain_1_1fork__database__impl_a2b64c6ee2f61647756dfa79e450a412b_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_ac5cff58b9a2a775c9a96a17ba4638dfb}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!fetch\_branch\_impl@{fetch\_branch\_impl}}
\index{fetch\_branch\_impl@{fetch\_branch\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{fetch\_branch\_impl()}{fetch\_branch\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_ac5cff58b9a2a775c9a96a17ba4638dfb} 
\mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{branch\+\_\+type}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::fetch\+\_\+branch\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{h}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{trim\+\_\+after\+\_\+block\+\_\+num}{}\end{DoxyParamCaption}) const}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00423}{423}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{branch\_type}}\ result;}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(h);\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}-\/>header.previous\ )\ )\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}-\/>block\_num\ <=\ trim\_after\_block\_num\ )}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ result.push\_back(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ );}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00431\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=332pt]{structsysio_1_1chain_1_1fork__database__impl_ac5cff58b9a2a775c9a96a17ba4638dfb_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a65a4578964babf603443cdf3c0726908}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!get\_block\_header\_impl@{get\_block\_header\_impl}}
\index{get\_block\_header\_impl@{get\_block\_header\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{get\_block\_header\_impl()}{get\_block\_header\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a65a4578964babf603443cdf3c0726908} 
\mbox{\hyperlink{namespacesysio_1_1chain_a918963c39fa6317556dca73276274e64}{block\+\_\+header\+\_\+state\+\_\+ptr}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::get\+\_\+block\+\_\+header\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{}\end{DoxyParamCaption}) const}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00336}{336}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ root-\/>id\ ==\ \textcolor{keywordtype}{id}\ )\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32}{root}};}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ index.find(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ itr\ !=\ index.end()\ )}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *itr;}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_a918963c39fa6317556dca73276274e64}{block\_header\_state\_ptr}}();}
\DoxyCodeLine{00346\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_a65a4578964babf603443cdf3c0726908_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!get\_block\_impl@{get\_block\_impl}}
\index{get\_block\_impl@{get\_block\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{get\_block\_impl()}{get\_block\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27} 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::get\+\_\+block\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{}\end{DoxyParamCaption}) const}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00573}{573}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ index.find(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ itr\ !=\ index.end()\ )}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *itr;}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}();}
\DoxyCodeLine{00578\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_ad569f7a3388b5a8e35f8c4ccb4a1c311}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!mark\_valid\_impl@{mark\_valid\_impl}}
\index{mark\_valid\_impl@{mark\_valid\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{mark\_valid\_impl()}{mark\_valid\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_ad569f7a3388b5a8e35f8c4ccb4a1c311} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::mark\+\_\+valid\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&}]{h}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00548}{548}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ h-\/>validated\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ by\_id\_idx\ =\ index.get<by\_block\_id>();}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ by\_id\_idx.find(\ h-\/>id\ );}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ itr\ !=\ by\_id\_idx.end(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ state\ not\ in\ fork\ database;\ cannot\ mark\ as\ valid"{}},}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ h-\/>id)\ );}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \ \ \ \ by\_id\_idx.modify(\ itr,\ [](\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ bsp\ )\ \{}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ bsp-\/>validated\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ candidate\ =\ index.get<by\_lib\_block\_num>().begin();}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a4d023005b3b47d76c62beeaebc291fa3}{first\_preferred}}(\ **candidate,\ *\mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ )\ )\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ =\ *candidate;}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00566\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=319pt]{structsysio_1_1chain_1_1fork__database__impl_ad569f7a3388b5a8e35f8c4ccb4a1c311_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_ab8bde04ebc49f6731e46ab330812bd00}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!open\_impl@{open\_impl}}
\index{open\_impl@{open\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{open\_impl()}{open\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_ab8bde04ebc49f6731e46ab330812bd00} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::open\+\_\+impl (\begin{DoxyParamCaption}\item[{const std\+::function$<$ void(\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}}, const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&, const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&)$>$ \&}]{validator}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00113}{113}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00116\ \ \ \ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespacefc_ab123bfeadf918cc293ecad88bca7c499}{fc::is\_directory}}(\mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad}{datadir}}))}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a76b0787468a9f403087b71a894c07ce2}{fc::create\_directories}}(\mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad}{datadir}});}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fork\_db\_dat\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad}{datadir}}\ /\ config::forkdb\_filename;}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacefc_a3fcf0d920aea28014aacae50a51d8485}{fc::exists}}(\ fork\_db\_dat\ )\ )\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ content;}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a23ea7ee1b75c710ca0ba138e94395ed1}{fc::read\_file\_contents}}(\ fork\_db\_dat,\ content\ );}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{fc::datastream<const\ char*>}}\ \mbox{\hyperlink{namespace_xbyak_1_1util_a4b2aef26182d21706896022467868f7c}{ds}}(\ content.data(),\ content.size()\ );}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ validate\ totem}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ totem\ =\ 0;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(\ ds,\ totem\ );}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ totem\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a6649b0d3a5a88f5cea9d2f467601fe24}{fork\_database::magic\_number}},\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Fork\ database\ file\ '\$\{filename\}'\ has\ unexpected\ magic\ number:\ \$\{actual\_totem\}.\ Expected\ \$\{expected\_totem\}"{}},}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}filename"{}},\ fork\_db\_dat.generic\_string())}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}actual\_totem"{}},\ totem)}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}expected\_totem"{}},\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a6649b0d3a5a88f5cea9d2f467601fe24}{fork\_database::magic\_number}})}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ validate\ version}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{namespacewebsocketpp_1_1http_1_1parser_1_1state_a12f378e0c6dbf373781e7988ee4a0853a08c88a938bc459c7997b48f74248752f}{version}}\ =\ 0;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(\ ds,\ version\ );}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ version\ >=\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a849a1eb423d310b17ec5d899b48b80d7}{fork\_database::min\_supported\_version}}\ \&\&\ version\ <=\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a04a97bab59df6c56c06101d431f06e84}{fork\_database::max\_supported\_version}},}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unsupported\ version\ of\ fork\ database\ file\ '\$\{filename\}'.\ "{}}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Fork\ database\ version\ is\ \$\{version\}\ while\ code\ supports\ version(s)\ [\$\{min\},\$\{max\}]"{}},}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}filename"{}},\ fork\_db\_dat.generic\_string())}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}version"{}},\ version)}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}min"{}},\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a849a1eb423d310b17ec5d899b48b80d7}{fork\_database::min\_supported\_version}})}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}max"{}},\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a04a97bab59df6c56c06101d431f06e84}{fork\_database::max\_supported\_version}})}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ block\_header\_state\ bhs;}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(\ ds,\ bhs\ );}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a0acb7aa1a0689cb15fb93145f9e5293c}{reset\_impl}}(\ bhs\ );}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ unsigned\_int\ size;\ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(\ ds,\ size\ );}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ i\ =\ 0,\ n\ =\ size.value;\ i\ <\ n;\ ++i\ )\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block\_state\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(\ ds,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ );}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ not\ populate\ transaction\_metadatas,\ they\ will\ be\ created\ as\ needed\ in\ apply\_block\ with\ appropriate\ key\ recovery}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}.header\_exts\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}.block-\/>validate\_and\_extract\_header\_extensions();}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a04a30379f1937bd83b8ced954d7a4ef7}{add\_impl}}(\ std::make\_shared<block\_state>(\ std::move(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ )\ ),\ \textcolor{keyword}{false},\ \textcolor{keyword}{true},\ validator\ );}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\_id\_type}}\ head\_id;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(\ ds,\ head\_id\ );}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ root-\/>id\ ==\ head\_id\ )\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32}{root}};}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ head\_id\ );}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}},\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}could\ not\ find\ head\ while\ reconstructing\ fork\ database\ from\ file;\ '\$\{filename\}'\ is\ likely\ corrupted"{}},}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}filename"{}},\ fork\_db\_dat.generic\_string())\ );}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ candidate\ =\ index.get<by\_lib\_block\_num>().begin();}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ candidate\ ==\ index.get<by\_lib\_block\_num>().end()\ ||\ !(*candidate)-\/>is\_valid()\ )\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}-\/>id\ ==\ root-\/>id,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}head\ not\ set\ to\ root\ despite\ no\ better\ option\ available;\ '\$\{filename\}'\ is\ likely\ corrupted"{}},}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}filename"{}},\ fork\_db\_dat.generic\_string())\ );}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !\mbox{\hyperlink{namespacesysio_1_1chain_a4d023005b3b47d76c62beeaebc291fa3}{first\_preferred}}(\ **candidate,\ *\mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ ),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}head\ not\ set\ to\ best\ available\ option\ available;\ '\$\{filename\}'\ is\ likely\ corrupted"{}},}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}filename"{}},\ fork\_db\_dat.generic\_string())\ );}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}(\ (fork\_db\_dat)\ )}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a0db76f35dc060918029b16de918b1e84}{fc::remove}}(\ fork\_db\_dat\ );}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_ab8bde04ebc49f6731e46ab330812bd00_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_aded14555f97fc186af50537babc4995e}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!remove\_impl@{remove\_impl}}
\index{remove\_impl@{remove\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{remove\_impl()}{remove\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_aded14555f97fc186af50537babc4995e} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::remove\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00522}{522}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00523\ \ \ \ \ \ \ deque<block\_id\_type>\ remove\_queue\{\textcolor{keywordtype}{id}\};}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ previdx\ =\ index.get<by\_prev>();}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ head\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}-\/>id;}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ i\ =\ 0;\ i\ <\ remove\_queue.size();\ ++i\ )\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ remove\_queue[i]\ !=\ head\_id,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}removing\ the\ block\ and\ its\ descendants\ would\ remove\ the\ current\ head\ block"{}}\ );}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ previtr\ =\ previdx.lower\_bound(\ remove\_queue[i]\ );}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ previtr\ !=\ previdx.end()\ \&\&\ (*previtr)-\/>header.previous\ ==\ remove\_queue[i]\ )\ \{}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ \ \ remove\_queue.emplace\_back(\ (*previtr)-\/>id\ );}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \ \ ++previtr;}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00538\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\_id\ :\ remove\_queue\ )\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ index.erase(\ block\_id\ );}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00541\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_aded14555f97fc186af50537babc4995e_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a0acb7aa1a0689cb15fb93145f9e5293c}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!reset\_impl@{reset\_impl}}
\index{reset\_impl@{reset\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{reset\_impl()}{reset\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a0acb7aa1a0689cb15fb93145f9e5293c} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::reset\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\+\_\+header\+\_\+state}} \&}]{root\+\_\+bhs}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00268}{268}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ index.clear();}
\DoxyCodeLine{00270\ \ \ \ \ \ \ root\ =\ std::make\_shared<block\_state>();}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}block\_header\_state\&\textcolor{keyword}{>}(*root)\ =\ root\_bhs;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ root-\/>validated\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32}{root}};}
\DoxyCodeLine{00274\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1fork__database__impl_a0acb7aa1a0689cb15fb93145f9e5293c_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_adce8101013b4aa8279b778de6ba96a5e}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!rollback\_head\_to\_root\_impl@{rollback\_head\_to\_root\_impl}}
\index{rollback\_head\_to\_root\_impl@{rollback\_head\_to\_root\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{rollback\_head\_to\_root\_impl()}{rollback\_head\_to\_root\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_adce8101013b4aa8279b778de6ba96a5e} 
void sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::rollback\+\_\+head\+\_\+to\+\_\+root\+\_\+impl (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00281}{281}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ by\_id\_idx\ =\ index.get<by\_block\_id>();}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ by\_id\_idx.begin();}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (itr\ !=\ by\_id\_idx.end())\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ by\_id\_idx.modify(\ itr,\ [\&](\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ bsp\ )\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ bsp-\/>validated\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ ++itr;}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32}{root}};}
\DoxyCodeLine{00291\ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a514dc4c7bd5146928e30e32d7ebc918f}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!search\_on\_branch\_impl@{search\_on\_branch\_impl}}
\index{search\_on\_branch\_impl@{search\_on\_branch\_impl}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{search\_on\_branch\_impl()}{search\_on\_branch\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a514dc4c7bd5146928e30e32d7ebc918f} 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::search\+\_\+on\+\_\+branch\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{h}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{block\+\_\+num}{}\end{DoxyParamCaption}) const}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00438}{438}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(h);\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1fork__database__impl_ab5a93206da8f421ced6d9f69ec2b9a27}{get\_block\_impl}}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}-\/>header.previous\ )\ )\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}-\/>block\_num\ ==\ block\_num\ )}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{00445\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=339pt]{structsysio_1_1chain_1_1fork__database__impl_a514dc4c7bd5146928e30e32d7ebc918f_cgraph}
\end{center}
\end{figure}


\doxysubsection{Member Data Documentation}
\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!datadir@{datadir}}
\index{datadir@{datadir}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{datadir}{datadir}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a9da19bee8c2b0fd04ccc6263a0bafaad} 
\mbox{\hyperlink{classfc_1_1path}{fc\+::path}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::datadir}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00072}{72}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!head@{head}}
\index{head@{head}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{head}{head}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a1e62e12db374c811deab2822dc8bfa63} 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::head}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00071}{71}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_afce88b79ad80446e7393c5f7a5f428ef}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!index@{index}}
\index{index@{index}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{index}{index}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_afce88b79ad80446e7393c5f7a5f428ef} 
\mbox{\hyperlink{namespacesysio_1_1chain_a41ae8badf840b6de83fb1a7697c0b583}{fork\+\_\+multi\+\_\+index\+\_\+type}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::index}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00069}{69}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a2799d519da9d0e00d12dd368b04f8b41}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!mtx@{mtx}}
\index{mtx@{mtx}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{mtx}{mtx}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a2799d519da9d0e00d12dd368b04f8b41} 
std\+::shared\+\_\+mutex sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::mtx}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00068}{68}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32}\index{sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}!root@{root}}
\index{root@{root}!sysio::chain::fork\_database\_impl@{sysio::chain::fork\_database\_impl}}
\doxysubsubsection{\texorpdfstring{root}{root}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1fork__database__impl_a2eacd40c2fc12431505346da61fbac32} 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} sysio\+::chain\+::fork\+\_\+database\+\_\+impl\+::root}



Definition at line \mbox{\hyperlink{fork__database_8cpp_source_l00070}{70}} of file \mbox{\hyperlink{fork__database_8cpp_source}{fork\+\_\+database.\+cpp}}.



The documentation for this struct was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
libraries/chain/\mbox{\hyperlink{fork__database_8cpp}{fork\+\_\+database.\+cpp}}\end{DoxyCompactItemize}
