<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wire Sysio: sysio::wallet::detail::se_wallet_impl Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Wire Sysio<span id="projectnumber">&#160;Wire Sysion 1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">sysio::wallet::detail::se_wallet_impl Struct Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for sysio::wallet::detail::se_wallet_impl:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl__coll__graph.png" border="0" usemap="#asysio_1_1wallet_1_1detail_1_1se__wallet__impl_coll__map" alt="Collaboration graph"/></div>
<map name="asysio_1_1wallet_1_1detail_1_1se__wallet__impl_coll__map" id="asysio_1_1wallet_1_1detail_1_1se__wallet__impl_coll__map">
<area shape="rect" title=" " alt="" coords="16,109,150,150"/>
<area shape="rect" title=" " alt="" coords="5,5,161,46"/>
<area shape="poly" title=" " alt="" coords="86,62,86,109,80,109,80,62"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3cfe51bbc6f89087296a06d2a8dbf65c" id="r_a3cfe51bbc6f89087296a06d2a8dbf65c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3cfe51bbc6f89087296a06d2a8dbf65c">populate_existing_keys</a> ()</td></tr>
<tr class="separator:a3cfe51bbc6f89087296a06d2a8dbf65c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a910dfcc255f4f77f893ca8e2c13a22ae" id="r_a910dfcc255f4f77f893ca8e2c13a22ae"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a910dfcc255f4f77f893ca8e2c13a22ae">create</a> ()</td></tr>
<tr class="separator:a910dfcc255f4f77f893ca8e2c13a22ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af55d7af9639ae410b25d61286e03912a" id="r_af55d7af9639ae410b25d61286e03912a"><td class="memItemLeft" align="right" valign="top">std::optional&lt; <a class="el" href="namespacesysio_1_1chain.html#af141a69eb789b86fa0eb93c2d263f0df">signature_type</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af55d7af9639ae410b25d61286e03912a">try_sign_digest</a> (const <a class="el" href="namespacesysio_1_1chain.html#a357fd9478475457e5bb386a3143079b6">digest_type</a> d, const <a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a> <a class="el" href="classfc_1_1crypto_1_1r1_1_1public__key.html">public_key</a>)</td></tr>
<tr class="separator:af55d7af9639ae410b25d61286e03912a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d449cd700d93a211a5c3b7709028d3e" id="r_a6d449cd700d93a211a5c3b7709028d3e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6d449cd700d93a211a5c3b7709028d3e">remove_key</a> (<a class="el" href="namespacefc.html#a0f3d84fe9e7adcd2d1e0bb7b60b49aa0">string</a> <a class="el" href="classfc_1_1crypto_1_1r1_1_1public__key.html">public_key</a>)</td></tr>
<tr class="separator:a6d449cd700d93a211a5c3b7709028d3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30be7d19ef03fda4c26d444ade686834" id="r_a30be7d19ef03fda4c26d444ade686834"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a30be7d19ef03fda4c26d444ade686834">~se_wallet_impl</a> ()</td></tr>
<tr class="separator:a30be7d19ef03fda4c26d444ade686834"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a06cd1a5418bb1d4d6fd34a06d98479d7" id="r_a06cd1a5418bb1d4d6fd34a06d98479d7"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacefc_1_1crypto_1_1r1.html#a2bfc308262de40acfc2a5e7c725bbe3f">public_key_data</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a06cd1a5418bb1d4d6fd34a06d98479d7">get_public_key_data</a> (SecKeyRef <a class="el" href="#a29018169d2b644e215e3d1042074ec36">key</a>)</td></tr>
<tr class="separator:a06cd1a5418bb1d4d6fd34a06d98479d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4143e58c3ef85d340f73fd65e5805f3f" id="r_a4143e58c3ef85d340f73fd65e5805f3f"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4143e58c3ef85d340f73fd65e5805f3f">get_public_key</a> (SecKeyRef <a class="el" href="#a29018169d2b644e215e3d1042074ec36">key</a>)</td></tr>
<tr class="separator:a4143e58c3ef85d340f73fd65e5805f3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a617c3932501399454678530512b48f57" id="r_a617c3932501399454678530512b48f57"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacefc.html#a0f3d84fe9e7adcd2d1e0bb7b60b49aa0">string</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a617c3932501399454678530512b48f57">string_for_cferror</a> (CFErrorRef error)</td></tr>
<tr class="separator:a617c3932501399454678530512b48f57"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a1b80313991e86ed845e8f6e4c1c49f6b" id="r_a1b80313991e86ed845e8f6e4c1c49f6b"><td class="memItemLeft" align="right" valign="top">map&lt; <a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a>, SecKeyRef &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a></td></tr>
<tr class="separator:a1b80313991e86ed845e8f6e4c1c49f6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29018169d2b644e215e3d1042074ec36" id="r_a29018169d2b644e215e3d1042074ec36"><td class="memItemLeft" align="right" valign="top">fc::ec_key&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a29018169d2b644e215e3d1042074ec36">key</a> = EC_KEY_new_by_curve_name(NID_X9_62_prime256v1)</td></tr>
<tr class="separator:a29018169d2b644e215e3d1042074ec36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac922260d33409ae131ed50209403452" id="r_aac922260d33409ae131ed50209403452"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aac922260d33409ae131ed50209403452">locked</a> = true</td></tr>
<tr class="separator:aac922260d33409ae131ed50209403452"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00025">25</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a30be7d19ef03fda4c26d444ade686834" name="a30be7d19ef03fda4c26d444ade686834"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30be7d19ef03fda4c26d444ade686834">&#9670;&#160;</a></span>~se_wallet_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">sysio::wallet::detail::se_wallet_impl::~se_wallet_impl </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00255">255</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  255</span>                     {</div>
<div class="line"><span class="lineno">  256</span>      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; k : <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>)</div>
<div class="line"><span class="lineno">  257</span>         CFRelease(k.second);</div>
<div class="line"><span class="lineno">  258</span>   }</div>
<div class="ttc" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_html_a1b80313991e86ed845e8f6e4c1c49f6b"><div class="ttname"><a href="#a1b80313991e86ed845e8f6e4c1c49f6b">sysio::wallet::detail::se_wallet_impl::_keys</a></div><div class="ttdeci">map&lt; public_key_type, SecKeyRef &gt; _keys</div><div class="ttdef"><b>Definition</b> <a href="se__wallet_8cpp_source.html#l00260">se_wallet.cpp:260</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a910dfcc255f4f77f893ca8e2c13a22ae" name="a910dfcc255f4f77f893ca8e2c13a22ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a910dfcc255f4f77f893ca8e2c13a22ae">&#9670;&#160;</a></span>create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a> sysio::wallet::detail::se_wallet_impl::create </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00122">122</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  122</span>                            {</div>
<div class="line"><span class="lineno">  123</span>      SecAccessControlRef accessControlRef = SecAccessControlCreateWithFlags(<span class="keyword">nullptr</span>, kSecAttrAccessibleWhenUnlockedThisDeviceOnly, kSecAccessControlPrivateKeyUsage, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>      <span class="keywordtype">int</span> keySizeValue = 256;</div>
<div class="line"><span class="lineno">  126</span>      CFNumberRef keySizeNumber = CFNumberCreate(NULL, kCFNumberIntType, &amp;keySizeValue);</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* keyAttrKeys[] = {</div>
<div class="line"><span class="lineno">  129</span>         kSecAttrIsPermanent,</div>
<div class="line"><span class="lineno">  130</span>         kSecAttrAccessControl,</div>
<div class="line"><span class="lineno">  131</span>         kSecAttrAccessGroup</div>
<div class="line"><span class="lineno">  132</span>      };</div>
<div class="line"><span class="lineno">  133</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* keyAttrValues[] = {</div>
<div class="line"><span class="lineno">  134</span>         kCFBooleanTrue,</div>
<div class="line"><span class="lineno">  135</span>         accessControlRef,</div>
<div class="line"><span class="lineno">  136</span><span class="preprocessor">#ifdef MAS_KEYCHAIN_GROUP</span></div>
<div class="line"><span class="lineno">  137</span>         CFSTR(<a class="code hl_define" href="se__wallet_8cpp.html#aaf66ac368b4f14a1b2b7ffbed48651cc">XSTR</a>(MAS_KEYCHAIN_GROUP))</div>
<div class="line"><span class="lineno">  138</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  139</span>      };</div>
<div class="line"><span class="lineno">  140</span>      CFDictionaryRef keyAttrDic = CFDictionaryCreate(NULL, keyAttrKeys, keyAttrValues, <span class="keyword">sizeof</span>(keyAttrValues)/<span class="keyword">sizeof</span>(keyAttrValues[0]), &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* attrKeys[] = {</div>
<div class="line"><span class="lineno">  143</span>         kSecAttrKeyType,</div>
<div class="line"><span class="lineno">  144</span>         kSecAttrKeySizeInBits,</div>
<div class="line"><span class="lineno">  145</span>         kSecAttrTokenID,</div>
<div class="line"><span class="lineno">  146</span>         kSecPrivateKeyAttrs</div>
<div class="line"><span class="lineno">  147</span>      };</div>
<div class="line"><span class="lineno">  148</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* atrrValues[] = {</div>
<div class="line"><span class="lineno">  149</span>         kSecAttrKeyTypeECSECPrimeRandom,</div>
<div class="line"><span class="lineno">  150</span>         keySizeNumber,</div>
<div class="line"><span class="lineno">  151</span>         kSecAttrTokenIDSecureEnclave,</div>
<div class="line"><span class="lineno">  152</span>         keyAttrDic</div>
<div class="line"><span class="lineno">  153</span>      };</div>
<div class="line"><span class="lineno">  154</span>      CFDictionaryRef attributesDic = CFDictionaryCreate(NULL, attrKeys, atrrValues, <span class="keyword">sizeof</span>(attrKeys)/<span class="keyword">sizeof</span>(attrKeys[0]), &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>      CFErrorRef error = NULL;</div>
<div class="line"><span class="lineno">  157</span>      SecKeyRef privateKey = SecKeyCreateRandomKey(attributesDic, &amp;error);</div>
<div class="line"><span class="lineno">  158</span>      <span class="keywordtype">string</span> error_string;</div>
<div class="line"><span class="lineno">  159</span>      <span class="keywordflow">if</span>(error) {</div>
<div class="line"><span class="lineno">  160</span>         error_string = <a class="code hl_function" href="#a617c3932501399454678530512b48f57">string_for_cferror</a>(error);</div>
<div class="line"><span class="lineno">  161</span>         CFRelease(error);</div>
<div class="line"><span class="lineno">  162</span>      }</div>
<div class="line"><span class="lineno">  163</span> </div>
<div class="line"><span class="lineno">  164</span>      CFRelease(attributesDic);</div>
<div class="line"><span class="lineno">  165</span>      CFRelease(keyAttrDic);</div>
<div class="line"><span class="lineno">  166</span>      CFRelease(keySizeNumber);</div>
<div class="line"><span class="lineno">  167</span>      CFRelease(accessControlRef);</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>      <span class="keywordflow">if</span>(error_string.size())</div>
<div class="line"><span class="lineno">  170</span>         <a class="code hl_define" href="exception_8hpp.html#a7590ddac4f181b661c3eeaf5feccc6ac">FC_THROW_EXCEPTION</a>(chain::wallet_exception, <span class="stringliteral">&quot;Failed to create key in Secure Enclave: ${m}&quot;</span>, (<span class="stringliteral">&quot;m&quot;</span>, error_string));</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>      <a class="code hl_class" href="classfc_1_1crypto_1_1public__key.html">public_key_type</a> <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3037ff69dd24c6e34aee6fdd45269f13">pub</a>;</div>
<div class="line"><span class="lineno">  173</span>      <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  174</span>         <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3037ff69dd24c6e34aee6fdd45269f13">pub</a> = <a class="code hl_function" href="#a4143e58c3ef85d340f73fd65e5805f3f">get_public_key</a>(privateKey);</div>
<div class="line"><span class="lineno">  175</span>      }</div>
<div class="line"><span class="lineno">  176</span>      <span class="keywordflow">catch</span>(chain::wallet_exception&amp;) {</div>
<div class="line"><span class="lineno">  177</span>         <span class="comment">//possibly we should delete the key here?</span></div>
<div class="line"><span class="lineno">  178</span>         CFRelease(privateKey);</div>
<div class="line"><span class="lineno">  179</span>         <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  180</span>      }</div>
<div class="line"><span class="lineno">  181</span>      <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>[<a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3037ff69dd24c6e34aee6fdd45269f13">pub</a>] = privateKey;</div>
<div class="line"><span class="lineno">  182</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3037ff69dd24c6e34aee6fdd45269f13">pub</a>;</div>
<div class="line"><span class="lineno">  183</span>   }</div>
<div class="ttc" id="aclassfc_1_1crypto_1_1public__key_html"><div class="ttname"><a href="classfc_1_1crypto_1_1public__key.html">fc::crypto::public_key</a></div><div class="ttdef"><b>Definition</b> <a href="public__key_8hpp_source.html#l00023">public_key.hpp:24</a></div></div>
<div class="ttc" id="aexception_8hpp_html_a7590ddac4f181b661c3eeaf5feccc6ac"><div class="ttname"><a href="exception_8hpp.html#a7590ddac4f181b661c3eeaf5feccc6ac">FC_THROW_EXCEPTION</a></div><div class="ttdeci">#define FC_THROW_EXCEPTION(EXCEPTION, FORMAT,...)</div><div class="ttdef"><b>Definition</b> <a href="exception_8hpp_source.html#l00395">exception.hpp:395</a></div></div>
<div class="ttc" id="ase__wallet_8cpp_html_aaf66ac368b4f14a1b2b7ffbed48651cc"><div class="ttname"><a href="se__wallet_8cpp.html#aaf66ac368b4f14a1b2b7ffbed48651cc">XSTR</a></div><div class="ttdeci">#define XSTR(A)</div><div class="ttdef"><b>Definition</b> <a href="se__wallet_8cpp_source.html#l00079">se_wallet.cpp:79</a></div></div>
<div class="ttc" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_html_a4143e58c3ef85d340f73fd65e5805f3f"><div class="ttname"><a href="#a4143e58c3ef85d340f73fd65e5805f3f">sysio::wallet::detail::se_wallet_impl::get_public_key</a></div><div class="ttdeci">static public_key_type get_public_key(SecKeyRef key)</div><div class="ttdef"><b>Definition</b> <a href="se__wallet_8cpp_source.html#l00053">se_wallet.cpp:53</a></div></div>
<div class="ttc" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_html_a617c3932501399454678530512b48f57"><div class="ttname"><a href="#a617c3932501399454678530512b48f57">sysio::wallet::detail::se_wallet_impl::string_for_cferror</a></div><div class="ttdeci">static string string_for_cferror(CFErrorRef error)</div><div class="ttdef"><b>Definition</b> <a href="se__wallet_8cpp_source.html#l00067">se_wallet.cpp:67</a></div></div>
<div class="ttc" id="ayubihsm__pkcs11_8c_html_a3037ff69dd24c6e34aee6fdd45269f13"><div class="ttname"><a href="yubihsm__pkcs11_8c.html#a3037ff69dd24c6e34aee6fdd45269f13">pub</a></div><div class="ttdeci">bool pub</div><div class="ttdef"><b>Definition</b> <a href="yubihsm__pkcs11_8c_source.html#l01928">yubihsm_pkcs11.c:1928</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a910dfcc255f4f77f893ca8e2c13a22ae_cgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a910dfcc255f4f77f893ca8e2c13a22ae_cgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a910dfcc255f4f77f893ca8e2c13a22ae_cgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a910dfcc255f4f77f893ca8e2c13a22ae_cgraph">
<area shape="rect" title=" " alt="" coords="5,147,165,187"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a4143e58c3ef85d340f73fd65e5805f3f" title=" " alt="" coords="213,68,354,124"/>
<area shape="poly" title=" " alt="" coords="143,144,197,124,199,129,145,149"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a617c3932501399454678530512b48f57" title=" " alt="" coords="591,102,747,157"/>
<area shape="poly" title=" " alt="" coords="165,174,245,181,339,184,442,182,543,171,585,160,587,165,544,176,442,188,339,190,244,186,165,179"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a06cd1a5418bb1d4d6fd34a06d98479d7" title=" " alt="" coords="402,31,543,87"/>
<area shape="poly" title=" " alt="" coords="354,80,386,73,387,78,355,85"/>
<area shape="rect" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1" title=" " alt="" coords="633,14,705,40"/>
<area shape="poly" title=" " alt="" coords="315,66,354,38,401,16,458,5,517,3,572,7,618,14,617,19,571,12,517,8,459,11,403,21,357,43,318,70"/>
<area shape="rect" href="namespacefc_1_1raw.html#a0b442d98ceb22dd5a6ae84745e43ffab" title=" " alt="" coords="417,135,528,161"/>
<area shape="poly" title=" " alt="" coords="355,113,410,128,408,133,353,118"/>
<area shape="poly" title=" " alt="" coords="543,45,618,32,619,38,544,50"/>
<area shape="poly" title=" " alt="" coords="545,82,578,94,576,99,543,87"/>
<area shape="poly" title=" " alt="" coords="441,136,435,127,438,117,451,111,473,109,496,111,508,118,505,123,494,116,473,114,453,116,442,121,440,126,445,134"/>
</map>
</div>

</div>
</div>
<a id="a4143e58c3ef85d340f73fd65e5805f3f" name="a4143e58c3ef85d340f73fd65e5805f3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4143e58c3ef85d340f73fd65e5805f3f">&#9670;&#160;</a></span>get_public_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a> sysio::wallet::detail::se_wallet_impl::get_public_key </td>
          <td>(</td>
          <td class="paramtype">SecKeyRef</td>          <td class="paramname"><span class="paramname"><em>key</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00053">53</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   53</span>                                                        {</div>
<div class="line"><span class="lineno">   54</span>      <span class="keywordtype">char</span> serialized_pub_key[<span class="keyword">sizeof</span>(<a class="code hl_typedef" href="namespacefc_1_1crypto_1_1r1.html#a2bfc308262de40acfc2a5e7c725bbe3f">public_key_data</a>) + 1];</div>
<div class="line"><span class="lineno">   55</span>      serialized_pub_key[0] = 0x01;</div>
<div class="line"><span class="lineno">   56</span> </div>
<div class="line"><span class="lineno">   57</span>      <a class="code hl_typedef" href="namespacefc_1_1crypto_1_1r1.html#a2bfc308262de40acfc2a5e7c725bbe3f">public_key_data</a> pub_key_data = <a class="code hl_function" href="#a06cd1a5418bb1d4d6fd34a06d98479d7">get_public_key_data</a>(key);</div>
<div class="line"><span class="lineno">   58</span>      <a class="code hl_function" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1">memcpy</a>(serialized_pub_key+1, pub_key_data.data, <span class="keyword">sizeof</span>(pub_key_data));</div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>      <a class="code hl_class" href="classfc_1_1crypto_1_1public__key.html">public_key_type</a> pub_key;</div>
<div class="line"><span class="lineno">   61</span>      <a class="code hl_class" href="classfc_1_1datastream.html">fc::datastream&lt;const char *&gt;</a> <a class="code hl_function" href="namespace_xbyak_1_1util.html#a4b2aef26182d21706896022467868f7c">ds</a>(serialized_pub_key, <span class="keyword">sizeof</span>(serialized_pub_key));</div>
<div class="line"><span class="lineno">   62</span>      <a class="code hl_function" href="namespacefc_1_1raw.html#a0b442d98ceb22dd5a6ae84745e43ffab">fc::raw::unpack</a>(ds, pub_key);</div>
<div class="line"><span class="lineno">   63</span> </div>
<div class="line"><span class="lineno">   64</span>      <span class="keywordflow">return</span> pub_key;</div>
<div class="line"><span class="lineno">   65</span>   }</div>
<div class="ttc" id="aclassfc_1_1datastream_html"><div class="ttname"><a href="classfc_1_1datastream.html">fc::datastream</a></div><div class="ttdef"><b>Definition</b> <a href="datastream_8hpp_source.html#l00018">datastream.hpp:18</a></div></div>
<div class="ttc" id="anamespace_xbyak_1_1util_html_a4b2aef26182d21706896022467868f7c"><div class="ttname"><a href="namespace_xbyak_1_1util.html#a4b2aef26182d21706896022467868f7c">Xbyak::util::ds</a></div><div class="ttdeci">static const Segment ds(Segment::ds)</div></div>
<div class="ttc" id="anamespacefc_1_1crypto_1_1r1_html_a2bfc308262de40acfc2a5e7c725bbe3f"><div class="ttname"><a href="namespacefc_1_1crypto_1_1r1.html#a2bfc308262de40acfc2a5e7c725bbe3f">fc::crypto::r1::public_key_data</a></div><div class="ttdeci">fc::array&lt; char, 33 &gt; public_key_data</div><div class="ttdef"><b>Definition</b> <a href="elliptic__r1_8hpp_source.html#l00020">elliptic_r1.hpp:20</a></div></div>
<div class="ttc" id="anamespacefc_1_1raw_html_a0b442d98ceb22dd5a6ae84745e43ffab"><div class="ttname"><a href="namespacefc_1_1raw.html#a0b442d98ceb22dd5a6ae84745e43ffab">fc::raw::unpack</a></div><div class="ttdeci">void unpack(Stream &amp;s, std::deque&lt; T &gt; &amp;value)</div><div class="ttdef"><b>Definition</b> <a href="raw_8hpp_source.html#l00540">raw.hpp:540</a></div></div>
<div class="ttc" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_html_a06cd1a5418bb1d4d6fd34a06d98479d7"><div class="ttname"><a href="#a06cd1a5418bb1d4d6fd34a06d98479d7">sysio::wallet::detail::se_wallet_impl::get_public_key_data</a></div><div class="ttdeci">static public_key_data get_public_key_data(SecKeyRef key)</div><div class="ttdef"><b>Definition</b> <a href="se__wallet_8cpp_source.html#l00027">se_wallet.cpp:27</a></div></div>
<div class="ttc" id="ayubihsm__pkcs11_8c_html_ae785d5badbf1f08b491af31f32a135a1"><div class="ttname"><a href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1">memcpy</a></div><div class="ttdeci">memcpy((char *) pInfo-&gt;slotDescription, s, l)</div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_cgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_cgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_cgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,147,111"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a06cd1a5418bb1d4d6fd34a06d98479d7" title=" " alt="" coords="195,56,336,111"/>
<area shape="poly" title=" " alt="" coords="147,81,179,81,179,86,147,86"/>
<area shape="rect" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1" title=" " alt="" coords="426,5,497,31"/>
<area shape="poly" title=" " alt="" coords="147,54,194,41,310,24,410,17,411,22,310,29,195,46,148,59"/>
<area shape="rect" href="namespacefc_1_1raw.html#a0b442d98ceb22dd5a6ae84745e43ffab" title=" " alt="" coords="210,160,321,186"/>
<area shape="poly" title=" " alt="" coords="138,109,224,151,221,155,135,114"/>
<area shape="poly" title=" " alt="" coords="335,57,383,41,411,32,412,37,385,46,337,62"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a617c3932501399454678530512b48f57" title=" " alt="" coords="384,56,539,111"/>
<area shape="poly" title=" " alt="" coords="337,81,369,81,369,86,337,86"/>
<area shape="poly" title=" " alt="" coords="233,161,227,151,231,142,244,136,265,133,288,136,300,142,298,147,287,141,265,139,245,141,235,145,233,151,238,158"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_icgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_icgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_icgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a4143e58c3ef85d340f73fd65e5805f3f_icgraph">
<area shape="rect" title=" " alt="" coords="226,34,367,90"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a910dfcc255f4f77f893ca8e2c13a22ae" title=" " alt="" coords="12,5,171,46"/>
<area shape="poly" title=" " alt="" coords="210,49,171,42,172,37,211,44"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a3cfe51bbc6f89087296a06d2a8dbf65c" title=" " alt="" coords="5,70,178,126"/>
<area shape="poly" title=" " alt="" coords="211,79,179,85,178,80,210,74"/>
</map>
</div>

</div>
</div>
<a id="a06cd1a5418bb1d4d6fd34a06d98479d7" name="a06cd1a5418bb1d4d6fd34a06d98479d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06cd1a5418bb1d4d6fd34a06d98479d7">&#9670;&#160;</a></span>get_public_key_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="namespacefc_1_1crypto_1_1r1.html#a2bfc308262de40acfc2a5e7c725bbe3f">public_key_data</a> sysio::wallet::detail::se_wallet_impl::get_public_key_data </td>
          <td>(</td>
          <td class="paramtype">SecKeyRef</td>          <td class="paramname"><span class="paramname"><em>key</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00027">27</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   27</span>                                                             {</div>
<div class="line"><span class="lineno">   28</span>      SecKeyRef <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a931987c85fd408a620505ee9a1aa6f58">pubkey</a> = SecKeyCopyPublicKey(key);</div>
<div class="line"><span class="lineno">   29</span> </div>
<div class="line"><span class="lineno">   30</span>      CFErrorRef error = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   31</span>      CFDataRef keyrep = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   32</span>      keyrep = SecKeyCopyExternalRepresentation(<a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a931987c85fd408a620505ee9a1aa6f58">pubkey</a>, &amp;error);</div>
<div class="line"><span class="lineno">   33</span> </div>
<div class="line"><span class="lineno">   34</span>      <a class="code hl_typedef" href="namespacefc_1_1crypto_1_1r1.html#a2bfc308262de40acfc2a5e7c725bbe3f">public_key_data</a> pub_key_data;</div>
<div class="line"><span class="lineno">   35</span>      <span class="keywordflow">if</span>(!error) {</div>
<div class="line"><span class="lineno">   36</span>         <span class="keyword">const</span> UInt8* cfdata = CFDataGetBytePtr(keyrep);</div>
<div class="line"><span class="lineno">   37</span>         <a class="code hl_function" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1">memcpy</a>(pub_key_data.data+1, cfdata+1, 32);</div>
<div class="line"><span class="lineno">   38</span>         pub_key_data.data[0] = 0x02 + (cfdata[64]&amp;1);</div>
<div class="line"><span class="lineno">   39</span>      }</div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span>      CFRelease(keyrep);</div>
<div class="line"><span class="lineno">   42</span>      CFRelease(<a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a931987c85fd408a620505ee9a1aa6f58">pubkey</a>);</div>
<div class="line"><span class="lineno">   43</span> </div>
<div class="line"><span class="lineno">   44</span>      <span class="keywordflow">if</span>(error) {</div>
<div class="line"><span class="lineno">   45</span>         <span class="keywordtype">string</span> error_string = <a class="code hl_function" href="#a617c3932501399454678530512b48f57">string_for_cferror</a>(error);</div>
<div class="line"><span class="lineno">   46</span>         CFRelease(error);</div>
<div class="line"><span class="lineno">   47</span>         <a class="code hl_define" href="exception_8hpp.html#a7590ddac4f181b661c3eeaf5feccc6ac">FC_THROW_EXCEPTION</a>(chain::wallet_exception, <span class="stringliteral">&quot;Failed to get public key from Secure Enclave: ${m}&quot;</span>, (<span class="stringliteral">&quot;m&quot;</span>, error_string));</div>
<div class="line"><span class="lineno">   48</span>      }</div>
<div class="line"><span class="lineno">   49</span> </div>
<div class="line"><span class="lineno">   50</span>      <span class="keywordflow">return</span> pub_key_data;</div>
<div class="line"><span class="lineno">   51</span>   }</div>
<div class="ttc" id="ayubihsm__pkcs11_8c_html_a931987c85fd408a620505ee9a1aa6f58"><div class="ttname"><a href="yubihsm__pkcs11_8c.html#a931987c85fd408a620505ee9a1aa6f58">pubkey</a></div><div class="ttdeci">CK_BYTE_PTR pubkey</div><div class="ttdef"><b>Definition</b> <a href="yubihsm__pkcs11_8c_source.html#l04984">yubihsm_pkcs11.c:4984</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_cgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_cgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_cgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_cgraph">
<area shape="rect" title=" " alt="" coords="5,24,147,79"/>
<area shape="rect" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1" title=" " alt="" coords="237,5,308,31"/>
<area shape="poly" title=" " alt="" coords="147,37,221,24,222,29,148,42"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a617c3932501399454678530512b48f57" title=" " alt="" coords="195,56,350,111"/>
<area shape="poly" title=" " alt="" coords="148,60,180,66,179,71,147,66"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_icgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_icgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_icgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a06cd1a5418bb1d4d6fd34a06d98479d7_icgraph">
<area shape="rect" title=" " alt="" coords="415,74,556,130"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a4143e58c3ef85d340f73fd65e5805f3f" title=" " alt="" coords="226,34,367,90"/>
<area shape="poly" title=" " alt="" coords="399,86,367,79,368,74,401,81"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#af55d7af9639ae410b25d61286e03912a" title=" " alt="" coords="227,114,366,170"/>
<area shape="poly" title=" " alt="" coords="401,122,367,130,365,124,399,117"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a910dfcc255f4f77f893ca8e2c13a22ae" title=" " alt="" coords="12,5,171,46"/>
<area shape="poly" title=" " alt="" coords="210,49,171,42,172,37,211,44"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a3cfe51bbc6f89087296a06d2a8dbf65c" title=" " alt="" coords="5,70,178,126"/>
<area shape="poly" title=" " alt="" coords="211,79,179,85,178,80,210,74"/>
</map>
</div>

</div>
</div>
<a id="a3cfe51bbc6f89087296a06d2a8dbf65c" name="a3cfe51bbc6f89087296a06d2a8dbf65c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cfe51bbc6f89087296a06d2a8dbf65c">&#9670;&#160;</a></span>populate_existing_keys()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sysio::wallet::detail::se_wallet_impl::populate_existing_keys </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00082">82</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   82</span>                                 {</div>
<div class="line"><span class="lineno">   83</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* keyAttrKeys[] = {</div>
<div class="line"><span class="lineno">   84</span>         kSecClass,</div>
<div class="line"><span class="lineno">   85</span>         kSecAttrKeyClass,</div>
<div class="line"><span class="lineno">   86</span>         kSecMatchLimit,</div>
<div class="line"><span class="lineno">   87</span>         kSecReturnRef,</div>
<div class="line"><span class="lineno">   88</span>         kSecAttrTokenID,</div>
<div class="line"><span class="lineno">   89</span>         kSecAttrAccessGroup</div>
<div class="line"><span class="lineno">   90</span>      };</div>
<div class="line"><span class="lineno">   91</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* keyAttrValues[] = {</div>
<div class="line"><span class="lineno">   92</span>         kSecClassKey,</div>
<div class="line"><span class="lineno">   93</span>         kSecAttrKeyClassPrivate,</div>
<div class="line"><span class="lineno">   94</span>         kSecMatchLimitAll,</div>
<div class="line"><span class="lineno">   95</span>         kCFBooleanTrue,</div>
<div class="line"><span class="lineno">   96</span>         kSecAttrTokenIDSecureEnclave,</div>
<div class="line"><span class="lineno">   97</span><span class="preprocessor">#ifdef MAS_KEYCHAIN_GROUP</span></div>
<div class="line"><span class="lineno">   98</span>         CFSTR(<a class="code hl_define" href="se__wallet_8cpp.html#aaf66ac368b4f14a1b2b7ffbed48651cc">XSTR</a>(MAS_KEYCHAIN_GROUP))</div>
<div class="line"><span class="lineno">   99</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  100</span>      };</div>
<div class="line"><span class="lineno">  101</span>      CFDictionaryRef keyAttrDic = CFDictionaryCreate(<span class="keyword">nullptr</span>, keyAttrKeys, keyAttrValues, <span class="keyword">sizeof</span>(keyAttrValues)/<span class="keyword">sizeof</span>(keyAttrValues[0]), &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>      CFArrayRef keyRefs = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  104</span>      <span class="keywordflow">if</span>(SecItemCopyMatching(keyAttrDic, (CFTypeRef*)&amp;keyRefs) || !keyRefs) {</div>
<div class="line"><span class="lineno">  105</span>         CFRelease(keyAttrDic);</div>
<div class="line"><span class="lineno">  106</span>         <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  107</span>      }</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>      CFIndex <a class="code hl_variable" href="gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a> = CFArrayGetCount(keyRefs);</div>
<div class="line"><span class="lineno">  110</span>      <span class="keywordflow">for</span>(<span class="keywordtype">long</span> i = 0; i &lt; <a class="code hl_variable" href="gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a>; ++i) {</div>
<div class="line"><span class="lineno">  111</span>         <a class="code hl_class" href="classfc_1_1crypto_1_1public__key.html">public_key_type</a> <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3037ff69dd24c6e34aee6fdd45269f13">pub</a>;</div>
<div class="line"><span class="lineno">  112</span>         <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  113</span>            SecKeyRef key = (SecKeyRef)CFRetain(CFArrayGetValueAtIndex(keyRefs, i));</div>
<div class="line"><span class="lineno">  114</span>            <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>[<a class="code hl_function" href="#a4143e58c3ef85d340f73fd65e5805f3f">get_public_key</a>(key)] = <a class="code hl_variable" href="#a29018169d2b644e215e3d1042074ec36">key</a>;</div>
<div class="line"><span class="lineno">  115</span>         }</div>
<div class="line"><span class="lineno">  116</span>         <span class="keywordflow">catch</span>(chain::wallet_exception&amp;) {}</div>
<div class="line"><span class="lineno">  117</span>      }</div>
<div class="line"><span class="lineno">  118</span>      CFRelease(keyRefs);</div>
<div class="line"><span class="lineno">  119</span>      CFRelease(keyAttrDic);</div>
<div class="line"><span class="lineno">  120</span>   }</div>
<div class="ttc" id="agmock__stress__test_8cc_html_afd9db40e3361ae09188795e8cbe19752"><div class="ttname"><a href="gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a></div><div class="ttdeci">int * count</div><div class="ttdef"><b>Definition</b> <a href="gmock__stress__test_8cc_source.html#l00177">gmock_stress_test.cc:177</a></div></div>
<div class="ttc" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_html_a29018169d2b644e215e3d1042074ec36"><div class="ttname"><a href="#a29018169d2b644e215e3d1042074ec36">sysio::wallet::detail::se_wallet_impl::key</a></div><div class="ttdeci">fc::ec_key key</div><div class="ttdef"><b>Definition</b> <a href="se__wallet_8cpp_source.html#l00261">se_wallet.cpp:261</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a3cfe51bbc6f89087296a06d2a8dbf65c_cgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a3cfe51bbc6f89087296a06d2a8dbf65c_cgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a3cfe51bbc6f89087296a06d2a8dbf65c_cgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a3cfe51bbc6f89087296a06d2a8dbf65c_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,178,111"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a4143e58c3ef85d340f73fd65e5805f3f" title=" " alt="" coords="226,56,367,111"/>
<area shape="poly" title=" " alt="" coords="178,81,210,81,210,86,178,86"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a06cd1a5418bb1d4d6fd34a06d98479d7" title=" " alt="" coords="415,56,556,111"/>
<area shape="poly" title=" " alt="" coords="367,81,400,81,400,86,367,86"/>
<area shape="rect" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1" title=" " alt="" coords="646,5,718,31"/>
<area shape="poly" title=" " alt="" coords="367,54,414,41,530,24,630,17,631,22,531,29,416,46,368,59"/>
<area shape="rect" href="namespacefc_1_1raw.html#a0b442d98ceb22dd5a6ae84745e43ffab" title=" " alt="" coords="430,160,541,186"/>
<area shape="poly" title=" " alt="" coords="358,109,444,151,442,155,356,114"/>
<area shape="poly" title=" " alt="" coords="556,57,603,41,631,32,633,37,605,46,557,62"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a617c3932501399454678530512b48f57" title=" " alt="" coords="604,56,760,111"/>
<area shape="poly" title=" " alt="" coords="557,81,589,81,589,86,557,86"/>
<area shape="poly" title=" " alt="" coords="454,161,448,151,451,142,464,136,486,133,509,136,521,142,518,147,507,141,486,139,466,141,455,145,453,151,458,158"/>
</map>
</div>

</div>
</div>
<a id="a6d449cd700d93a211a5c3b7709028d3e" name="a6d449cd700d93a211a5c3b7709028d3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d449cd700d93a211a5c3b7709028d3e">&#9670;&#160;</a></span>remove_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool sysio::wallet::detail::se_wallet_impl::remove_key </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefc.html#a0f3d84fe9e7adcd2d1e0bb7b60b49aa0">string</a></td>          <td class="paramname"><span class="paramname"><em>public_key</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00230">230</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  230</span>                                      {</div>
<div class="line"><span class="lineno">  231</span>      <span class="keyword">auto</span> it = <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>.find(<a class="code hl_class" href="classfc_1_1crypto_1_1public__key.html">public_key_type</a>{<a class="code hl_class" href="classfc_1_1public__key.html">public_key</a>});</div>
<div class="line"><span class="lineno">  232</span>      <span class="keywordflow">if</span>(it == <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>.end())</div>
<div class="line"><span class="lineno">  233</span>         <a class="code hl_define" href="exception_8hpp.html#a7590ddac4f181b661c3eeaf5feccc6ac">FC_THROW_EXCEPTION</a>(chain::wallet_exception, <span class="stringliteral">&quot;Given key to delete not found in Secure Enclave wallet&quot;</span>);</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span>      promise&lt;bool&gt; prom;</div>
<div class="line"><span class="lineno">  236</span>      future&lt;bool&gt; fut = prom.get_future();</div>
<div class="line"><span class="lineno">  237</span>      <a class="code hl_function" href="macos__user__auth_8h.html#af17e895352b722eb1a08dd36478bce9f">macos_user_auth</a>(auth_callback, &amp;prom, CFSTR(<span class="stringliteral">&quot;remove a key from your SYSIO wallet&quot;</span>));</div>
<div class="line"><span class="lineno">  238</span>      <span class="keywordflow">if</span>(!fut.get())</div>
<div class="line"><span class="lineno">  239</span>         <a class="code hl_define" href="exception_8hpp.html#a7590ddac4f181b661c3eeaf5feccc6ac">FC_THROW_EXCEPTION</a>(chain::wallet_invalid_password_exception, <span class="stringliteral">&quot;Local user authentication failed&quot;</span>);</div>
<div class="line"><span class="lineno">  240</span> </div>
<div class="line"><span class="lineno">  241</span>      CFDictionaryRef deleteDic = CFDictionaryCreate(<span class="keyword">nullptr</span>, (<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;kSecValueRef, (<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;it-&gt;second, 1, &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>      OSStatus <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3d854b6efad16a16e4d7b4539d4fc71f">ret</a> = SecItemDelete(deleteDic);</div>
<div class="line"><span class="lineno">  244</span>      CFRelease(deleteDic);</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3d854b6efad16a16e4d7b4539d4fc71f">ret</a>)</div>
<div class="line"><span class="lineno">  247</span>         <a class="code hl_define" href="exception_8hpp.html#a7590ddac4f181b661c3eeaf5feccc6ac">FC_THROW_EXCEPTION</a>(chain::wallet_exception, <span class="stringliteral">&quot;Failed to getremove key from Secure Enclave&quot;</span>);</div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>      CFRelease(it-&gt;second);</div>
<div class="line"><span class="lineno">  250</span>      <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>.erase(it);</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  253</span>   }</div>
<div class="ttc" id="aclassfc_1_1public__key_html"><div class="ttname"><a href="classfc_1_1public__key.html">fc::public_key</a></div><div class="ttdef"><b>Definition</b> <a href="pke_8hpp_source.html#l00019">pke.hpp:20</a></div></div>
<div class="ttc" id="amacos__user__auth_8h_html_af17e895352b722eb1a08dd36478bce9f"><div class="ttname"><a href="macos__user__auth_8h.html#af17e895352b722eb1a08dd36478bce9f">macos_user_auth</a></div><div class="ttdeci">void macos_user_auth(void(*cb)(int, void *), void *cb_userdata, CFStringRef message)</div><div class="ttdef"><b>Definition</b> <a href="macos__user__auth_8m_source.html#l00003">macos_user_auth.m:3</a></div></div>
<div class="ttc" id="ayubihsm__pkcs11_8c_html_a3d854b6efad16a16e4d7b4539d4fc71f"><div class="ttname"><a href="yubihsm__pkcs11_8c.html#a3d854b6efad16a16e4d7b4539d4fc71f">ret</a></div><div class="ttdeci">CK_RV ret</div><div class="ttdef"><b>Definition</b> <a href="yubihsm__pkcs11_8c_source.html#l00973">yubihsm_pkcs11.c:973</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a6d449cd700d93a211a5c3b7709028d3e_cgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a6d449cd700d93a211a5c3b7709028d3e_cgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a6d449cd700d93a211a5c3b7709028d3e_cgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a6d449cd700d93a211a5c3b7709028d3e_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,200,46"/>
<area shape="rect" href="macos__user__auth_8m.html#af17e895352b722eb1a08dd36478bce9f" title=" " alt="" coords="248,13,372,38"/>
<area shape="poly" title=" " alt="" coords="200,23,232,23,232,28,200,28"/>
</map>
</div>

</div>
</div>
<a id="a617c3932501399454678530512b48f57" name="a617c3932501399454678530512b48f57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a617c3932501399454678530512b48f57">&#9670;&#160;</a></span>string_for_cferror()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="namespacefc.html#a0f3d84fe9e7adcd2d1e0bb7b60b49aa0">string</a> sysio::wallet::detail::se_wallet_impl::string_for_cferror </td>
          <td>(</td>
          <td class="paramtype">CFErrorRef</td>          <td class="paramname"><span class="paramname"><em>error</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00067">67</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   67</span>                                                      {</div>
<div class="line"><span class="lineno">   68</span>      CFStringRef errorString = CFCopyDescription(error);</div>
<div class="line"><span class="lineno">   69</span>      <span class="keywordtype">char</span> buff[CFStringGetLength(errorString) + 1];</div>
<div class="line"><span class="lineno">   70</span>      <span class="keywordtype">string</span> <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3d854b6efad16a16e4d7b4539d4fc71f">ret</a>;</div>
<div class="line"><span class="lineno">   71</span>      <span class="keywordflow">if</span>(CFStringGetCString(errorString, buff, <span class="keyword">sizeof</span>(buff), kCFStringEncodingUTF8))</div>
<div class="line"><span class="lineno">   72</span>         <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3d854b6efad16a16e4d7b4539d4fc71f">ret</a> = buff;</div>
<div class="line"><span class="lineno">   73</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   74</span>         <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3d854b6efad16a16e4d7b4539d4fc71f">ret</a> = <span class="stringliteral">&quot;Unknown&quot;</span>;</div>
<div class="line"><span class="lineno">   75</span>      CFRelease(errorString);</div>
<div class="line"><span class="lineno">   76</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a3d854b6efad16a16e4d7b4539d4fc71f">ret</a>;</div>
<div class="line"><span class="lineno">   77</span>   }</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a617c3932501399454678530512b48f57_icgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a617c3932501399454678530512b48f57_icgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a617c3932501399454678530512b48f57_icgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_a617c3932501399454678530512b48f57_icgraph">
<area shape="rect" title=" " alt="" coords="604,67,760,123"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a910dfcc255f4f77f893ca8e2c13a22ae" title=" " alt="" coords="12,5,171,46"/>
<area shape="poly" title=" " alt="" coords="589,65,556,58,453,42,348,33,171,27,172,22,349,28,453,37,557,52,590,60"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a06cd1a5418bb1d4d6fd34a06d98479d7" title=" " alt="" coords="415,67,556,123"/>
<area shape="poly" title=" " alt="" coords="589,98,557,98,557,92,589,92"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#af55d7af9639ae410b25d61286e03912a" title=" " alt="" coords="227,143,366,199"/>
<area shape="poly" title=" " alt="" coords="590,129,557,138,457,156,366,167,365,162,456,151,556,132,589,124"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a4143e58c3ef85d340f73fd65e5805f3f" title=" " alt="" coords="226,63,367,119"/>
<area shape="poly" title=" " alt="" coords="400,96,367,95,367,90,400,91"/>
<area shape="poly" title=" " alt="" coords="402,131,367,146,365,141,400,127"/>
<area shape="poly" title=" " alt="" coords="210,66,157,49,159,44,212,61"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a3cfe51bbc6f89087296a06d2a8dbf65c" title=" " alt="" coords="5,70,178,126"/>
<area shape="poly" title=" " alt="" coords="210,96,178,98,178,92,210,91"/>
</map>
</div>

</div>
</div>
<a id="af55d7af9639ae410b25d61286e03912a" name="af55d7af9639ae410b25d61286e03912a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af55d7af9639ae410b25d61286e03912a">&#9670;&#160;</a></span>try_sign_digest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; <a class="el" href="namespacesysio_1_1chain.html#af141a69eb789b86fa0eb93c2d263f0df">signature_type</a> &gt; sysio::wallet::detail::se_wallet_impl::try_sign_digest </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacesysio_1_1chain.html#a357fd9478475457e5bb386a3143079b6">digest_type</a></td>          <td class="paramname"><span class="paramname"><em>d</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a></td>          <td class="paramname"><span class="paramname"><em>public_key</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00185">185</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  185</span>                                                                                                      {</div>
<div class="line"><span class="lineno">  186</span>      <span class="keyword">auto</span> it = <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>.find(<a class="code hl_class" href="classfc_1_1public__key.html">public_key</a>);</div>
<div class="line"><span class="lineno">  187</span>      <span class="keywordflow">if</span>(it == <a class="code hl_variable" href="#a1b80313991e86ed845e8f6e4c1c49f6b">_keys</a>.end())</div>
<div class="line"><span class="lineno">  188</span>         <span class="keywordflow">return</span> std::optional&lt;signature_type&gt;{};</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>      fc::ecdsa_sig sig = ECDSA_SIG_new();</div>
<div class="line"><span class="lineno">  191</span>      CFErrorRef error = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>      CFDataRef digestData = CFDataCreateWithBytesNoCopy(<span class="keyword">nullptr</span>, (UInt8*)<a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a107648633008a7f2d872b4b3d98c2f96">d</a>.data(), <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a107648633008a7f2d872b4b3d98c2f96">d</a>.data_size(), kCFAllocatorNull);</div>
<div class="line"><span class="lineno">  194</span>      CFDataRef <a class="code hl_typedef" href="namespacefc.html#a50190ee8a24af6929033b058b16158c4">signature</a> = SecKeyCreateSignature(it-&gt;second, kSecKeyAlgorithmECDSASignatureDigestX962SHA256, digestData, &amp;error);</div>
<div class="line"><span class="lineno">  195</span>      <span class="keywordflow">if</span>(error) {</div>
<div class="line"><span class="lineno">  196</span>         <span class="keywordtype">string</span> error_string = <a class="code hl_function" href="#a617c3932501399454678530512b48f57">string_for_cferror</a>(error);</div>
<div class="line"><span class="lineno">  197</span>         CFRelease(error);</div>
<div class="line"><span class="lineno">  198</span>         CFRelease(digestData);</div>
<div class="line"><span class="lineno">  199</span>         <a class="code hl_define" href="exception_8hpp.html#a7590ddac4f181b661c3eeaf5feccc6ac">FC_THROW_EXCEPTION</a>(chain::wallet_exception, <span class="stringliteral">&quot;Failed to sign digest in Secure Enclave: ${m}&quot;</span>, (<span class="stringliteral">&quot;m&quot;</span>, error_string));</div>
<div class="line"><span class="lineno">  200</span>      }</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>      <span class="keyword">const</span> UInt8* der_bytes = CFDataGetBytePtr(<a class="code hl_typedef" href="namespacefc.html#a50190ee8a24af6929033b058b16158c4">signature</a>);</div>
<div class="line"><span class="lineno">  203</span>      <span class="keywordtype">long</span> derSize = CFDataGetLength(<a class="code hl_typedef" href="namespacefc.html#a50190ee8a24af6929033b058b16158c4">signature</a>);</div>
<div class="line"><span class="lineno">  204</span>      d2i_ECDSA_SIG(&amp;sig.obj, &amp;der_bytes, derSize);</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>      <a class="code hl_typedef" href="namespacefc_1_1crypto_1_1r1.html#a2bfc308262de40acfc2a5e7c725bbe3f">public_key_data</a> kd;</div>
<div class="line"><span class="lineno">  207</span>      <a class="code hl_typedef" href="namespacefc_1_1crypto_1_1r1.html#ae05a9b8a3e71b719d56c0a87c491a8f6">compact_signature</a> compact_sig;</div>
<div class="line"><span class="lineno">  208</span>      <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  209</span>         kd = <a class="code hl_function" href="#a06cd1a5418bb1d4d6fd34a06d98479d7">get_public_key_data</a>(it-&gt;second);</div>
<div class="line"><span class="lineno">  210</span>         compact_sig = <a class="code hl_function" href="namespacefc_1_1crypto_1_1r1.html#a69fb535e6486039f3d86e9d5dd3ab954">signature_from_ecdsa</a>(key, kd, sig, d);</div>
<div class="line"><span class="lineno">  211</span>      } <span class="keywordflow">catch</span>(chain::wallet_exception&amp;) {</div>
<div class="line"><span class="lineno">  212</span>         CFRelease(<a class="code hl_typedef" href="namespacefc.html#a50190ee8a24af6929033b058b16158c4">signature</a>);</div>
<div class="line"><span class="lineno">  213</span>         CFRelease(digestData);</div>
<div class="line"><span class="lineno">  214</span>         <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  215</span>      }</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>      CFRelease(<a class="code hl_typedef" href="namespacefc.html#a50190ee8a24af6929033b058b16158c4">signature</a>);</div>
<div class="line"><span class="lineno">  218</span>      CFRelease(digestData);</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>      <span class="keywordtype">char</span> serialized_signature[<span class="keyword">sizeof</span>(compact_sig) + 1];</div>
<div class="line"><span class="lineno">  221</span>      serialized_signature[0] = 0x01;</div>
<div class="line"><span class="lineno">  222</span>      <a class="code hl_function" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1">memcpy</a>(serialized_signature+1, compact_sig.data, <span class="keyword">sizeof</span>(compact_sig));</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span>      <a class="code hl_class" href="classfc_1_1crypto_1_1signature.html">signature_type</a> final_signature;</div>
<div class="line"><span class="lineno">  225</span>      <a class="code hl_class" href="classfc_1_1datastream.html">fc::datastream&lt;const char *&gt;</a> <a class="code hl_function" href="namespace_xbyak_1_1util.html#a4b2aef26182d21706896022467868f7c">ds</a>(serialized_signature, <span class="keyword">sizeof</span>(serialized_signature));</div>
<div class="line"><span class="lineno">  226</span>      <a class="code hl_function" href="namespacefc_1_1raw.html#a0b442d98ceb22dd5a6ae84745e43ffab">fc::raw::unpack</a>(ds, final_signature);</div>
<div class="line"><span class="lineno">  227</span>      <span class="keywordflow">return</span> final_signature;</div>
<div class="line"><span class="lineno">  228</span>   }</div>
<div class="ttc" id="aclassfc_1_1crypto_1_1signature_html"><div class="ttname"><a href="classfc_1_1crypto_1_1signature.html">fc::crypto::signature</a></div><div class="ttdef"><b>Definition</b> <a href="signature_8hpp_source.html#l00021">signature.hpp:22</a></div></div>
<div class="ttc" id="anamespacefc_1_1crypto_1_1r1_html_a69fb535e6486039f3d86e9d5dd3ab954"><div class="ttname"><a href="namespacefc_1_1crypto_1_1r1.html#a69fb535e6486039f3d86e9d5dd3ab954">fc::crypto::r1::signature_from_ecdsa</a></div><div class="ttdeci">compact_signature signature_from_ecdsa(const EC_KEY *key, const public_key_data &amp;pub, fc::ecdsa_sig &amp;sig, const fc::sha256 &amp;d)</div><div class="ttdef"><b>Definition</b> <a href="elliptic__r1_8cpp_source.html#l00136">elliptic_r1.cpp:136</a></div></div>
<div class="ttc" id="anamespacefc_1_1crypto_1_1r1_html_ae05a9b8a3e71b719d56c0a87c491a8f6"><div class="ttname"><a href="namespacefc_1_1crypto_1_1r1.html#ae05a9b8a3e71b719d56c0a87c491a8f6">fc::crypto::r1::compact_signature</a></div><div class="ttdeci">fc::array&lt; unsigned char, 65 &gt; compact_signature</div><div class="ttdef"><b>Definition</b> <a href="elliptic__r1_8hpp_source.html#l00024">elliptic_r1.hpp:24</a></div></div>
<div class="ttc" id="anamespacefc_html_a50190ee8a24af6929033b058b16158c4"><div class="ttname"><a href="namespacefc.html#a50190ee8a24af6929033b058b16158c4">fc::signature</a></div><div class="ttdeci">bytes signature</div><div class="ttdef"><b>Definition</b> <a href="pke_8hpp_source.html#l00017">pke.hpp:17</a></div></div>
<div class="ttc" id="ayubihsm__pkcs11_8c_html_a107648633008a7f2d872b4b3d98c2f96"><div class="ttname"><a href="yubihsm__pkcs11_8c.html#a107648633008a7f2d872b4b3d98c2f96">d</a></div><div class="ttdeci">CK_ULONG d</div><div class="ttdef"><b>Definition</b> <a href="yubihsm__pkcs11_8c_source.html#l01238">yubihsm_pkcs11.c:1238</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl_af55d7af9639ae410b25d61286e03912a_cgraph.png" border="0" usemap="#astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_af55d7af9639ae410b25d61286e03912a_cgraph" alt=""/></div>
<map name="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_af55d7af9639ae410b25d61286e03912a_cgraph" id="astructsysio_1_1wallet_1_1detail_1_1se__wallet__impl_af55d7af9639ae410b25d61286e03912a_cgraph">
<area shape="rect" title=" " alt="" coords="5,101,144,157"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a06cd1a5418bb1d4d6fd34a06d98479d7" title=" " alt="" coords="199,36,340,92"/>
<area shape="poly" title=" " alt="" coords="143,103,184,90,185,95,145,108"/>
<area shape="rect" href="yubihsm__pkcs11_8c.html#ae785d5badbf1f08b491af31f32a135a1" title=" " alt="" coords="438,19,509,45"/>
<area shape="poly" title=" " alt="" coords="95,99,135,57,162,37,191,21,252,6,314,3,373,8,423,17,422,22,373,13,314,9,252,12,193,26,164,41,139,61,98,103"/>
<area shape="rect" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html#a617c3932501399454678530512b48f57" title=" " alt="" coords="396,69,551,125"/>
<area shape="poly" title=" " alt="" coords="144,121,380,102,381,107,144,126"/>
<area shape="rect" href="namespacefc_1_1crypto_1_1r1.html#a69fb535e6486039f3d86e9d5dd3ab954" title=" " alt="" coords="192,166,348,207"/>
<area shape="poly" title=" " alt="" coords="145,147,184,159,183,164,144,152"/>
<area shape="rect" href="namespacefc_1_1raw.html#a0b442d98ceb22dd5a6ae84745e43ffab" title=" " alt="" coords="214,255,326,281"/>
<area shape="poly" title=" " alt="" coords="112,155,193,216,236,244,233,249,190,221,109,159"/>
<area shape="poly" title=" " alt="" coords="341,50,422,37,423,42,341,55"/>
<area shape="poly" title=" " alt="" coords="341,73,381,79,380,85,341,78"/>
<area shape="poly" title=" " alt="" coords="237,256,231,246,235,237,248,230,270,228,294,231,306,238,304,243,292,236,270,234,249,236,238,240,236,246,241,253"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a1b80313991e86ed845e8f6e4c1c49f6b" name="a1b80313991e86ed845e8f6e4c1c49f6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b80313991e86ed845e8f6e4c1c49f6b">&#9670;&#160;</a></span>_keys</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">map&lt;<a class="el" href="namespacesysio_1_1chain.html#a0628a11f388cd2e43b1ccc1260a1042f">public_key_type</a>,SecKeyRef&gt; sysio::wallet::detail::se_wallet_impl::_keys</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00260">260</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>

</div>
</div>
<a id="a29018169d2b644e215e3d1042074ec36" name="a29018169d2b644e215e3d1042074ec36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29018169d2b644e215e3d1042074ec36">&#9670;&#160;</a></span>key</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fc::ec_key sysio::wallet::detail::se_wallet_impl::key = EC_KEY_new_by_curve_name(NID_X9_62_prime256v1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00261">261</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>

</div>
</div>
<a id="aac922260d33409ae131ed50209403452" name="aac922260d33409ae131ed50209403452"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac922260d33409ae131ed50209403452">&#9670;&#160;</a></span>locked</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sysio::wallet::detail::se_wallet_impl::locked = true</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="se__wallet_8cpp_source.html#l00262">262</a> of file <a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>plugins/wallet_plugin/<a class="el" href="se__wallet_8cpp_source.html">se_wallet.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacesysio.html">sysio</a></li><li class="navelem"><a class="el" href="namespacesysio_1_1wallet.html">wallet</a></li><li class="navelem"><a class="el" href="namespacesysio_1_1wallet_1_1detail.html">detail</a></li><li class="navelem"><a class="el" href="structsysio_1_1wallet_1_1detail_1_1se__wallet__impl.html">se_wallet_impl</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
