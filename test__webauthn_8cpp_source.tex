\doxysection{test\+\_\+webauthn.\+cpp}
\hypertarget{test__webauthn_8cpp_source}{}\label{test__webauthn_8cpp_source}\index{libraries/fc/test/crypto/test\_webauthn.cpp@{libraries/fc/test/crypto/test\_webauthn.cpp}}
\mbox{\hyperlink{test__webauthn_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00001}\mbox{\hyperlink{test__webauthn_8cpp_a6b2a3852db8bb19ab6909bac01859985}{00001}}\ \textcolor{preprocessor}{\#define\ BOOST\_TEST\_MODULE\ webauthn\_test\_mod}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <boost/test/included/unit\_test.hpp>}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <boost/algorithm/string.hpp>}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{public__key_8hpp}{fc/crypto/public\_key.hpp}}>}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{private__key_8hpp}{fc/crypto/private\_key.hpp}}>}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{signature_8hpp}{fc/crypto/signature.hpp}}>}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{utility_8hpp}{fc/utility.hpp}}>}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00010}00010\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacefc_1_1crypto}{fc::crypto}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00011}00011\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacefc}{fc}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00012}00012\ \textcolor{keyword}{using\ namespace\ }std::literals;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00014}00014\ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1signature}{fc::crypto::webauthn::signature}}\ make\_webauthn\_sig(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1crypto_1_1r1_1_1private__key}{fc::crypto::r1::private\_key}}\&\ priv\_key,}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00015}00015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<uint8\_t>\&\ auth\_data,}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00016}00016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classfc_1_1json}{json}})\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00018}00018\ \ \ \ \textcolor{comment}{//webauthn\ signature\ is\ sha256(auth\_data\ ||\ client\_data\_hash)}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00019}00019\ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{fc::sha256}}\ client\_data\_hash\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(\mbox{\hyperlink{classfc_1_1json}{json}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00020}00020\ \ \ \ \mbox{\hyperlink{classfc_1_1sha256_1_1encoder}{fc::sha256::encoder}}\ e;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00021}00021\ \ \ \ e.\mbox{\hyperlink{classfc_1_1sha256_1_1encoder_a4a246dfb33e3eb78ba167446bee92e30}{write}}((\textcolor{keywordtype}{char}*)auth\_data.data(),\ auth\_data.size());}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00022}00022\ \ \ \ e.\mbox{\hyperlink{classfc_1_1sha256_1_1encoder_a4a246dfb33e3eb78ba167446bee92e30}{write}}(client\_data\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ client\_data\_hash.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}());}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00024}00024\ \ \ \ \mbox{\hyperlink{classfc_1_1array}{r1::compact\_signature}}\ sig\ =\ priv\_key.\mbox{\hyperlink{classfc_1_1crypto_1_1r1_1_1private__key_a9f54b768f15f9685167c846e2cdcd61e}{sign\_compact}}(e.\mbox{\hyperlink{classfc_1_1sha256_1_1encoder_a4d8b8181e912194cf98a56164671adf8}{result}}());}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00025}00025\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00026}00026\ \ \ \ \textcolor{keywordtype}{char}\ buff[8192];}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00027}00027\ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<char*>}}\ ds(buff,\ \textcolor{keyword}{sizeof}(buff));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00028}00028\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ sig);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00029}00029\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ auth\_data);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00030}00030\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ \mbox{\hyperlink{classfc_1_1json}{json}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00031}00031\ \ \ \ ds.seekp(0);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00033}00033\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1signature}{fc::crypto::webauthn::signature}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00034}00034\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00036}00036\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a3d854b6efad16a16e4d7b4539d4fc71f}{ret}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00037}00037\ \}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00039}00039\ \textcolor{comment}{//used\ for\ many\ below}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00040}00040\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1crypto_1_1r1_1_1private__key}{r1::private\_key}}\ priv\ =\ \mbox{\hyperlink{classfc_1_1crypto_1_1r1_1_1private__key_ad71aa7d73e57ef9fd7648fb7461177fb}{fc::crypto::r1::private\_key::generate}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00041}00041\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1crypto_1_1r1_1_1public__key}{r1::public\_key}}\ pub\ =\ priv.get\_public\_key();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00042}00042\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{fc::sha256}}\ d\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(\textcolor{stringliteral}{"{}sup"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00043}00043\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{fc::sha256}}\ origin\_hash\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(\textcolor{stringliteral}{"{}fctesting.invalid"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00045}00045\ BOOST\_AUTO\_TEST\_SUITE(webauthn\_suite)}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00047}00047\ \textcolor{comment}{//Good\ signature}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00048}\mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{00048}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(good)\ \mbox{\hyperlink{hello__driver_8cpp_abe4cc9788f52e49485473dc699537388}{try}}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00049}00049\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00050}00050\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00052}00052\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00054}00054\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00055}00055\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00056}00056\ \ \ \ BOOST\_CHECK\_EQUAL(wa\_pub,\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00057}\mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{00057}}\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00059}00059\ \textcolor{comment}{//A\ valid\ signature\ but\ shouldn't\ match\ public\ key\ due\ to\ presence\ difference}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00060}\mbox{\hyperlink{test__webauthn_8cpp_a8f1802f977a71adb7942a40d8e9f6c47}{00060}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(mismatch\_presence)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00061}00061\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_PRESENT,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00062}00062\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00064}00064\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00065}00065\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00066}00066\ \ \ \ auth\_data[32]\ |=\ 0x04;\ \textcolor{comment}{//User\ presence\ verified}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00068}00068\ \ \ \ BOOST\_CHECK\_NE(wa\_pub,\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00069}00069\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00071}00071\ \textcolor{comment}{//A\ valid\ signature\ but\ shouldn't\ match\ public\ key\ due\ to\ origin\ difference}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00072}\mbox{\hyperlink{test__webauthn_8cpp_a2a1d2f05f67659071e22f320ef91c0ef}{00072}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(mismatch\_origin)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00073}00073\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_PRESENT,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00074}00074\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://mallory.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00076}00076\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00077}00077\ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{fc::sha256}}\ mallory\_origin\_hash\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(\textcolor{stringliteral}{"{}mallory.invalid"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00078}00078\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ mallory\_origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(mallory\_origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00080}00080\ \ \ \ BOOST\_CHECK\_NE(wa\_pub,\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00081}00081\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00083}00083\ \textcolor{comment}{//A\ valid\ signature\ but\ shouldn't\ recover\ because\ http\ was\ in\ use\ instead\ of\ https}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00084}\mbox{\hyperlink{test__webauthn_8cpp_a4b9953c77aafa04553785736c43e07a5}{00084}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(non\_https)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00085}00085\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00086}00086\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}http://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00088}00088\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00089}00089\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00091}00091\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00092}00092\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ origin\ must\ begin\ with\ https://"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00093}00093\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00094}00094\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00096}00096\ \textcolor{comment}{//A\ valid\ signature\ but\ shouldn't\ recover\ because\ there\ is\ no\ origin\ scheme}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00097}\mbox{\hyperlink{test__webauthn_8cpp_a1a4dc27ff697dc8d69cbd8bfd3e41853}{00097}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(lacking\_scheme)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00098}00098\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00099}00099\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00101}00101\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00102}00102\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00104}00104\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00105}00105\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ origin\ must\ begin\ with\ https://"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00106}00106\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00107}00107\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00109}00109\ \textcolor{comment}{//A\ valid\ signature\ but\ shouldn't\ recover\ because\ empty\ origin}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00110}\mbox{\hyperlink{test__webauthn_8cpp_a010d0b81ec2257a446d8f9e1a43a4d4f}{00110}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(empty\_origin)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00111}00111\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00112}00112\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00114}00114\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00115}00115\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00117}00117\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00118}00118\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ origin\ must\ begin\ with\ https://"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00119}00119\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00120}00120\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00121}00121\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00122}00122\ \textcolor{comment}{//Good\ signature\ with\ a\ port}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00123}\mbox{\hyperlink{test__webauthn_8cpp_aae90fa97d890394d420629752fef64df}{00123}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(good\_port)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00124}00124\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00125}00125\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid:123456\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00127}00127\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00128}00128\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00130}00130\ \ \ \ BOOST\_CHECK\_EQUAL(wa\_pub,\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00131}00131\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00132}00132\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00133}00133\ \textcolor{comment}{//Good\ signature\ with\ an\ empty\ port}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00134}\mbox{\hyperlink{test__webauthn_8cpp_a4f19eaa04d61bbaa9324ee8d5ada9a90}{00134}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(empty\_port)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00135}00135\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00136}00136\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid:\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00137}00137\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00138}00138\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00139}00139\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00140}00140\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00141}00141\ \ \ \ BOOST\_CHECK\_EQUAL(wa\_pub,\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00142}00142\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00143}00143\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00144}00144\ \textcolor{comment}{//valid\ signature\ but\ with\ misc\ junk\ in\ challenge}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00145}\mbox{\hyperlink{test__webauthn_8cpp_a0ed9c663c1c7990474cb70a258ec9377}{00145}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(challenge\_junk)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00146}00146\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00147}00147\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \textcolor{stringliteral}{"{}blahBLAH"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00148}00148\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00149}00149\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00150}00150\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00151}00151\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00152}00152\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}},\ [](\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00153}00153\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}().find(\textcolor{stringliteral}{"{}sha256:\ size\ mismatch"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00154}00154\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00155}00155\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00157}00157\ \textcolor{comment}{//valid\ signature\ but\ with\ non\ base64\ in\ challenge}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00158}\mbox{\hyperlink{test__webauthn_8cpp_af58f9647f13c05324de3b3fa2d6aa328}{00158}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(challenge\_non\_base64)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00159}00159\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00160}00160\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \textcolor{stringliteral}{"{}hello@world\$"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00161}00161\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00162}00162\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00163}00163\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00164}00164\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00165}00165\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}},\ [](\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00166}00166\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}().find(\textcolor{stringliteral}{"{}encountered\ non-\/base64\ character"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00167}00167\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00168}00168\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00169}00169\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00170}00170\ \textcolor{comment}{//valid\ signature\ but\ with\ some\ other\ digest\ in\ the\ challenge\ that\ is\ not\ the\ one\ we\ are\ recovering\ from}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00171}\mbox{\hyperlink{test__webauthn_8cpp_abd36e135c2332d8f04b795dddc13a2f3}{00171}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(challenge\_wrong)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00172}00172\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00173}00173\ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{fc::sha256}}\ other\_digest\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(\textcolor{stringliteral}{"{}yo"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00174}00174\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(other\_digest.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ other\_digest.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00175}00175\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00176}00176\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00177}00177\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00179}00179\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00180}00180\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}Wrong\ webauthn\ challenge"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00181}00181\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00182}00182\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00183}00183\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00184}00184\ \textcolor{comment}{//valid\ signature\ but\ wrong\ webauthn\ type}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00185}\mbox{\hyperlink{test__webauthn_8cpp_a6d810d26f3a9ea62940516bbcbcf6b90}{00185}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(wrong\_type)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00186}00186\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00187}00187\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00188}00188\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.meh\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00189}00189\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00190}00190\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00191}00191\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00193}00193\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00194}00194\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ signature\ type\ not\ an\ assertion"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00195}00195\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00196}00196\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00198}00198\ \textcolor{comment}{//signature\ if\ good\ but\ the\ auth\_data\ rpid\ hash\ is\ not\ what\ is\ expected\ for\ origin}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00199}\mbox{\hyperlink{test__webauthn_8cpp_ad6a3dcec639ba94708fa05a8d82c891c}{00199}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(auth\_data\_rpid\_hash\_bad)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00200}00200\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00201}00201\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00203}00203\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00204}00204\ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{fc::sha256}}\ origin\_hash\_corrupt\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(\textcolor{stringliteral}{"{}fctesting.invalid"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00205}00205\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash\_corrupt.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash\_corrupt));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00206}00206\ \ \ \ auth\_data[4]++;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00208}00208\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00209}00209\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ rpid\ hash\ doesn't\ match\ origin"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00210}00210\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00211}00211\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00213}00213\ \textcolor{comment}{//signature\ if\ good\ but\ auth\_data\ too\ short\ to\ store\ what\ needs\ to\ be\ stored}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00214}\mbox{\hyperlink{test__webauthn_8cpp_a04cd22b50edfdbf19e9c068f6a7228e3}{00214}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(auth\_data\_too\_short)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00215}00215\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00216}00216\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00218}00218\ \ \ \ std::vector<uint8\_t>\ auth\_data(1);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00220}00220\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00221}00221\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}auth\_data\ not\ as\ large\ as\ required"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00222}00222\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00223}00223\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00224}00224\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00225}00225\ \textcolor{comment}{//Good\ signature\ but\ missing\ origin\ completely}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00226}\mbox{\hyperlink{test__webauthn_8cpp_af95c77a48776d8dc9544884aaeaf5946}{00226}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(missing\_origin)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00227}00227\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00228}00228\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00229}00229\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00230}00230\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00231}00231\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00232}00232\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00233}00233\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00234}00234\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ origin\ must\ begin\ with\ https://"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00235}00235\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00236}00236\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00237}00237\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00238}00238\ \textcolor{comment}{//Good\ signature\ but\ missing\ type\ completely}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00239}\mbox{\hyperlink{test__webauthn_8cpp_a91ac61998bf2fbd672164518842c3dbc}{00239}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(missing\_type)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00240}00240\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00241}00241\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00242}00242\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00243}00243\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00244}00244\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00245}00245\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00246}00246\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00247}00247\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ signature\ type\ not\ an\ assertion"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00248}00248\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00249}00249\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00250}00250\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00251}00251\ \textcolor{comment}{//Good\ signature\ but\ missing\ challenge\ completely}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00252}\mbox{\hyperlink{test__webauthn_8cpp_a0c364fa12210f90fb306e3948cd3e5b0}{00252}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(missing\_challenge)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00253}00253\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00254}00254\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00255}00255\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00256}00256\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00257}00257\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00258}00258\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00259}00259\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}},\ [](\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00260}00260\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}().find(\textcolor{stringliteral}{"{}sha256:\ size\ mismatch"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00261}00261\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00262}00262\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00263}00263\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00264}00264\ \textcolor{comment}{//Good\ signature\ with\ some\ extra\ stuff\ sprinkled\ in\ the\ json}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00265}\mbox{\hyperlink{test__webauthn_8cpp_a4fa4b484f47ac1bf70c7b2c99a91c9fb}{00265}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(good\_extrajunk)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00266}00266\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00267}00267\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}cool\(\backslash\)"{}:\(\backslash\)"{}beans\(\backslash\)"{},\(\backslash\)"{}obj\(\backslash\)"{}:\{\(\backslash\)"{}array\(\backslash\)"{}:[4,\ 5,\ 6]\},"{}}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}answer\(\backslash\)"{}:\ 42\ ,\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00269}00269\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00270}00270\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00271}00271\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00272}00272\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00273}00273\ \ \ \ BOOST\_CHECK\_EQUAL(wa\_pub,\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00274}00274\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00275}00275\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00276}00276\ \textcolor{comment}{//Good\ signature\ but\ it's\ not\ a\ JSON\ object!}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00277}\mbox{\hyperlink{test__webauthn_8cpp_a72e0ee1c4a2abdcc362828f8ca7f119d}{00277}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(not\_json\_object)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00278}00278\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00279}00279\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}hey\ man"{}}\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00280}00280\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00281}00281\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00282}00282\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00283}00283\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00284}00284\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00285}00285\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}Failed\ to\ parse\ client\ data\ JSON"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00286}00286\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00287}00287\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00288}00288\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00289}00289\ \textcolor{comment}{//damage\ the\ r/s\ portion\ of\ the\ signature}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00290}\mbox{\hyperlink{test__webauthn_8cpp_ad28a941550711577d070b4c59039fb47}{00290}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(damage\_sig)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00291}00291\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00292}00292\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00293}00293\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00294}00294\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00295}00295\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00296}00296\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00297}00297\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1signature}{webauthn::signature}}\ sig\ =\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00298}00298\ \ \ \ \textcolor{keywordtype}{char}\ buff[8192];}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00299}00299\ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<char*>}}\ ds(buff,\ \textcolor{keyword}{sizeof}(buff));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00300}00300\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ sig);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00301}00301\ \ \ \ buff[4]++;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00302}00302\ \ \ \ ds.seekp(0);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00303}00303\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ sig);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00304}00304\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00305}00305\ \ \ \ \textcolor{keywordtype}{bool}\ failed\_recovery\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00306}00306\ \ \ \ \textcolor{keywordtype}{bool}\ failed\_compare\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00307}00307\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ recovered\_pub;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00308}00308\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00309}00309\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00310}00310\ \ \ \ \ \ \ recovered\_pub\ =\ sig.\mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1signature_a28633b0f40d89bedb305e2343d9ac4ca}{recover}}(d,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00311}00311\ \ \ \ \ \ \ failed\_compare\ =\ !(wa\_pub\ ==\ recovered\_pub);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00312}00312\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00313}00313\ \ \ \ \textcolor{keywordflow}{catch}(\mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00314}00314\ \ \ \ \ \ \ failed\_recovery\ =\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}().find(\textcolor{stringliteral}{"{}unable\ to\ reconstruct\ public\ key\ from\ signature"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00315}00315\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00317}00317\ \ \ \ \textcolor{comment}{//We\ can\ fail\ either\ by\ failing\ to\ recover\ any\ key,\ or\ recovering\ the\ wrong\ key.\ Check\ that\ at\ least\ one\ of\ these\ failed}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00318}00318\ \ \ \ BOOST\_CHECK\_EQUAL(failed\_recovery\ ||\ failed\_compare,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00319}00319\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00320}00320\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00321}00321\ \textcolor{comment}{//damage\ the\ recovery\ index\ portion\ of\ the\ sig}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00322}\mbox{\hyperlink{test__webauthn_8cpp_a3f379acf17a88ae382a683f053192846}{00322}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(damage\_sig\_idx)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00323}00323\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00324}00324\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00325}00325\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00326}00326\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00327}00327\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00328}00328\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00329}00329\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1signature}{webauthn::signature}}\ sig\ =\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00330}00330\ \ \ \ \textcolor{keywordtype}{char}\ buff[8192];}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00331}00331\ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<char*>}}\ ds(buff,\ \textcolor{keyword}{sizeof}(buff));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00332}00332\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ sig);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00333}00333\ \ \ \ buff[0]++;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00334}00334\ \ \ \ ds.seekp(0);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00335}00335\ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ sig);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00337}00337\ \ \ \ \textcolor{keywordtype}{bool}\ failed\_recovery\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00338}00338\ \ \ \ \textcolor{keywordtype}{bool}\ failed\_compare\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00339}00339\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ recovered\_pub;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00340}00340\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00341}00341\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00342}00342\ \ \ \ \ \ \ recovered\_pub\ =\ sig.\mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1signature_a28633b0f40d89bedb305e2343d9ac4ca}{recover}}(d,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00343}00343\ \ \ \ \ \ \ failed\_compare\ =\ !(wa\_pub\ ==\ recovered\_pub);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00344}00344\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00345}00345\ \ \ \ \textcolor{keywordflow}{catch}(\mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00346}00346\ \ \ \ \ \ \ failed\_recovery\ =\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}().find(\textcolor{stringliteral}{"{}unable\ to\ reconstruct\ public\ key\ from\ signature"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00347}00347\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00348}00348\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00349}00349\ \ \ \ \textcolor{comment}{//We\ can\ fail\ either\ by\ failing\ to\ recover\ any\ key,\ or\ recovering\ the\ wrong\ key.\ Check\ that\ at\ least\ one\ of\ these\ failed}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00350}00350\ \ \ \ BOOST\_CHECK\_EQUAL(failed\_recovery\ ||\ failed\_compare,\ \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00351}00351\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00352}00352\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00353}00353\ \textcolor{comment}{//Good\ signature\ but\ with\ a\ different\ private\ key\ than\ was\ expecting}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00354}\mbox{\hyperlink{test__webauthn_8cpp_a297871fcd73110d766a978fe337ef1e5}{00354}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(different\_priv\_key)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00355}00355\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1r1_1_1private__key}{r1::private\_key}}\ other\_priv\ =\ \mbox{\hyperlink{classfc_1_1crypto_1_1r1_1_1private__key_ad71aa7d73e57ef9fd7648fb7461177fb}{fc::crypto::r1::private\_key::generate}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00356}00356\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00357}00357\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00358}00358\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00359}00359\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00360}00360\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00361}00361\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00362}00362\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00363}00363\ \ \ \ BOOST\_CHECK\_NE(wa\_pub,\ make\_webauthn\_sig(other\_priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00364}00364\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00365}00365\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00366}00366\ \textcolor{comment}{//Good\ signature\ but\ has\ empty\ json}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00367}\mbox{\hyperlink{test__webauthn_8cpp_ac9a2e889a79cc815fd3d36b6f8f77724}{00367}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(empty\_json)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00368}00368\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00369}00369\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00370}00370\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00371}00371\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00372}00372\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00373}00373\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00374}00374\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00375}00375\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}Failed\ to\ parse\ client\ data\ JSON"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00376}00376\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00377}00377\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00378}00378\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00379}00379\ \textcolor{comment}{//empty\ rpid\ not\ allowed\ for\ pub\ key}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00380}\mbox{\hyperlink{test__webauthn_8cpp_adc615b5851afd2b6e5668f9311758a45}{00380}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(empty\_rpid)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00381}00381\ \ \ \ \textcolor{keywordtype}{char}\ data[67]\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00382}00382\ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<char*>}}\ ds(data,\ \textcolor{keyword}{sizeof}(data));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00383}00383\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a931987c85fd408a620505ee9a1aa6f58}{pubkey}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00384}00384\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00385}00385\ \ \ \ BOOST\_CHECK\_EXCEPTION(\mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a931987c85fd408a620505ee9a1aa6f58}{pubkey}}),\ fc::assert\_exception,\ [](\textcolor{keyword}{const}\ fc::assert\_exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00386}00386\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.to\_detail\_string().find(\textcolor{stringliteral}{"{}webauthn\ pubkey\ must\ have\ non\ empty\ rpid"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00387}00387\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00388}00388\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00389}00389\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00390}00390\ \textcolor{comment}{//good\ sig\ but\ remove\ the\ trailing\ =,\ should\ still\ be\ accepted}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00391}\mbox{\hyperlink{test__webauthn_8cpp_a15cf1d57bbd4118800b640e96c012cd2}{00391}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(good\_no\_trailing\_equal)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00392}00392\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00393}00393\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00394}00394\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00395}00395\ \ \ \ boost::erase\_all(\mbox{\hyperlink{classfc_1_1json}{json}},\ \textcolor{stringliteral}{"{}="{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00396}00396\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00397}00397\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00398}00398\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00399}00399\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00400}00400\ \ \ \ BOOST\_CHECK\_EQUAL(wa\_pub,\ make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00401}00401\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00402}00402\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00403}00403\ \textcolor{comment}{//Before\ the\ base64\ decoder\ was\ adjusted\ to\ throw\ in\ error\ (pre-\/webauthn-\/merge),\ it\ would\ simply\ stop\ when\ encountering}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00404}00404\ \textcolor{comment}{//a\ non-\/base64\ char.\ This\ means\ it\ was\ possible\ for\ the\ following\ JSON\ \&\ challenge\ to\ validate\ completely\ correctly.\ Now\ it}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00405}00405\ \textcolor{comment}{//should\ not\ pass.}}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00406}\mbox{\hyperlink{test__webauthn_8cpp_a4567990f83744a1b06c7894321f28f7b}{00406}}\ \mbox{\hyperlink{test__webauthn_8cpp_a75805940106aba536c48e0c047fc814e}{BOOST\_AUTO\_TEST\_CASE}}(base64\_wonky)\ \textcolor{keyword}{try}\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00407}00407\ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1webauthn_1_1public__key}{webauthn::public\_key}}\ wa\_pub(pub.serialize(),\ webauthn::public\_key::user\_presence\_t::USER\_PRESENCE\_NONE,\ \textcolor{stringliteral}{"{}fctesting.invalid"{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00408}00408\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00409}00409\ \ \ \ std::string\ \mbox{\hyperlink{classfc_1_1json}{json}}\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}origin\(\backslash\)"{}:\(\backslash\)"{}https://fctesting.invalid\(\backslash\)"{},\(\backslash\)"{}type\(\backslash\)"{}:\(\backslash\)"{}webauthn.get\(\backslash\)"{},\(\backslash\)"{}challenge\(\backslash\)"{}:\(\backslash\)"{}"{}}\ +\ \mbox{\hyperlink{namespacefc_a4d30681e99b9cacc0c9b3b8985a5daa4}{fc::base64url\_encode}}(d.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ d.\mbox{\hyperlink{classfc_1_1sha256_ac7722b7428b1db345f1b7fab7f4d5774}{data\_size}}())\ +\ \textcolor{stringliteral}{"{}!@\#\$\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00410}00410\ \ \ \ boost::erase\_all(\mbox{\hyperlink{classfc_1_1json}{json}},\ \textcolor{stringliteral}{"{}="{}});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00411}00411\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00412}00412\ \ \ \ std::vector<uint8\_t>\ auth\_data(37);}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00413}00413\ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_ae785d5badbf1f08b491af31f32a135a1}{memcpy}}(auth\_data.data(),\ origin\_hash.\mbox{\hyperlink{classfc_1_1sha256_ab897537f6c524085b28049be51ed370d}{data}}(),\ \textcolor{keyword}{sizeof}(origin\_hash));}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00414}00414\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00415}00415\ \ \ \ BOOST\_CHECK\_EXCEPTION(make\_webauthn\_sig(priv,\ auth\_data,\ \mbox{\hyperlink{classfc_1_1json}{json}}).recover(d,\ \textcolor{keyword}{true}),\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}},\ [](\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00416}00416\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}().find(\textcolor{stringliteral}{"{}encountered\ non-\/base64\ character"{}})\ !=\ std::string::npos;}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00417}00417\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00418}00418\ \}\ \mbox{\hyperlink{test__webauthn_8cpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}();}
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00419}00419\ }
\DoxyCodeLine{\Hypertarget{test__webauthn_8cpp_source_l00420}00420\ BOOST\_AUTO\_TEST\_SUITE\_END()}

\end{DoxyCode}
