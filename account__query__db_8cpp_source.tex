\doxysection{account\+\_\+query\+\_\+db.\+cpp}
\hypertarget{account__query__db_8cpp_source}{}\label{account__query__db_8cpp_source}\index{plugins/chain\_plugin/account\_query\_db.cpp@{plugins/chain\_plugin/account\_query\_db.cpp}}
\mbox{\hyperlink{account__query__db_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{account__query__db_8hpp}{sysio/chain\_plugin/account\_query\_db.hpp}}>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{contract__types_8hpp}{sysio/chain/contract\_types.hpp}}>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{controller_8hpp}{sysio/chain/controller.hpp}}>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{permission__object_8hpp}{sysio/chain/permission\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <boost/multi\_index\_container.hpp>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <boost/multi\_index/ordered\_index.hpp>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <boost/multi\_index/composite\_key.hpp>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <boost/multi\_index/member.hpp>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <boost/bimap.hpp>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <boost/bimap/multiset\_of.hpp>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <boost/bimap/set\_of.hpp>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00016}00016\ \textcolor{preprocessor}{\#include\ <shared\_mutex>}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00018}00018\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacesysio}{sysio}};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00019}00019\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacesysio_1_1chain_1_1literals}{sysio::chain::literals}};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00020}00020\ \textcolor{keyword}{using\ namespace\ }boost::multi\_index;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00021}00021\ \textcolor{keyword}{using\ namespace\ }boost::bimaps;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00023}00023\ \textcolor{keyword}{namespace\ }\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00028}00028\ \ \ \ \textcolor{keyword}{struct\ }permission\_info\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00029}00029\ \ \ \ \ \ \ \textcolor{comment}{//\ indexed\ data}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00030}00030\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{chain::name}}\ \ \ \ owner;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00031}00031\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{chain::name}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00032}00032\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ last\_updated\_height;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00034}00034\ \ \ \ \ \ \ \textcolor{comment}{//\ un-\/indexed\ data}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00035}00035\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ threshold;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00037}00037\ \ \ \ \ \ \ \textcolor{keyword}{using\ }cref\ =\ std::reference\_wrapper<const\ permission\_info>;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00038}00038\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00040}00040\ \ \ \ \textcolor{keyword}{struct\ }by\_owner\_name;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00041}00041\ \ \ \ \textcolor{keyword}{struct\ }by\_last\_updated\_height;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00046}00046\ \ \ \ \textcolor{keyword}{using\ }permission\_info\_index\_t\ =\ multi\_index\_container<}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00047}00047\ \ \ \ \ \ \ permission\_info,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00048}00048\ \ \ \ \ \ \ indexed\_by<}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00049}00049\ \ \ \ \ \ \ \ \ \ ordered\_unique<}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ tag<by\_owner\_name>,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ composite\_key<permission\_info,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ member<permission\_info,\ chain::name,\ \&permission\_info::owner>,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ member<permission\_info,\ chain::name,\ \&permission\_info::name>}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ >}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00055}00055\ \ \ \ \ \ \ \ \ \ >,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00056}00056\ \ \ \ \ \ \ \ \ \ ordered\_non\_unique<}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ tag<by\_last\_updated\_height>,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ member<permission\_info,\ uint32\_t,\ \&permission\_info::last\_updated\_height>}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00059}00059\ \ \ \ \ \ \ \ \ \ >}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00060}00060\ \ \ \ \ \ \ >}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00061}00061\ \ \ \ >;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00068}00068\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacesysio_1_1chain_a9a9946a27c3832394b9b2b3911e0733c}{is\_onblock}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{chain::transaction\_trace\_ptr}}\&\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}})\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00069}00069\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}-\/>action\_traces.empty())}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00071}00071\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ act\ =\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}-\/>action\_traces[0].act;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00072}00072\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (act.account\ !=\ sysio::chain::config::system\_account\_name\ ||\ act.name\ !=\ \textcolor{stringliteral}{"{}onblock"{}}\_n\ ||}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ act.authorization.size()\ !=\ 1)}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00075}00075\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ auth\ =\ act.authorization[0];}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00076}00076\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ auth.actor\ ==\ sysio::chain::config::system\_account\_name\ \&\&}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ auth.permission\ ==\ sysio::chain::config::active\_name;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00078}00078\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00080}00080\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00081}00081\ \ \ \ \textcolor{keyword}{struct\ }weighted\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00082}00082\ \ \ \ \ \ \ \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00083}00083\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_abb0a383cca5adde7807bbcc3c48840d4}{chain::weight\_type}}\ \ weight;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00085}00085\ \ \ \ \ \ \ \textcolor{keyword}{static}\ weighted\ lower\_bound\_for(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}}\&\ value\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}},\ std::numeric\_limits<chain::weight\_type>::min()\};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00087}00087\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00088}00088\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00089}00089\ \ \ \ \ \ \ \textcolor{keyword}{static}\ weighted\ upper\_bound\_for(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}}\&\ value\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{pkcs11_8h_a32aff7c6c4cd253fdf6563677afab5ce}{value}},\ std::numeric\_limits<chain::weight\_type>::max()\};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00091}00091\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00092}00092\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00094}00094\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Output,\ \textcolor{keyword}{typename}\ Input>}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00095}00095\ \ \ \ \textcolor{keyword}{auto}\ make\_optional\_authorizer(\textcolor{keyword}{const}\ Input\&\ authorizer)\ -\/>\ std::optional<Output>\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00096}00096\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same\_v<Input,\ Output>)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ authorizer;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00098}00098\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00100}00100\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00101}00101\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00102}00102\ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00104}00104\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacestd}{std}}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00108}00108\ \ \ \ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00109}\mbox{\hyperlink{structstd_1_1less_3_01permission__info_1_1cref_01_4}{00109}}\ \ \ \ \textcolor{keyword}{struct\ }less<permission\_info::cref>\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00110}\mbox{\hyperlink{structstd_1_1less_3_01permission__info_1_1cref_01_4_a06506be0139ee5e4eabeaf489798fd29}{00110}}\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structstd_1_1less_3_01permission__info_1_1cref_01_4_a06506be0139ee5e4eabeaf489798fd29}{operator()}}(\ \textcolor{keyword}{const}\ permission\_info::cref\&\ lhs,\ \textcolor{keyword}{const}\ permission\_info::cref\&\ rhs\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::uintptr\_t(\&lhs.get())\ <\ std::uintptr\_t(\&rhs.get());}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00112}00112\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00113}00113\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00118}00118\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00119}\mbox{\hyperlink{structstd_1_1less_3_01weighted_3_01_t_01_4_01_4}{00119}}\ \ \ \ \textcolor{keyword}{struct\ }less<weighted<\mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}}>>\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00120}\mbox{\hyperlink{structstd_1_1less_3_01weighted_3_01_t_01_4_01_4_a1a6a1e94171e4c0cd4fcfd49deec7382}{00120}}\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structstd_1_1less_3_01weighted_3_01_t_01_4_01_4_a1a6a1e94171e4c0cd4fcfd49deec7382}{operator()}}(\ \textcolor{keyword}{const}\ weighted<T>\&\ lhs,\ \textcolor{keyword}{const}\ weighted<T>\&\ rhs\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::tie(lhs.value,\ lhs.weight)\ <\ std::tie(rhs.value,\ rhs.weight);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00122}00122\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00123}00123\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00124}00124\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00125}00125\ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00127}00127\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio_1_1chain__apis}{sysio::chain\_apis}}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00131}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl}{00131}}\ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl}{account\_query\_db\_impl}}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00132}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a7159b63787fb0ccdda7f45536bbbdf03}{00132}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a7159b63787fb0ccdda7f45536bbbdf03}{account\_query\_db\_impl}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{chain::controller}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}})}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00133}00133\ \ \ \ \ \ \ :\mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}(\mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}})}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00134}00134\ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00135}00135\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00140}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a9e19a7f902401bfa1de26cb0924c380f}{00140}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a9e19a7f902401bfa1de26cb0924c380f}{build\_account\_query\_map}}()\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00141}00141\ \ \ \ \ \ \ \ \ \ std::unique\_lock\ write\_lock(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ad111bde83946593be763eeb7e3541fdf}{rw\_mutex}});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Building\ account\ query\ DB"{}});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ start\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ index\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a4e24a1668746342d40487d1019880986}{chain::permission\_index}}>().indices().get<by\_id>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ build\ a\ initial\ time\ to\ block\ number\ map}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ lib\_num\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a53495de416021a4e56e889e771b25a52}{last\_irreversible\_block\_num}}();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ head\_num\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00151}00151\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num\ =\ lib\_num\ +\ 1;\ block\_num\ <=\ head\_num;\ block\_num++)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ block\_p\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1379e43325b7e517a058bddce15571eb}{fetch\_block\_by\_number}}(block\_num);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00153}00153\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(block\_p,\ chain::plugin\_exception,\ \textcolor{stringliteral}{"{}cannot\ fetch\ reversible\ block\ \$\{block\_num\},\ required\ for\ account\_db\ initialization"{}},\ (\textcolor{stringliteral}{"{}block\_num"{}},\ block\_num));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}}.emplace(block\_p-\/>timestamp.to\_time\_point(),\ block\_num);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00155}00155\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00157}00157\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ po\ :\ index\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00158}00158\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ last\_updated\_height\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a2789aac6391a10191d5aeb728fbe6410}{last\_updated\_time\_to\_height}}(po.last\_updated);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00159}00159\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pi\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aba57026fbb7d549b2431c788a5bd3a2d}{permission\_info\_index}}.emplace(\ permission\_info\{\ po.owner,\ po.name,\ last\_updated\_height,\ po.auth.threshold\ \}\ ).first;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00160}00160\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a8fda1043cb0c69e99385511e8a23c50f}{add\_to\_bimaps}}(*pi,\ po);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00162}00162\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ duration\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ -\/\ start;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Finished\ building\ account\ query\ DB\ in\ \$\{sec\}"{}},\ (\textcolor{stringliteral}{"{}sec"{}},\ (duration.count()\ /\ 1'000'000.0\ )));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00164}00164\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00171}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a8fda1043cb0c69e99385511e8a23c50f}{00171}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a8fda1043cb0c69e99385511e8a23c50f}{add\_to\_bimaps}}(\ \textcolor{keyword}{const}\ permission\_info\&\ pi,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1permission__object}{chain::permission\_object}}\&\ po\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ each\ account,\ add\ this\ permission\ info's\ non-\/owning\ reference\ to\ the\ bimap\ for\ accounts}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ :\ po.auth.\mbox{\hyperlink{structsysio_1_1chain_1_1shared__authority_a72a2e362bf5730b766f0eca81e6dd3b2}{accounts}})\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}}.insert(name\_bimap\_t::value\_type\ \{\{\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.permission,\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.weight\},\ pi\});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00176}00176\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ key,\ add\ this\ permission\ info's\ non-\/owning\ reference\ to\ the\ bimap\ for\ keys}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ k:\ po.auth.\mbox{\hyperlink{structsysio_1_1chain_1_1shared__authority_ae3fd05d8cc108e26ea6eac205f1c5150}{keys}})\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1crypto_1_1public__key}{chain::public\_key\_type}}\ key\ =\ k.key;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adaaa7d466a003a720717341ca7fda6c5}{key\_bimap}}.insert(key\_bimap\_t::value\_type\ \{\{std::move(key),\ k.weight\},\ pi\});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00182}00182\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00183}00183\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00188}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a91acce27e2dee3eee42bc63d1d589919}{00188}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a91acce27e2dee3eee42bc63d1d589919}{remove\_from\_bimaps}}(\ \textcolor{keyword}{const}\ permission\_info\&\ pi\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ remove\ all\ entries\ from\ the\ name\ bimap\ that\ refer\ to\ this\ permission\_info's\ reference}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ name\_range\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}}.right.equal\_range(pi);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00191}00191\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}}.right.erase(name\_range.first,\ name\_range.second);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00193}00193\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ remove\ all\ entries\ from\ the\ key\ bimap\ that\ refer\ to\ this\ permission\_info's\ reference}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00194}00194\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ key\_range\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adaaa7d466a003a720717341ca7fda6c5}{key\_bimap}}.right.equal\_range(pi);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00195}00195\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adaaa7d466a003a720717341ca7fda6c5}{key\_bimap}}.right.erase(key\_range.first,\ key\_range.second);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00196}00196\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00198}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a0f81334b9ee80d92a1971d03e0bb0e36}{00198}}\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a0f81334b9ee80d92a1971d03e0bb0e36}{is\_rollback\_required}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00199}00199\ \ \ \ \ \ \ \ \ \ std::shared\_lock\ read\_lock(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ad111bde83946593be763eeb7e3541fdf}{rw\_mutex}});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00200}00200\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ bnum\ =\ bsp-\/>block-\/>block\_num();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00201}00201\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ index\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aba57026fbb7d549b2431c788a5bd3a2d}{permission\_info\_index}}.get<by\_last\_updated\_height>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (index.empty())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00205}00205\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pi\ =\ (*index.rbegin());}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pi.last\_updated\_height\ <\ bnum)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00211}00211\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00212}00212\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00213}00213\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00214}00214\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00215}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a2789aac6391a10191d5aeb728fbe6410}{00215}}\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a2789aac6391a10191d5aeb728fbe6410}{last\_updated\_time\_to\_height}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\&\ last\_updated)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ lib\_num\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a53495de416021a4e56e889e771b25a52}{last\_irreversible\_block\_num}}();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00217}00217\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ lib\_time\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a878ff6368c473051417382a9d485030d}{last\_irreversible\_block\_time}}();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00218}00218\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ last\_updated\_height\ =\ lib\_num;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (last\_updated\ >\ lib\_time)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ iter\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}}.find(last\_updated);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00222}00222\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(iter\ !=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}}.end(),\ chain::plugin\_exception,\ \textcolor{stringliteral}{"{}invalid\ block\ time\ encountered\ in\ on-\/chain\ accounts\ \$\{time\}"{}},\ (\textcolor{stringliteral}{"{}time"{}},\ last\_updated));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00223}00223\ \ \ \ \ \ \ \ \ \ \ \ \ last\_updated\_height\ =\ iter-\/>second;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00225}00225\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ last\_updated\_height;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00227}00227\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00228}00228\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00237}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a55b5594b7d59cd2c7c38207cb988a44c}{00237}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a55b5594b7d59cd2c7c38207cb988a44c}{rollback\_to\_before}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00238}00238\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ bnum\ =\ bsp-\/>block-\/>block\_num();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00239}00239\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ index\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aba57026fbb7d549b2431c788a5bd3a2d}{permission\_info\_index}}.get<by\_last\_updated\_height>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00240}00240\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ permission\_by\_owner\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a4e24a1668746342d40487d1019880986}{chain::permission\_index}}>().indices().get<chain::by\_owner>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00242}00242\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ roll\ back\ time-\/map}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00243}00243\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ time\_iter\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}}.rbegin();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00244}00244\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (time\_iter\ !=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}}.rend()\ \&\&\ time\_iter-\/>second\ >=\ bnum)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00245}00245\ \ \ \ \ \ \ \ \ \ \ \ \ time\_iter\ =\ \textcolor{keyword}{decltype}(time\_iter)\{\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}}.erase(\ std::next(time\_iter).base()\ )\};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00247}00247\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00248}00248\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ curr\_iter\ =\ index.rbegin();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00249}00249\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!index.empty())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00250}00250\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (curr\_iter\ ==\ index.rend())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00251}00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00252}00252\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00253}00253\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pi\ =\ (*curr\_iter);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pi.last\_updated\_height\ <\ bnum)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00258}00258\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ remove\ this\ entry\ from\ the\ bimaps}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00260}00260\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a91acce27e2dee3eee42bc63d1d589919}{remove\_from\_bimaps}}(pi);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00261}00261\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00262}00262\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ permission\_by\_owner.find(std::make\_tuple(pi.owner,\ pi.name));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (itr\ ==\ permission\_by\_owner.end())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00264}00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ permission\ does\ not\ exist\ at\ this\ point\ in\ the\ chains\ history}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00265}00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ curr\_iter\ =\ \textcolor{keyword}{decltype}(curr\_iter)(\ index.erase(index.iterator\_to(pi))\ );}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ po\ =\ *itr;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00268}00268\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ last\_updated\_height\ =\ po.last\_updated\ ==\ bsp-\/>header.timestamp\ ?\ bsp-\/>block\_num\ :\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a2789aac6391a10191d5aeb728fbe6410}{last\_updated\_time\_to\_height}}(po.last\_updated);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00271}00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index.modify(index.iterator\_to(pi),\ [\&po,\ last\_updated\_height](\textcolor{keyword}{auto}\&\ mutable\_pi)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00272}00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mutable\_pi.last\_updated\_height\ =\ last\_updated\_height;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00273}00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mutable\_pi.threshold\ =\ po.auth.threshold;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00274}00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00275}00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a8fda1043cb0c69e99385511e8a23c50f}{add\_to\_bimaps}}(pi,\ po);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00276}00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++curr\_iter;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00278}00278\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00279}00279\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00280}00280\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00286}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_af06f4fce80c950b9b1c20a552b4a2a15}{00286}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_af06f4fce80c950b9b1c20a552b4a2a15}{cache\_transaction\_trace}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{chain::transaction\_trace\_ptr}}\&\ trace\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00287}00287\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !trace-\/>receipt\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00288}00288\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ include\ only\ executed\ transactions;\ soft\_fail\ included\ so\ that\ onerror\ (and\ any\ inlines\ via\ onerror)\ are\ included}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00289}00289\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((trace-\/>receipt-\/>status\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{chain::transaction\_receipt\_header::executed}}\ \&\&}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00290}00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>receipt-\/>status\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a98d0df834b74445e549f5d2123443b4e}{chain::transaction\_receipt\_header::soft\_fail}}))\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00291}00291\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00293}00293\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a9a9946a27c3832394b9b2b3911e0733c}{is\_onblock}}(\ trace\ ))\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00294}00294\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6a6e477d5ab8af17385632e6cc16bbdd}{onblock\_trace}}.emplace(\ trace\ );}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00295}00295\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ trace-\/>failed\_dtrx\_trace\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00296}00296\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_acfb769f3aefd6346ad9172f6726d253d}{cached\_trace\_map}}[trace-\/>failed\_dtrx\_trace-\/>id]\ =\ trace;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00297}00297\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00298}00298\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_acfb769f3aefd6346ad9172f6726d253d}{cached\_trace\_map}}[trace-\/>id]\ =\ trace;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00299}00299\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00300}00300\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00301}00301\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00302}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a80e7966e67f2a780ce1f804ca2239f4c}{00302}}\ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a80e7966e67f2a780ce1f804ca2239f4c}{permission\_set\_t}}\ =\ std::set<chain::permission\_level>;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00308}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aa224e5ba2c6565d1626adbd9cc9d997a}{00308}}\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aa224e5ba2c6565d1626adbd9cc9d997a}{commit\_block\_prelock}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00309}00309\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a80e7966e67f2a780ce1f804ca2239f4c}{permission\_set\_t}}\ updated;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00310}00310\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a80e7966e67f2a780ce1f804ca2239f4c}{permission\_set\_t}}\ deleted;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00311}00311\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00316}00316\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ process\_trace\ =\ [\&](\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{chain::transaction\_trace\_ptr}}\&\ trace)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ at\ :\ trace-\/>action\_traces\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00318}00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::tie(at.receiver,\ at.act.account)\ !=\ std::tie(chain::config::system\_account\_name,chain::config::system\_account\_name))\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00319}00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00321}00321\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (at.act.name\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1updateauth_afc31c0680242885924f64fc347780814}{chain::updateauth::get\_name}}())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ data\ =\ at.act.data\_as<\mbox{\hyperlink{structsysio_1_1chain_1_1updateauth}{chain::updateauth}}>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00324}00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ updated.emplace(\mbox{\hyperlink{structsysio_1_1chain_1_1permission__level}{chain::permission\_level}}\{data.account,\ data.permission\}).first;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ deleted.erase(*itr);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00326}00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (at.act.name\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1deleteauth_add712cbf63b55d0e2db2b874dca6576d}{chain::deleteauth::get\_name}}())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ data\ =\ at.act.data\_as<\mbox{\hyperlink{structsysio_1_1chain_1_1deleteauth}{chain::deleteauth}}>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00328}00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ deleted.emplace(\mbox{\hyperlink{structsysio_1_1chain_1_1permission__level}{chain::permission\_level}}\{data.account,\ data.permission\}).first;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ updated.erase(*itr);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (at.act.name\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1newaccount_a962c693e8d73cb4314453c348ababbde}{chain::newaccount::get\_name}}())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ data\ =\ at.act.data\_as<\mbox{\hyperlink{structsysio_1_1chain_1_1newaccount}{chain::newaccount}}>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ updated.emplace(\mbox{\hyperlink{structsysio_1_1chain_1_1permission__level}{chain::permission\_level}}\{data.name,\ \textcolor{stringliteral}{"{}owner"{}}\_n\});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ updated.emplace(\mbox{\hyperlink{structsysio_1_1chain_1_1permission__level}{chain::permission\_level}}\{data.name,\ \textcolor{stringliteral}{"{}active"{}}\_n\});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00335}00335\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00336}00336\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00337}00337\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00338}00338\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6a6e477d5ab8af17385632e6cc16bbdd}{onblock\_trace}}\ )}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00339}00339\ \ \ \ \ \ \ \ \ \ \ \ \ process\_trace(*\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6a6e477d5ab8af17385632e6cc16bbdd}{onblock\_trace}});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00340}00340\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00341}00341\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}\ :\ bsp-\/>block-\/>transactions\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00342}00342\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{chain::transaction\_id\_type}}\ \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<chain::transaction\_id\_type>(\mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.trx))\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00344}00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{id}\ =\ std::get<chain::transaction\_id\_type>(\mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.trx);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00345}00345\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00346}00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{id}\ =\ std::get<chain::packed\_transaction>(\mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.trx).id();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00347}00347\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00348}00348\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00349}00349\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ it\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_acfb769f3aefd6346ad9172f6726d253d}{cached\_trace\_map}}.find(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00350}00350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ it\ !=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_acfb769f3aefd6346ad9172f6726d253d}{cached\_trace\_map}}.end()\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ process\_trace(\ it-\/>second\ );}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00352}00352\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00353}00353\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00354}00354\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_tuple(std::move(updated),\ std::move(deleted),\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a0f81334b9ee80d92a1971d03e0bb0e36}{is\_rollback\_required}}(bsp));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00356}00356\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00357}00357\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00363}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aa184af1bc686f0c89bb5837f05ef30fb}{00363}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aa184af1bc686f0c89bb5837f05ef30fb}{commit\_block}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00364}00364\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a80e7966e67f2a780ce1f804ca2239f4c}{permission\_set\_t}}\ updated;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00365}00365\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a80e7966e67f2a780ce1f804ca2239f4c}{permission\_set\_t}}\ deleted;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00366}00366\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ rollback\_required\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00367}00367\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00368}00368\ \ \ \ \ \ \ \ \ \ std::tie(updated,\ deleted,\ rollback\_required)\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aa224e5ba2c6565d1626adbd9cc9d997a}{commit\_block\_prelock}}(bsp);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00369}00369\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ optimistic\ skip\ of\ locking\ section\ if\ there\ is\ nothing\ to\ do}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00371}00371\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!updated.empty()\ ||\ !deleted.empty()\ ||\ rollback\_required)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_lock\ write\_lock(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ad111bde83946593be763eeb7e3541fdf}{rw\_mutex}});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00373}00373\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00374}00374\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a55b5594b7d59cd2c7c38207cb988a44c}{rollback\_to\_before}}(bsp);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00375}00375\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ insert\ this\ blocks\ time\ into\ the\ time\ map}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00377}00377\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}}.emplace(bsp-\/>header.timestamp,\ bsp-\/>block\_num);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00378}00378\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00379}00379\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ bnum\ =\ bsp-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00380}00380\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ index\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aba57026fbb7d549b2431c788a5bd3a2d}{permission\_info\_index}}.get<by\_owner\_name>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00381}00381\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ permission\_by\_owner\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a4e24a1668746342d40487d1019880986}{chain::permission\_index}}>().indices().get<chain::by\_owner>();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00382}00382\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00383}00383\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ updated\ permission,\ find\ the\ new\ values\ and\ update\ the\ account\ query\ db}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ up:\ updated)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ key\ =\ std::make\_tuple(up.actor,\ up.permission);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00386}00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ source\_itr\ =\ permission\_by\_owner.find(key);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00387}00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(source\_itr\ !=\ permission\_by\_owner.end(),\ chain::plugin\_exception,\ \textcolor{stringliteral}{"{}chain\ data\ is\ missing"{}});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00388}00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ index.find(key);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00389}00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (itr\ ==\ index.end())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00390}00390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ po\ =\ *source\_itr;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00391}00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ itr\ =\ index.emplace(permission\_info\{\ po.owner,\ po.name,\ bnum,\ po.auth.threshold\ \}).first;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00392}00392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00393}00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a91acce27e2dee3eee42bc63d1d589919}{remove\_from\_bimaps}}(*itr);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00394}00394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index.modify(itr,\ [\&](\textcolor{keyword}{auto}\&\ mutable\_pi)\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00395}00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mutable\_pi.last\_updated\_height\ =\ bnum;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mutable\_pi.threshold\ =\ source\_itr-\/>auth.threshold;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00397}00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00398}00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00399}00399\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a8fda1043cb0c69e99385511e8a23c50f}{add\_to\_bimaps}}(*itr,\ *source\_itr);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00401}00401\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00402}00402\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00403}00403\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ all\ deleted\ permissions,\ process\ their\ removal\ from\ the\ account\ query\ DB}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00404}00404\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ dp:\ deleted)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00405}00405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ key\ =\ std::make\_tuple(dp.actor,\ dp.permission);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ index.find(key);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (itr\ !=\ index.end())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a91acce27e2dee3eee42bc63d1d589919}{remove\_from\_bimaps}}(*itr);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ index.erase(itr);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00410}00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00411}00411\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00413}00413\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ drop\ any\ unprocessed\ cached\ traces}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_acfb769f3aefd6346ad9172f6726d253d}{cached\_trace\_map}}.clear();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6a6e477d5ab8af17385632e6cc16bbdd}{onblock\_trace}}.reset();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00417}00417\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00418}00418\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00419}00419\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__result}{account\_query\_db::get\_accounts\_by\_authorizers\_result}}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00420}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a12a133f315d14e1fda76e6ee64e0c078}{00420}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a12a133f315d14e1fda76e6ee64e0c078}{get\_accounts\_by\_authorizers}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params}{account\_query\_db::get\_accounts\_by\_authorizers\_params}}\&\ args)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00421}00421\ \ \ \ \ \ \ \ \ \ std::shared\_lock\ read\_lock(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ad111bde83946593be763eeb7e3541fdf}{rw\_mutex}});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00422}00422\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }result\_t\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__result}{account\_query\_db::get\_accounts\_by\_authorizers\_result}};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00424}00424\ \ \ \ \ \ \ \ \ \ result\_t\ result;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00425}00425\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00426}00426\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ deduplicate\ inputs}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00427}00427\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ account\_set\ =\ std::set<chain::permission\_level>(args.\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params_a3a982b7949e6e5b9ea508448c1f8d8af}{accounts}}.begin(),\ args.\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params_a3a982b7949e6e5b9ea508448c1f8d8af}{accounts}}.end());}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ key\_set\ =\ std::set<chain::public\_key\_type>(args.\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params_a1b6ac4031438d3bc900894f085c94142}{keys}}.begin(),\ args.\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params_a1b6ac4031438d3bc900894f085c94142}{keys}}.end());}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00429}00429\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ push\_results\ =\ [\&result](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ begin,\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ end)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00434}00434\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ itr\ =\ begin;\ itr\ !=\ end;\ ++itr)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00435}00435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pi\ =\ itr-\/>second.get();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ authorizer\ =\ itr-\/>first.value;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ weight\ =\ itr-\/>first.weight;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00438}00438\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result.accounts.emplace\_back(result\_t::account\_result\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pi.owner,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pi.name,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00442}00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ make\_optional\_authorizer<chain::permission\_level>(authorizer),}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00443}00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ make\_optional\_authorizer<chain::public\_key\_type>(authorizer),}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ weight,}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00445}00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pi.threshold}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00446}00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00447}00447\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00448}00448\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00449}00449\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00450}00450\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00451}00451\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}:\ account\_set)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00452}00452\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.permission.empty())\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00453}00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ empty\ permission\ is\ a\ wildcard}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00454}00454\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ construct\ a\ range\ between\ the\ lower\ bound\ of\ the\ given\ account\ and\ the\ lower\ bound\ of\ the}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00455}00455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ next\ possible\ account\ name}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00456}00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ begin\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}}.left.lower\_bound(weighted<chain::permission\_level>::lower\_bound\_for(\{\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.actor,\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.permission\}));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00457}00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ next\_account\_name\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{chain::name}}(\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.actor.to\_uint64\_t()\ +\ 1);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00458}00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ end\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}}.left.lower\_bound(weighted<chain::permission\_level>::lower\_bound\_for(\{next\_account\_name,\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.permission\}));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00459}00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ push\_results(begin,\ end);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00460}00460\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00461}00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ construct\ a\ range\ of\ all\ possible\ weights\ for\ an\ account/permission\ pair}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00462}00462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1permission__level}{chain::permission\_level}}\{\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.actor,\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.permission\};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00463}00463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ begin\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}}.left.lower\_bound(weighted<chain::permission\_level>::lower\_bound\_for(\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00464}00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ end\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}}.left.upper\_bound(weighted<chain::permission\_level>::upper\_bound\_for(\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00465}00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ push\_results(begin,\ end);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00466}00466\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00467}00467\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00468}00468\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00469}00469\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ k:\ key\_set)\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00470}00470\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ construct\ a\ range\ of\ all\ possible\ weights\ for\ a\ key}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00471}00471\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ begin\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adaaa7d466a003a720717341ca7fda6c5}{key\_bimap}}.left.lower\_bound(weighted<chain::public\_key\_type>::lower\_bound\_for(k));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00472}00472\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ end\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adaaa7d466a003a720717341ca7fda6c5}{key\_bimap}}.left.upper\_bound(weighted<chain::public\_key\_type>::upper\_bound\_for(k));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00473}00473\ \ \ \ \ \ \ \ \ \ \ \ \ push\_results(begin,\ end);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00474}00474\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00475}00475\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00476}00476\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00477}00477\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00478}00478\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00482}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_af147fd6d9ed179c6f379965feb0579a6}{00482}}\ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_af147fd6d9ed179c6f379965feb0579a6}{cached\_trace\_map\_t}}\ =\ std::map<chain::transaction\_id\_type,\ chain::transaction\_trace\_ptr>;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00483}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_abdd57326fce804f4a467539158816e88}{00483}}\ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_abdd57326fce804f4a467539158816e88}{onblock\_trace\_t}}\ =\ std::optional<chain::transaction\_trace\_ptr>;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00484}00484\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00485}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a0eaaa63915f583ca51f38307d557f7e9}{00485}}\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{chain::controller}}\&\ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a0eaaa63915f583ca51f38307d557f7e9}{controller}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00486}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_acfb769f3aefd6346ad9172f6726d253d}{00486}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_af147fd6d9ed179c6f379965feb0579a6}{cached\_trace\_map\_t}}\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_acfb769f3aefd6346ad9172f6726d253d}{cached\_trace\_map}};\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00487}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6a6e477d5ab8af17385632e6cc16bbdd}{00487}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_abdd57326fce804f4a467539158816e88}{onblock\_trace\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6a6e477d5ab8af17385632e6cc16bbdd}{onblock\_trace}};\ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00488}00488\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00489}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ab624636989896e7e7aac983cd4eb12ec}{00489}}\ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ab624636989896e7e7aac983cd4eb12ec}{time\_map\_t}}\ =\ std::map<fc::time\_point,\ uint32\_t>;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00490}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{00490}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ab624636989896e7e7aac983cd4eb12ec}{time\_map\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adf9eb275a2909c7f837e9514146468d5}{time\_to\_block\_num}};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00491}00491\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00492}00492\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00493}00493\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00494}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_abebad38a4e12d41c47569dc60125cdcd}{00494}}\ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_abebad38a4e12d41c47569dc60125cdcd}{name\_bimap\_t}}\ =\ bimap<multiset\_of<weighted<chain::permission\_level>>,\ multiset\_of<permission\_info::cref>>;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00495}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aea2e43cf58e004caaac0c903a10a076d}{00495}}\ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aea2e43cf58e004caaac0c903a10a076d}{key\_bimap\_t}}\ =\ bimap<multiset\_of<weighted<chain::public\_key\_type>>,\ multiset\_of<permission\_info::cref>>;}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00496}00496\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00497}00497\ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00498}00498\ \textcolor{comment}{\ \ \ \ \ \ \ *\ The\ structures\ below\ are\ shared\ between\ the\ writing\ thread\ and\ the\ reading\ thread(s)\ and\ must\ be\ protected}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00499}00499\ \textcolor{comment}{\ \ \ \ \ \ \ *\ by\ the\ \`{}rw\_mutex`}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00500}00500\ \textcolor{comment}{\ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00501}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aba57026fbb7d549b2431c788a5bd3a2d}{00501}}\ \ \ \ \ \ \ permission\_info\_index\_t\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aba57026fbb7d549b2431c788a5bd3a2d}{permission\_info\_index}};\ \ \ \ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00502}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{00502}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_abebad38a4e12d41c47569dc60125cdcd}{name\_bimap\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_a6bf2e9f0ed9cd1f0762888b22ad55024}{name\_bimap}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00503}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adaaa7d466a003a720717341ca7fda6c5}{00503}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_aea2e43cf58e004caaac0c903a10a076d}{key\_bimap\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_adaaa7d466a003a720717341ca7fda6c5}{key\_bimap}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00504}00504\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00505}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ad111bde83946593be763eeb7e3541fdf}{00505}}\ \ \ \ \ \ \ \textcolor{keyword}{mutable}\ std::shared\_mutex\ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl_ad111bde83946593be763eeb7e3541fdf}{rw\_mutex}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00506}00506\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00507}00507\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00508}00508\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_a8ceb2cdfa36df94db0cd90983339318f}{account\_query\_db::account\_query\_db}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{chain::controller}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}\ )}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00509}00509\ \ \ \ :\_impl(\mbox{\hyperlink{namespacestd}{std}}::make\_unique<\mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db__impl}{account\_query\_db\_impl}}>(\mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}))}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00510}00510\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00511}00511\ \ \ \ \ \ \ \_impl-\/>build\_account\_query\_map();}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00512}00512\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00513}00513\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00514}00514\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_a32c1f91d12ed117e6ead0ad01607dce7}{account\_query\_db::\string~account\_query\_db}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00515}00515\ \ \ \ account\_query\_db\ \&\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_a3064a2ab0ccd12ba8e1deb3bcb9d3f47}{account\_query\_db::operator=}}(account\_query\_db\ \&\&)\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00516}00516\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00517}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_aaac955f657f2235ed3fa73adb7595db8}{00517}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_aaac955f657f2235ed3fa73adb7595db8}{account\_query\_db::cache\_transaction\_trace}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{chain::transaction\_trace\_ptr}}\&\ trace\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00518}00518\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00519}00519\ \ \ \ \ \ \ \ \ \ \_impl-\/>cache\_transaction\_trace(trace);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00520}00520\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}((\textcolor{stringliteral}{"{}ACCOUNT\ DB\ cache\_transaction\_trace\ ERROR"{}}));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00521}00521\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00522}00522\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00523}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_a9384b34eb85ca432cec8849fb8640fc8}{00523}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_a9384b34eb85ca432cec8849fb8640fc8}{account\_query\_db::commit\_block}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ block\ )\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00524}00524\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00525}00525\ \ \ \ \ \ \ \ \ \ \_impl-\/>commit\_block(block);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00526}00526\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}((\textcolor{stringliteral}{"{}ACCOUNT\ DB\ commit\_block\ ERROR"{}}));}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00527}00527\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00528}00528\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00529}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_a21aaf4c8bb5fe0072692e1b8021bb323}{00529}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__result}{account\_query\_db::get\_accounts\_by\_authorizers\_result}}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1account__query__db_a21aaf4c8bb5fe0072692e1b8021bb323}{account\_query\_db::get\_accounts\_by\_authorizers}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params}{account\_query\_db::get\_accounts\_by\_authorizers\_params}}\&\ args)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00530}00530\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_impl-\/>get\_accounts\_by\_authorizers(args);}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00531}00531\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00532}00532\ }
\DoxyCodeLine{\Hypertarget{account__query__db_8cpp_source_l00533}00533\ \}}

\end{DoxyCode}
