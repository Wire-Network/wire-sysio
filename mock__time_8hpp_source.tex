\doxysection{mock\+\_\+time.\+hpp}
\hypertarget{mock__time_8hpp_source}{}\label{mock__time_8hpp_source}\index{libraries/fc/include/fc/mock\_time.hpp@{libraries/fc/include/fc/mock\_time.hpp}}
\mbox{\hyperlink{mock__time_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00001}00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{include_2fc_2time_8hpp}{fc/time.hpp}}>}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <boost/asio/deadline\_timer.hpp>}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00006}00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacefc}{fc}}\ \{}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00009}\mbox{\hyperlink{classfc_1_1mock__time__traits}{00009}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classfc_1_1mock__time__traits}{mock\_time\_traits}}\ \{}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00010}00010\ \ \ \ \textcolor{keyword}{typedef}\ boost::asio::deadline\_timer::traits\_type\ source\_traits;}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00011}00011\ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00012}\mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{00012}}\ \ \ \ \textcolor{keyword}{typedef}\ source\_traits::time\_type\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}};}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00013}\mbox{\hyperlink{classfc_1_1mock__time__traits_a4533ad89c70bf284cf7ff4fc830a547b}{00013}}\ \ \ \ \textcolor{keyword}{typedef}\ source\_traits::duration\_type\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a4533ad89c70bf284cf7ff4fc830a547b}{duration\_type}};}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00015}00015\ \ \ \ \textcolor{comment}{//\ Requires\ set\_now()\ to\ be\ called\ first\ on\ main\ thread\ before\ any\ calls\ to\ fc::time\_point::now()}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00016}00016\ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a0d7245b32fd62b3bc712f658250cc4db}{now}}()\ noexcept;}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00018}00018\ \ \ \ \textcolor{comment}{//\ First\ call\ should\ be\ on\ one\ thread\ before\ any\ calls\ to\ fc::time\_point::now()}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00019}00019\ \ \ \ static\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a374e695ad10b80d8a13e7955cf5abbd8}{set\_now}}(\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ t\ );}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00020}00020\ \ \ \ static\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a374e695ad10b80d8a13e7955cf5abbd8}{set\_now}}(\ const\ \mbox{\hyperlink{namespacefc}{fc}}::\mbox{\hyperlink{classfc_1_1time__point}{time\_point}}\&\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a0d7245b32fd62b3bc712f658250cc4db}{now}}\ );}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00022}00022\ \ \ \ \textcolor{comment}{//\ Thread\ safe\ only\ if\ first\ call\ to\ set\_now\ is\ before\ any\ threads\ are\ spawned\ or\ memory\ barrier\ introduced}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00023}\mbox{\hyperlink{classfc_1_1mock__time__traits_adddeebdf472c33f927827c111ddbf0b1}{00023}}\ \ \ \ static\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_adddeebdf472c33f927827c111ddbf0b1}{is\_set}}()\ \{\ \textcolor{keywordflow}{return}\ mock\_enabled\_;\ \}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00025}\mbox{\hyperlink{classfc_1_1mock__time__traits_a29ebf3e988a19e4f80a4fdc1e268d0cd}{00025}}\ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a29ebf3e988a19e4f80a4fdc1e268d0cd}{add}}(\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ t,\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a4533ad89c70bf284cf7ff4fc830a547b}{duration\_type}}\ d\ )\ \{\ \textcolor{keywordflow}{return}\ source\_traits::add(\ t,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}\ );\ \}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00026}\mbox{\hyperlink{classfc_1_1mock__time__traits_aa63b04683676b62d9f4ca0059947d88b}{00026}}\ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a4533ad89c70bf284cf7ff4fc830a547b}{duration\_type}}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_aa63b04683676b62d9f4ca0059947d88b}{subtract}}(\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ t1,\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ t2\ )\ \{\ \textcolor{keywordflow}{return}\ source\_traits::subtract(\ t1,\ t2\ );\ \}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00027}\mbox{\hyperlink{classfc_1_1mock__time__traits_afabcb84f88b9367b7d6a10a8627713f6}{00027}}\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_afabcb84f88b9367b7d6a10a8627713f6}{less\_than}}(\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ t1,\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a42a56c9a52cd289340b7e7be8b663e5e}{time\_type}}\ t2\ )\ \{\ \textcolor{keywordflow}{return}\ source\_traits::less\_than(\ t1,\ t2\ );\ \}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00029}00029\ \ \ \ \textcolor{comment}{//\ This\ function\ is\ called\ by\ asio\ to\ determine\ how\ often\ to\ check}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00030}00030\ \ \ \ \textcolor{comment}{//\ if\ the\ timer\ is\ ready\ to\ fire.\ By\ manipulating\ this\ function,\ we}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00031}00031\ \ \ \ \textcolor{comment}{//\ can\ make\ sure\ asio\ detects\ changes\ to\ now\_\ in\ a\ timely\ fashion.}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00032}\mbox{\hyperlink{classfc_1_1mock__time__traits_a437da363274d8347260118d349d69b20}{00032}}\ \ \ \ \textcolor{keyword}{static}\ boost::posix\_time::time\_duration\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a437da363274d8347260118d349d69b20}{to\_posix\_duration}}(\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a4533ad89c70bf284cf7ff4fc830a547b}{duration\_type}}\ d\ )\ \{}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00033}00033\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}\ <\ boost::posix\_time::milliseconds(\ 1\ )\ ?\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}\ :\ boost::posix\_time::milliseconds(\ 1\ );}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00034}00034\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00036}00036\ \ \ \ \textcolor{comment}{//\ return\ now\ as\ fc::time\_point,\ used\ by\ fc::time\_point::now()\ if\ mock\_time\_traits\ is\_set()}}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00037}00037\ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ \mbox{\hyperlink{classfc_1_1mock__time__traits_a0bed781012a73b8c15882648397b56be}{fc\_now}}();}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00039}00039\ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00040}00040\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ mock\_enabled\_;}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00041}00041\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ boost::posix\_time::ptime\ epoch\_;}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00042}00042\ \ \ \ \textcolor{keyword}{static}\ std::atomic<int64\_t>\ now\_;}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00043}00043\ \};}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00045}\mbox{\hyperlink{namespacefc_a638f08708d417380918d83501d190b4e}{00045}}\ \textcolor{keyword}{typedef}\ boost::asio::basic\_deadline\_timer<boost::posix\_time::ptime,\ mock\_time\_traits>\ \mbox{\hyperlink{namespacefc_a638f08708d417380918d83501d190b4e}{mock\_deadline\_timer}};}
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{mock__time_8hpp_source_l00047}00047\ \}\ \textcolor{comment}{//\ namespace\ fc}}

\end{DoxyCode}
