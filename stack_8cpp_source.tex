\doxysection{stack.\+cpp}
\hypertarget{stack_8cpp_source}{}\label{stack_8cpp_source}\index{libraries/chain/webassembly/runtimes/sys-\/vm-\/oc/stack.cpp@{libraries/chain/webassembly/runtimes/sys-\/vm-\/oc/stack.cpp}}
\mbox{\hyperlink{stack_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{stack_8hpp}{sysio/chain/webassembly/sys-\/vm-\/oc/stack.hpp}}>}}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{exception_8hpp}{fc/exception/exception.hpp}}>}}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <sys/mman.h>}}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00005}00005\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacesysio_1_1chain_1_1eosvmoc}{sysio::chain::eosvmoc}};}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00007}\mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_af69753f37c77d1bd9cd4420a0acacd65}{00007}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_a3217be8e5d6a12c986bed6a0f3cd07cd}{execution\_stack::reset}}(std::size\_t\ max\_call\_depth)\ \{}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00008}00008\ \ \ \ \textcolor{keywordflow}{if}(max\_call\_depth\ >\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_a015b438965e2decec08521ec952b8ad7}{call\_depth\_limit}})\ \{}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00009}00009\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_a3217be8e5d6a12c986bed6a0f3cd07cd}{reset}}();}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00010}00010\ \ \ \ \ \ \ std::size\_t\ new\_stack\_size\ =\ max\_call\_depth\ *\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_ae40786885d68cb5ccdbf3df72b34e936}{max\_bytes\_per\_frame}}\ +\ 4*1024*1024;}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00011}00011\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ ptr\ =\ mmap(\textcolor{keyword}{nullptr},\ new\_stack\_size,\ PROT\_READ|PROT\_WRITE,\ MAP\_PRIVATE|MAP\_ANON,\ 0,\ 0);}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00012}00012\ \ \ \ \ \ \ \mbox{\hyperlink{exception_8hpp_abed525eeff3ae581be7e4e2fcd3b7bf4}{FC\_ASSERT}}(ptr\ !=\ MAP\_FAILED,\ \textcolor{stringliteral}{"{}Failed\ to\ allocate\ wasm\ stack"{}});}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00013}00013\ \ \ \ \ \ \ mprotect(ptr,\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_ae40786885d68cb5ccdbf3df72b34e936}{max\_bytes\_per\_frame}},\ PROT\_NONE);}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00014}00014\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_af43042bb976d6c06edc3ed08dec2a361}{stack\_top}}\ =\ (\textcolor{keywordtype}{char}*)ptr\ +\ new\_stack\_size;}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00015}00015\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_aba7bf0665aa509c8caa4f1612a005500}{stack\_size}}\ =\ new\_stack\_size;}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00016}00016\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_a015b438965e2decec08521ec952b8ad7}{call\_depth\_limit}}\ =\ max\_call\_depth;}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00017}00017\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00018}00018\ \}}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00020}\mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_a3217be8e5d6a12c986bed6a0f3cd07cd}{00020}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_a3217be8e5d6a12c986bed6a0f3cd07cd}{execution\_stack::reset}}()\ \{}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00021}00021\ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_af43042bb976d6c06edc3ed08dec2a361}{stack\_top}})\ \{}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00022}00022\ \ \ \ \ \ \ munmap((\textcolor{keywordtype}{char}*)\mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_af43042bb976d6c06edc3ed08dec2a361}{stack\_top}}\ -\/\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_aba7bf0665aa509c8caa4f1612a005500}{stack\_size}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_aba7bf0665aa509c8caa4f1612a005500}{stack\_size}});}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00023}00023\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_af43042bb976d6c06edc3ed08dec2a361}{stack\_top}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00024}00024\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_aba7bf0665aa509c8caa4f1612a005500}{stack\_size}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00025}00025\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_a015b438965e2decec08521ec952b8ad7}{call\_depth\_limit}}\ =\ 4*1024*1024\ /\ \mbox{\hyperlink{structsysio_1_1chain_1_1eosvmoc_1_1execution__stack_ae40786885d68cb5ccdbf3df72b34e936}{max\_bytes\_per\_frame}};}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00026}00026\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{stack_8cpp_source_l00027}00027\ \}}

\end{DoxyCode}
