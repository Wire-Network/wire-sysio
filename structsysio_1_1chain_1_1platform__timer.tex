\doxysection{sysio\+::chain\+::platform\+\_\+timer Struct Reference}
\hypertarget{structsysio_1_1chain_1_1platform__timer}{}\label{structsysio_1_1chain_1_1platform__timer}\index{sysio::chain::platform\_timer@{sysio::chain::platform\_timer}}


{\ttfamily \#include $<$platform\+\_\+timer.\+hpp$>$}

\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_1_1impl}{impl}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a73955c69921017b77b595476e8de4eea}{platform\+\_\+timer}} ()
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_ab241e03e3055f290f13d6b367d8447b7}{\texorpdfstring{$\sim$}{\string~}platform\+\_\+timer}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a8396e86c6a626dd2632cb075bd254ad4}{start}} (\mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} tp)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a5cb70a095755d00bf02d37d31b6e46af}{stop}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a5fd5d9852eeb86bed7975076db770b10}{set\+\_\+expiration\+\_\+callback}} (void(\texorpdfstring{$\ast$}{*}func)(void \texorpdfstring{$\ast$}{*}), void \texorpdfstring{$\ast$}{*}user)
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::atomic\+\_\+bool \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}} = true
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line \mbox{\hyperlink{platform__timer_8hpp_source_l00014}{14}} of file \mbox{\hyperlink{platform__timer_8hpp_source}{platform\+\_\+timer.\+hpp}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{structsysio_1_1chain_1_1platform__timer_a73955c69921017b77b595476e8de4eea}\index{sysio::chain::platform\_timer@{sysio::chain::platform\_timer}!platform\_timer@{platform\_timer}}
\index{platform\_timer@{platform\_timer}!sysio::chain::platform\_timer@{sysio::chain::platform\_timer}}
\doxysubsubsection{\texorpdfstring{platform\_timer()}{platform\_timer()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1platform__timer_a73955c69921017b77b595476e8de4eea} 
sysio\+::chain\+::platform\+\_\+timer\+::platform\+\_\+timer (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source_l00024}{24}} of file \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source}{platform\+\_\+timer\+\_\+asio\+\_\+fallback.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00025\ \ \ \ \textcolor{keyword}{static\_assert}(\textcolor{keyword}{sizeof}(impl)\ <=\ fwd\_size);}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \ std::lock\_guard\ guard(timer\_ref\_mutex);}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \textcolor{keywordflow}{if}(refcount++\ ==\ 0)\ \{}
\DoxyCodeLine{00030\ \ \ \ \ \ \ std::promise<void>\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}};}
\DoxyCodeLine{00031\ \ \ \ \ \ \ checktime\_thread\ =\ std::thread([\&\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}]()\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_ab58a7f71e88d7d4d5761bbd24837c595}{fc::set\_os\_thread\_name}}(\textcolor{stringliteral}{"{}checktime"{}});}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ checktime\_ios\ =\ std::make\_unique<boost::asio::io\_service>();}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ boost::asio::io\_service::work\ work(*checktime\_ios);}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.set\_value();}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ checktime\_ios-\/>run();}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.get\_future().get();}
\DoxyCodeLine{00040\ \ \ \ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ my-\/>timer\ =\ std::make\_unique<boost::asio::high\_resolution\_timer>(*checktime\_ios);}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \textcolor{comment}{//compute\_and\_print\_timer\_accuracy(*this);}}
\DoxyCodeLine{00045\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=348pt]{structsysio_1_1chain_1_1platform__timer_a73955c69921017b77b595476e8de4eea_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1platform__timer_ab241e03e3055f290f13d6b367d8447b7}\index{sysio::chain::platform\_timer@{sysio::chain::platform\_timer}!````~platform\_timer@{\texorpdfstring{$\sim$}{\string~}platform\_timer}}
\index{````~platform\_timer@{\texorpdfstring{$\sim$}{\string~}platform\_timer}!sysio::chain::platform\_timer@{sysio::chain::platform\_timer}}
\doxysubsubsection{\texorpdfstring{\texorpdfstring{$\sim$}{\string~}platform\_timer()}{\string~platform\_timer()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1platform__timer_ab241e03e3055f290f13d6b367d8447b7} 
sysio\+::chain\+::platform\+\_\+timer\+::\texorpdfstring{$\sim$}{\string~}platform\+\_\+timer (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source_l00047}{47}} of file \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source}{platform\+\_\+timer\+\_\+asio\+\_\+fallback.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a5cb70a095755d00bf02d37d31b6e46af}{stop}}();}
\DoxyCodeLine{00049\ \ \ \ \textcolor{keywordflow}{if}(std::lock\_guard\ guard(timer\_ref\_mutex);\ -\/-\/refcount\ ==\ 0)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ checktime\_ios-\/>stop();}
\DoxyCodeLine{00051\ \ \ \ \ \ \ checktime\_thread.join();}
\DoxyCodeLine{00052\ \ \ \ \ \ \ checktime\_ios.reset();}
\DoxyCodeLine{00053\ \ \ \ \}}
\DoxyCodeLine{00054\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=343pt]{structsysio_1_1chain_1_1platform__timer_ab241e03e3055f290f13d6b367d8447b7_cgraph}
\end{center}
\end{figure}


\doxysubsection{Member Function Documentation}
\Hypertarget{structsysio_1_1chain_1_1platform__timer_a5fd5d9852eeb86bed7975076db770b10}\index{sysio::chain::platform\_timer@{sysio::chain::platform\_timer}!set\_expiration\_callback@{set\_expiration\_callback}}
\index{set\_expiration\_callback@{set\_expiration\_callback}!sysio::chain::platform\_timer@{sysio::chain::platform\_timer}}
\doxysubsubsection{\texorpdfstring{set\_expiration\_callback()}{set\_expiration\_callback()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1platform__timer_a5fd5d9852eeb86bed7975076db770b10} 
void sysio\+::chain\+::platform\+\_\+timer\+::set\+\_\+expiration\+\_\+callback (\begin{DoxyParamCaption}\item[{void(\texorpdfstring{$\ast$}{*}}]{func~}{)(void \texorpdfstring{$\ast$}{*}), }\item[{void \texorpdfstring{$\ast$}{*}}]{user}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{platform__timer_8hpp_source_l00024}{24}} of file \mbox{\hyperlink{platform__timer_8hpp_source}{platform\+\_\+timer.\+hpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ expect\_false\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(!atomic\_compare\_exchange\_strong(\&\_callback\_variables\_busy,\ \&expect\_false,\ \textcolor{keyword}{true}))}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ expect\_false\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_busy\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([\textcolor{keyword}{this}]()\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \_callback\_variables\_busy.store(\textcolor{keyword}{false},\ std::memory\_order\_release);}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(!(func\ \&\&\ \_expiration\_callback),\ misc\_exception,\ \textcolor{stringliteral}{"{}Setting\ a\ platform\_timer\ callback\ when\ one\ already\ exists"{}});}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \_expiration\_callback\ =\ \mbox{\hyperlink{namespacesysio_1_1vm_aea2b0c85e98f4073b07115a97b46ae55a6b56c53a1b24e55124ff7f71bb9817d2}{func}};}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \_expiration\_callback\_data\ =\ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aee11cbb19052e40b07aac0ca060c23ee}{user}};}
\DoxyCodeLine{00035\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=338pt]{structsysio_1_1chain_1_1platform__timer_a5fd5d9852eeb86bed7975076db770b10_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1platform__timer_a5fd5d9852eeb86bed7975076db770b10_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1platform__timer_a8396e86c6a626dd2632cb075bd254ad4}\index{sysio::chain::platform\_timer@{sysio::chain::platform\_timer}!start@{start}}
\index{start@{start}!sysio::chain::platform\_timer@{sysio::chain::platform\_timer}}
\doxysubsubsection{\texorpdfstring{start()}{start()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1platform__timer_a8396e86c6a626dd2632cb075bd254ad4} 
void sysio\+::chain\+::platform\+\_\+timer\+::start (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}}}]{tp}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source_l00056}{56}} of file \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source}{platform\+\_\+timer\+\_\+asio\+\_\+fallback.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00057\ \ \ \ \textcolor{keywordflow}{if}(tp\ ==\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}())\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}}\ =\ 0;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00060\ \ \ \ \}}
\DoxyCodeLine{00061\ \ \ \ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ x\ =\ tp.\mbox{\hyperlink{classfc_1_1time__point_abfea5efbe9ef58024cda814395ee9945}{time\_since\_epoch}}()\ -\/\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}().\mbox{\hyperlink{classfc_1_1time__point_abfea5efbe9ef58024cda814395ee9945}{time\_since\_epoch}}();}
\DoxyCodeLine{00062\ \ \ \ \textcolor{keywordflow}{if}(x.\mbox{\hyperlink{classfc_1_1microseconds_a20fba59ec7e1f50c6b8f2c9443cc9b92}{count}}()\ <=\ 0)}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}}\ =\ 1;}
\DoxyCodeLine{00064\ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#if\ 0}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ std::promise<void>\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}};}
\DoxyCodeLine{00067\ \ \ \ \ \ \ checktime\_ios-\/>post([\&\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}},\textcolor{keyword}{this}]()\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}}\ =\ 0;}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.set\_value();}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.get\_future().get();}
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}}\ =\ 0;}
\DoxyCodeLine{00074\ \ \ \ \ \ \ my-\/>timer-\/>expires\_after(std::chrono::microseconds(x.\mbox{\hyperlink{classfc_1_1microseconds_a20fba59ec7e1f50c6b8f2c9443cc9b92}{count}}()));}
\DoxyCodeLine{00075\ \ \ \ \ \ \ my-\/>timer-\/>async\_wait([\textcolor{keyword}{this}](\textcolor{keyword}{const}\ boost::system::error\_code\&\ ec)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(ec)}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}}\ =\ 1;}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ call\_expiration\_callback();}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00081\ \ \ \ \}}
\DoxyCodeLine{00082\ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1platform__timer_a8396e86c6a626dd2632cb075bd254ad4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1platform__timer_a8396e86c6a626dd2632cb075bd254ad4_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1platform__timer_a5cb70a095755d00bf02d37d31b6e46af}\index{sysio::chain::platform\_timer@{sysio::chain::platform\_timer}!stop@{stop}}
\index{stop@{stop}!sysio::chain::platform\_timer@{sysio::chain::platform\_timer}}
\doxysubsubsection{\texorpdfstring{stop()}{stop()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1platform__timer_a5cb70a095755d00bf02d37d31b6e46af} 
void sysio\+::chain\+::platform\+\_\+timer\+::stop (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source_l00084}{84}} of file \mbox{\hyperlink{platform__timer__asio__fallback_8cpp_source}{platform\+\_\+timer\+\_\+asio\+\_\+fallback.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00085\ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}})}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ my-\/>timer-\/>cancel();}
\DoxyCodeLine{00089\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}{expired}}\ =\ 1;}
\DoxyCodeLine{00090\ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1platform__timer_a5cb70a095755d00bf02d37d31b6e46af_icgraph}
\end{center}
\end{figure}


\doxysubsection{Member Data Documentation}
\Hypertarget{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643}\index{sysio::chain::platform\_timer@{sysio::chain::platform\_timer}!expired@{expired}}
\index{expired@{expired}!sysio::chain::platform\_timer@{sysio::chain::platform\_timer}}
\doxysubsubsection{\texorpdfstring{expired}{expired}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1platform__timer_a801fb6084f296f86fdc1dedd980ac643} 
std\+::atomic\+\_\+bool sysio\+::chain\+::platform\+\_\+timer\+::expired = true}



Definition at line \mbox{\hyperlink{platform__timer_8hpp_source_l00037}{37}} of file \mbox{\hyperlink{platform__timer_8hpp_source}{platform\+\_\+timer.\+hpp}}.



The documentation for this struct was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
libraries/chain/include/sysio/chain/\mbox{\hyperlink{platform__timer_8hpp}{platform\+\_\+timer.\+hpp}}\item 
libraries/chain/\mbox{\hyperlink{platform__timer__asio__fallback_8cpp}{platform\+\_\+timer\+\_\+asio\+\_\+fallback.\+cpp}}\item 
libraries/chain/\mbox{\hyperlink{platform__timer__macos_8cpp}{platform\+\_\+timer\+\_\+macos.\+cpp}}\item 
libraries/chain/\mbox{\hyperlink{platform__timer__posix_8cpp}{platform\+\_\+timer\+\_\+posix.\+cpp}}\end{DoxyCompactItemize}
