\doxysection{trx\+\_\+finality\+\_\+status\+\_\+processing.\+cpp}
\hypertarget{trx__finality__status__processing_8cpp_source}{}\label{trx__finality__status__processing_8cpp_source}\index{plugins/chain\_plugin/trx\_finality\_status\_processing.cpp@{plugins/chain\_plugin/trx\_finality\_status\_processing.cpp}}
\mbox{\hyperlink{trx__finality__status__processing_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{trx__finality__status__processing_8hpp}{sysio/chain\_plugin/trx\_finality\_status\_processing.hpp}}>}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{finality__status__object_8hpp}{sysio/chain\_plugin/finality\_status\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00005}00005\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacesysio}{sysio}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00006}00006\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacesysio_1_1finality__status}{sysio::finality\_status}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00008}00008\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio_1_1chain__apis}{sysio::chain\_apis}}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00010}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl}{00010}}\ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl}{trx\_finality\_status\_processing\_impl}}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00011}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a00664d13ec61472fc7fda8ebaf7b2fdd}{00011}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a00664d13ec61472fc7fda8ebaf7b2fdd}{trx\_finality\_status\_processing\_impl}}(\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ max\_storage,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\&\ success\_duration,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\&\ failure\_duration\ )}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00012}00012\ \ \ \ \ \ \ :\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a4922f5ff7622ac87e135a3574b183f52}{\_max\_storage}}(max\_storage),}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00013}00013\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a9f36789d27fbc1d927642a23f4117bfa}{\_success\_duration}}(success\_duration),}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00014}00014\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af4f1c66592e80fad61772476ad99ad34}{\_failure\_duration}}(failure\_duration)\ \{\}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00016}00016\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a1b0776ff5d6ee121d0d61e2581435ad6}{signal\_applied\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{chain::transaction\_trace\_ptr}}\&\ trace,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a7041c0316bd294d0866609ab3e0cc7a7}{chain::packed\_transaction\_ptr}}\&\ ptrx\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00018}00018\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a16ae35501d6c55a1cd2585969e341611}{signal\_accepted\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00020}00020\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a157a592793d854f7a313298d775b1d25}{handle\_rollback}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00022}00022\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_acfde00e63071c1aa398e74e8fe0306fc}{status\_expiry\_of\_trxs}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\&\ now);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00024}00024\ \ \ \ \ \ \ \textcolor{comment}{//\ free\ up\ 10\%\ of\ memory\ if\ \_max\_storage\ is\ exceeded}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00025}00025\ \ \ \ \ \ \ \textcolor{comment}{//\ returns\ true\ if\ storage\ was\ freed}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00026}00026\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a0d416e47b482d4f1c1d6b23c038de967}{ensure\_storage}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00028}00028\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a2a5d14660e5ba86b4b06f589eec5a8e7}{determine\_earliest\_tracked\_block\_id}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00030}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a4922f5ff7622ac87e135a3574b183f52}{00030}}\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a4922f5ff7622ac87e135a3574b183f52}{\_max\_storage}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00031}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{00031}}\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1tracked__storage}{fc::tracked\_storage<finality\_status\_multi\_index>}}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00032}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af6515d4dfe64b6bec180393797cef907}{00032}}\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af6515d4dfe64b6bec180393797cef907}{\_last\_proc\_block\_num}}\ =\ \mbox{\hyperlink{namespacesysio_1_1finality__status_aa2f6a378e104dee648942ec55fd40328}{finality\_status::no\_block\_num}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00033}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{00033}}\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{chain::block\_id\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00034}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a979e03eea277b26e63c858e220d036b5}{00034}}\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{chain::block\_timestamp\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a979e03eea277b26e63c858e220d036b5}{\_head\_block\_timestamp}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00035}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_abe0600fcf98bbf00c3bb871cd5f89e22}{00035}}\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{chain::block\_id\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_abe0600fcf98bbf00c3bb871cd5f89e22}{\_irr\_block\_id}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00036}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a5ef00aba17d165185fe150c53147d3a3}{00036}}\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{chain::block\_timestamp\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a5ef00aba17d165185fe150c53147d3a3}{\_irr\_block\_timestamp}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00037}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a65090e0e8f9a1108d9257427db0a0dca}{00037}}\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{chain::block\_id\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a65090e0e8f9a1108d9257427db0a0dca}{\_earliest\_tracked\_block\_id}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00038}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a9f36789d27fbc1d927642a23f4117bfa}{00038}}\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a9f36789d27fbc1d927642a23f4117bfa}{\_success\_duration}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00039}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af4f1c66592e80fad61772476ad99ad34}{00039}}\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af4f1c66592e80fad61772476ad99ad34}{\_failure\_duration}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00040}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aff8114edbf26fe58bbe016fe4c0fbf85}{00040}}\ \ \ \ \ \ \ std::deque<chain::transaction\_id\_type>\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aff8114edbf26fe58bbe016fe4c0fbf85}{\_speculative\_trxs}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00041}00041\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00043}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a56d782ee67ef2d95ef1e979d3ed132fe}{00043}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a56d782ee67ef2d95ef1e979d3ed132fe}{trx\_finality\_status\_processing::trx\_finality\_status\_processing}}(\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ max\_storage,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\&\ success\_duration,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\&\ failure\_duration\ )}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00044}00044\ \ \ \ :\ \_my(new\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl}{trx\_finality\_status\_processing\_impl}}(max\_storage,\ success\_duration,\ failure\_duration))}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00045}00045\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00046}00046\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00048}00048\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_ac098137950b6a6813b3bd12ad2687406}{trx\_finality\_status\_processing::\string~trx\_finality\_status\_processing}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00050}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a9ce87be9e53254558a22c5f485477d62}{00050}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a9ce87be9e53254558a22c5f485477d62}{trx\_finality\_status\_processing::signal\_irreversible\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00051}00051\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \_my-\/>\_irr\_block\_id\ =\ bsp-\/>id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \_my-\/>\_irr\_block\_timestamp\ =\ bsp-\/>block-\/>timestamp;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00054}00054\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}((\textcolor{stringliteral}{"{}Failed\ to\ signal\ irreversible\ block\ for\ finality\ status"{}}));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00055}00055\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00057}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a020c0c2f18f96d776ceba64e84d62bfe}{00057}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a020c0c2f18f96d776ceba64e84d62bfe}{trx\_finality\_status\_processing::signal\_block\_start}}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00058}00058\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ since\ a\ new\ block\ is\ started,\ no\ block\ state\ was\ received,\ so\ the\ speculative\ block\ did\ not\ get\ eventually\ produced}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \_my-\/>\_speculative\_trxs.clear();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00061}00061\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}((\textcolor{stringliteral}{"{}Failed\ to\ signal\ block\ start\ for\ finality\ status"{}}));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00062}00062\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00064}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a497d4f66156523b19e6b93d72264996e}{00064}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a497d4f66156523b19e6b93d72264996e}{trx\_finality\_status\_processing::signal\_applied\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{chain::transaction\_trace\_ptr}}\&\ trace,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a7041c0316bd294d0866609ab3e0cc7a7}{chain::packed\_transaction\_ptr}}\&\ ptrx\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00065}00065\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \_my-\/>signal\_applied\_transaction(trace,\ ptrx);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00067}00067\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}((\textcolor{stringliteral}{"{}Failed\ to\ signal\ applied\ transaction\ for\ finality\ status"{}}));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00068}00068\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00070}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a678364d6ca4f830032d132157bb90e75}{00070}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a678364d6ca4f830032d132157bb90e75}{trx\_finality\_status\_processing::signal\_accepted\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00071}00071\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \_my-\/>signal\_accepted\_block(bsp);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00073}00073\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}((\textcolor{stringliteral}{"{}Failed\ to\ signal\ accepted\ block\ for\ finality\ status"{}}));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00074}00074\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00076}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a1b0776ff5d6ee121d0d61e2581435ad6}{00076}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a1b0776ff5d6ee121d0d61e2581435ad6}{trx\_finality\_status\_processing\_impl::signal\_applied\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{chain::transaction\_trace\_ptr}}\&\ trace,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a7041c0316bd294d0866609ab3e0cc7a7}{chain::packed\_transaction\_ptr}}\&\ ptrx\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00077}00077\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ now\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00078}00078\ \ \ \ \ \ \ \textcolor{comment}{//\ use\ the\ head\ block\ num\ if\ we\ are\ in\ a\ block,\ otherwise\ don't\ provide\ block\ number\ for\ speculative\ blocks}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00079}00079\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{chain::block\_id\_type}}\ block\_id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00080}00080\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{chain::block\_timestamp\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00081}00081\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ modified\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00082}00082\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trace-\/>producer\_block\_id)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ block\_id\ =\ *trace-\/>producer\_block\_id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ block\_changed\ =\ block\_id\ !=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (block\_changed)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}}\ =\ block\_id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a979e03eea277b26e63c858e220d036b5}{\_head\_block\_timestamp}}\ =\ trace-\/>block\_time;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}}\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a979e03eea277b26e63c858e220d036b5}{\_head\_block\_timestamp}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ head\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{chain::block\_header::num\_from\_id}}(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}});}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (block\_changed\ \&\&\ head\_block\_num\ <=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af6515d4dfe64b6bec180393797cef907}{\_last\_proc\_block\_num}})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a157a592793d854f7a313298d775b1d25}{handle\_rollback}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ modified\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af6515d4dfe64b6bec180393797cef907}{\_last\_proc\_block\_num}}\ =\ head\_block\_num;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_acfde00e63071c1aa398e74e8fe0306fc}{status\_expiry\_of\_trxs}}(now))\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ modified\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00102}00102\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00104}00104\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trace-\/>receipt)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00105}00105\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trace-\/>receipt-\/>status\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{chain::transaction\_receipt\_header::executed}})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00107}00107\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00108}00108\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trace-\/>scheduled)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00109}00109\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesysio_1_1chain_a9a9946a27c3832394b9b2b3911e0733c}{chain::is\_onblock}}(*trace))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00111}00111\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trace-\/>producer\_block\_id)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aff8114edbf26fe58bbe016fe4c0fbf85}{\_speculative\_trxs}}.push\_back(trace-\/>id);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00113}00113\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00115}00115\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a0d416e47b482d4f1c1d6b23c038de967}{ensure\_storage}}())\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00116}00116\ \ \ \ \ \ \ \ \ \ modified\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00117}00117\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00119}00119\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_id\ =\ trace-\/>id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00120}00120\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ iter\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_adc1778619d5a0ef17222e82bfce775e8}{find}}(trx\_id);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00121}00121\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (iter\ !=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().cend())\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_a857cf0f6d4ca31111b633b9d4c923ffe}{modify}}(\ iter,\ [\&block\_id,\&\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}}](\ \mbox{\hyperlink{structsysio_1_1finality__status__object}{finality\_status\_object}}\&\ obj\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ obj.\mbox{\hyperlink{structsysio_1_1finality__status__object_a45ea8643d0061aeedda3fd2cb610cd81}{block\_id}}\ =\ block\_id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ obj.\mbox{\hyperlink{structsysio_1_1finality__status__object_a84419aca3d888816a90fff72fccc440b}{block\_timestamp}}\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ obj.\mbox{\hyperlink{structsysio_1_1finality__status__object_ac845ab23a755acae525aea4fb3e98a2e}{forked\_out}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00126}00126\ \ \ \ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00127}00127\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00128}00128\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00129}00129\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_a6d24a6bf4512b48a846d88a1bf44b5b8}{insert}}(}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1finality__status__object}{finality\_status\_object}}\{.trx\_id\ =\ trx\_id,}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .trx\_expiry\ =\ ptrx-\/>expiration(),}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00132}00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .received\ =\ now,}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .block\_id\ =\ block\_id,}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .block\_timestamp\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}}\});}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00135}00135\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00137}00137\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (modified\ ||\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a65090e0e8f9a1108d9257427db0a0dca}{\_earliest\_tracked\_block\_id}}\ ==\ \mbox{\hyperlink{classfc_1_1sha256}{chain::block\_id\_type}}\{\})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a2a5d14660e5ba86b4b06f589eec5a8e7}{determine\_earliest\_tracked\_block\_id}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00139}00139\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00140}00140\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00141}00141\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00142}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a16ae35501d6c55a1cd2585969e341611}{00142}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a16ae35501d6c55a1cd2585969e341611}{trx\_finality\_status\_processing\_impl::signal\_accepted\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{chain::block\_state\_ptr}}\&\ bsp\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00143}00143\ \ \ \ \ \ \ \textcolor{comment}{//\ if\ this\ block\ had\ any\ transactions,\ then\ we\ have\ processed\ everything\ we\ need\ to\ already}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00144}00144\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bsp-\/>id\ ==\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00146}00146\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00147}00147\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00148}00148\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}}\ =\ bsp-\/>id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00149}00149\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a979e03eea277b26e63c858e220d036b5}{\_head\_block\_timestamp}}\ =\ bsp-\/>block-\/>timestamp;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00151}00151\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ head\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{chain::block\_header::num\_from\_id}}(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}});}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00152}00152\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (head\_block\_num\ <=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af6515d4dfe64b6bec180393797cef907}{\_last\_proc\_block\_num}})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00153}00153\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a157a592793d854f7a313298d775b1d25}{handle\_rollback}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00154}00154\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00155}00155\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00156}00156\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ now\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00157}00157\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ status\_expiry\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_acfde00e63071c1aa398e74e8fe0306fc}{status\_expiry\_of\_trxs}}(now);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00158}00158\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\_expiry)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00159}00159\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a2a5d14660e5ba86b4b06f589eec5a8e7}{determine\_earliest\_tracked\_block\_id}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00160}00160\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00161}00161\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00162}00162\ \ \ \ \ \ \ \textcolor{comment}{//\ if\ this\ approve\ block\ was\ preceded\ by\ speculative\ transactions\ then\ we\ produced\ the\ block,\ update\ trx\ state.}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00163}00163\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ mod\ =\ [\&block\_id=\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}},\&\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}}=\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a979e03eea277b26e63c858e220d036b5}{\_head\_block\_timestamp}}](\ \mbox{\hyperlink{structsysio_1_1finality__status__object}{finality\_status\_object}}\&\ obj\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00164}00164\ \ \ \ \ \ \ \ \ \ obj.block\_id\ =\ block\_id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00165}00165\ \ \ \ \ \ \ \ \ \ obj.block\_timestamp\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00166}00166\ \ \ \ \ \ \ \ \ \ obj.forked\_out\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00167}00167\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00168}00168\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_id\ :\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aff8114edbf26fe58bbe016fe4c0fbf85}{\_speculative\_trxs}})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ iter\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_adc1778619d5a0ef17222e82bfce775e8}{find}}(trx\_id);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exception_8hpp_abed525eeff3ae581be7e4e2fcd3b7bf4}{FC\_ASSERT}}(\ iter\ !=\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().cend(),}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CODE\ ERROR:\ Should\ not\ have\ speculative\ transactions\ that\ have\ not\ already"{}}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}been\ identified\ prior\ to\ the\ block\ being\ accepted.\ trx\ id:\ \$\{trx\_id\}"{}},}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}trx\_id"{}},\ trx\_id)\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_a857cf0f6d4ca31111b633b9d4c923ffe}{modify}}(\ iter,\ mod\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00175}00175\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00176}00176\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aff8114edbf26fe58bbe016fe4c0fbf85}{\_speculative\_trxs}}.clear();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00177}00177\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00178}00178\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af6515d4dfe64b6bec180393797cef907}{\_last\_proc\_block\_num}}\ =\ head\_block\_num;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00179}00179\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00180}00180\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00181}00181\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00182}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a157a592793d854f7a313298d775b1d25}{00182}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a157a592793d854f7a313298d775b1d25}{trx\_finality\_status\_processing\_impl::handle\_rollback}}()\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00183}00183\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ indx\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().get<by\_block\_num>();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00184}00184\ \ \ \ \ \ \ chain::deque<\textcolor{keyword}{decltype}(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().project<0>(indx.begin()))>\ trxs;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00185}00185\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ iter\ =\ indx.lower\_bound(\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{chain::block\_header::num\_from\_id}}(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a79253637ce9d67b868b1a7801c526059}{\_head\_block\_id}}));\ iter\ !=\ indx.end();\ ++iter)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00186}00186\ \ \ \ \ \ \ \ \ \ trxs.push\_back(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().project<0>(iter));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00187}00187\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00188}00188\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_iter\ :\ trxs)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_a857cf0f6d4ca31111b633b9d4c923ffe}{modify}}(\ trx\_iter,\ [](\ \mbox{\hyperlink{structsysio_1_1finality__status__object}{finality\_status\_object}}\&\ obj\ )\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ obj.\mbox{\hyperlink{structsysio_1_1finality__status__object_ac845ab23a755acae525aea4fb3e98a2e}{forked\_out}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00191}00191\ \ \ \ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00192}00192\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00193}00193\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00194}00194\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00195}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_acfde00e63071c1aa398e74e8fe0306fc}{00195}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_acfde00e63071c1aa398e74e8fe0306fc}{trx\_finality\_status\_processing\_impl::status\_expiry\_of\_trxs}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\&\ now)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00196}00196\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ indx\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().get<by\_status\_expiry>();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00197}00197\ \ \ \ \ \ \ chain::deque<\textcolor{keyword}{decltype}(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().project<0>(indx.begin()))>\ remove\_trxs;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00198}00198\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00199}00199\ \ \ \ \ \ \ \textcolor{comment}{//\ find\ the\ successful\ (in\ any\ block)\ transactions\ that\ are\ past\ the\ failure\ expiry\ times}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00200}00200\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ success\_iter\ =\ indx.lower\_bound(boost::make\_tuple(\textcolor{keyword}{true},\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\{\}));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00202}00202\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ success\_expiry\ =\ now\ -\/\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a9f36789d27fbc1d927642a23f4117bfa}{\_success\_duration}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00203}00203\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ success\_end\ =\ indx.upper\_bound(boost::make\_tuple(\textcolor{keyword}{true},\ success\_expiry));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00204}00204\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ success\_iter\ !=\ success\_end;\ ++success\_iter)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00205}00205\ \ \ \ \ \ \ \ \ \ remove\_trxs.push\_back(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().project<0>(success\_iter));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00206}00206\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00208}00208\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ fail\_expiry\ =\ now\ -\/\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_af4f1c66592e80fad61772476ad99ad34}{\_failure\_duration}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00209}00209\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ fail\_end\ =\ indx.upper\_bound(boost::make\_tuple(\textcolor{keyword}{false},\ fail\_expiry));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00210}00210\ \ \ \ \ \ \ \textcolor{comment}{//\ find\ the\ failure\ (not\ in\ a\ block)\ transactions\ that\ are\ past\ the\ failure\ expiry\ time}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00211}00211\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ fail\_iter\ =\ indx.begin();\ fail\_iter\ !=\ fail\_end;\ ++fail\_iter)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00212}00212\ \ \ \ \ \ \ \ \ \ remove\_trxs.push\_back(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().project<0>(fail\_iter));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00213}00213\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00214}00214\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00215}00215\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_iter\ :\ remove\_trxs)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_a51396073d7aa4bd1a431e318f5557924}{erase}}(trx\_iter);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00217}00217\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00218}00218\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !remove\_trxs.empty();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00219}00219\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00220}00220\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00221}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a0d416e47b482d4f1c1d6b23c038de967}{00221}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a0d416e47b482d4f1c1d6b23c038de967}{trx\_finality\_status\_processing\_impl::ensure\_storage}}()\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00222}00222\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ remaining\_storage\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a4922f5ff7622ac87e135a3574b183f52}{\_max\_storage}}\ -\/\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_a5bd678ec2e09568df574c8ecaa184962}{memory\_size}}();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00223}00223\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (remaining\_storage\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00225}00225\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00227}00227\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ percentage\ =\ [](\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ mem)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ pcnt\ =\ 90;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (mem\ *\ pcnt)/100;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00230}00230\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00231}00231\ \ \ \ \ \ \ \textcolor{comment}{//\ determine\ how\ much\ we\ need\ to\ free\ to\ get\ back\ to\ at\ least\ the\ desired\ percentage\ of\ the\ storage}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00232}00232\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ storage\_to\_free\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a4922f5ff7622ac87e135a3574b183f52}{\_max\_storage}}\ -\/\ percentage(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a4922f5ff7622ac87e135a3574b183f52}{\_max\_storage}})\ -\/\ remaining\_storage;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00233}00233\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Finality\ Status\ exceeded\ max\ storage\ (\$\{max\_storage\}GB)\ need\ to\ free\ up\ \$\{storage\_to\_free\}\ GB"{}},}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}max\_storage"{}},\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a4922f5ff7622ac87e135a3574b183f52}{\_max\_storage}}/1024/1024/1024)}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00235}00235\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}storage\_to\_free"{}},storage\_to\_free/1024/1024/1024));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00236}00236\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\_indx\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().get<by\_block\_num>();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00237}00237\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ status\_expiry\_indx\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().get<by\_status\_expiry>();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00238}00238\ \ \ \ \ \ \ \textcolor{keyword}{using\ }index\_iter\_type\ =\ \textcolor{keyword}{decltype}(\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().project<0>(block\_indx.begin()));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00239}00239\ \ \ \ \ \ \ chain::deque<index\_iter\_type>\ remove\_trxs;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00240}00240\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00241}00241\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reduce\_storage\ =\ [\&storage\_to\_free,\&remove\_trxs,\&storage=this-\/>\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}](\textcolor{keyword}{auto}\ iter)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00242}00242\ \ \ \ \ \ \ \ \ \ storage\_to\_free\ -\/=\ iter-\/>memory\_size();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00243}00243\ \ \ \ \ \ \ \ \ \ remove\_trxs.push\_back(storage.index().project<0>(iter));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00244}00244\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00245}00245\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00246}00246\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ block\_upper\_bound\ =\ \mbox{\hyperlink{namespacesysio_1_1finality__status_aa2f6a378e104dee648942ec55fd40328}{finality\_status::no\_block\_num}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00247}00247\ \ \ \ \ \ \ \textcolor{comment}{//\ start\ at\ the\ beginning\ of\ the\ oldest\_failure\ section\ and\ just\ keep\ iterating\ from\ there}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00248}00248\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ oldest\_failure\_iter\ =\ status\_expiry\_indx.begin();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00249}00249\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ end\ of\ the\ oldest\ failure\ section}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00250}00250\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ oldest\_failure\_end\ =\ status\_expiry\_indx.lower\_bound(\ std::make\_tuple(\ \textcolor{keyword}{true},\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\{\}\ )\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00251}00251\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ earliest\_block\ =\ \mbox{\hyperlink{namespacesysio_1_1finality__status_aa2f6a378e104dee648942ec55fd40328}{finality\_status::no\_block\_num}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00252}00252\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (storage\_to\_free\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00253}00253\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ oldest\_block\_iter\ =\ block\_indx.upper\_bound(block\_upper\_bound);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (oldest\_block\_iter\ ==\ block\_indx.end())\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exception_8hpp_abed525eeff3ae581be7e4e2fcd3b7bf4}{FC\_ASSERT}}(\ oldest\_failure\_iter\ !=\ oldest\_failure\_end,}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CODE\ ERROR:\ can\ not\ free\ more\ storage,\ but\ still\ exceeding\ limit.\ "{}}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Total\ entries:\ \$\{total\_entries\},\ storage\ memory\ to\ free:\ \$\{storage\},\ "{}}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00258}00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}entries\ slated\ for\ removal:\ \$\{remove\_entries\}"{}},}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}total\_entries"{}},\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().size())}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00260}00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}storage"{}},\ storage\_to\_free)}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00261}00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}remove\_entries"{}},\ remove\_trxs.size()));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00262}00262\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ oldest\_failure\_iter\ !=\ oldest\_failure\_end\ \&\&\ storage\_to\_free\ >\ 0;\ ++oldest\_failure\_iter)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reduce\_storage(oldest\_failure\_iter);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00264}00264\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00265}00265\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exception_8hpp_abed525eeff3ae581be7e4e2fcd3b7bf4}{FC\_ASSERT}}(\ storage\_to\_free\ <\ 1,}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}CODE\ ERROR:\ can\ not\ free\ more\ storage,\ but\ still\ exceeding\ limit.\ "{}}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Total\ entries:\ \$\{total\_entries\},\ storage\ memory\ to\ free:\ \$\{storage\},\ "{}}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}entries\ slated\ for\ removal:\ \$\{remove\_entries\}"{}},}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}total\_entries"{}},\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().size())}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00270}00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}storage"{}},\ storage\_to\_free)}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00271}00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}remove\_entries"{}},\ remove\_trxs.size()));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00272}00272\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00273}00273\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00274}00274\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00275}00275\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ block\_num\ =\ oldest\_block\_iter-\/>block\_num();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00276}00276\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (earliest\_block\ ==\ \mbox{\hyperlink{namespacesysio_1_1finality__status_aa2f6a378e104dee648942ec55fd40328}{finality\_status::no\_block\_num}})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ earliest\_block\ =\ block\_num;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00278}00278\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00279}00279\ \ \ \ \ \ \ \ \ \ \ \ \ block\_upper\_bound\ =\ block\_num;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00280}00280\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}}\ =\ oldest\_block\_iter-\/>\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp_a3fa049f1a91294814a9cda7ae0745d14}{block\_timestamp}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00281}00281\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ oldest\_block\_iter\ !=\ block\_indx.end()\ \&\&\ oldest\_block\_iter-\/>block\_num()\ ==\ block\_num;\ ++oldest\_block\_iter)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00282}00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reduce\_storage(oldest\_block\_iter);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00283}00283\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00284}00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ oldest\_failure\_upper\_bound\ =\ status\_expiry\_indx.upper\_bound(\ std::make\_tuple(\ \textcolor{keyword}{false},\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp_aa1d88152d9cc082b5ad651c3aeadfb8f}{to\_time\_point}}()\ ));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00285}00285\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ oldest\_failure\_iter\ !=\ oldest\_failure\_upper\_bound;\ ++oldest\_failure\_iter)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00286}00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reduce\_storage(oldest\_failure\_iter);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00287}00287\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00288}00288\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00289}00289\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00290}00290\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00291}00291\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_iter\ :\ remove\_trxs)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_a51396073d7aa4bd1a431e318f5557924}{erase}}(trx\_iter);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00293}00293\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00294}00294\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00295}00295\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (earliest\_block\ !=\ \mbox{\hyperlink{namespacesysio_1_1finality__status_aa2f6a378e104dee648942ec55fd40328}{finality\_status::no\_block\_num}})\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00296}00296\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}Finality\ Status\ dropped\ \$\{trx\_count\}\ transactions,\ which\ were\ removed\ from\ block\ \#\ \$\{block\_num\_start\}\ to\ block\ \#\ \$\{block\_num\_end\}"{}},}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00297}00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}trx\_count"{}},\ remove\_trxs.size())(\textcolor{stringliteral}{"{}block\_num\_start"{}},\ earliest\_block)(\textcolor{stringliteral}{"{}block\_num\_end"{}},\ block\_upper\_bound)\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00298}00298\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00299}00299\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00300}00300\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}Finality\ Status\ dropped\ \$\{trx\_count\}\ transactions,\ all\ were\ failed\ transactions"{}},\ (\textcolor{stringliteral}{"{}trx\_count"{}},\ remove\_trxs.size())\ );}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00301}00301\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00302}00302\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00303}00303\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00304}00304\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00305}00305\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00306}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_af01637ac02a44792fd55e8c1f7d4c631}{00306}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing_1_1chain__state}{trx\_finality\_status\_processing::chain\_state}}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_af01637ac02a44792fd55e8c1f7d4c631}{trx\_finality\_status\_processing::get\_chain\_state}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00307}00307\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\ .head\_id\ =\ \_my-\/>\_head\_block\_id,\ .head\_block\_timestamp\ =\ \_my-\/>\_head\_block\_timestamp,\ .irr\_id\ =\ \_my-\/>\_irr\_block\_id,\ .irr\_block\_timestamp\ =\ \_my-\/>\_irr\_block\_timestamp,\ .earliest\_tracked\_block\_id\ =\ \_my-\/>\_earliest\_tracked\_block\_id\ \};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00308}00308\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00309}00309\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00310}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a7cc0444455cdef3c9190a42075401b73}{00310}}\ \ \ \ std::optional<trx\_finality\_status\_processing::trx\_state>\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a7cc0444455cdef3c9190a42075401b73}{trx\_finality\_status\_processing::get\_trx\_state}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{chain::transaction\_id\_type}}\&\ \textcolor{keywordtype}{id}\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00311}00311\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ iter\ =\ \_my-\/>\_storage.find(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00312}00312\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (iter\ ==\ \_my-\/>\_storage.index().cend())\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00313}00313\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00314}00314\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00315}00315\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00316}00316\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ status;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00317}00317\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!iter-\/>is\_in\_block())\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00318}00318\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ >=\ iter-\/>trx\_expiry)\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00319}00319\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ \textcolor{stringliteral}{"{}FAILED"{}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ iter-\/>forked\_out\ ?\ \textcolor{stringliteral}{"{}FORKED\_OUT"{}}\ :\ \textcolor{stringliteral}{"{}LOCALLY\_APPLIED"{}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00324}00324\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00325}00325\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00326}00326\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ block\_num\ =\ iter-\/>block\_num();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ lib\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{chain::block\_header::num\_from\_id}}(\_my-\/>\_irr\_block\_id);}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00328}00328\ \ \ \ \ \ \ \ \ \ status\ =\ (block\_num\ >\ lib)\ ?\ \textcolor{stringliteral}{"{}IN\_BLOCK"{}}\ :\ \textcolor{stringliteral}{"{}IRREVERSIBLE"{}};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00329}00329\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00330}00330\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing_1_1trx__state}{trx\_finality\_status\_processing::trx\_state}}\{\ .block\_id\ =\ iter-\/>block\_id,\ .block\_timestamp\ =\ iter-\/>block\_timestamp,\ .received\ =\ iter-\/>received,\ .expiration\ =\ iter-\/>trx\_expiry,\ .status\ =\ status\ \};}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00331}00331\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00332}00332\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00333}\mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a732e6994e895af082e0c019686803b29}{00333}}\ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classsysio_1_1chain__apis_1_1trx__finality__status__processing_a732e6994e895af082e0c019686803b29}{trx\_finality\_status\_processing::get\_storage\_memory\_size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00334}00334\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_my-\/>\_storage.memory\_size();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00335}00335\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00337}\mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a2a5d14660e5ba86b4b06f589eec5a8e7}{00337}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a2a5d14660e5ba86b4b06f589eec5a8e7}{trx\_finality\_status\_processing\_impl::determine\_earliest\_tracked\_block\_id}}()\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00338}00338\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ indx\ =\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_aaa007f1ba3a88c1bb11fd8cc3ee1975d}{\_storage}}.\mbox{\hyperlink{classfc_1_1tracked__storage_ab578f3765c80c8cee1d758d440c99e90}{index}}().get<by\_status\_expiry>();}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00339}00339\ }
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00340}00340\ \ \ \ \ \ \ \textcolor{comment}{//\ find\ the\ lowest\ value\ successful\ block}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00341}00341\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ success\_iter\ =\ indx.lower\_bound(boost::make\_tuple(\textcolor{keyword}{true},\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\{\}));}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00342}00342\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (success\_iter\ !=\ indx.cend())\ \{}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1trx__finality__status__processing__impl_a65090e0e8f9a1108d9257427db0a0dca}{\_earliest\_tracked\_block\_id}}\ =\ success\_iter-\/>block\_id;}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00344}00344\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00345}00345\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{trx__finality__status__processing_8cpp_source_l00346}00346\ \}}

\end{DoxyCode}
