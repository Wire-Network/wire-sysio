\doxysection{controller.\+cpp}
\hypertarget{controller_8cpp_source}{}\label{controller_8cpp_source}\index{libraries/chain/controller.cpp@{libraries/chain/controller.cpp}}
\mbox{\hyperlink{controller_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{controller_8hpp}{sysio/chain/controller.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{transaction__context_8hpp}{sysio/chain/transaction\_context.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{block__log_8hpp}{sysio/chain/block\_log.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{fork__database_8hpp}{sysio/chain/fork\_database.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp}{sysio/chain/exceptions.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{account__object_8hpp}{sysio/chain/account\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{code__object_8hpp}{sysio/chain/code\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{block__summary__object_8hpp}{sysio/chain/block\_summary\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00011}00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{sysio__contract_8hpp}{sysio/chain/sysio\_contract.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{global__property__object_8hpp}{sysio/chain/global\_property\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{protocol__state__object_8hpp}{sysio/chain/protocol\_state\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{contract__table__objects_8hpp}{sysio/chain/contract\_table\_objects.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00015}00015\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{generated__transaction__object_8hpp}{sysio/chain/generated\_transaction\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00016}00016\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{transaction__object_8hpp}{sysio/chain/transaction\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00017}00017\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{genesis__intrinsics_8hpp}{sysio/chain/genesis\_intrinsics.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00018}00018\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{whitelisted__intrinsics_8hpp}{sysio/chain/whitelisted\_intrinsics.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00019}00019\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{database__header__object_8hpp}{sysio/chain/database\_header\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00021}00021\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{protocol__feature__manager_8hpp}{sysio/chain/protocol\_feature\_manager.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00022}00022\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{authorization__manager_8hpp}{sysio/chain/authorization\_manager.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00023}00023\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{resource__limits_8hpp}{sysio/chain/resource\_limits.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00024}00024\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{chain__snapshot_8hpp}{sysio/chain/chain\_snapshot.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00025}00025\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{thread__utils_8hpp}{sysio/chain/thread\_utils.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00026}00026\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{platform__timer_8hpp}{sysio/chain/platform\_timer.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00027}00027\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{deep__mind_8hpp}{sysio/chain/deep\_mind.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00029}00029\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{chainbase_8hpp}{chainbase/chainbase.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00030}00030\ \textcolor{preprocessor}{\#include\ <sysio/vm/allocator.hpp>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00031}00031\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{json_8hpp}{fc/io/json.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00032}00032\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger__config_8hpp}{fc/log/logger\_config.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00033}00033\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{scoped__exit_8hpp}{fc/scoped\_exit.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00034}00034\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{variant__object_8hpp}{fc/variant\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00036}00036\ \textcolor{preprocessor}{\#include\ <new>}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00038}00038\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio}{sysio}}\ \{\ \textcolor{keyword}{namespace\ }chain\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00040}00040\ \textcolor{keyword}{using\ }resource\_limits::resource\_limits\_manager;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00042}\mbox{\hyperlink{namespacesysio_1_1chain_a5af72ea2ff72b80b5f7c50c5a43722c5}{00042}}\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classsysio_1_1chain_1_1index__set}{controller\_index\_set}}\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1index__set}{index\_set}}<}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00043}00043\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a1736163b16f1771314cd01a1208621c7}{account\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00044}00044\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aeced8cdafcddda68b18c6c579dea0cc1}{account\_metadata\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00045}00045\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4c900d23edfaeb9e6e25aa3a21e0ab4b}{account\_ram\_correction\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00046}00046\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a0612ad4956bca2a7b23f9a14e2b32106}{global\_property\_multi\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00047}00047\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ab03689aa0bc2fbf321d7644f838f23a5}{protocol\_state\_multi\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00048}00048\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a7f5e587f777791897526e74e58c086be}{dynamic\_global\_property\_multi\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00049}00049\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a2c8a11798aa7d85bd95fec0fb483d91b}{block\_summary\_multi\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00050}00050\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a7ae1398893dd587589ee5593a952a2ef}{transaction\_multi\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00051}00051\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a9e9842ee49526c2423e014a696edc602}{generated\_transaction\_multi\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00052}00052\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aacd8d660fd83146e0a5d6a9cb7b19a29}{table\_id\_multi\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00053}00053\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a0f69872bbb285f6f90ff8b5e30ef6aa8}{code\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00054}00054\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a7d61e01ac919d654401a1db8399a3945}{database\_header\_multi\_index}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00055}00055\ >;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00057}\mbox{\hyperlink{namespacesysio_1_1chain_ac4f7cb93debf1865241d63e122d5e689}{00057}}\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classsysio_1_1chain_1_1index__set}{contract\_database\_index\_set}}\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1index__set}{index\_set}}<}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00058}00058\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aac1a2c1330fcb6c8002d59d4d1de5858}{key\_value\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00059}00059\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a6575ee303f00a9488efc0e9c0614c62e}{index64\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00060}00060\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a3aa50d622507be5b1de392b4aae55b0d}{index128\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00061}00061\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a8e9186f3a170838216f0535ee44b6d7b}{index256\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00062}00062\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a613ce5969969e88f01eba861173d2b1b}{index\_double\_index}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00063}00063\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_afd7252a1e9677ed6c7762531cc275f41}{index\_long\_double\_index}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00064}00064\ >;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00066}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{00066}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00067}00067\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00068}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a58384b7d055e54178bda99e67c165878}{00068}}\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a58384b7d055e54178bda99e67c165878}{maybe\_session}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00070}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_afcc5601bfdefa774205a1dd4845eba73}{00070}}\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_afcc5601bfdefa774205a1dd4845eba73}{maybe\_session}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\&\&\ other)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00071}00071\ \ \ \ \ \ \ :\_session(move(other.\_session))}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00072}00072\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00073}00073\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00075}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a438e4a87d88afef121f9a2c9c89e30c8}{00075}}\ \ \ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a438e4a87d88afef121f9a2c9c89e30c8}{maybe\_session}}(\mbox{\hyperlink{classchainbase_1_1database}{database}}\&\ db)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \_session.emplace(db.\mbox{\hyperlink{classchainbase_1_1database_abb570c03bda1ee6ae1b428d41481b476}{start\_undo\_session}}(\textcolor{keyword}{true}));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00077}00077\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00079}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_aaba101b94bc3ac6f5f3a88b1ceba284a}{00079}}\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_aaba101b94bc3ac6f5f3a88b1ceba284a}{maybe\_session}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00081}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a1e5c5b89d2b1fac7f982ede7f0b1b545}{00081}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a1e5c5b89d2b1fac7f982ede7f0b1b545}{squash}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_session)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \_session-\/>squash();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00084}00084\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00086}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a749517d619768ab8885fc8e2785e3b40}{00086}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a749517d619768ab8885fc8e2785e3b40}{undo}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_session)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \_session-\/>undo();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00089}00089\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00091}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_ab35e3889eb7fd6cd0c65d2d349111050}{00091}}\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_ab35e3889eb7fd6cd0c65d2d349111050}{push}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_session)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \_session-\/>push();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00094}00094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00096}\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a142562a4ca875304802fc6d2cc41d669}{00096}}\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a142562a4ca875304802fc6d2cc41d669}{operator\ =\ }}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\&\&\ mv\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mv.\_session)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \_session.emplace(move(*mv.\_session));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ mv.\_session.reset();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \_session.reset();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00105}00105\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00106}00106\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00107}00107\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00108}00108\ \ \ \ \ \ \ std::optional<database::session>\ \ \ \ \ \_session;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00109}00109\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00111}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block}{00111}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1building__block}{building\_block}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00112}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_ad1a55d886f919432dd2cf5a2179ad697}{00112}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_ad1a55d886f919432dd2cf5a2179ad697}{building\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}\&\ prev,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ when,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ num\_prev\_blocks\_to\_confirm,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_protocol\_feature\_activations\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00116}00116\ \ \ \ :\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a6f4c847bd9e684175c5c2dd9a293bcce}{\_pending\_block\_header\_state}}(\ prev.next(\ when,\ num\_prev\_blocks\_to\_confirm\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00117}00117\ \ \ \ ,\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a505d69cba19e3830b35a7794d7c4adca}{\_new\_protocol\_feature\_activations}}(\ new\_protocol\_feature\_activations\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00118}00118\ \ \ \ \{\}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00120}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a6f4c847bd9e684175c5c2dd9a293bcce}{00120}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__block__header__state}{pending\_block\_header\_state}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a6f4c847bd9e684175c5c2dd9a293bcce}{\_pending\_block\_header\_state}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00121}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_ad23c5b9aff9e1e2033ee5ff0e0b38a13}{00121}}\ \ \ \ std::optional<producer\_authority\_schedule>\ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_ad23c5b9aff9e1e2033ee5ff0e0b38a13}{\_new\_pending\_producer\_schedule}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00122}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a505d69cba19e3830b35a7794d7c4adca}{00122}}\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a505d69cba19e3830b35a7794d7c4adca}{\_new\_protocol\_feature\_activations}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00123}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a185ab69ca6d476247057e18672aed3ad}{00123}}\ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a185ab69ca6d476247057e18672aed3ad}{\_num\_new\_protocol\_features\_that\_have\_activated}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00124}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a44bbb13d65743e9b5370f928cd57fa0c}{00124}}\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_metadata\_ptr>}}\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a44bbb13d65743e9b5370f928cd57fa0c}{\_pending\_trx\_metas}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00125}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_af666a80cf6adc295cc63a81e1ab421bf}{00125}}\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_receipt>}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_af666a80cf6adc295cc63a81e1ab421bf}{\_pending\_trx\_receipts}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00126}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a798382d177c089494b584b5a9b3f1af1}{00126}}\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a798382d177c089494b584b5a9b3f1af1}{\_action\_receipt\_digests}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00127}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a0f41d6d213209b2c8c73acb198b44d31}{00127}}\ \ \ \ std::optional<checksum256\_type>\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a0f41d6d213209b2c8c73acb198b44d31}{\_transaction\_mroot}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00128}\mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a431e096b0d1fe2977a905f332bc67fe3}{00128}}\ \ \ \ std::optional<s\_header>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block_a431e096b0d1fe2977a905f332bc67fe3}{\_s\_header}};\ \textcolor{comment}{//\ Added\ new\ functionality\ to\ pass\ an\ optional\ s\_header\ to\ be\ included\ in\ block\ header\ extension}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00129}00129\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00130}00130\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00131}\mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block}{00131}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block}{assembled\_block}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00132}\mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_a67c880fe80f20c21ab50b9e597610c49}{00132}}\ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_a67c880fe80f20c21ab50b9e597610c49}{\_id}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00133}\mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_a421c03cda1ddda0efe26b080545fa423}{00133}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__block__header__state}{pending\_block\_header\_state}}\ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_a421c03cda1ddda0efe26b080545fa423}{\_pending\_block\_header\_state}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00134}\mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_a5ddb3774763eee6d0817ad927559d215}{00134}}\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_metadata\_ptr>}}\ \ \mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_a5ddb3774763eee6d0817ad927559d215}{\_trx\_metas}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00135}\mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_aeb5b3ffe37e9ba44bdc8fb0cefa3f5f6}{00135}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_aeb5b3ffe37e9ba44bdc8fb0cefa3f5f6}{\_unsigned\_block}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00137}00137\ \ \ \ \textcolor{comment}{//\ if\ the\ \_unsigned\_block\ pre-\/dates\ block-\/signing\ authorities\ this\ may\ be\ present.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00138}\mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_ac8104404bca401ce911462d43578b5ba}{00138}}\ \ \ \ std::optional<producer\_authority\_schedule>\ \mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block_ac8104404bca401ce911462d43578b5ba}{\_new\_producer\_authority\_cache}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00139}00139\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00140}00140\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00141}\mbox{\hyperlink{structsysio_1_1chain_1_1completed__block}{00141}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1completed__block}{completed\_block}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00142}\mbox{\hyperlink{structsysio_1_1chain_1_1completed__block_a07a433c3d74af71add53f639c88d86a2}{00142}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1completed__block_a07a433c3d74af71add53f639c88d86a2}{\_block\_state}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00143}00143\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00144}00144\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00145}\mbox{\hyperlink{namespacesysio_1_1chain_a4d2a657824ea3c4e231edee184c29b20}{00145}}\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacesysio_1_1chain_a4d2a657824ea3c4e231edee184c29b20}{block\_stage\_type}}\ =\ std::variant<building\_block,\ assembled\_block,\ completed\_block>;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00147}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state}{00147}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state}{pending\_state}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00148}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a13e2c50cfff7b6b71fb7492f4d1fb062}{00148}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a13e2c50cfff7b6b71fb7492f4d1fb062}{pending\_state}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\&\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}\&\ prev,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ when,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ num\_prev\_blocks\_to\_confirm,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00151}00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_protocol\_feature\_activations\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00152}00152\ \ \ \ :\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a517fdd298cc25b04ae5cd0392922e777}{\_db\_session}}(\ move(\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}})\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00153}00153\ \ \ \ ,\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1building__block}{building\_block}}(\ prev,\ when,\ num\_prev\_blocks\_to\_confirm,\ new\_protocol\_feature\_activations\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00154}00154\ \ \ \ \{\}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00155}00155\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00156}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a517fdd298cc25b04ae5cd0392922e777}{00156}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a517fdd298cc25b04ae5cd0392922e777}{\_db\_session}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00157}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{00157}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4d2a657824ea3c4e231edee184c29b20}{block\_stage\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00158}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae760ba9e1dec40b2ebf90dff08a3efec}{00158}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller::block\_status}}\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae760ba9e1dec40b2ebf90dff08a3efec}{\_block\_status}}\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00159}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a990d04e147e24c39dd40fe0be53109fb}{00159}}\ \ \ \ std::optional<block\_id\_type>\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a990d04e147e24c39dd40fe0be53109fb}{\_producer\_block\_id}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00160}00160\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00162}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a2c405d44fcef39bacfe70543cfe39f45}{00162}}\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__block__header__state}{pending\_block\_header\_state}}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a2c405d44fcef39bacfe70543cfe39f45}{get\_pending\_block\_header\_state}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00163}00163\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}})\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_pending\_block\_header\_state;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00166}00166\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_pending\_block\_header\_state;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00167}00167\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00168}00168\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00169}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_aaa0b61ca367d56e4954e753286a8f5fb}{00169}}\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_receipt>}}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_aaa0b61ca367d56e4954e753286a8f5fb}{get\_trx\_receipts}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00170}00170\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}})\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_pending\_trx\_receipts;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00173}00173\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}})\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_unsigned\_block-\/>transactions;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00175}00175\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00176}00176\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_block\_state-\/>block-\/>transactions;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00177}00177\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00179}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a7421746433955d65443ce99c8eb80162}{00179}}\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_metadata\_ptr>}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a7421746433955d65443ce99c8eb80162}{extract\_trx\_metas}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00180}00180\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}})\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::move(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_pending\_trx\_metas\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00182}00182\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00183}00183\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}})\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::move(\ std::get<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_trx\_metas\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00185}00185\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00186}00186\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_block\_state-\/>extract\_trxs\_metas();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00187}00187\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00188}00188\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00189}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a30e2df8beb27a0811a10a033d783caf8}{00189}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a30e2df8beb27a0811a10a033d783caf8}{is\_protocol\_feature\_activated}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{digest\_type}}\&\ feature\_digest\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00190}00190\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}})\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00191}00191\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00192}00192\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ activated\_features\ =\ bb.\_pending\_block\_header\_state.prev\_activated\_protocol\_features-\/>protocol\_features;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00194}00194\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ activated\_features.find(\ feature\_digest\ )\ !=\ activated\_features.end()\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00195}00195\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00196}00196\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ bb.\_num\_new\_protocol\_features\_that\_have\_activated\ ==\ 0\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00198}00198\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ end\ =\ bb.\_new\_protocol\_feature\_activations.begin()\ +\ bb.\_num\_new\_protocol\_features\_that\_have\_activated;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00199}00199\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (std::find(\ bb.\_new\_protocol\_feature\_activations.begin(),\ end,\ feature\_digest\ )\ !=\ end);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00200}00200\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00202}00202\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}})\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calling\ is\_protocol\_feature\_activated\ during\ the\ assembled\_block\ stage\ is\ not\ efficient.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ should\ avoid\ doing\ it.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00205}00205\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ fact\ for\ now\ it\ isn't\ even\ implemented.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ misc\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}checking\ if\ protocol\ feature\ is\ activated\ in\ the\ assembled\_block\ stage\ is\ not\ yet\ supported"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ implement\ this}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00209}00209\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00210}00210\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00211}00211\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ activated\_features\ =\ std::get<completed\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_ae74607271d60d9118b221f3596b16271}{\_block\_stage}}).\_block\_state-\/>activated\_protocol\_features-\/>protocol\_features;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00212}00212\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (activated\_features.find(\ feature\_digest\ )\ !=\ activated\_features.end());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00213}00213\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00214}00214\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00215}\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a6d01b8752e2c1422ca60ffa14a1b9c98}{00215}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a6d01b8752e2c1422ca60ffa14a1b9c98}{push}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00216}00216\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state_a517fdd298cc25b04ae5cd0392922e777}{\_db\_session}}.\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_ab35e3889eb7fd6cd0c65d2d349111050}{push}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00217}00217\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00218}00218\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00220}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl}{00220}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl}{controller\_impl}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00221}00221\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00222}00222\ \ \ \ \textcolor{comment}{//\ LLVM\ sets\ the\ new\ handler,\ we\ need\ to\ reset\ this\ to\ throw\ a\ bad\_alloc\ exception\ so\ we\ can\ possibly\ exit\ cleanly}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00223}00223\ \ \ \ \textcolor{comment}{//\ and\ not\ just\ abort.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00224}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler}{00224}}\ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler}{reset\_new\_handler}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00225}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler_a32e46acf3fe5190e6640413f0295ebee}{00225}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler_a32e46acf3fe5190e6640413f0295ebee}{reset\_new\_handler}}()\ \{\ std::set\_new\_handler([]()\{\ \textcolor{keywordflow}{throw}\ std::bad\_alloc();\ \});\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00226}00226\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00227}00227\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00228}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a342fd89592616d7ca931ff64fe75ead7}{00228}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler}{reset\_new\_handler}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a342fd89592616d7ca931ff64fe75ead7}{rnh}};\ \textcolor{comment}{//\ placed\ here\ to\ allow\ for\ this\ to\ be\ set\ before\ constructing\ the\ other\ fields}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00229}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{00229}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00230}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{00230}}\ \ \ \ std::function<void()>\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00231}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{00231}}\ \ \ \ \mbox{\hyperlink{classchainbase_1_1database}{chainbase::database}}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00232}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{00232}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{block\_log}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00233}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{00233}}\ \ \ \ std::optional<pending\_state>\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00234}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{00234}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00235}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{00235}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database}{fork\_database}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00236}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}{00236}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1wasm__interface}{wasm\_interface}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}{wasmif}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00237}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{00237}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager}{resource\_limits\_manager}}\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00238}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{00238}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager}{authorization\_manager}}\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00239}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{00239}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager}{protocol\_feature\_manager}}\ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00240}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{00240}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{controller::config}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00241}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{00241}}\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}};\ \textcolor{comment}{//\ read\ by\ thread\_pool\ threads,\ value\ will\ not\ be\ changed}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00242}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{00242}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00243}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{00243}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5e}{db\_read\_mode}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ =\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\_read\_mode::SPECULATIVE}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00244}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{00244}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ \textcolor{keyword}{false};\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00245}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}{00245}}\ \ \ \ std::optional<fc::microseconds>\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}{subjective\_cpu\_leeway}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00246}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{00246}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\_producer\_light\_validation}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00247}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{00247}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00248}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{00248}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool}{named\_thread\_pool}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00249}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{00249}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer}{platform\_timer}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00250}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4f73eb03cb9df364b792166a70f78320}{00250}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\_mind\_handler}}*\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4f73eb03cb9df364b792166a70f78320}{deep\_mind\_logger}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00251}00251\ \textcolor{preprocessor}{\#if\ defined(SYSIO\_SYS\_VM\_RUNTIME\_ENABLED)\ ||\ defined(SYSIO\_SYS\_VM\_JIT\_RUNTIME\_ENABLED)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00252}00252\ \ \ \ \mbox{\hyperlink{classsysio_1_1vm_1_1wasm__allocator}{vm::wasm\_allocator}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wasm\_alloc;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00253}00253\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00254}00254\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00255}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c}{00255}}\ \ \ \ \textcolor{keyword}{typedef}\ pair<scope\_name,action\_name>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c}{handler\_key}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00256}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a67d7a4050a78ec74aaf524a46bbcdf54}{00256}}\ \ \ \ map<\ account\_name,\ map<handler\_key,\ apply\_handler>\ >\ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a67d7a4050a78ec74aaf524a46bbcdf54}{apply\_handlers}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00257}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{00257}}\ \ \ \ unordered\_map<\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\_protocol\_feature\_t}},\ std::function<void(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl}{controller\_impl}}\&)>,\ \mbox{\hyperlink{structsysio_1_1chain_1_1enum__hash}{enum\_hash<builtin\_protocol\_feature\_t>}}\ >\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\_feature\_activation\_handlers}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00258}00258\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00259}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}{00259}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}{pop\_block}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00260}00260\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ prev\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_aee9daa00e2698a868ad36853e58d3908}{get\_block}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>header.previous\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00261}00261\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00262}00262\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !prev\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>header.previous,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}attempt\ to\ pop\ beyond\ last\ irreversible\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00264}00264\ \ \ \ \ \ \ \ \ \ prev\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00265}00265\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00266}00266\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00267}00267\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\_read\_mode::SPECULATIVE}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}attempting\ to\ pop\ a\ block\ that\ was\ sparsely\ loaded\ from\ a\ snapshot"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00269}00269\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00271}00271\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ prev;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00272}00272\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00273}00273\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a167bce30384de1f373ebe0c25d4d0de6}{undo}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00274}00274\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00275}00275\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a5b8ed9cc5cb5822d6cb645a3b7a5f98c}{popped\_blocks\_to}}(\ prev-\/>block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00276}00276\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00277}00277\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00278}00278\ \ \ \ \textcolor{keyword}{template}<builtin\_protocol\_feature\_t\ F>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00279}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744}{00279}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744}{on\_activation}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00280}00280\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00281}00281\ \ \ \ \textcolor{keyword}{template}<builtin\_protocol\_feature\_t\ F>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00282}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{00282}}\ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00283}00283\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ res\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\_feature\_activation\_handlers}}.emplace(\ F,\ \&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744}{controller\_impl::on\_activation<F>}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00284}00284\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ res.second,\ misc\_exception,\ \textcolor{stringliteral}{"{}attempting\ to\ set\ activation\ handler\ twice"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00285}00285\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00286}00286\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00287}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff}{00287}}\ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff}{trigger\_activation\_handler}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\_protocol\_feature\_t}}\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00288}00288\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\_feature\_activation\_handlers}}.find(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00289}00289\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ itr\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\_feature\_activation\_handlers}}.end()\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00290}00290\ \ \ \ \ \ \ (itr-\/>second)(\ *\textcolor{keyword}{this}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00291}00291\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00292}00292\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00293}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a866a2ded537cb72ff21ae968a7940432}{00293}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a866a2ded537cb72ff21ae968a7940432}{set\_apply\_handler}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ receiver,\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ contract,\ \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ab143988ae1cae85e839b01eb768804c3}{apply\_handler}}\ v\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00294}00294\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a67d7a4050a78ec74aaf524a46bbcdf54}{apply\_handlers}}[receiver][make\_pair(contract,\mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}})]\ =\ v;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00295}00295\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00296}00296\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00297}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afcd800bda7495ddc4ddee1074d5bfcb7}{00297}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afcd800bda7495ddc4ddee1074d5bfcb7}{controller\_impl}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{controller::config}}\&\ cfg,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set}{protocol\_feature\_set}}\&\&\ pfs,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00298}00298\ \ \ \ :\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a342fd89592616d7ca931ff64fe75ead7}{rnh}}(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00299}00299\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00300}00300\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}(\ cfg.state\_dir,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00301}00301\ \ \ \ \ \ \ \ \ cfg.\mbox{\hyperlink{namespacefc_a3d8a2be677709cc41f09aa7925f2d55fad6bcd1364809e1b881bb22334d14cd56}{read\_only}}\ ?\ \mbox{\hyperlink{classchainbase_1_1database}{database}}::\mbox{\hyperlink{namespacefc_a3d8a2be677709cc41f09aa7925f2d55fad6bcd1364809e1b881bb22334d14cd56}{read\_only}}\ :\ \mbox{\hyperlink{classchainbase_1_1database}{database}}::\mbox{\hyperlink{namespacefc_a3d8a2be677709cc41f09aa7925f2d55fa4eaf6936474fac52a87743f3de041c42}{read\_write}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00302}00302\ \ \ \ \ \ \ \ \ cfg.state\_size,\ false,\ cfg.db\_map\_mode\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00303}00303\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}(\ cfg.blocks\_dir,\ cfg.prune\_config\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00304}00304\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}(\ cfg.blocks\_dir\ /\ \mbox{\hyperlink{classconfig}{config}}::reversible\_blocks\_dir\_name\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00305}00305\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}{wasmif}}(\ cfg.wasm\_runtime,\ cfg.eosvmoc\_tierup,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ cfg.state\_dir,\ cfg.eosvmoc\_config,\ !cfg.profile\_accounts.empty()\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00306}00306\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\&\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}]()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}.get\_deep\_mind\_logger();\ \}),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00307}00307\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00308}00308\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}(\ std::move(pfs),\ [\&\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}]()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}.get\_deep\_mind\_logger();\ \}\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00309}00309\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}(\ cfg\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00310}00310\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00311}00311\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}(\ cfg.read\_mode\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00312}00312\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}(\ \textcolor{stringliteral}{"{}chain"{}},\ cfg.thread\_pool\_size\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00313}00313\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00314}00314\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a378b089fe1ff7ac016ee51058ff52cb2}{open}}(\ [\textcolor{keyword}{this}](\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00315}00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00316}00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_features\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60}{check\_protocol\_features}}(\ timestamp,\ cur\_features,\ new\_features\ );\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00318}00318\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00319}00319\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00320}00320\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::preactivate\_feature>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00321}00321\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::replace\_deferred>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00322}00322\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::get\_sender>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00323}00323\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::webauthn\_key>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00324}00324\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::wtmsig\_block\_signatures>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00325}00325\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::action\_return\_value>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00326}00326\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::configurable\_wasm\_limits>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00327}00327\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::blockchain\_parameters>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00328}00328\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::get\_code\_hash>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00329}00329\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::get\_block\_num>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00330}00330\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::crypto\_primitives>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00331}00331\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::em\_key>}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00332}00332\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00333}00333\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a27266ebf16b6dd19a860635f7d1f9930}{irreversible\_block}}.connect([\textcolor{keyword}{this}](\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ bsp)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}{wasmif}}.\mbox{\hyperlink{classsysio_1_1chain_1_1wasm__interface_ab8938ee3dc1cd9964f4d13671f0058bd}{current\_lib}}(bsp-\/>block\_num);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00335}00335\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00337}00337\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00338}00338\ \textcolor{preprocessor}{\#define\ SET\_APP\_HANDLER(\ receiver,\ contract,\ action)\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00339}00339\ \textcolor{preprocessor}{\ \ \ set\_apply\_handler(\ account\_name(\#receiver),\ account\_name(\#contract),\ action\_name(\#action),\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00340}00340\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&BOOST\_PP\_CAT(apply\_,\ BOOST\_PP\_CAT(contract,\ BOOST\_PP\_CAT(\_,action)\ )\ )\ )}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00341}00341\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00342}00342\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ newaccount\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00343}00343\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ setcode\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00344}00344\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ setabi\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00345}00345\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ updateauth\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00346}00346\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ deleteauth\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00347}00347\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ linkauth\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00348}00348\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ unlinkauth\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00349}00349\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00350}00350\ \textcolor{comment}{\ \ \ SET\_APP\_HANDLER(\ sysio,\ sysio,\ postrecovery\ );}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00351}00351\ \textcolor{comment}{\ \ \ SET\_APP\_HANDLER(\ sysio,\ sysio,\ passrecovery\ );}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00352}00352\ \textcolor{comment}{\ \ \ SET\_APP\_HANDLER(\ sysio,\ sysio,\ vetorecovery\ );}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00353}00353\ \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00354}00354\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00355}00355\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ canceldelay\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00356}00356\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00357}00357\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00367}00367\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Signal,\ \textcolor{keyword}{typename}\ Arg>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00368}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{00368}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \textcolor{keyword}{const}\ Signal\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ Arg\&\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00369}00369\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}(\ std::forward<Arg>(\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ ));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00371}00371\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (std::bad\_alloc\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}std::bad\_alloc:\ \$\{w\}"{}},\ (\textcolor{stringliteral}{"{}w"{}},\ e.what())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ e;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00374}00374\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (boost::interprocess::bad\_alloc\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00375}00375\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}boost::interprocess::bad\ alloc:\ \$\{w\}"{}},\ (\textcolor{stringliteral}{"{}w"{}},\ e.what())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ e;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00377}00377\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ controller\_emit\_signal\_exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00378}00378\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}controller\_emit\_signal\_exception:\ \$\{details\}"{}},\ (\textcolor{stringliteral}{"{}details"{}},\ e.to\_detail\_string())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00379}00379\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ e;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00380}00380\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00381}00381\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}fc::exception:\ \$\{details\}"{}},\ (\textcolor{stringliteral}{"{}details"{}},\ e.to\_detail\_string())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00382}00382\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00383}00383\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}std::exception:\ \$\{details\}"{}},\ (\textcolor{stringliteral}{"{}details"{}},\ e.what())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00384}00384\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ ...\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}signal\ handler\ threw\ exception"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00386}00386\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00387}00387\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00388}00388\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00389}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{00389}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\&\ t)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00390}00390\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00391}00391\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_applied\_transaction(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}()\ +\ 1,\ t);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00392}00392\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00393}00393\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00394}00394\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00395}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{00395}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\_irreversible}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00396}00396\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}fork\ database\ not\ properly\ initialized"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00397}00397\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00398}00398\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ log\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00399}00399\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00400}00400\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lib\_num\ =\ log\_head\ ?\ log\_head-\/>block\_num()\ :\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ -\/\ 1);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00401}00401\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00402}00402\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ root\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00403}00403\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00404}00404\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ log\_head\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00405}00405\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ root\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a4d0b6ecf420faffc4f00ba6af3d0af99}{head\_id}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}fork\ database\ root\ does\ not\ match\ block\ log\ head"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00406}00406\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ ==\ lib\_num,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}empty\ block\ log\ expects\ the\ first\ appended\ block\ to\ build\ off\ a\ block\ that\ is\ not\ the\ fork\ database\ root.\ root\ block\ number:\ \$\{block\_num\},\ lib:\ \$\{lib\_num\}"{}},\ (\textcolor{stringliteral}{"{}block\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num)\ (\textcolor{stringliteral}{"{}lib\_num"{}},\ lib\_num)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00409}00409\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00410}00410\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00411}00411\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fork\_head\ =\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}})\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}()\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00412}00412\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00413}00413\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ fork\_head-\/>dpos\_irreversible\_blocknum\ <=\ lib\_num\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00415}00415\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00416}00416\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ branch\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a18e51b748469f97473d120ef69e1da22}{fetch\_branch}}(\ fork\_head-\/>id,\ fork\_head-\/>dpos\_irreversible\_blocknum\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00417}00417\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00418}00418\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00419}00419\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ bitr\ =\ branch.rbegin();\ bitr\ !=\ branch.rend();\ ++bitr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00421}00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ *bitr,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00422}00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ (*bitr);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00424}00424\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00425}00425\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00426}00426\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a27266ebf16b6dd19a860635f7d1f9930}{irreversible\_block}},\ *bitr\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00427}00427\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ blog.append\ could\ fail\ due\ to\ failures\ like\ running\ out\ of\ space.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ it\ before\ commit\ so\ that\ in\ case\ it\ throws,\ DB\ can\ be\ rolled\ back.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00430}00430\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_aca2eca093aee072fc3f599a7c642a227}{append}}(\ (*bitr)-\/>block\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00431}00431\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00432}00432\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_aca6d7bcd700644f077b89203b2e8b7ef}{commit}}(\ (*bitr)-\/>block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \ \ \ root\_id\ =\ (*bitr)-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00434}00434\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00435}00435\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ std::exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ root\_id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_ae911acbc996994cb6dfd21fddfb89a45}{advance\_root}}(\ root\_id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00440}00440\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00441}00441\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00442}00442\ \ \ \ \ \ \ \textcolor{comment}{//db.commit(\ fork\_head-\/>dpos\_irreversible\_blocknum\ );\ //\ redundant}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00443}00443\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00444}00444\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ root\_id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00445}00445\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_ae911acbc996994cb6dfd21fddfb89a45}{advance\_root}}(\ root\_id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00446}00446\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00447}00447\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00448}00448\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00452}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d}{00452}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d}{initialize\_blockchain\_state}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\_state}}\&\ genesis)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00453}00453\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}Initializing\ new\ blockchain\ with\ genesis\ state"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00454}00454\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule}{producer\_authority\_schedule}}\ initial\_schedule\ =\ \{\ 0,\ \{\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority}{producer\_authority}}\{config::system\_account\_name,\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__signing__authority__v0}{block\_signing\_authority\_v0}}\{\ 1,\ \{\{genesis.initial\_key,\ 1\}\}\ \}\ \}\ \}\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00455}00455\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1producer__schedule__type}{legacy::producer\_schedule\_type}}\ initial\_legacy\_schedule\{\ 0,\ \{\{config::system\_account\_name,\ genesis.initial\_key\}\}\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00456}00456\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00457}00457\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}\ genheader;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00458}00458\ \ \ \ \ \ \ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1detail_1_1block__header__state__common_abfdafe630675287e81a2bc479aa6ce20}{active\_schedule}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ initial\_schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00459}00459\ \ \ \ \ \ \ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a5345ec8573d52d400076e739db4cccce}{pending\_schedule}}.\mbox{\hyperlink{structsysio_1_1chain_1_1detail_1_1schedule__info_a4f1fa6ff028fd822e1e566bdb7dd95a7}{schedule}}\ \ \ \ \ \ =\ initial\_schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00460}00460\ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ if\ wtmsig\ block\ signatures\ are\ enabled\ at\ genesis\ time\ this\ should\ be\ the\ hash\ of\ a\ producer\ authority\ schedule}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00461}00461\ \ \ \ \ \ \ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a5345ec8573d52d400076e739db4cccce}{pending\_schedule}}.\mbox{\hyperlink{structsysio_1_1chain_1_1detail_1_1schedule__info_ace19480f2ab629e6b82a3a8286b38729}{schedule\_hash}}\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(initial\_legacy\_schedule);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00462}00462\ \ \ \ \ \ \ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a6f6971715037cfbddcfbd54a88ff4d0f}{header}}.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a0fe1e5860e2b78b0a14da6565e2294bb}{timestamp}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ genesis.initial\_timestamp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00463}00463\ \ \ \ \ \ \ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a6f6971715037cfbddcfbd54a88ff4d0f}{header}}.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a4096ec8f931ab9180ae80f6e06332103}{action\_mroot}}\ \ \ \ \ \ \ \ \ \ \ \ =\ genesis.compute\_chain\_id();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00464}00464\ \ \ \ \ \ \ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a19f6899e80705092e990411eaed6e7a8}{id}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a6f6971715037cfbddcfbd54a88ff4d0f}{header}}.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_ab1f18a64cbf39c54da83f75c9632f9cd}{calculate\_id}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00465}00465\ \ \ \ \ \ \ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1detail_1_1block__header__state__common_ae85e3375836639cb1e7543aea7cf0552}{block\_num}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a6f6971715037cfbddcfbd54a88ff4d0f}{header}}.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a84daf28c790313cfaffff12e2a962cdb}{block\_num}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00466}00466\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00467}00467\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ std::make\_shared<block\_state>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00468}00468\ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}\&\textcolor{keyword}{>}(*head)\ =\ genheader;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00469}00469\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a20bdbb99af936c532c6c316d8abc981c}{activated\_protocol\_features}}\ =\ std::make\_shared<protocol\_feature\_activation\_set>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00470}00470\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\ =\ std::make\_shared<signed\_block>(genheader.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state_a6f6971715037cfbddcfbd54a88ff4d0f}{header}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00471}00471\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a24e7f6336cad0bd2fc280dab381665ed}{set\_revision}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00472}00472\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde}{initialize\_database}}(genesis);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00473}00473\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00474}00474\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00475}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647}{00475}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647}{replay}}(std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00476}00476\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ \&\&\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00477}00477\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00478}00478\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00479}00479\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00480}00480\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00481}00481\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ blog\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00482}00482\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00483}00483\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ start\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00484}00484\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ start\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00485}00485\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00486}00486\ \ \ \ \ \ \ std::exception\_ptr\ except\_ptr;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00487}00487\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00488}00488\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ blog\_head\ \&\&\ start\_block\_num\ <=\ blog\_head-\/>block\_num()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00489}00489\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}existing\ block\ log,\ attempting\ to\ replay\ from\ \$\{s\}\ to\ \$\{n\}\ blocks"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00490}00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}s"{}},\ start\_block\_num)(\textcolor{stringliteral}{"{}n"{}},\ blog\_head-\/>block\_num())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00491}00491\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00492}00492\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \textcolor{keyword}{auto}\ next\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a99c59d29b262144ad99eacc827f76107}{read\_block\_by\_num}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00493}00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}{replay\_push\_block}}(\ next,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00494}00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_shutdown()\ )\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00495}00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ next-\/>block\_num()\ \%\ 500\ ==\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00496}00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}\$\{n\}\ of\ \$\{head\}"{}},\ (\textcolor{stringliteral}{"{}n"{}},\ next-\/>block\_num())(\textcolor{stringliteral}{"{}head"{}},\ blog\_head-\/>block\_num())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00497}00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00498}00498\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00499}00499\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \ \textcolor{keyword}{const}\ database\_guard\_exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00500}00500\ \ \ \ \ \ \ \ \ \ \ \ \ except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00501}00501\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00502}00502\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}\$\{n\}\ irreversible\ blocks\ replayed"{}},\ (\textcolor{stringliteral}{"{}n"{}},\ 1\ +\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ -\/\ start\_block\_num)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00503}00503\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00504}00504\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ pending\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00505}00505\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ pending\_head\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00506}00506\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}fork\ database\ head\ \$\{h\},\ root\ \$\{r\}"{}},\ (\textcolor{stringliteral}{"{}h"{}},\ pending\_head-\/>block\_num)(\ \textcolor{stringliteral}{"{}r"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00507}00507\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ pending\_head-\/>block\_num\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ ||\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00508}00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}resetting\ fork\ database\ with\ new\ last\ irreversible\ block\ as\ the\ new\ root:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00509}00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00510}00510\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00511}00511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ new\_root\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a17185d8543965b7cd40066019bbf5740}{search\_on\_branch}}(\ pending\_head-\/>id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00512}00512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ new\_root,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00513}00513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}unexpected\ error:\ could\ not\ find\ new\ LIB\ in\ fork\ database"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00514}00514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}advancing\ fork\ database\ root\ to\ new\ last\ irreversible\ block\ within\ existing\ fork\ database:\ \$\{id\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00515}00515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ new\_root-\/>id)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00516}00516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ new\_root\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00517}00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_ae911acbc996994cb6dfd21fddfb89a45}{advance\_root}}(\ new\_root-\/>id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00518}00518\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00519}00519\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00520}00520\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00521}00521\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ irreverible\ log\ is\ played\ without\ undo\ sessions\ enabled,\ we\ need\ to\ sync\ the}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00522}00522\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ revision\ ordinal\ to\ the\ appropriate\ expected\ value\ here.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00523}00523\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00524}00524\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a24e7f6336cad0bd2fc280dab381665ed}{set\_revision}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00525}00525\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00526}00526\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}no\ irreversible\ blocks\ need\ to\ be\ replayed"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00527}00527\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00528}00528\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00529}00529\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !except\_ptr\ \&\&\ !check\_shutdown()\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00530}00530\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ head\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00531}00531\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ branch\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a18e51b748469f97473d120ef69e1da22}{fetch\_branch}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00532}00532\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rev\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00533}00533\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ i\ =\ branch.rbegin();\ i\ !=\ branch.rend();\ ++i\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00534}00534\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_shutdown()\ )\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00535}00535\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (*i)-\/>block\_num\ <=\ head\_block\_num\ )\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00536}00536\ \ \ \ \ \ \ \ \ \ \ \ \ ++rev;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00537}00537\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}{replay\_push\_block}}(\ (*i)-\/>block,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00538}00538\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00539}00539\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}\$\{n\}\ reversible\ blocks\ replayed"{}},\ (\textcolor{stringliteral}{"{}n"{}},rev)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00540}00540\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00541}00541\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00542}00542\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00543}00543\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00544}00544\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00545}00545\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00546}00546\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ end\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00547}00547\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}replayed\ \$\{n\}\ blocks\ in\ \$\{duration\}\ seconds,\ \$\{mspb\}\ ms/block"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00548}00548\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}n"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1\ -\/\ start\_block\_num)(\textcolor{stringliteral}{"{}duration"{}},\ (end-\/start).count()/1000000)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00549}00549\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}mspb"{}},\ ((end-\/start).count()/1000.0)/(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num-\/start\_block\_num))\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00550}00550\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00551}00551\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00552}00552\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ except\_ptr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00553}00553\ \ \ \ \ \ \ \ \ \ std::rethrow\_exception(\ except\_ptr\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00554}00554\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00555}00555\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00556}00556\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00557}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a18bcf25847599b0f9caa6566364bb0ac}{00557}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a18bcf25847599b0f9caa6566364bb0ac}{startup}}(std::function<\textcolor{keywordtype}{void}()>\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}},\ std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\_reader\_ptr}}\&\ snapshot)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00558}00558\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ snapshot,\ snapshot\_exception,\ \textcolor{stringliteral}{"{}No\ snapshot\ reader\ provided"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00559}00559\ \ \ \ \ \ \ this-\/>shutdown\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00560}00560\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}Starting\ initialization\ from\ snapshot,\ this\ may\ take\ a\ significant\ amount\ of\ time"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00561}00561\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00562}00562\ \ \ \ \ \ \ \ \ \ snapshot-\/>validate();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00563}00563\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00564}00564\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}{read\_from\_snapshot}}(\ snapshot,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00565}00565\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00566}00566\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}{read\_from\_snapshot}}(\ snapshot,\ 0,\ std::numeric\_limits<uint32\_t>::max()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00567}00567\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00568}00568\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ lib\_num\ >\ 0,\ snapshot\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00569}00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Snapshot\ indicates\ controller\ head\ at\ block\ number\ 0,\ but\ that\ is\ not\ allowed.\ "{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00570}00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Snapshot\ is\ invalid."{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00571}00571\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ lib\_num\ +\ 1\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00572}00572\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00573}00573\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ hash\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6}{calculate\_integrity\_hash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00574}00574\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}database\ initialized\ with\ hash:\ \$\{hash\}"{}},\ (\textcolor{stringliteral}{"{}hash"{}},\ hash)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00575}00575\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00576}00576\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_8h_a02fd73d861ef2e4aabb38c0c9ff82947}{init}}(check\_shutdown);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00577}00577\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}Finished\ initialization\ from\ snapshot"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00578}00578\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (boost::interprocess::bad\_alloc\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00579}00579\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}Failed\ initialization\ from\ snapshot\ -\/\ db\ storage\ not\ configured\ to\ have\ enough\ storage\ for\ the\ provided\ snapshot,\ please\ increase\ and\ retry\ snapshot"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00580}00580\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00581}00581\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00582}00582\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00583}00583\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00584}00584\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00585}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a7863870ecde398ac7def54e4814db6bc}{00585}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a7863870ecde398ac7def54e4814db6bc}{startup}}(std::function<\textcolor{keywordtype}{void}()>\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}},\ std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\_state}}\&\ genesis)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00586}00586\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ <\ 1,\ \mbox{\hyperlink{namespacesysio_1_1chain_a6b9cb254135911c4a6d577a9ab7fdd4e}{database\_exception}},\ \textcolor{stringliteral}{"{}This\ version\ of\ controller::startup\ only\ works\ with\ a\ fresh\ state\ database."{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00587}00587\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ genesis\_chain\_id\ =\ genesis.compute\_chain\_id();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00588}00588\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ genesis\_chain\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ chain\_id\_type\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00589}00589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}genesis\ state\ provided\ to\ startup\ corresponds\ to\ a\ chain\ ID\ (\$\{genesis\_chain\_id\})\ that\ does\ not\ match\ the\ chain\ ID\ that\ controller\ was\ constructed\ with\ (\$\{controller\_chain\_id\})"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00590}00590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}genesis\_chain\_id"{}},\ genesis\_chain\_id)(\textcolor{stringliteral}{"{}controller\_chain\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}})}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00591}00591\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00592}00592\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00593}00593\ \ \ \ \ \ \ this-\/>shutdown\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00594}00594\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00595}00595\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00596}00596\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a611cc70b13dee823c43ffe99df5522d4}{rollback\_head\_to\_root}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00597}00597\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00598}00598\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}No\ existing\ chain\ state.\ Initializing\ fresh\ blockchain\ state."{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00599}00599\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00600}00600\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}No\ existing\ chain\ state\ or\ fork\ database.\ Initializing\ fresh\ blockchain\ state\ and\ resetting\ fork\ database."{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00601}00601\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00602}00602\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d}{initialize\_blockchain\_state}}(genesis);\ \textcolor{comment}{//\ sets\ head\ to\ genesis\ state}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00603}00603\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00604}00604\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00605}00605\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00606}00606\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00607}00607\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00608}00608\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00609}00609\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ ==\ 1,\ block\_log\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00610}00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ log\ does\ not\ start\ with\ genesis\ block"{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00611}00611\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00612}00612\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00613}00613\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ genesis,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00614}00614\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00615}00615\ \ \ \ \ \ \ \mbox{\hyperlink{lib_8h_a02fd73d861ef2e4aabb38c0c9ff82947}{init}}(check\_shutdown);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00616}00616\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00617}00617\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00618}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a90da90c73cb32b5e5ec498da5e02753f}{00618}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a90da90c73cb32b5e5ec498da5e02753f}{startup}}(std::function<\textcolor{keywordtype}{void}()>\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}},\ std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00619}00619\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >=\ 1,\ \mbox{\hyperlink{namespacesysio_1_1chain_a6b9cb254135911c4a6d577a9ab7fdd4e}{database\_exception}},\ \textcolor{stringliteral}{"{}This\ version\ of\ controller::startup\ does\ not\ work\ with\ a\ fresh\ state\ database."{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00620}00620\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}No\ existing\ fork\ database\ despite\ existing\ chain\ state.\ Replay\ required."{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00621}00621\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00622}00622\ \ \ \ \ \ \ this-\/>shutdown\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00623}00623\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00624}00624\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ first\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00625}00625\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00626}00626\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ first\_block\_num\ <=\ lib\_num\ \&\&\ lib\_num\ <=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00627}00627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block\_log\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00628}00628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ log\ (ranging\ from\ \$\{block\_log\_first\_num\}\ to\ \$\{block\_log\_last\_num\})\ does\ not\ contain\ the\ last\ irreversible\ block\ (\$\{fork\_db\_lib\})"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00629}00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_first\_num"{}},\ first\_block\_num)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00630}00630\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_last\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num())}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00631}00631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}fork\_db\_lib"{}},\ lib\_num)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00632}00632\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00633}00633\ \ \ \ \ \ \ \ \ \ lib\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00634}00634\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00635}00635\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ first\_block\_num\ !=\ (lib\_num\ +\ 1)\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00636}00636\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ lib\_num\ +\ 1\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00637}00637\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00638}00638\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00639}00639\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00640}00640\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00641}00641\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a611cc70b13dee823c43ffe99df5522d4}{rollback\_head\_to\_root}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00642}00642\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00643}00643\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00644}00644\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00645}00645\ \ \ \ \ \ \ \mbox{\hyperlink{lib_8h_a02fd73d861ef2e4aabb38c0c9ff82947}{init}}(check\_shutdown);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00646}00646\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00647}00647\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00648}00648\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00649}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139}{00649}}\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139}{validate\_db\_version}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classchainbase_1_1database}{chainbase::database}}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00650}00650\ \ \ \ \ \ \ \textcolor{comment}{//\ check\ database\ version}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00651}00651\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ header\_idx\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a7d61e01ac919d654401a1db8399a3945}{database\_header\_multi\_index}}>().indices().get<by\_id>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00652}00652\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00653}00653\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(header\_idx.begin()\ !=\ header\_idx.end(),\ bad\_database\_version\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00654}00654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}state\ database\ version\ pre-\/dates\ versioning,\ please\ restore\ from\ a\ compatible\ snapshot\ or\ replay!"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00655}00655\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00656}00656\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ header\_itr\ =\ header\_idx.begin();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00657}00657\ \ \ \ \ \ \ header\_itr-\/>validate();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00658}00658\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00659}00659\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ header\_itr;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00660}00660\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00661}00661\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00662}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9efbc515682ae5dede91184c36af73f7}{00662}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9efbc515682ae5dede91184c36af73f7}{init}}(std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00663}00663\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ header\_itr\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139}{validate\_db\_version}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00664}00664\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00665}00665\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00666}00666\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ state\_chain\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>().\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00667}00667\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ state\_chain\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ chain\_id\_type\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00668}00668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}chain\ ID\ in\ state\ (\$\{state\_chain\_id\})\ does\ not\ match\ the\ chain\ ID\ that\ controller\ was\ constructed\ with\ (\$\{controller\_chain\_id\})"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00669}00669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}state\_chain\_id"{}},\ state\_chain\_id)(\textcolor{stringliteral}{"{}controller\_chain\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}})}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00670}00670\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00671}00671\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00672}00672\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00673}00673\ \ \ \ \ \ \ \textcolor{comment}{//\ upgrade\ to\ the\ latest\ compatible\ version}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00674}00674\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (header\_itr-\/>version\ !=\ database\_header\_object::current\_version)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00675}00675\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(*header\_itr,\ [](\textcolor{keyword}{auto}\&\ header)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00676}00676\ \ \ \ \ \ \ \ \ \ \ \ \ header.version\ =\ database\_header\_object::current\_version;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00677}00677\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00678}00678\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00679}00679\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00680}00680\ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ head\ !=\ nullptr}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00681}00681\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00682}00682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}fork\ database\ head\ (\$\{head\})\ is\ inconsistent\ with\ state\ (\$\{db\})"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00683}00683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}db"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}())(\textcolor{stringliteral}{"{}head"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00684}00684\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00685}00685\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00686}00686\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}database\ revision\ (\$\{db\})\ is\ greater\ than\ head\ block\ number\ (\$\{head\}),\ "{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00687}00687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}attempting\ to\ undo\ pending\ changes"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00688}00688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}db"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}())(\textcolor{stringliteral}{"{}head"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00689}00689\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00690}00690\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00691}00691\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a167bce30384de1f373ebe0c25d4d0de6}{undo}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00692}00692\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00693}00693\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00694}00694\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a573b85f64307919aa077810980b74b43}{init}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00695}00695\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00696}00696\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00697}00697\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_startup(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00698}00698\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00699}00699\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00700}00700\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647}{replay}}(\ check\_shutdown\ );\ \textcolor{comment}{//\ replay\ any\ irreversible\ and\ reversible\ blocks\ ahead\ of\ current\ head}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00701}00701\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00702}00702\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_shutdown()\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00703}00703\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00704}00704\ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ head\ !=\ nullptr\ \&\&\ fork\_db.head()\ !=\ nullptr\ \&\&\ fork\_db.root()\ !=\ nullptr.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00705}00705\ \ \ \ \ \ \ \textcolor{comment}{//\ Furthermore,\ fork\_db.root()-\/>block\_num\ <=\ lib\_num.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00706}00706\ \ \ \ \ \ \ \textcolor{comment}{//\ Also,\ even\ though\ blog.head()\ may\ still\ be\ nullptr,\ blog.first\_block\_num()\ is\ guaranteed\ to\ be\ lib\_num\ +\ 1.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00707}00707\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00708}00708\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00709}00709\ \ \ \ \ \ \ \ \ \ \ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}()-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00710}00710\ \ \ \ \ \ \ \ \ \ \ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00711}00711\ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00712}00712\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}read\_mode\ has\ changed\ from\ irreversible:\ applying\ best\ branch\ from\ fork\ database"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00713}00713\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00714}00714\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ pending\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00715}00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pending\_head-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00716}00716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pending\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}()}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00717}00717\ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00718}00718\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}applying\ branch\ from\ fork\ database\ ending\ with\ block:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ pending\_head-\/>id)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00719}00719\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\_switch\_forks}}(\ pending\_head,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\_branch\_callback}}\{\},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00720}00720\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00721}00721\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00722}00722\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00723}00723\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00724}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af239089382ffa593908091df9d6d0cbd}{00724}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af239089382ffa593908091df9d6d0cbd}{\string~controller\_impl}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00725}00725\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}.\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool_a2cf9d662cfa57de6d29cd900f8375208}{stop}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00726}00726\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.reset();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00727}00727\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00728}00728\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00729}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac7dedae4e6f8bcbd20e69d1e5551e378}{00729}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac7dedae4e6f8bcbd20e69d1e5551e378}{add\_indices}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00730}00730\ \ \ \ \ \ \ controller\_index\_set::add\_indices(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00731}00731\ \ \ \ \ \ \ contract\_database\_index\_set::add\_indices(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00732}00732\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00733}00733\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a112c1fae696fe6f53103076e9afa5a16}{add\_indices}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00734}00734\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_acc5c0d662f97873d93dadbf8b6451978}{add\_indices}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00735}00735\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00736}00736\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00737}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ade7505662796ff416f1d43862b0507fb}{00737}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ade7505662796ff416f1d43862b0507fb}{clear\_all\_undo}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00738}00738\ \ \ \ \ \ \ \textcolor{comment}{//\ Rewind\ the\ database\ to\ the\ last\ irreversible\ block}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00739}00739\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a832c383b7d8573d399e6149d4c715bd6}{undo\_all}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00740}00740\ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00741}00741\ \textcolor{comment}{\ \ \ \ \ \ FC\_ASSERT(db.revision()\ ==\ self.head\_block\_num(),}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00742}00742\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}Chainbase\ revision\ does\ not\ match\ head\ block\ num"{},}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00743}00743\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ("{}rev"{},\ db.revision())("{}head\_block"{},\ self.head\_block\_num()));}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00744}00744\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00745}00745\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00746}00746\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00747}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148}{00747}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148}{add\_contract\_tables\_to\_snapshot}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a80afaa06d96e661a0f93e0ba4b09c8dc}{snapshot\_writer\_ptr}}\&\ snapshot\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00748}00748\ \ \ \ \ \ \ snapshot-\/>write\_section(\textcolor{stringliteral}{"{}contract\_tables"{}},\ [\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00749}00749\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1index__utils_a20f6cbb7f55f78ff4d35a4bf7e928a86}{index\_utils<table\_id\_multi\_index>::walk}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section](\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1table__id__object}{table\_id\_object}}\&\ table\_row\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00750}00750\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ a\ row\ for\ the\ table}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00751}00751\ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(table\_row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00752}00752\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00753}00753\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ followed\ by\ a\ size\ row\ and\ then\ N\ data\ rows\ for\ each\ type\ of\ table}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00754}00754\ \ \ \ \ \ \ \ \ \ \ \ \ contract\_database\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&section,\ \&table\_row](\ \textcolor{keyword}{auto}\ utils\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00755}00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }utils\_t\ =\ \textcolor{keyword}{decltype}(utils);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00756}00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }value\_t\ =\ \textcolor{keyword}{typename}\ \textcolor{keyword}{decltype}(utils)::index\_t::value\_type;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00757}00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }by\_table\_id\ =\ \mbox{\hyperlink{namespacesysio_1_1chain_a551a62ef64d082b2bbc5a50e2b6ccaa9}{object\_to\_table\_id\_tag\_t<value\_t>}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00758}00758\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00759}00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tid\_key\ =\ boost::make\_tuple(table\_row.id);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00760}00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ next\_tid\_key\ =\ boost::make\_tuple(\mbox{\hyperlink{classchainbase_1_1oid}{table\_id\_object::id\_type}}(table\_row.id.\mbox{\hyperlink{classchainbase_1_1oid_a572c4ef080a7db37d93631ab0fbb123a}{\_id}}\ +\ 1));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00761}00761\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00762}00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structfc_1_1unsigned__int}{unsigned\_int}}\ size\ =\ utils\_t::template\ size\_range<by\_table\_id>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ tid\_key,\ next\_tid\_key);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00763}00763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(size,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00764}00764\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00765}00765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ utils\_t::template\ walk\_range<by\_table\_id>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ tid\_key,\ next\_tid\_key,\ [\textcolor{keyword}{this},\ \&section](\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&row\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00766}00766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00767}00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00768}00768\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00769}00769\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00770}00770\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00771}00771\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00772}00772\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00773}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22}{00773}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22}{read\_contract\_tables\_from\_snapshot}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\_reader\_ptr}}\&\ snapshot\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00774}00774\ \ \ \ \ \ \ snapshot-\/>read\_section(\textcolor{stringliteral}{"{}contract\_tables"{}},\ [\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00775}00775\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ more\ =\ !section.empty();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00776}00776\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (more)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00777}00777\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ read\ the\ row\ for\ the\ table}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00778}00778\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classchainbase_1_1oid}{table\_id\_object::id\_type}}\ t\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00779}00779\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1index__utils_a4ba170946682ddcea81d558b0ee8899a}{index\_utils<table\_id\_multi\_index>::create}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section,\ \&t\_id](\textcolor{keyword}{auto}\&\ row)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00780}00780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00781}00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\_id\ =\ row.id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00782}00782\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00783}00783\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00784}00784\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ read\ the\ size\ and\ data\ rows\ for\ each\ type\ of\ table}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00785}00785\ \ \ \ \ \ \ \ \ \ \ \ \ contract\_database\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&section,\ \&t\_id,\ \&more](\textcolor{keyword}{auto}\ utils)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00786}00786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }utils\_t\ =\ \textcolor{keyword}{decltype}(utils);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00787}00787\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00788}00788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structfc_1_1unsigned__int}{unsigned\_int}}\ size;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00789}00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ more\ =\ section.read\_row(size,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00790}00790\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00791}00791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ idx\ =\ 0;\ idx\ <\ size.\mbox{\hyperlink{structfc_1_1unsigned__int_ac54ac972d3e38a5852616aaee955ff3f}{value}};\ idx++)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00792}00792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ utils\_t::create(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section,\ \&more,\ \&t\_id](\textcolor{keyword}{auto}\&\ row)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00793}00793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ row.t\_id\ =\ t\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00794}00794\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ more\ =\ section.read\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00795}00795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00796}00796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00797}00797\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00798}00798\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00799}00799\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00800}00800\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00801}00801\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00802}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795}{00802}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795}{add\_to\_snapshot}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a80afaa06d96e661a0f93e0ba4b09c8dc}{snapshot\_writer\_ptr}}\&\ snapshot\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00803}00803\ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ in\ case\ the\ previous\ call\ to\ clear\ did\ not\ finish\ in\ time\ of\ deadline}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00804}00804\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}{clear\_expired\_input\_transactions}}(\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00805}00805\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00806}00806\ \ \ \ \ \ \ snapshot-\/>write\_section<\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header}{chain\_snapshot\_header}}>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00807}00807\ \ \ \ \ \ \ \ \ \ section.add\_row(\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header}{chain\_snapshot\_header}}(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00808}00808\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00809}00809\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00810}00810\ \ \ \ \ \ \ snapshot-\/>write\_section<\mbox{\hyperlink{structsysio_1_1chain_1_1block__state}{block\_state}}>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00811}00811\ \ \ \ \ \ \ \ \ \ section.template\ add\_row<block\_header\_state>(*\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00812}00812\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00813}00813\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00814}00814\ \ \ \ \ \ \ controller\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&snapshot](\ \textcolor{keyword}{auto}\ utils\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00815}00815\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }value\_t\ =\ \textcolor{keyword}{typename}\ \textcolor{keyword}{decltype}(utils)::index\_t::value\_type;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00816}00816\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00817}00817\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ table\_id\_object\ as\ its\ inlined\ with\ contract\ tables\ section}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00818}00818\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ table\_id\_object>::value)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00819}00819\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00820}00820\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00821}00821\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00822}00822\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ database\_header\ as\ it\ is\ only\ relevant\ to\ in-\/memory\ database}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00823}00823\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ database\_header\_object>::value)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00824}00824\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00825}00825\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00826}00826\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00827}00827\ \ \ \ \ \ \ \ \ \ snapshot-\/>write\_section<value\_t>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00828}00828\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{decltype}(utils)::walk(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section](\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&row\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00829}00829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00830}00830\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00831}00831\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00832}00832\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00833}00833\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00834}00834\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148}{add\_contract\_tables\_to\_snapshot}}(snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00835}00835\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00836}00836\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a24e23281d4ccfdddcc761c83e14a4080}{add\_to\_snapshot}}(snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00837}00837\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a7160417d30f5ef3a91467fefebf65dc6}{add\_to\_snapshot}}(snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00838}00838\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00839}00839\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00840}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47}{00840}}\ \ \ \ \textcolor{keyword}{static}\ std::optional<genesis\_state>\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47}{extract\_legacy\_genesis\_state}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1snapshot__reader}{snapshot\_reader}}\&\ snapshot,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ version\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00841}00841\ \ \ \ \ \ \ std::optional<genesis\_state>\ genesis;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00842}00842\ \ \ \ \ \ \ \textcolor{keyword}{using\ }v2\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1snapshot__global__property__object__v2}{legacy::snapshot\_global\_property\_object\_v2}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00843}00843\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00844}00844\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(version,\ v2::minimum\_version,\ v2::maximum\_version)\ ==\ version\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00845}00845\ \ \ \ \ \ \ \ \ \ genesis.emplace();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00846}00846\ \ \ \ \ \ \ \ \ \ snapshot.read\_section<\mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\_state}}>([\&genesis=*genesis](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00847}00847\ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(genesis);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00848}00848\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00849}00849\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00850}00850\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ genesis;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00851}00851\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00852}00852\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00853}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}{00853}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}{read\_from\_snapshot}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\_reader\_ptr}}\&\ snapshot,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ blog\_start,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ blog\_end\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00854}00854\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header}{chain\_snapshot\_header}}\ header;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00855}00855\ \ \ \ \ \ \ snapshot-\/>read\_section<\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header}{chain\_snapshot\_header}}>([\textcolor{keyword}{this},\ \&header](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00856}00856\ \ \ \ \ \ \ \ \ \ section.read\_row(header,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00857}00857\ \ \ \ \ \ \ \ \ \ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a6f183a866ea3a474243c55484f0c700e}{validate}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00858}00858\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00859}00859\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00860}00860\ \ \ \ \ \ \ \{\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00861}00861\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}\ head\_header\_state;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00862}00862\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v2\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1snapshot__block__header__state__v2}{legacy::snapshot\_block\_header\_state\_v2}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00863}00863\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00864}00864\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}},\ v2::minimum\_version,\ v2::maximum\_version)\ ==\ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00865}00865\ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<\mbox{\hyperlink{structsysio_1_1chain_1_1block__state}{block\_state}}>([\textcolor{keyword}{this},\ \&head\_header\_state](\ \textcolor{keyword}{auto}\ \&section\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00866}00866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1snapshot__block__header__state__v2}{legacy::snapshot\_block\_header\_state\_v2}}\ legacy\_header\_state;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00867}00867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_header\_state,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00868}00868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ head\_header\_state\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}(std::move(legacy\_header\_state));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00869}00869\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00870}00870\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00871}00871\ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<\mbox{\hyperlink{structsysio_1_1chain_1_1block__state}{block\_state}}>([\textcolor{keyword}{this},\&head\_header\_state](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00872}00872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(head\_header\_state,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00873}00873\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00874}00874\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00875}00875\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00876}00876\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}}\ =\ head\_header\_state.\mbox{\hyperlink{structsysio_1_1chain_1_1detail_1_1block__header__state__common_ae85e3375836639cb1e7543aea7cf0552}{block\_num}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00877}00877\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ blog\_start\ <=\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}}\ +\ 1)\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}}\ <=\ blog\_end,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00878}00878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block\_log\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00879}00879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Block\ log\ is\ provided\ with\ snapshot\ but\ does\ not\ contain\ the\ head\ block\ from\ the\ snapshot\ nor\ a\ block\ right\ after\ it"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00880}00880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}snapshot\_head\_block"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}})}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00881}00881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_first\_num"{}},\ blog\_start)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00882}00882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_last\_num"{}},\ blog\_end)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00883}00883\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00884}00884\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00885}00885\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ std::make\_shared<block\_state>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00886}00886\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}\&\textcolor{keyword}{>}(*head)\ =\ head\_header\_state;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00887}00887\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00888}00888\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00889}00889\ \ \ \ \ \ \ controller\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&snapshot,\ \&header](\ \textcolor{keyword}{auto}\ utils\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00890}00890\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }value\_t\ =\ \textcolor{keyword}{typename}\ \textcolor{keyword}{decltype}(utils)::index\_t::value\_type;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00891}00891\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00892}00892\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ table\_id\_object\ as\ its\ inlined\ with\ contract\ tables\ section}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00893}00893\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ table\_id\_object>::value)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00894}00894\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00895}00895\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00896}00896\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00897}00897\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ database\_header\ as\ it\ is\ only\ relevant\ to\ in-\/memory\ database}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00898}00898\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ database\_header\_object>::value)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00899}00899\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00900}00900\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00901}00901\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00902}00902\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ special\ case\ for\ in-\/place\ upgrade\ of\ global\_property\_object}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00903}00903\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ global\_property\_object>::value)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00904}00904\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v2\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1snapshot__global__property__object__v2}{legacy::snapshot\_global\_property\_object\_v2}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00905}00905\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v3\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1snapshot__global__property__object__v3}{legacy::snapshot\_global\_property\_object\_v3}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00906}00906\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v4\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1snapshot__global__property__object__v4}{legacy::snapshot\_global\_property\_object\_v4}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00907}00907\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00908}00908\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}},\ v2::minimum\_version,\ v2::maximum\_version)\ ==\ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00909}00909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::optional<genesis\_state>\ genesis\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47}{extract\_legacy\_genesis\_state}}(*snapshot,\ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00910}00910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ genesis,\ snapshot\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00911}00911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Snapshot\ indicates\ chain\_snapshot\_header\ version\ 2,\ but\ does\ not\ contain\ a\ genesis\_state.\ "{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00912}00912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}It\ must\ be\ corrupted."{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00913}00913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}=this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},gs\_chain\_id=genesis-\/>compute\_chain\_id()](\ \textcolor{keyword}{auto}\ \&section\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00914}00914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v2\ legacy\_global\_properties;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00915}00915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_global\_properties,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00916}00916\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00917}00917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&legacy\_global\_properties,\&gs\_chain\_id](\textcolor{keyword}{auto}\&\ gpo\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00918}00918\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gpo.initalize\_from(legacy\_global\_properties,\ gs\_chain\_id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1kv__database__config}{kv\_database\_config}}\{\},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00919}00919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state_a3e6e5eb6e7b0107b1f105eb8a4dcca41}{genesis\_state::default\_initial\_wasm\_configuration}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00920}00920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00921}00921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00922}00922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ early\ out\ to\ avoid\ default\ processing}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00923}00923\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00924}00924\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00925}00925\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}},\ v3::minimum\_version,\ v3::maximum\_version)\ ==\ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00926}00926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}=this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}](\ \textcolor{keyword}{auto}\ \&section\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00927}00927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v3\ legacy\_global\_properties;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00928}00928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_global\_properties,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00929}00929\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00930}00930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&legacy\_global\_properties](\textcolor{keyword}{auto}\&\ gpo\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00931}00931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gpo.initalize\_from(legacy\_global\_properties,\ \mbox{\hyperlink{structsysio_1_1chain_1_1kv__database__config}{kv\_database\_config}}\{\},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00932}00932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state_a3e6e5eb6e7b0107b1f105eb8a4dcca41}{genesis\_state::default\_initial\_wasm\_configuration}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00933}00933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00934}00934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00935}00935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ early\ out\ to\ avoid\ default\ processing}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00936}00936\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00937}00937\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00938}00938\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}},\ v4::minimum\_version,\ v4::maximum\_version)\ ==\ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00939}00939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ =\ this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}](\textcolor{keyword}{auto}\&\ section)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00940}00940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v4\ legacy\_global\_properties;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00941}00941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_global\_properties,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00942}00942\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00943}00943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&legacy\_global\_properties](\textcolor{keyword}{auto}\&\ gpo)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00944}00944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gpo.initalize\_from(legacy\_global\_properties);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00945}00945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00946}00946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00947}00947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ early\ out\ to\ avoid\ default\ processing}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00948}00948\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00949}00949\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00950}00950\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00951}00951\ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<value\_t>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00952}00952\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ more\ =\ !section.empty();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00953}00953\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(more)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00954}00954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{decltype}(utils)::create(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section,\ \&more](\ \textcolor{keyword}{auto}\ \&row\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00955}00955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ more\ =\ section.read\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00956}00956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00957}00957\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00958}00958\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00959}00959\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00960}00960\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00961}00961\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22}{read\_contract\_tables\_from\_snapshot}}(snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00962}00962\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00963}00963\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a7a4d84d47bcd9069ab0c8d8f9f9ac5f3}{read\_from\_snapshot}}(snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00964}00964\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a32baa74135a1423302de3a849dc8b40c}{read\_from\_snapshot}}(snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00965}00965\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00966}00966\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a24e7f6336cad0bd2fc280dab381665ed}{set\_revision}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00967}00967\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1database__header__object}{database\_header\_object}}>([](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ header)\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00968}00968\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nothing\ to\ do}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00969}00969\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00970}00970\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00971}00971\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00972}00972\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ gpo.chain\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ chain\_id\_type\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00973}00973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}chain\ ID\ in\ snapshot\ (\$\{snapshot\_chain\_id\})\ does\ not\ match\ the\ chain\ ID\ that\ controller\ was\ constructed\ with\ (\$\{controller\_chain\_id\})"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00974}00974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}snapshot\_chain\_id"{}},\ gpo.chain\_id)(\textcolor{stringliteral}{"{}controller\_chain\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}})}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00975}00975\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00976}00976\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00977}00977\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00978}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6}{00978}}\ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{sha256}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6}{calculate\_integrity\_hash}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00979}00979\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256_1_1encoder}{sha256::encoder}}\ enc;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00980}00980\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hash\_writer\ =\ std::make\_shared<integrity\_hash\_snapshot\_writer>(enc);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00981}00981\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795}{add\_to\_snapshot}}(hash\_writer);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00982}00982\ \ \ \ \ \ \ hash\_writer-\/>finalize();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00983}00983\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00984}00984\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ enc.\mbox{\hyperlink{classfc_1_1sha256_1_1encoder_a4d8b8181e912194cf98a56164671adf8}{result}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00985}00985\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00986}00986\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00987}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{00987}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\_native\_account}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\&\ initial\_timestamp,\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}\&\ owner,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}\&\ active,\ \textcolor{keywordtype}{bool}\ is\_privileged\ =\ \textcolor{keyword}{false}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00988}00988\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1account__object}{account\_object}}>([\&](\textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00989}00989\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.name\ =\ \mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00990}00990\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.creation\_date\ =\ initial\_timestamp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00991}00991\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00992}00992\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}}\ ==\ config::system\_account\_name\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00993}00993\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ initial\ sysio\ ABI\ value\ affects\ consensus;\ see\ \ https://github.com/SYSIO/eos/issues/7794}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00994}00994\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ This\ doesn't\ charge\ RAM;\ a\ fix\ requires\ a\ consensus\ upgrade.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00995}00995\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.abi.assign(\mbox{\hyperlink{namespacesysio_1_1chain_aa290df66096212c62e680f2c839ec925}{sysio\_abi\_bin}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespacesysio_1_1chain_aa290df66096212c62e680f2c839ec925}{sysio\_abi\_bin}}));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00996}00996\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00997}00997\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00998}00998\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1account__metadata__object}{account\_metadata\_object}}>([\&](\textcolor{keyword}{auto}\ \&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l00999}00999\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.name\ =\ \mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01000}01000\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.set\_privileged(\ is\_privileged\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01001}01001\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01002}01002\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01003}01003\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ owner\_permission\ \ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}},\ config::owner\_name,\ 0,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01004}01004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ owner,\ initial\_timestamp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01005}01005\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ active\_permission\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}},\ config::active\_name,\ owner\_permission.id,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01006}01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active,\ initial\_timestamp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01007}01007\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01008}01008\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a30cd4db6f08948e05aba424431ec0605}{initialize\_account}}(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01009}01009\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01010}01010\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ ram\_delta\ =\ config::overhead\_per\_account\_ram\_bytes;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01011}01011\ \ \ \ \ \ \ ram\_delta\ +=\ 2*\mbox{\hyperlink{namespacesysio_1_1chain_1_1config_a2772c77657b1f6fda680bbe8f7282d13}{config::billable\_size\_v<permission\_object>}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01012}01012\ \ \ \ \ \ \ ram\_delta\ +=\ owner\_permission.auth.get\_billable\_size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01013}01013\ \ \ \ \ \ \ ram\_delta\ +=\ active\_permission.auth.get\_billable\_size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01014}01014\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01015}01015\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01016}01016\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_ram\_trace(\mbox{\hyperlink{deep__mind_8hpp_aaaa2f1dbd522de03ccbaa73f01db5f50}{RAM\_EVENT\_ID}}(\textcolor{stringliteral}{"{}\$\{name\}"{}},\ (\textcolor{stringliteral}{"{}name"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}})),\ \textcolor{stringliteral}{"{}account"{}},\ \textcolor{stringliteral}{"{}add"{}},\ \textcolor{stringliteral}{"{}newaccount"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01017}01017\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01018}01018\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01019}01019\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a7fea1de6a3806590de0bda86e53c7995}{add\_pending\_ram\_usage}}(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}},\ ram\_delta);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01020}01020\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_af72734af83f353fae77fbf837776db10}{verify\_account\_ram\_usage}}(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01021}01021\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01022}01022\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01023}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde}{01023}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde}{initialize\_database}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\_state}}\&\ genesis)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01024}01024\ \ \ \ \ \ \ \textcolor{comment}{//\ create\ the\ database\ header\ sigil}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01025}01025\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1database__header__object}{database\_header\_object}}>([\&](\ \textcolor{keyword}{auto}\&\ header\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01026}01026\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nothing\ to\ do\ for\ now}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01027}01027\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01028}01028\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01029}01029\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ block\ summary\ index}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01030}01030\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 0x10000;\ i++)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01031}01031\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1block__summary__object}{block\_summary\_object}}>([\&](\mbox{\hyperlink{classsysio_1_1chain_1_1block__summary__object}{block\_summary\_object}}\&)\ \{\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01032}01032\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01033}01033\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ tapos\_block\_summary\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1block__summary__object}{block\_summary\_object}}>(1);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01034}01034\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ tapos\_block\_summary,\ [\&](\ \textcolor{keyword}{auto}\&\ bs\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01035}01035\ \ \ \ \ \ \ \ \ \ bs.block\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01036}01036\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01037}01037\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01038}01038\ \ \ \ \ \ \ genesis.initial\_configuration.validate();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01039}01039\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&genesis,\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}=this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}](\textcolor{keyword}{auto}\&\ gpo\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01040}01040\ \ \ \ \ \ \ \ \ \ gpo.configuration\ =\ genesis.initial\_configuration;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01041}01041\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Update\ this\ when\ genesis\ protocol\ features\ are\ enabled.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01042}01042\ \ \ \ \ \ \ \ \ \ gpo.wasm\_configuration\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state_a3e6e5eb6e7b0107b1f105eb8a4dcca41}{genesis\_state::default\_initial\_wasm\_configuration}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01043}01043\ \ \ \ \ \ \ \ \ \ gpo.chain\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01044}01044\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01045}01045\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01046}01046\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>([\&](\textcolor{keyword}{auto}\&\ pso\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01047}01047\ \ \ \ \ \ \ \ \ \ pso.num\_supported\_key\_types\ =\ config::genesis\_num\_supported\_key\_types;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01048}01048\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ i\ :\ \mbox{\hyperlink{namespacesysio_1_1chain_a01ed37e95a76bcd3dec49672be7acfaa}{genesis\_intrinsics}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01049}01049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a32f7ac67403d93f11d6098fb6abd1cc3}{add\_intrinsic\_to\_whitelist}}(\ pso.whitelisted\_intrinsics,\ i\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01050}01050\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01051}01051\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01052}01052\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01053}01053\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<\mbox{\hyperlink{classsysio_1_1chain_1_1dynamic__global__property__object}{dynamic\_global\_property\_object}}>([](\textcolor{keyword}{auto}\&)\{\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01054}01054\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01055}01055\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a27cfd5f70c12c10a9939e7bf6b3a52e4}{initialize\_database}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01056}01056\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a1b9d0326965430166923c2241a3a6a45}{initialize\_database}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01057}01057\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01058}01058\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}\ system\_auth(genesis.initial\_key);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01059}01059\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\_native\_account}}(\ genesis.initial\_timestamp,\ config::system\_account\_name,\ system\_auth,\ system\_auth,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01060}01060\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01061}01061\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ empty\_authority\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}(1,\ \{\},\ \{\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01062}01062\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ active\_producers\_authority\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}(1,\ \{\},\ \{\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01063}01063\ \ \ \ \ \ \ active\_producers\_authority.\mbox{\hyperlink{structsysio_1_1chain_1_1authority_a89e0cd6c19b4d59a0d37c499d6e90dd0}{accounts}}.push\_back(\{\{config::system\_account\_name,\ config::active\_name\},\ 1\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01064}01064\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01065}01065\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\_native\_account}}(\ genesis.initial\_timestamp,\ config::null\_account\_name,\ empty\_authority,\ empty\_authority\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01066}01066\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\_native\_account}}(\ genesis.initial\_timestamp,\ config::producers\_account\_name,\ empty\_authority,\ active\_producers\_authority\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01067}01067\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ active\_permission\ \ \ \ \ \ \ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,\ config::active\_name\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01068}01068\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ majority\_permission\ \ \ \ \ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\ config::producers\_account\_name,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01069}01069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::majority\_producers\_permission\_name,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01070}01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active\_permission.id,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01071}01071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active\_producers\_authority,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01072}01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ genesis.initial\_timestamp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01073}01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\ config::producers\_account\_name,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01074}01074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::minority\_producers\_permission\_name,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01075}01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ majority\_permission.id,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01076}01076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active\_producers\_authority,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01077}01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ genesis.initial\_timestamp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01078}01078\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01079}01079\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01080}01080\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01081}01081\ \ \ \ \textcolor{comment}{//\ The\ returned\ scoped\_exit\ should\ not\ exceed\ the\ lifetime\ of\ the\ pending\ which\ existed\ when\ make\_block\_restore\_point\ was\ called.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01082}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{01082}}\ \ \ \ \mbox{\hyperlink{classfc_1_1scoped__exit}{fc::scoped\_exit}}<std::function<void()>>\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\_block\_restore\_point}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01083}01083\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01084}01084\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ orig\_block\_transactions\_size\ =\ bb.\_pending\_trx\_receipts.size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01085}01085\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ orig\_state\_transactions\_size\ =\ bb.\_pending\_trx\_metas.size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01086}01086\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ orig\_action\_receipt\_digests\_size\ =\ bb.\_action\_receipt\_digests.size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01087}01087\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01088}01088\ \ \ \ \ \ \ std::function<void()>\ callback\ =\ [\textcolor{keyword}{this},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01089}01089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orig\_block\_transactions\_size,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01090}01090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orig\_state\_transactions\_size,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01091}01091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orig\_action\_receipt\_digests\_size]()}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01092}01092\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01093}01093\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01094}01094\ \ \ \ \ \ \ \ \ \ bb.\_pending\_trx\_receipts.resize(orig\_block\_transactions\_size);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01095}01095\ \ \ \ \ \ \ \ \ \ bb.\_pending\_trx\_metas.resize(orig\_state\_transactions\_size);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01096}01096\ \ \ \ \ \ \ \ \ \ bb.\_action\_receipt\_digests.resize(orig\_action\_receipt\_digests\_size);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01097}01097\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01098}01098\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01099}01099\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}(\ std::move(callback)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01100}01100\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01101}01101\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01102}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b}{01102}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b}{apply\_onerror}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction}{generated\_transaction}}\&\ gtrx,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01103}01103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ block\_deadline,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01104}01104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ max\_transaction\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01105}01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ start,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01106}01106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\&\ cpu\_time\_to\_bill\_us,\ \textcolor{comment}{//\ only\ set\ on\ failure}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01107}01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ billed\_cpu\_time\_us,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01108}01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ explicit\_billed\_cpu\_time\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01109}01109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ enforce\_whiteblacklist\ =\ \textcolor{keyword}{true}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01110}01110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01111}01111\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01112}01112\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1signed__transaction}{signed\_transaction}}\ etrx;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01113}01113\ \ \ \ \ \ \ \textcolor{comment}{//\ Deliver\ onerror\ action\ containing\ the\ failed\ deferred\ transaction\ directly\ back\ to\ the\ sender.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01114}01114\ \ \ \ \ \ \ etrx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction_a407fcf1868b81bb30b85f80d388bbac2}{actions}}.emplace\_back(\ \mbox{\hyperlink{classfc_1_1vector}{vector<permission\_level>}}\{\{gtrx.\mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction_a6908b60ff3382855ee46b8c1e0ab2690}{sender}},\ config::active\_name\}\},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01115}01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1onerror}{onerror}}(\ gtrx.\mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction_af49dc304254627bac1f43fc182b143e8}{sender\_id}},\ gtrx.\mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction_ae7161050b7f947df1748a6c1ae0cba5d}{packed\_trx}}.data(),\ gtrx.\mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction_ae7161050b7f947df1748a6c1ae0cba5d}{packed\_trx}}.size()\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01116}01116\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa808acf858e93c567ff983ccbf8fb6d3}{is\_builtin\_activated}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cfa1e0a5b7203c3f4124dc8c1880b04e36b}{builtin\_protocol\_feature\_t::no\_duplicate\_deferred\_id}}\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01117}01117\ \ \ \ \ \ \ \ \ \ etrx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}}\ =\ \mbox{\hyperlink{classfc_1_1time__point__sec}{time\_point\_sec}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01118}01118\ \ \ \ \ \ \ \ \ \ etrx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a459d803b930351f4a1565d9c082debea}{ref\_block\_num}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01119}01119\ \ \ \ \ \ \ \ \ \ etrx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a6f02077864a99b91d043cd329433a532}{ref\_block\_prefix}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01120}01120\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01121}01121\ \ \ \ \ \ \ \ \ \ etrx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ +\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}(999'999);\ \textcolor{comment}{//\ Round\ up\ to\ nearest\ second\ to\ avoid\ appearing\ expired}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01122}01122\ \ \ \ \ \ \ \ \ \ etrx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a220798b433002112ac85e5545a99ec51}{set\_reference\_block}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01123}01123\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01124}01124\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01125}01125\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01126}01126\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_onerror(etrx);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01127}01127\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01128}01128\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01129}01129\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__checktime__timer}{transaction\_checktime\_timer}}\ trx\_timer(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01130}01130\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1packed__transaction}{packed\_transaction}}\ trx(\ std::move(\ etrx\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01131}01131\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context}{transaction\_context}}\ trx\_context(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}},\ trx,\ std::move(trx\_timer),\ start\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01132}01132\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01133}01133\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a708229aea669816e99b0039d716c3ed5}{block\_deadline}}\ =\ block\_deadline;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01134}01134\ \ \ \ \ \ \ trx\_context.max\_transaction\_time\_subjective\ =\ max\_transaction\_time;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01135}01135\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a05dbab6e9e0d4f3e30fa1392ac4430a1}{explicit\_billed\_cpu\_time}}\ =\ explicit\_billed\_cpu\_time;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01136}01136\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}}\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01137}01137\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a799e9208ec6d2ea3d1dfccfd4eb97cec}{enforce\_whiteblacklist}}\ =\ enforce\_whiteblacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01138}01138\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a7211fab425e4375e247c2a3d1924e63f}{trace}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01139}01139\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01140}01140\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ handle\_exception\ =\ [\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ e)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01141}01141\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01142}01142\ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a2f8dc57cb2e3562de132326b0d06e15d}{update\_billed\_cpu\_time}}(\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01143}01143\ \ \ \ \ \ \ \ \ \ trace-\/>error\_code\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{controller::convert\_exception\_to\_error\_code}}(\ e\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01144}01144\ \ \ \ \ \ \ \ \ \ trace-\/>except\ =\ e;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01145}01145\ \ \ \ \ \ \ \ \ \ trace-\/>except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01146}01146\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01147}01147\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01148}01148\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01149}01149\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a5d3d1260b6f77fdc4b6a8cef3417e94c}{init\_for\_implicit\_trx}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01150}01150\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_ab8e1aaec319ed2ae90b6a6f499919c89}{published}}\ =\ gtrx.\mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction_a01a19b0ce89dd3ef4a668455365a7c0a}{published}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01151}01151\ \ \ \ \ \ \ \ \ \ trx\_context.execute\_action(\ trx\_context.schedule\_action(\ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1packed__transaction_ad193d26eb97cfd5b3f7d8b957eaa35a2}{get\_transaction}}().\mbox{\hyperlink{structsysio_1_1chain_1_1transaction_a407fcf1868b81bb30b85f80d388bbac2}{actions}}.back(),\ gtrx.\mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction_a6908b60ff3382855ee46b8c1e0ab2690}{sender}},\ \textcolor{keyword}{false},\ 0,\ 0\ ),\ 0\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01152}01152\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a300b3d2c25e7de11562c579c41f43dda}{finalize}}();\ \textcolor{comment}{//\ Automatically\ rounds\ up\ network\ and\ CPU\ usage\ in\ trace\ and\ bills\ payers\ if\ successful}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01153}01153\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01154}01154\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ restore\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\_block\_restore\_point}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01155}01155\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(\ gtrx.\mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction_abe73e701a3935f3369f212a744c9a6cc}{trx\_id}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a98d0df834b74445e549f5d2123443b4e}{transaction\_receipt::soft\_fail}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01156}01156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}},\ trace-\/>net\_usage\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01157}01157\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a219f556e23004060631ffb2baaeaff02}{fc::move\_append}}(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01158}01158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_aa16627a2b31f924e998137ba14f22123}{executed\_action\_receipt\_digests}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01159}01159\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01160}01160\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a558e8aff8e48deb61fae7407e10e8788}{squash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01161}01161\ \ \ \ \ \ \ \ \ \ restore.cancel();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01162}01162\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01163}01163\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ disallowed\_transaction\_extensions\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01164}01164\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01165}01165\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ protocol\_feature\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01166}01166\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01167}01167\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01168}01168\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01169}01169\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01170}01170\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01171}01171\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01172}01172\ \ \ \ \ \ \ \ \ \ handle\_exception(e);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01173}01173\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01174}01174\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ wrapper\ =\ \mbox{\hyperlink{classfc_1_1std__exception__wrapper_ae5ad64f84b1d373f5b92031566284c7c}{fc::std\_exception\_wrapper::from\_current\_exception}}(e);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01175}01175\ \ \ \ \ \ \ \ \ \ handle\_exception(wrapper);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01176}01176\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01177}01177\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01178}01178\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01179}01179\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01180}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43}{01180}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43}{remove\_scheduled\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction__object}{generated\_transaction\_object}}\&\ gto\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01181}01181\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01182}01182\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_ram\_trace(\mbox{\hyperlink{deep__mind_8hpp_aaaa2f1dbd522de03ccbaa73f01db5f50}{RAM\_EVENT\_ID}}(\textcolor{stringliteral}{"{}\$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ gto.id)),\ \textcolor{stringliteral}{"{}deferred\_trx"{}},\ \textcolor{stringliteral}{"{}remove"{}},\ \textcolor{stringliteral}{"{}deferred\_trx\_removed"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01183}01183\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01184}01184\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01185}01185\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ ram\_delta\ =\ -\/(\mbox{\hyperlink{namespacesysio_1_1chain_1_1config_a2772c77657b1f6fda680bbe8f7282d13}{config::billable\_size\_v<generated\_transaction\_object>}}\ +\ gto.packed\_trx.\mbox{\hyperlink{classchainbase_1_1shared__cow__string_a3b3c57c0d2ee027bb70beb283be2a0f2}{size}}());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01186}01186\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a7fea1de6a3806590de0bda86e53c7995}{add\_pending\_ram\_usage}}(\ gto.payer,\ ram\_delta\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01187}01187\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ need\ to\ verify\_account\_ram\_usage\ since\ we\ are\ only\ reducing\ memory}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01188}01188\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01189}01189\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_ac6bb29708e4fdfb6899028e3c351fe0b}{remove}}(\ gto\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01190}01190\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ram\_delta;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01191}01191\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01192}01192\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01193}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{01193}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\_is\_subjective}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01194}01194\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ code\ =\ e.\mbox{\hyperlink{classfc_1_1exception_a79a36225cde10dcd23057bbe19d3390f}{code}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01195}01195\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ \ \ (code\ ==\ subjective\_block\_production\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01196}01196\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ block\_net\_usage\_exceeded::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01197}01197\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ greylist\_net\_usage\_exceeded::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01198}01198\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ block\_cpu\_usage\_exceeded::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01199}01199\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ greylist\_cpu\_usage\_exceeded::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01200}01200\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ deadline\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01201}01201\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ leeway\_deadline\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01202}01202\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ actor\_whitelist\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01203}01203\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ actor\_blacklist\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01204}01204\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ contract\_whitelist\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01205}01205\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ contract\_blacklist\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01206}01206\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ action\_blacklist\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01207}01207\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ key\_blacklist\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01208}01208\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ sig\_variable\_size\_limit\_exception::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01209}01209\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ inline\_action\_too\_big\_nonprivileged::code\_value);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01210}01210\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01211}01211\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01212}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}{01212}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}{scheduled\_failure\_is\_subjective}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01213}01213\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ code\ =\ e.\mbox{\hyperlink{classfc_1_1exception_a79a36225cde10dcd23057bbe19d3390f}{code}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01214}01214\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ \ \ (code\ ==\ tx\_cpu\_usage\_exceeded::code\_value)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01215}01215\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\_is\_subjective}}(e);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01216}01216\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01217}01217\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01218}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}{01218}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}{push\_scheduled\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{transaction\_id\_type}}\&\ trxid,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01219}01219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ block\_deadline,\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ max\_transaction\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01220}01220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ billed\_cpu\_time\_us,\ \textcolor{keywordtype}{bool}\ explicit\_billed\_cpu\_time\ =\ \textcolor{keyword}{false}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01221}01221\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01222}01222\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ idx\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a9e9842ee49526c2423e014a696edc602}{generated\_transaction\_multi\_index}},by\_trx\_id>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01223}01223\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ idx.find(\ trxid\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01224}01224\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ itr\ !=\ idx.end(),\ unknown\_transaction\_exception,\ \textcolor{stringliteral}{"{}unknown\ transaction"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01225}01225\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}{push\_scheduled\_transaction}}(\ *itr,\ block\_deadline,\ max\_transaction\_time,\ billed\_cpu\_time\_us,\ explicit\_billed\_cpu\_time\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01226}01226\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01227}01227\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01228}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a43b89d301b09c599969412d7db819bd3}{01228}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a43b89d301b09c599969412d7db819bd3}{push\_scheduled\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction__object}{generated\_transaction\_object}}\&\ gto,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01229}01229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ block\_deadline,\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ max\_transaction\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01230}01230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ billed\_cpu\_time\_us,\ \textcolor{keywordtype}{bool}\ explicit\_billed\_cpu\_time\ =\ \textcolor{keyword}{false}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01231}01231\ \ \ \ \{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01232}01232\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01233}01233\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ validating\ =\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{is\_producing\_block}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01234}01234\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !validating\ ||\ explicit\_billed\_cpu\_time,\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}validating\ requires\ explicit\ billing"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01235}01235\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01236}01236\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}\ undo\_session;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01237}01237\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}()\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01238}01238\ \ \ \ \ \ \ \ \ \ undo\_session\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01239}01239\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01240}01240\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gtrx\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction}{generated\_transaction}}(gto);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01241}01241\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01242}01242\ \ \ \ \ \ \ \textcolor{comment}{//\ remove\ the\ generated\ transaction\ object\ after\ making\ a\ copy}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01243}01243\ \ \ \ \ \ \ \textcolor{comment}{//\ this\ will\ ensure\ that\ anything\ which\ affects\ the\ GTO\ multi-\/index-\/container\ will\ not\ invalidate}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01244}01244\ \ \ \ \ \ \ \textcolor{comment}{//\ data\ we\ need\ to\ successfully\ retire\ this\ transaction.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01245}01245\ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01246}01246\ \ \ \ \ \ \ \textcolor{comment}{//\ IF\ the\ transaction\ FAILs\ in\ a\ subjective\ way,\ \`{}undo\_session`\ should\ expire\ without\ being\ squashed}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01247}01247\ \ \ \ \ \ \ \textcolor{comment}{//\ resulting\ in\ the\ GTO\ being\ restored\ and\ available\ for\ a\ future\ block\ to\ retire.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01248}01248\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ trx\_removal\_ram\_delta\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43}{remove\_scheduled\_transaction}}(gto);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01249}01249\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01250}01250\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{fc::datastream<const\ char*>}}\ ds(\ gtrx.packed\_trx.data(),\ gtrx.packed\_trx.size()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01251}01251\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01252}01252\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ gtrx.delay\_until\ <=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}this\ transaction\ isn't\ ready"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01253}01253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}gtrx.delay\_until"{}},gtrx.delay\_until)(\textcolor{stringliteral}{"{}pbt"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}())\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01254}01254\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01255}01255\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1signed__transaction}{signed\_transaction}}\ dtrx;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01256}01256\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{structsysio_1_1chain_1_1transaction}{transaction}}\&\textcolor{keyword}{>}(dtrx)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01257}01257\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\ trx\ =}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01258}01258\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_acb14de2d02033c2d43c65319825d3d5b}{transaction\_metadata::create\_no\_recover\_keys}}(\ std::make\_shared<packed\_transaction>(\ std::move(dtrx)\ \ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01259}01259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053eda638a6d925c422c868b28b9562498ea1d}{transaction\_metadata::trx\_type::scheduled}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01260}01260\ \ \ \ \ \ \ trx-\/>accepted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01261}01261\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01262}01262\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01263}01263\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ gtrx.expiration\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01264}01264\ \ \ \ \ \ \ \ \ \ trace\ =\ std::make\_shared<transaction\_trace>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01265}01265\ \ \ \ \ \ \ \ \ \ trace-\/>id\ =\ gtrx.trx\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01266}01266\ \ \ \ \ \ \ \ \ \ trace-\/>block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}()\ +\ 1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01267}01267\ \ \ \ \ \ \ \ \ \ trace-\/>block\_time\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01268}01268\ \ \ \ \ \ \ \ \ \ trace-\/>producer\_block\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8ad92bdf81057887fdc4b732cb864bc4}{pending\_producer\_block\_id}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01269}01269\ \ \ \ \ \ \ \ \ \ trace-\/>scheduled\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01270}01270\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(\ gtrx.trx\_id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55ac9a3d403c49bf068d1f8f07e20df72b5}{transaction\_receipt::expired}},\ billed\_cpu\_time\_us,\ 0\ );\ \textcolor{comment}{//\ expire\ the\ transaction}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01271}01271\ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1account__delta}{account\_delta}}(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01272}01272\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01273}01273\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01274}01274\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01275}01275\ \ \ \ \ \ \ \ \ \ undo\_session.\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a1e5c5b89d2b1fac7f982ede7f0b1b545}{squash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01276}01276\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01277}01277\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01278}01278\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01279}01279\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_in\_trx\_requiring\_checks\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([old\_value=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}},\textcolor{keyword}{this}]()\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01280}01280\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ old\_value;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01281}01281\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01282}01282\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01283}01283\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01284}01284\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ cpu\_time\_to\_bill\_us\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01285}01285\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01286}01286\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__checktime__timer}{transaction\_checktime\_timer}}\ trx\_timer(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01287}01287\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context}{transaction\_context}}\ trx\_context(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}},\ *trx-\/>packed\_trx(),\ std::move(trx\_timer)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01288}01288\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a1fafa59ca3817a6fc89466a7da19b72c}{leeway}}\ =\ \ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}(0);\ \textcolor{comment}{//\ avoid\ stealing\ cpu\ resource}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01289}01289\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a708229aea669816e99b0039d716c3ed5}{block\_deadline}}\ =\ block\_deadline;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01290}01290\ \ \ \ \ \ \ trx\_context.max\_transaction\_time\_subjective\ =\ max\_transaction\_time;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01291}01291\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a05dbab6e9e0d4f3e30fa1392ac4430a1}{explicit\_billed\_cpu\_time}}\ =\ explicit\_billed\_cpu\_time;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01292}01292\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}}\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01293}01293\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a799e9208ec6d2ea3d1dfccfd4eb97cec}{enforce\_whiteblacklist}}\ =\ gtrx.sender.empty()\ ?\ true\ :\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735}{sender\_avoids\_whitelist\_blacklist\_enforcement}}(\ gtrx.sender\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01294}01294\ \ \ \ \ \ \ trace\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a7211fab425e4375e247c2a3d1924e63f}{trace}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01295}01295\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01296}01296\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ handle\_exception\ =\ [\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ e)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01297}01297\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01298}01298\ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a2f8dc57cb2e3562de132326b0d06e15d}{update\_billed\_cpu\_time}}(\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01299}01299\ \ \ \ \ \ \ \ \ \ trace-\/>error\_code\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{controller::convert\_exception\_to\_error\_code}}(\ e\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01300}01300\ \ \ \ \ \ \ \ \ \ trace-\/>except\ =\ e;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01301}01301\ \ \ \ \ \ \ \ \ \ trace-\/>except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01302}01302\ \ \ \ \ \ \ \ \ \ trace-\/>elapsed\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ -\/\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a9c12181bd0bd8a5aea0200c80e7b00e7}{start}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01303}01303\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01304}01304\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01305}01305\ \ \ \ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_fail\_deferred();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01306}01306\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01307}01307\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01308}01308\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01309}01309\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01310}01310\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a03f76febe2160f0f23a5f60dae262184}{init\_for\_deferred\_trx}}(\ gtrx.published\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01311}01311\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01312}01312\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a799e9208ec6d2ea3d1dfccfd4eb97cec}{enforce\_whiteblacklist}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01313}01313\ \ \ \ \ \ \ \ \ \ \ \ \ flat\_set<account\_name>\ actors;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01314}01314\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ act\ :\ trx-\/>packed\_trx()-\/>get\_transaction().actions\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01315}01315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ auth\ :\ act.authorization\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01316}01316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ actors.insert(\ auth.actor\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01317}01317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01318}01318\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01319}01319\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1}{check\_actor\_list}}(\ actors\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01320}01320\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01321}01321\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01322}01322\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a01f9fd71b2b5511311c8817a8b32c845}{exec}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01323}01323\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a300b3d2c25e7de11562c579c41f43dda}{finalize}}();\ \textcolor{comment}{//\ Automatically\ rounds\ up\ network\ and\ CPU\ usage\ in\ trace\ and\ bills\ payers\ if\ successful}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01324}01324\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01325}01325\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ restore\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\_block\_restore\_point}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01326}01326\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01327}01327\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(\ gtrx.trx\_id,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01328}01328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{transaction\_receipt::executed}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01329}01329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01330}01330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>net\_usage\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01331}01331\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01332}01332\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a219f556e23004060631ffb2baaeaff02}{fc::move\_append}}(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01333}01333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_aa16627a2b31f924e998137ba14f22123}{executed\_action\_receipt\_digests}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01334}01334\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01335}01335\ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1account__delta}{account\_delta}}(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01336}01336\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01337}01337\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01338}01338\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01339}01339\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01340}01340\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01341}01341\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a558e8aff8e48deb61fae7407e10e8788}{squash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01342}01342\ \ \ \ \ \ \ \ \ \ undo\_session.\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a1e5c5b89d2b1fac7f982ede7f0b1b545}{squash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01343}01343\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01344}01344\ \ \ \ \ \ \ \ \ \ restore.cancel();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01345}01345\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01346}01346\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01347}01347\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ disallowed\_transaction\_extensions\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01348}01348\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01349}01349\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ protocol\_feature\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01350}01350\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01351}01351\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01352}01352\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01353}01353\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01354}01354\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01355}01355\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01356}01356\ \ \ \ \ \ \ \ \ handle\_exception(e);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01357}01357\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01358}01358\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ wrapper\ =\ \mbox{\hyperlink{classfc_1_1std__exception__wrapper_ae5ad64f84b1d373f5b92031566284c7c}{fc::std\_exception\_wrapper::from\_current\_exception}}(e);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01359}01359\ \ \ \ \ \ \ \ \ handle\_exception(wrapper);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01360}01360\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01361}01361\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01362}01362\ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a5631f6c990c61c078e0de6f0e53171be}{undo}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01363}01363\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01364}01364\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ subjective\ OR\ soft\ OR\ hard\ failure\ logic\ below:}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01365}01365\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01366}01366\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ gtrx.sender\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}()\ \&\&\ !(validating\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\_is\_subjective}}(*trace-\/>except)\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}{scheduled\_failure\_is\_subjective}}(*trace-\/>except)))\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01367}01367\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Attempt\ error\ handling\ for\ the\ generated\ transaction.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01368}01368\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01369}01369\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ error\_trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b}{apply\_onerror}}(\ gtrx,\ block\_deadline,\ max\_transaction\_time,\ trx\_context.pseudo\_start,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01370}01370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us,\ billed\_cpu\_time\_us,\ explicit\_billed\_cpu\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01371}01371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a799e9208ec6d2ea3d1dfccfd4eb97cec}{enforce\_whiteblacklist}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01372}01372\ \ \ \ \ \ \ \ \ \ error\_trace-\/>failed\_dtrx\_trace\ =\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01373}01373\ \ \ \ \ \ \ \ \ \ trace\ =\ error\_trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01374}01374\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !trace-\/>except\_ptr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01375}01375\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1account__delta}{account\_delta}}(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01376}01376\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01377}01377\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01378}01378\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01379}01379\ \ \ \ \ \ \ \ \ \ \ \ \ undo\_session.\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a1e5c5b89d2b1fac7f982ede7f0b1b545}{squash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01380}01380\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01381}01381\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01382}01382\ \ \ \ \ \ \ \ \ \ trace-\/>elapsed\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ -\/\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a9c12181bd0bd8a5aea0200c80e7b00e7}{start}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01383}01383\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01384}01384\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01385}01385\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ subjective\ OR\ hard\ failure\ logic\ below:}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01386}01386\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01387}01387\ \ \ \ \ \ \ \textcolor{comment}{//\ subjectivity\ changes\ based\ on\ producing\ vs\ validating}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01388}01388\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ subjective\ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01389}01389\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (validating)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01390}01390\ \ \ \ \ \ \ \ \ \ subjective\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\_is\_subjective}}(*trace-\/>except);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01391}01391\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01392}01392\ \ \ \ \ \ \ \ \ \ subjective\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}{scheduled\_failure\_is\_subjective}}(*trace-\/>except);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01393}01393\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01394}01394\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01395}01395\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !subjective\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01396}01396\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ hard\ failure\ logic}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01397}01397\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01398}01398\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !validating\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01399}01399\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ rl\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_add2453cf4d0208ca9f277337c9a5ed7a}{get\_mutable\_resource\_limits\_manager}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01400}01400\ \ \ \ \ \ \ \ \ \ \ \ \ rl.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aaa7345adbf341592a81c087c50655597}{update\_account\_usage}}(\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_ac178b3a7e2ef905025ae4e2f262422ff}{bill\_to\_accounts}},\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()).\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp_a1bdb67323980085a2d4002d877b6c232}{slot}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01401}01401\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ account\_cpu\_limit\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01402}01402\ \ \ \ \ \ \ \ \ \ \ \ \ std::tie(\ std::ignore,\ account\_cpu\_limit,\ std::ignore,\ std::ignore\ )\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_ad525fafe1ffad93dc767bf2b5b9ea0cc}{max\_bandwidth\_billed\_accounts\_can\_pay}}(\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01403}01403\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01404}01404\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ limited\_cpu\_time\_to\_bill\_us\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\textcolor{keyword}{>}(\ std::min(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01405}01405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::min(\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\textcolor{keyword}{>}(cpu\_time\_to\_bill\_us),\ account\_cpu\_limit\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01406}01406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.initial\_objective\_duration\_limit.\mbox{\hyperlink{classfc_1_1microseconds_a20fba59ec7e1f50c6b8f2c9443cc9b92}{count}}()\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01407}01407\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !explicit\_billed\_cpu\_time\ ||\ (cpu\_time\_to\_bill\_us\ ==\ limited\_cpu\_time\_to\_bill\_us),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01408}01408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}cpu\ to\ bill\ \$\{cpu\}\ !=\ limited\ \$\{limit\}"{}},\ (\textcolor{stringliteral}{"{}cpu"{}},\ cpu\_time\_to\_bill\_us)(\textcolor{stringliteral}{"{}limit"{}},\ limited\_cpu\_time\_to\_bill\_us)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01409}01409\ \ \ \ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us\ =\ limited\_cpu\_time\_to\_bill\_us;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01410}01410\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01411}01411\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01412}01412\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae6e413bd0a6e43b36deff7aacdd0bfd6}{add\_transaction\_usage}}(\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_ac178b3a7e2ef905025ae4e2f262422ff}{bill\_to\_accounts}},\ cpu\_time\_to\_bill\_us,\ 0,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01413}01413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()).\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp_a1bdb67323980085a2d4002d877b6c232}{slot}}\ );\ \textcolor{comment}{//\ Should\ never\ fail}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01414}01414\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01415}01415\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(gtrx.trx\_id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55ac705728ca8b5f3a44d8026e14990c463}{transaction\_receipt::hard\_fail}},\ cpu\_time\_to\_bill\_us,\ 0);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01416}01416\ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1account__delta}{account\_delta}}(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01417}01417\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01418}01418\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01419}01419\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01420}01420\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01421}01421\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01422}01422\ \ \ \ \ \ \ \ \ \ undo\_session.\mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session_a1e5c5b89d2b1fac7f982ede7f0b1b545}{squash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01423}01423\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01424}01424\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01425}01425\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01426}01426\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01427}01427\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01428}01428\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01429}01429\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01430}01430\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}()\ \}\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01431}01431\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01432}01432\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01436}01436\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01437}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{01437}}\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt}{transaction\_receipt}}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}}\&\ trx,\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55}{transaction\_receipt\_header::status\_enum}}\ status,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01438}01438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ cpu\_usage\_us,\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ net\_usage\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01439}01439\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ net\_usage\_words\ =\ net\_usage\ /\ 8;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01440}01440\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ net\_usage\_words*8\ ==\ net\_usage,\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}net\_usage\ is\ not\ divisible\ by\ 8"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01441}01441\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ receipts\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_pending\_trx\_receipts;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01442}01442\ \ \ \ \ \ \ receipts.emplace\_back(\ trx\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01443}01443\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt}{transaction\_receipt}}\&\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}\ =\ receipts.back();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01444}01444\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.cpu\_usage\_us\ \ \ \ \ \ \ \ \ =\ cpu\_usage\_us;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01445}01445\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.net\_usage\_words\ \ \ \ \ \ =\ net\_usage\_words;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01446}01446\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.status\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ status;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01447}01447\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01448}01448\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01449}01449\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01455}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}{01455}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}{push\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\&\ trx,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01456}01456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ block\_deadline,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01457}01457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ max\_transaction\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01458}01458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ billed\_cpu\_time\_us,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01459}01459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ explicit\_billed\_cpu\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01460}01460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ subjective\_cpu\_bill\_us\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01461}01461\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01462}01462\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(block\_deadline\ !=\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}deadline\ cannot\ be\ uninitialized"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01463}01463\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01464}01464\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01465}01465\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01466}01466\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ start\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01467}01467\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ check\_auth\ =\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a42a29a059b847799ae3a75953b6bff1e}{skip\_auth\_check}}()\ \&\&\ !trx-\/>implicit;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01468}01468\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ sig\_cpu\_usage\ =\ trx-\/>signature\_cpu\_usage();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01469}01469\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01470}01470\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !explicit\_billed\_cpu\_time\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01471}01471\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ already\_consumed\_time(\ \mbox{\hyperlink{chain_2include_2sysio_2chain_2config_8hpp_a0b4bacb63f31764f50a185f320551fbc}{SYS\_PERCENT}}(sig\_cpu\_usage.\mbox{\hyperlink{classfc_1_1microseconds_a20fba59ec7e1f50c6b8f2c9443cc9b92}{count}}(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a681e42f55477a7b01ba14c05a76e9b18}{sig\_cpu\_bill\_pct}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01472}01472\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01473}01473\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ start.time\_since\_epoch()\ <\ \ already\_consumed\_time\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01474}01474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ start\ =\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01475}01475\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01476}01476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ start\ -\/=\ already\_consumed\_time;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01477}01477\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01478}01478\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01479}01479\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01480}01480\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1signed__transaction}{signed\_transaction}}\&\ trn\ =\ trx-\/>packed\_trx()-\/>get\_signed\_transaction();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01481}01481\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__checktime__timer}{transaction\_checktime\_timer}}\ trx\_timer(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01482}01482\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context}{transaction\_context}}\ trx\_context(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}},\ *trx-\/>packed\_trx(),\ std::move(trx\_timer),\ start,\ trx-\/>read\_only);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01483}01483\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{bool})\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}{subjective\_cpu\_leeway}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01484}01484\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a1fafa59ca3817a6fc89466a7da19b72c}{leeway}}\ =\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}{subjective\_cpu\_leeway}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01485}01485\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01486}01486\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a708229aea669816e99b0039d716c3ed5}{block\_deadline}}\ =\ block\_deadline;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01487}01487\ \ \ \ \ \ \ \ \ \ trx\_context.max\_transaction\_time\_subjective\ =\ max\_transaction\_time;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01488}01488\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a05dbab6e9e0d4f3e30fa1392ac4430a1}{explicit\_billed\_cpu\_time}}\ =\ explicit\_billed\_cpu\_time;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01489}01489\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}}\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01490}01490\ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_af80f48b601534a0adc286de6195e26a2}{subjective\_cpu\_bill\_us}}\ =\ subjective\_cpu\_bill\_us;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01491}01491\ \ \ \ \ \ \ \ \ \ trace\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a7211fab425e4375e247c2a3d1924e63f}{trace}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01492}01492\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01493}01493\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ handle\_exception\ =[\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ e)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01494}01494\ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01495}01495\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>error\_code\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{controller::convert\_exception\_to\_error\_code}}(\ e\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01496}01496\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>except\ =\ e;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01497}01497\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01498}01498\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>elapsed\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ -\/\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a9c12181bd0bd8a5aea0200c80e7b00e7}{start}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01499}01499\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01500}01500\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01501}01501\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01502}01502\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx-\/>implicit\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01503}01503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a5d3d1260b6f77fdc4b6a8cef3417e94c}{init\_for\_implicit\_trx}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01504}01504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a799e9208ec6d2ea3d1dfccfd4eb97cec}{enforce\_whiteblacklist}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01505}01505\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01506}01506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_adbf0d6f8a8a8d3b4544fafe24cd0a135}{init\_for\_input\_trx}}(\ trx-\/>packed\_trx()-\/>get\_unprunable\_size(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01507}01507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>packed\_trx()-\/>get\_prunable\_size()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01508}01508\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01509}01509\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01510}01510\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a73f4035fab7271fec7fcac5aa01bd461}{delay}}\ =\ \mbox{\hyperlink{namespacefc_a9623b8cae3f48bbed6aa1fc2afe9b174}{fc::seconds}}(trn.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a349b11695387e3dbe91f918ee759d4b4}{delay\_sec}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01511}01511\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01512}01512\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_auth\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01513}01513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a8566f4407e33eb1e4029455e4feae2f1}{check\_authorization}}(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01514}01514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trn.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction_a407fcf1868b81bb30b85f80d388bbac2}{actions}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01515}01515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>recovered\_keys(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01516}01516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01517}01517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a73f4035fab7271fec7fcac5aa01bd461}{delay}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01518}01518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\&trx\_context]()\{\ trx\_context.checktime();\ \},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01519}01519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01520}01520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>read\_only}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01521}01521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01522}01522\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01523}01523\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a01f9fd71b2b5511311c8817a8b32c845}{exec}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01524}01524\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a300b3d2c25e7de11562c579c41f43dda}{finalize}}();\ \textcolor{comment}{//\ Automatically\ rounds\ up\ network\ and\ CPU\ usage\ in\ trace\ and\ bills\ payers\ if\ successful}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01525}01525\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01526}01526\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ restore\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\_block\_restore\_point}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01527}01527\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01528}01528\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>implicit)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01529}01529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55}{transaction\_receipt::status\_enum}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ (trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a73f4035fab7271fec7fcac5aa01bd461}{delay}}\ ==\ \mbox{\hyperlink{namespacefc_a9623b8cae3f48bbed6aa1fc2afe9b174}{fc::seconds}}(0))}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01530}01530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{transaction\_receipt::executed}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01531}01531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a6b6365bc9e75414c669484391aa7729d}{transaction\_receipt::delayed}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01532}01532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(*trx-\/>packed\_trx(),\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}},\ trace-\/>net\_usage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01533}01533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>billed\_cpu\_time\_us\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01534}01534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_pending\_trx\_metas.emplace\_back(trx);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01535}01535\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01536}01536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header}{transaction\_receipt\_header}}\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01537}01537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.status\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{transaction\_receipt::executed}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01538}01538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.cpu\_usage\_us\ =\ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a08b550fccea696363035c6736c146436}{billed\_cpu\_time\_us}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01539}01539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.net\_usage\_words\ =\ trace-\/>net\_usage\ /\ 8;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01540}01540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01541}01541\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01542}01542\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01543}01543\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a219f556e23004060631ffb2baaeaff02}{fc::move\_append}}(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01544}01544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_aa16627a2b31f924e998137ba14f22123}{executed\_action\_receipt\_digests}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01545}01545\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01546}01546\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ call\ the\ accept\ signal\ but\ only\ once\ for\ this\ transaction}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01547}01547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>read\_only)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01548}01548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>accepted)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01549}01549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>accepted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01550}01550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01551}01551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01552}01552\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01553}01553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01554}01554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01555}01555\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01556}01556\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01557}01557\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01558}01558\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\_read\_mode::SPECULATIVE}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}})\ ||\ trx-\/>read\_only\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01559}01559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//this\ may\ happen\ automatically\ in\ destructor,\ but\ I\ prefer\ make\ it\ more\ explicit}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01560}01560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a5631f6c990c61c078e0de6f0e53171be}{undo}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01561}01561\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01562}01562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ restore.cancel();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01563}01563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__context_a558e8aff8e48deb61fae7407e10e8788}{squash}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01564}01564\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01565}01565\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01566}01566\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01567}01567\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ disallowed\_transaction\_extensions\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01568}01568\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01569}01569\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ protocol\_feature\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01570}01570\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01571}01571\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01572}01572\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01573}01573\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01574}01574\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01575}01575\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01576}01576\ \ \ \ \ \ \ \ \ \ \ \ handle\_exception(e);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01577}01577\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01578}01578\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ wrapper\ =\ \mbox{\hyperlink{classfc_1_1std__exception__wrapper_ae5ad64f84b1d373f5b92031566284c7c}{fc::std\_exception\_wrapper::from\_current\_exception}}(e);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01579}01579\ \ \ \ \ \ \ \ \ \ \ \ handle\_exception(wrapper);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01580}01580\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01581}01581\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01582}01582\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>read\_only)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01583}01583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01584}01584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01585}01585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01586}01586\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01587}01587\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01588}01588\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01589}01589\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}((trace))}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01590}01590\ \ \ \ \}\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01591}01591\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01592}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566}{01592}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566}{start\_block}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ when,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01593}01593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ confirm\_block\_count,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01594}01594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_protocol\_feature\_activations,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01595}01595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller::block\_status}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01596}01596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::optional<block\_id\_type>\&\ producer\_block\_id,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01597}01597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\&\ deadline\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01598}01598\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01599}01599\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}pending\ block\ already\ exists"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01600}01600\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01601}01601\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_adbf19ff6a0a51a5d85e2be416a586dcc}{block\_start}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01602}01602\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01603}01603\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01604}01604\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ head\ block\ represents\ the\ block\ just\ before\ this\ one\ that\ is\ about\ to\ start,\ so\ add\ 1\ to\ get\ this\ block\ num}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01605}01605\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_start\_block(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01606}01606\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01607}01607\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01608}01608\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ guard\_pending\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([\textcolor{keyword}{this},\ head\_block\_num=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num]()\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01609}01609\ \ \ \ \ \ \ \ \ \ protocol\_features.popped\_blocks\_to(\ head\_block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01610}01610\ \ \ \ \ \ \ \ \ \ pending.reset();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01611}01611\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01612}01612\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01613}01613\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}))\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01614}01614\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num,\ \mbox{\hyperlink{namespacesysio_1_1chain_a6b9cb254135911c4a6d577a9ab7fdd4e}{database\_exception}},\ \textcolor{stringliteral}{"{}db\ revision\ is\ not\ on\ par\ with\ head\ block"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01615}01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}db.revision()"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}())(\textcolor{stringliteral}{"{}controller\_head\_block"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)(\textcolor{stringliteral}{"{}fork\_db\_head\_block"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>block\_num)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01616}01616\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01617}01617\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.emplace(\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}),\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ when,\ confirm\_block\_count,\ new\_protocol\_feature\_activations\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01618}01618\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01619}01619\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.emplace(\ \mbox{\hyperlink{classsysio_1_1chain_1_1maybe__session}{maybe\_session}}(),\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ when,\ confirm\_block\_count,\ new\_protocol\_feature\_activations\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01620}01620\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01621}01621\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01622}01622\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01623}01623\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_producer\_block\_id\ =\ producer\_block\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01624}01624\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01625}01625\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01626}01626\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pbhs\ =\ bb.\_pending\_block\_header\_state;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01627}01627\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01628}01628\ \ \ \ \ \ \ \textcolor{comment}{//\ modify\ state\ of\ speculative\ block\ only\ if\ we\ are\ in\ speculative\ read\ mode\ (otherwise\ we\ need\ clean\ state\ for\ head\ or\ read-\/only\ modes)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01629}01629\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\_read\_mode::SPECULATIVE}}\ ||\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ !=\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01630}01630\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01631}01631\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pso\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01632}01632\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01633}01633\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ num\_preactivated\_protocol\_features\ =\ pso.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object_af9aaf45cddecb84f71b527784984b83a}{preactivated\_protocol\_features}}.size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01634}01634\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ handled\_all\_preactivated\_features\ =\ (num\_preactivated\_protocol\_features\ ==\ 0);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01635}01635\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01636}01636\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ new\_protocol\_feature\_activations.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01637}01637\ \ \ \ \ \ \ \ \ \ \ \ \ flat\_map<digest\_type,\ bool>\ activated\_protocol\_features;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01638}01638\ \ \ \ \ \ \ \ \ \ \ \ \ activated\_protocol\_features.reserve(\ std::max(\ num\_preactivated\_protocol\_features,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01639}01639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_protocol\_feature\_activations.size()\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01640}01640\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ feature\_digest\ :\ pso.preactivated\_protocol\_features\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01641}01641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ activated\_protocol\_features.emplace(\ feature\_digest,\ \textcolor{keyword}{false}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01642}01642\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01643}01643\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01644}01644\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_preactivated\_features\_that\_have\_activated\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01645}01645\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01646}01646\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pfs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01647}01647\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ feature\_digest\ :\ new\_protocol\_feature\_activations\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01648}01648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ =\ pfs.get\_protocol\_feature(\ feature\_digest\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01649}01649\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01650}01650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ res\ =\ activated\_protocol\_features.emplace(\ feature\_digest,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01651}01651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ res.second\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01652}01652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ feature\_digest\ was\ not\ preactivated}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01653}01653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !\mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}.preactivation\_required,\ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01654}01654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}attempted\ to\ activate\ protocol\ feature\ without\ prior\ required\ preactivation:\ \$\{digest\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01655}01655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01656}01656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01657}01657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01658}01658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !res.first-\/>second,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01659}01659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}attempted\ duplicate\ activation\ within\ a\ single\ block:\ \$\{digest\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01660}01660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01661}01661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01662}01662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ feature\_digest\ was\ preactivated}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01663}01663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res.first-\/>second\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01664}01664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++num\_preactivated\_features\_that\_have\_activated;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01665}01665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01666}01666\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01667}01667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}.builtin\_feature\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01668}01668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff}{trigger\_activation\_handler}}(\ *\mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}.builtin\_feature\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01669}01669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01670}01670\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01671}01671\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9fd76dbd437aa9d52791de3e7893be48}{activate\_feature}}(\ feature\_digest,\ pbhs.block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01672}01672\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01673}01673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++bb.\_num\_new\_protocol\_features\_that\_have\_activated;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01674}01674\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01675}01675\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01676}01676\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ num\_preactivated\_features\_that\_have\_activated\ ==\ num\_preactivated\_protocol\_features\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01677}01677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ handled\_all\_preactivated\_features\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01678}01678\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01679}01679\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01680}01680\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01681}01681\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ handled\_all\_preactivated\_features,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01682}01682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}There\ are\ pre-\/activated\ protocol\ features\ that\ were\ not\ activated\ at\ the\ start\ of\ this\ block"{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01683}01683\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01684}01684\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01685}01685\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ new\_protocol\_feature\_activations.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01686}01686\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ pso,\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01687}01687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ps.preactivated\_protocol\_features.clear();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01688}01688\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01689}01689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ps.activated\_protocol\_features.reserve(\ ps.activated\_protocol\_features.size()}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01690}01690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ new\_protocol\_feature\_activations.size()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01691}01691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ feature\_digest\ :\ new\_protocol\_feature\_activations\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01692}01692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ps.activated\_protocol\_features.emplace\_back(\ feature\_digest,\ pbhs.block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01693}01693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01694}01694\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01695}01695\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01696}01696\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01697}01697\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01698}01698\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01699}01699\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ gpo.proposed\_schedule\_block\_num\ \&\&\ \textcolor{comment}{//\ if\ there\ is\ a\ proposed\ schedule\ that\ was\ proposed\ in\ a\ block\ ...}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01700}01700\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\ *gpo.proposed\_schedule\_block\_num\ <=\ pbhs.dpos\_irreversible\_blocknum\ )\ \&\&\ \textcolor{comment}{//\ ...\ that\ has\ now\ become\ irreversible\ ...}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01701}01701\ \ \ \ \ \ \ \ \ \ \ \ \ \ pbhs.prev\_pending\_schedule.schedule.producers.size()\ ==\ 0\ \textcolor{comment}{//\ ...\ and\ there\ was\ room\ for\ a\ new\ pending\ schedule\ prior\ to\ any\ possible\ promotion}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01702}01702\ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01703}01703\ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01704}01704\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Promote\ proposed\ schedule\ to\ pending\ schedule.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01705}01705\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01706}01706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}promoting\ proposed\ schedule\ (set\ in\ block\ \$\{proposed\_num\})\ to\ pending;\ current\ block:\ \$\{n\}\ lib:\ \$\{lib\}\ schedule:\ \$\{schedule\}\ "{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01707}01707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}proposed\_num"{}},\ *gpo.proposed\_schedule\_block\_num)(\textcolor{stringliteral}{"{}n"{}},\ pbhs.block\_num)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01708}01708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}lib"{}},\ pbhs.dpos\_irreversible\_blocknum)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01709}01709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}schedule"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a4b0d95b22a8be15ac06dc3b105638c54}{producer\_authority\_schedule::from\_shared}}(gpo.proposed\_schedule)\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01710}01710\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01711}01711\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01712}01712\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ gpo.proposed\_schedule.version\ ==\ pbhs.active\_schedule\_version\ +\ 1,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01713}01713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ producer\_schedule\_exception,\ \textcolor{stringliteral}{"{}wrong\ producer\ schedule\ version\ specified"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01714}01714\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01715}01715\ \ \ \ \ \ \ \ \ \ \ \ \ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_new\_pending\_producer\_schedule\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a4b0d95b22a8be15ac06dc3b105638c54}{producer\_authority\_schedule::from\_shared}}(gpo.proposed\_schedule);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01716}01716\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ gpo,\ [\&](\ \textcolor{keyword}{auto}\&\ gp\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01717}01717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gp.proposed\_schedule\_block\_num\ =\ std::optional<block\_num\_type>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01718}01718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gp.proposed\_schedule.version=0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01719}01719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gp.proposed\_schedule.producers.clear();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01720}01720\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01721}01721\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01722}01722\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01723}01723\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01724}01724\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\ onbtrx\ =}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01725}01725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_acb14de2d02033c2d43c65319825d3d5b}{transaction\_metadata::create\_no\_recover\_keys}}(\ std::make\_shared<packed\_transaction>(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902}{get\_on\_block\_transaction}}()\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01726}01726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053edacd1fed5e3277af3a9210b25059d86ff9}{transaction\_metadata::trx\_type::implicit}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01727}01727\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_in\_trx\_requiring\_checks\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([old\_value=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}},\textcolor{keyword}{this}]()\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01728}01728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ old\_value;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01729}01729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01730}01730\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01731}01731\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}{push\_transaction}}(\ onbtrx,\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}(),\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{fc::microseconds::maximum}}(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01732}01732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{get\_global\_properties}}().\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object_a7f149fcf87034217c899838eb4430496}{configuration}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a460f6b269c9da35d40b1cc5927c2205a}{min\_transaction\_cpu\_usage}},\ \textcolor{keyword}{true},\ 0\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01733}01733\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trace-\/>except\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01734}01734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\textcolor{stringliteral}{"{}onblock\ \$\{block\_num\}\ is\ REJECTING:\ \$\{entire\_trace\}"{}},(\textcolor{stringliteral}{"{}block\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1)(\textcolor{stringliteral}{"{}entire\_trace"{}},\ trace));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01735}01735\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01736}01736\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01737}01737\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ a\ std::bad\_alloc"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01738}01738\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01739}01739\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01740}01740\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ a\ bad\ allocation"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01741}01741\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01742}01742\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01743}01743\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed,\ but\ shouldn't\ impact\ block\ generation,\ system\ contract\ needs\ update"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01744}01744\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.to\_detail\_string()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01745}01745\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01746}01746\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ unexpected\ exception"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01747}01747\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.what()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01748}01748\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ ...\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01749}01749\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ unknown\ exception"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01750}01750\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01751}01751\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01752}01752\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}{clear\_expired\_input\_transactions}}(deadline);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01753}01753\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f}{update\_producers\_authority}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01754}01754\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01755}01755\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01756}01756\ \ \ \ \ \ \ guard\_pending.cancel();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01757}01757\ \ \ \ \}\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01758}01758\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01759}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192}{01759}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192}{finalize\_block}}()}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01760}01760\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01761}01761\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}it\ is\ not\ valid\ to\ finalize\ when\ there\ is\ no\ pending\ block"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01762}01762\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ std::holds\_alternative<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage),\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}already\ called\ finalize\_block"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01763}01763\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01764}01764\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01765}01765\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01766}01766\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ pbhs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>get\_pending\_block\_header\_state();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01767}01767\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01768}01768\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ resource\ limits:}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01769}01769\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a983919d376e5757bceee573e52b3c571}{process\_account\_limit\_updates}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01770}01770\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain\_config}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{get\_global\_properties}}().\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object_a7f149fcf87034217c899838eb4430496}{configuration}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01771}01771\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ CPU\_TARGET\ =\ \mbox{\hyperlink{chain_2include_2sysio_2chain_2config_8hpp_a0b4bacb63f31764f50a185f320551fbc}{SYS\_PERCENT}}(\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a292759d9e893bccf78a5d22279fb5752}{max\_block\_cpu\_usage}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_af2b14c2153bc64969ca85c8df8fbb7f9}{target\_block\_cpu\_usage\_pct}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01772}01772\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a4396d0acb70ebbd8054b13ff4c564e20}{set\_block\_parameters}}(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01773}01773\ \ \ \ \ \ \ \ \ \ \{\ CPU\_TARGET,\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a292759d9e893bccf78a5d22279fb5752}{max\_block\_cpu\_usage}},\ config::block\_cpu\_usage\_average\_window\_ms\ /\ config::block\_interval\_ms,\ config::maximum\_elastic\_resource\_multiplier,\ \{99,\ 100\},\ \{1000,\ 999\}\},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01774}01774\ \ \ \ \ \ \ \ \ \ \{\mbox{\hyperlink{chain_2include_2sysio_2chain_2config_8hpp_a0b4bacb63f31764f50a185f320551fbc}{SYS\_PERCENT}}(\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a796dada63527fcff40f838efc42a04ec}{max\_block\_net\_usage}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a216d150c1c6ad9ea64aaf82d86926d19}{target\_block\_net\_usage\_pct}}),\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a796dada63527fcff40f838efc42a04ec}{max\_block\_net\_usage}},\ config::block\_size\_average\_window\_ms\ /\ config::block\_interval\_ms,\ config::maximum\_elastic\_resource\_multiplier,\ \{99,\ 100\},\ \{1000,\ 999\}\}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01775}01775\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01776}01776\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a5ebf5f04366d7120f58430d9ba4f8c7a}{process\_block\_usage}}(pbhs.block\_num);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01777}01777\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01778}01778\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01779}01779\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01780}01780\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bb.\_s\_header)\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01781}01781\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}s\_header\ present\ in\ finalize\ block,\ adding\ to\ block\ header:\ \$\{s\}"{}},\ (\textcolor{stringliteral}{"{}s"{}},\ bb.\_s\_header-\/>to\_string()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01782}01782\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01783}01783\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01784}01784\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ (unsigned)\ block:}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01785}01785\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ block\_ptr\ =\ std::make\_shared<signed\_block>(\ pbhs.make\_block\_header(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01786}01786\ \ \ \ \ \ \ \ \ \ bb.\_transaction\_mroot\ ?\ *bb.\_transaction\_mroot\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}{calculate\_trx\_merkle}}(\ bb.\_pending\_trx\_receipts\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01787}01787\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a80d7ea5476f97bf51a25149b55469c40}{merkle}}(\ std::move(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests\ )\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01788}01788\ \ \ \ \ \ \ \ \ \ bb.\_new\_pending\_producer\_schedule,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01789}01789\ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_new\_protocol\_feature\_activations\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01790}01790\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01791}01791\ \ \ \ \ \ \ \ \ \ bb.\_s\_header\ \textcolor{comment}{//\ Include\ optional\ s\_header\ in\ block\ header}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01792}01792\ \ \ \ \ \ \ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01793}01793\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01794}01794\ \ \ \ \ \ \ block\_ptr-\/>transactions\ =\ std::move(\ bb.\_pending\_trx\_receipts\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01795}01795\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01796}01796\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keywordtype}{id}\ =\ block\_ptr-\/>calculate\_id();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01797}01797\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01798}01798\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ TaPoS\ table:}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01799}01799\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84}{create\_block\_summary}}(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01800}01800\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01801}01801\ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01802}01802\ \textcolor{comment}{\ \ \ \ \ \ ilog(\ "{}finalized\ block\ \$\{n\}\ (\$\{id\})\ at\ \$\{t\}\ by\ \$\{p\}\ (\$\{signing\_key\});\ schedule\_version:\ \$\{v\}\ lib:\ \$\{lib\}\ \#dtrxs:\ \$\{ndtrxs\}\ \$\{np\}"{},}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01803}01803\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}n"{},pbhs.block\_num)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01804}01804\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}id"{},id)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01805}01805\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}t"{},pbhs.timestamp)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01806}01806\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}p"{},pbhs.producer)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01807}01807\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}signing\_key"{},\ pbhs.block\_signing\_key)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01808}01808\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}v"{},pbhs.active\_schedule\_version)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01809}01809\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}lib"{},pbhs.dpos\_irreversible\_blocknum)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01810}01810\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}ndtrxs"{},db.get\_index<generated\_transaction\_multi\_index,by\_trx\_id>().size())}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01811}01811\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}np"{},block\_ptr-\/>new\_producers)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01812}01812\ \textcolor{comment}{\ \ \ \ \ \ );}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01813}01813\ \textcolor{comment}{\ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01814}01814\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01815}01815\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1assembled__block}{assembled\_block}}\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01816}01816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01817}01817\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_pending\_block\_header\_state\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01818}01818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_pending\_trx\_metas\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01819}01819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ block\_ptr\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01820}01820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_new\_pending\_producer\_schedule\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01821}01821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01822}01822\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}()\ \}\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01823}01823\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01827}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4}{01827}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4}{commit\_block}}(\ \textcolor{keywordtype}{bool}\ add\_to\_fork\_db\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01828}01828\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_pending\_on\_exit\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([\textcolor{keyword}{this}]\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01829}01829\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.reset();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01830}01830\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01831}01831\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01832}01832\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01833}01833\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ std::holds\_alternative<completed\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage),\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01834}01834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cannot\ call\ commit\_block\ until\ pending\ block\ is\ completed"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01835}01835\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01836}01836\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ std::get<completed\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_block\_state;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01837}01837\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01838}01838\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ add\_to\_fork\_db\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01839}01839\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a97cf1402b71020048ae0054e4d7c8079}{add}}(\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01840}01840\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01841}01841\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0a0659166483870bf065f4d5e671484e}{accepted\_block\_header}},\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01842}01842\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01843}01843\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ bsp\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}committed\ block\ did\ not\ become\ the\ new\ head\ in\ fork\ database"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01844}01844\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01845}01845\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01846}01846\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01847}01847\ \ \ \ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_accepted\_block(bsp);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01848}01848\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01849}01849\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01850}01850\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1ff3607461fff45552db45cec5aca012}{accepted\_block}},\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01851}01851\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01852}01852\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ add\_to\_fork\_db\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01853}01853\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\_irreversible}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01854}01854\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01855}01855\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (...)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01856}01856\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dont\ bother\ resetting\ pending,\ instead\ abort\ the\ block}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01857}01857\ \ \ \ \ \ \ \ \ \ reset\_pending\_on\_exit.cancel();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01858}01858\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\_block}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01859}01859\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01860}01860\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01861}01861\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01862}01862\ \ \ \ \ \ \ \textcolor{comment}{//\ push\ the\ state\ for\ pending.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01863}01863\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>push();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01864}01864\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01865}01865\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01875}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60}{01875}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60}{check\_protocol\_features}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01876}01876\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ currently\_activated\_protocol\_features,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01877}01877\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_protocol\_features\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01878}01878\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01879}01879\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pfs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01880}01880\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01881}01881\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ itr\ =\ new\_protocol\_features.begin();\ itr\ !=\ new\_protocol\_features.end();\ ++itr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01882}01882\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ =\ *itr;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01883}01883\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01884}01884\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ status\ =\ pfs.is\_recognized(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}},\ timestamp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01885}01885\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}(\ status\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01886}01886\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a96d8e9e3b92248258403f7fc4cb25644}{protocol\_feature\_set::recognized\_t::unrecognized}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01887}01887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01888}01888\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ unrecognized"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01889}01889\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01890}01890\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a075ae3d2fc31640504f814f60e5ef713}{protocol\_feature\_set::recognized\_t::disabled}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01891}01891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01892}01892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ disabled"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01893}01893\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01894}01894\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a5d203566b82250f4113257b6db12e488}{protocol\_feature\_set::recognized\_t::too\_early}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01895}01895\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01896}01896\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\$\{timestamp\}\ is\ too\ early\ for\ the\ earliest\ allowed\ activation\ time\ of\ the\ protocol\ feature\ with\ digest\ '\$\{digest\}'"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})(\textcolor{stringliteral}{"{}timestamp"{}},\ timestamp)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01897}01897\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01898}01898\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427ab2fdab230a2c39f3595a947861863cb7}{protocol\_feature\_set::recognized\_t::ready}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01899}01899\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01900}01900\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01901}01901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,\ \textcolor{stringliteral}{"{}unexpected\ recognized\_t\ status"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01902}01902\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01903}01903\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01904}01904\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01905}01905\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ currently\_activated\_protocol\_features.find(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ ==\ currently\_activated\_protocol\_features.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01906}01906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01907}01907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ has\ already\ been\ activated"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01908}01908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01909}01909\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01910}01910\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01911}01911\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ dependency\_checker\ =\ [\&currently\_activated\_protocol\_features,\ \&new\_protocol\_features,\ \&itr]}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01912}01912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{digest\_type}}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ -\/>\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01913}01913\ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01914}01914\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ currently\_activated\_protocol\_features.find(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ !=\ currently\_activated\_protocol\_features.end()\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01915}01915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01916}01916\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01917}01917\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (std::find(\ new\_protocol\_features.begin(),\ itr,\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ !=\ itr);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01918}01918\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01919}01919\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01920}01920\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ pfs.validate\_dependencies(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}},\ dependency\_checker\ ),\ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01921}01921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}not\ all\ dependencies\ of\ protocol\ feature\ with\ digest\ '\$\{digest\}'\ have\ been\ activated"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01922}01922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01923}01923\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01924}01924\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01925}01925\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01926}01926\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01927}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973}{01927}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973}{report\_block\_header\_diff}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\_header}}\&\ b,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\_header}}\&\ ab\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01928}01928\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01929}01929\ \textcolor{preprocessor}{\#define\ SYS\_REPORT(DESC,A,B)\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01930}01930\ \textcolor{preprocessor}{\ \ \ if(\ A\ !=\ B\ )\ \{\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01931}01931\ \textcolor{preprocessor}{\ \ \ \ \ \ elog("{}\$\{desc\}:\ \$\{bv\}\ !=\ \$\{abv\}"{},\ ("{}desc"{},\ DESC)("{}bv"{},\ A)("{}abv"{},\ B));\ \(\backslash\)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01932}01932\ \textcolor{preprocessor}{\ \ \ \}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01933}01933\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01934}01934\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}timestamp"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a0fe1e5860e2b78b0a14da6565e2294bb}{timestamp}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a0fe1e5860e2b78b0a14da6565e2294bb}{timestamp}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01935}01935\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}producer"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_ab73cce40ff45b968f3d9283d7ce1fcbd}{producer}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_ab73cce40ff45b968f3d9283d7ce1fcbd}{producer}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01936}01936\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}confirmed"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a2d039a5279169467dd1b3dae80ff2be3}{confirmed}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a2d039a5279169467dd1b3dae80ff2be3}{confirmed}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01937}01937\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}previous"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a449ed3d87648accf54bd0eae4424a3df}{previous}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a449ed3d87648accf54bd0eae4424a3df}{previous}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01938}01938\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}transaction\_mroot"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a2e1b24b48c9bbbe2d56ba6db5666673d}{transaction\_mroot}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a2e1b24b48c9bbbe2d56ba6db5666673d}{transaction\_mroot}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01939}01939\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}action\_mroot"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a4096ec8f931ab9180ae80f6e06332103}{action\_mroot}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a4096ec8f931ab9180ae80f6e06332103}{action\_mroot}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01940}01940\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}schedule\_version"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a8529628ed392b72693f23a636814172f}{schedule\_version}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a8529628ed392b72693f23a636814172f}{schedule\_version}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01941}01941\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}new\_producers"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_afbddec026595d42b3a280f8c0fddf336}{new\_producers}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_afbddec026595d42b3a280f8c0fddf336}{new\_producers}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01942}01942\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}header\_extensions"{}},\ b.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a8b87aa5950dbd992025ff7c213b1858a}{header\_extensions}},\ ab.\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a8b87aa5950dbd992025ff7c213b1858a}{header\_extensions}}\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01943}01943\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01944}01944\ \textcolor{preprocessor}{\#undef\ SYS\_REPORT}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01945}01945\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01946}01946\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01947}01947\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01948}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{01948}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ bsp,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller::block\_status}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\&\ trx\_lookup\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01949}01949\ \ \ \ \{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01950}01950\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01951}01951\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b\ =\ bsp-\/>block;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01952}01952\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ new\_protocol\_feature\_activations\ =\ bsp-\/>get\_new\_protocol\_feature\_activations();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01953}01953\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01954}01954\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ producer\_block\_id\ =\ bsp-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01955}01955\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566}{start\_block}}(\ b-\/>timestamp,\ b-\/>confirmed,\ new\_protocol\_feature\_activations,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ producer\_block\_id,\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01956}01956\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01957}01957\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ existing\_trxs\_metas\ =\ !bsp-\/>trxs\_metas().empty();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01958}01958\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ pub\_keys\_recovered\ =\ bsp-\/>is\_pub\_keys\_recovered();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01959}01959\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ skip\_auth\_checks\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a42a29a059b847799ae3a75953b6bff1e}{skip\_auth\_check}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01960}01960\ \ \ \ \ \ \ \ \ \ std::vector<std::tuple<transaction\_metadata\_ptr,\ recover\_keys\_future>>\ trx\_metas;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01961}01961\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ use\_bsp\_cached\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01962}01962\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ pub\_keys\_recovered\ ||\ (skip\_auth\_checks\ \&\&\ existing\_trxs\_metas)\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01963}01963\ \ \ \ \ \ \ \ \ \ \ \ \ use\_bsp\_cached\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01964}01964\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01965}01965\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.reserve(\ b-\/>transactions.size()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01966}01966\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ receipt\ :\ b-\/>transactions\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01967}01967\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<packed\_transaction>(receipt.trx))\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01968}01968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pt\ =\ std::get<packed\_transaction>(receipt.trx);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01969}01969\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\ trx\_meta\_ptr\ =\ trx\_lookup\ ?\ trx\_lookup(\ pt.id()\ )\ :\ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01970}01970\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx\_meta\_ptr\ \&\&\ *trx\_meta\_ptr-\/>packed\_trx()\ !=\ pt\ )\ trx\_meta\_ptr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01971}01971\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx\_meta\_ptr\ \&\&\ (\ skip\_auth\_checks\ ||\ !trx\_meta\_ptr-\/>recovered\_keys().empty()\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01972}01972\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.emplace\_back(\ std::move(\ trx\_meta\_ptr\ ),\ \mbox{\hyperlink{namespacesysio_1_1chain_a036ea97f093bf3270bd2c9a097cbcaba}{recover\_keys\_future}}\{\}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01973}01973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ skip\_auth\_checks\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01974}01974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a7041c0316bd294d0866609ab3e0cc7a7}{packed\_transaction\_ptr}}\ ptrx(\ b,\ \&pt\ );\ \textcolor{comment}{//\ alias\ signed\_block\_ptr}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01975}01975\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.emplace\_back(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01976}01976\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_acb14de2d02033c2d43c65319825d3d5b}{transaction\_metadata::create\_no\_recover\_keys}}(\ std::move(ptrx),\ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053edaa43c1b0aa53a0c908810c06ab1ff3967}{transaction\_metadata::trx\_type::input}}\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01977}01977\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a036ea97f093bf3270bd2c9a097cbcaba}{recover\_keys\_future}}\{\}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01978}01978\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01979}01979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a7041c0316bd294d0866609ab3e0cc7a7}{packed\_transaction\_ptr}}\ ptrx(\ b,\ \&pt\ );\ \textcolor{comment}{//\ alias\ signed\_block\_ptr}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01980}01980\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fut\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a122861328470aa67ebf9ac5cb798755d}{transaction\_metadata::start\_recover\_keys}}(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01981}01981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ ptrx\ ),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}.\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool_ae2f5fa4611193d13bb40e34708d897ea}{get\_executor}}(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{microseconds::maximum}}(),\ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053edaa43c1b0aa53a0c908810c06ab1ff3967}{transaction\_metadata::trx\_type::input}}\ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01982}01982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.emplace\_back(\ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\{\},\ std::move(\ fut\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01983}01983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01984}01984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01985}01985\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01986}01986\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01987}01987\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01988}01988\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01989}01989\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01990}01990\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ packed\_idx\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01991}01991\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ receipt\ :\ b-\/>transactions\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01992}01992\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_receipts\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_pending\_trx\_receipts;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01993}01993\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ num\_pending\_receipts\ =\ trx\_receipts.size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01994}01994\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<packed\_transaction>(receipt.trx)\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01995}01995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_meta\ =\ (\ use\_bsp\_cached\ ?\ bsp-\/>trxs\_metas().at(\ packed\_idx\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01996}01996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (\ !!std::get<0>(\ trx\_metas.at(\ packed\_idx\ )\ )\ ?}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01997}01997\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::get<0>(\ trx\_metas.at(\ packed\_idx\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01998}01998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ std::get<1>(\ trx\_metas.at(\ packed\_idx\ )\ ).get()\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l01999}01999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}{push\_transaction}}(\ trx\_meta,\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}(),\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{fc::microseconds::maximum}}(),\ receipt.cpu\_usage\_us,\ \textcolor{keyword}{true},\ 0\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02000}02000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++packed\_idx;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02001}02001\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ std::holds\_alternative<transaction\_id\_type>(receipt.trx)\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02002}02002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}{push\_scheduled\_transaction}}(\ std::get<transaction\_id\_type>(receipt.trx),\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}(),\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{fc::microseconds::maximum}}(),\ receipt.cpu\_usage\_us,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02003}02003\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02004}02004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \textcolor{keyword}{false},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}encountered\ unexpected\ receipt\ type"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02005}02005\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02006}02006\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02007}02007\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ transaction\_failed\ =\ \ trace\ \&\&\ trace-\/>except;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02008}02008\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ transaction\_can\_fail\ =\ receipt.status\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55ac705728ca8b5f3a44d8026e14990c463}{transaction\_receipt\_header::hard\_fail}}\ \&\&\ std::holds\_alternative<transaction\_id\_type>(receipt.trx);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02009}02009\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ transaction\_failed\ \&\&\ !transaction\_can\_fail)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02010}02010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((*trace));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02011}02011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ *trace-\/>except;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02012}02012\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02013}02013\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02014}02014\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ trx\_receipts.size()\ >\ 0,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02015}02015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}expected\ a\ receipt,\ block\_num\ \$\{bn\},\ block\_id\ \$\{id\},\ receipt\ \$\{e\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02016}02016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}bn"{}},\ b-\/>block\_num())(\textcolor{stringliteral}{"{}id"{}},\ producer\_block\_id)(\textcolor{stringliteral}{"{}e"{}},\ receipt)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02017}02017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02018}02018\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ trx\_receipts.size()\ ==\ num\_pending\_receipts\ +\ 1,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02019}02019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}expected\ receipt\ was\ not\ added,\ block\_num\ \$\{bn\},\ block\_id\ \$\{id\},\ receipt\ \$\{e\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02020}02020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}bn"{}},\ b-\/>block\_num())(\textcolor{stringliteral}{"{}id"{}},\ producer\_block\_id)(\textcolor{stringliteral}{"{}e"{}},\ receipt)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02021}02021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02022}02022\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header}{transaction\_receipt\_header}}\&\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}\ =\ trx\_receipts.back();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02023}02023\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}\ ==\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header}{transaction\_receipt\_header}}\&\textcolor{keyword}{>}(receipt),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02024}02024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}receipt\ does\ not\ match,\ \$\{lhs\}\ !=\ \$\{rhs\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02025}02025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}lhs"{}},\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}})(\textcolor{stringliteral}{"{}rhs"{}},\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header}{transaction\_receipt\_header}}\&\textcolor{keyword}{>}(receipt))\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02026}02026\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02027}02027\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02028}02028\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ validated\ in\ create\_block\_state\_future()}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02029}02029\ \ \ \ \ \ \ \ \ \ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_transaction\_mroot\ =\ b-\/>transaction\_mroot;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02030}02030\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02031}02031\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ New:\ Process\ the\ s\_header\ from\ block\ header\ extensions}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02032}02032\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\_header\_it\ =\ std::find\_if(b-\/>header\_extensions.begin(),\ b-\/>header\_extensions.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02033}02033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ ext)\ \{\ return\ ext.first\ ==\ s\_root\_extension::extension\_id();\ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02034}02034\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s\_header\_it\ !=\ b-\/>header\_extensions.end())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02035}02035\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Found\ s\_root\_extension\ in\ header\_extensions,\ attempting\ to\ extract..."{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02036}02036\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1s__header}{s\_header}}\ extracted\_s\_header\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack<s\_header>}}(s\_header\_it-\/>second);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02037}02037\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Extracted\ s\_header:\ \$\{s\_header\}"{}},\ (\textcolor{stringliteral}{"{}s\_header"{}},\ extracted\_s\_header.\mbox{\hyperlink{structsysio_1_1chain_1_1s__header_a2075610dd92e3718f545b14adcd3ebf7}{to\_string}}()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02038}02038\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a59e341a41ba27734555c54c37bacf358}{set\_s\_header}}(extracted\_s\_header);\ \textcolor{comment}{//\ Attempt\ to\ set\ s-\/header}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02039}02039\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02040}02040\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02041}02041\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192}{finalize\_block}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02042}02042\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02043}02043\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ ab\ =\ std::get<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02044}02044\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02045}02045\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02046}02046\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02047}02047\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ producer\_block\_id\ !=\ ab.\_id\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02048}02048\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}Validation\ block\ id\ does\ not\ match\ producer\ block\ id"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02049}02049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973}{report\_block\_header\_diff}}(\ *b,\ *ab.\_unsigned\_block\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02050}02050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ implicitly\ asserts\ that\ all\ header\ fields\ (less\ the\ signature)\ are\ identical}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02051}02051\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ producer\_block\_id\ ==\ ab.\_id,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}Block\ ID\ does\ not\ match"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02052}02052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}producer\_block\_id"{}},\ producer\_block\_id)(\textcolor{stringliteral}{"{}validator\_block\_id"{}},\ ab.\_id)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02053}02053\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02054}02054\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02055}02055\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !use\_bsp\_cached\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02056}02056\ \ \ \ \ \ \ \ \ \ \ \ \ bsp-\/>set\_trxs\_metas(\ std::move(\ ab.\_trx\_metas\ ),\ !skip\_auth\_checks\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02057}02057\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02058}02058\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ create\ completed\_block\ with\ the\ existing\ block\_state\ as\ we\ just\ verified\ it\ is\ the\ same\ as\ assembled\_block}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02059}02059\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1completed__block}{completed\_block}}\{\ bsp\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02060}02060\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02061}02061\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4}{commit\_block}}(\textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02062}02062\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02063}02063\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02064}02064\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02065}02065\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02066}02066\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02067}02067\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02068}02068\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02069}02069\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\_block}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02070}02070\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02071}02071\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02072}02072\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.\mbox{\hyperlink{classfc_1_1exception_ab1104818bf0d9b6a29f0dfe036cf97f6}{what}}()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02073}02073\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\_block}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02074}02074\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02075}02075\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02076}02076\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}()\ \}\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02077}02077\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02078}02078\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02079}02079\ \ \ \ \textcolor{comment}{//\ thread\ safe,\ expected\ to\ be\ called\ from\ thread\ other\ than\ the\ main\ thread}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02080}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8}{02080}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8}{create\_block\_state\_i}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \textcolor{keywordtype}{id},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\_header\_state}}\&\ prev\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02081}02081\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ trx\_mroot\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}{calculate\_trx\_merkle}}(\ b-\/>transactions\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02082}02082\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b-\/>transaction\_mroot\ ==\ trx\_mroot,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02083}02083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}invalid\ block\ transaction\ merkle\ root\ \$\{b\}\ !=\ \$\{c\}"{}},\ (\textcolor{stringliteral}{"{}b"{}},\ b-\/>transaction\_mroot)(\textcolor{stringliteral}{"{}c"{}},\ trx\_mroot)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02084}02084\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02085}02085\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ skip\_validate\_signee\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02086}02086\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ std::make\_shared<block\_state>(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02087}02087\ \ \ \ \ \ \ \ \ \ \ \ \ prev,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02088}02088\ \ \ \ \ \ \ \ \ \ \ \ \ b,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02089}02089\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02090}02090\ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02091}02091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02092}02092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_features\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02093}02093\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ check\_protocol\_features(\ timestamp,\ cur\_features,\ new\_features\ );\ \},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02094}02094\ \ \ \ \ \ \ \ \ \ \ \ \ skip\_validate\_signee}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02095}02095\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02096}02096\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02097}02097\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \textcolor{keywordtype}{id}\ ==\ bsp-\/>id,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02098}02098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}provided\ id\ \$\{id\}\ does\ not\ match\ block\ id\ \$\{bid\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ \textcolor{keywordtype}{id})(\textcolor{stringliteral}{"{}bid"{}},\ bsp-\/>id)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02099}02099\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ bsp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02100}02100\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02101}02101\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02102}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af1df7b3285411e4e9ae6781353ad4d80}{02102}}\ \ \ \ std::future<block\_state\_ptr>\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af1df7b3285411e4e9ae6781353ad4d80}{create\_block\_state\_future}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \textcolor{keywordtype}{id},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02103}02103\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}null\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02104}02104\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02105}02105\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_a7c89dacf49f9737b2395006400c5a26c}{async\_thread\_pool}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}.\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool_ae2f5fa4611193d13bb40e34708d897ea}{get\_executor}}(),\ [b,\ \textcolor{keywordtype}{id},\ control=\textcolor{keyword}{this}]()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02106}02106\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ no\ reason\ for\ a\ block\_state\ if\ fork\_db\ already\ knows\ about\ block}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02107}02107\ \ \ \ \ \ \ \ \ \ auto\ existing\ =\ control-\/>fork\_db.get\_block(\ id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02108}02108\ \ \ \ \ \ \ \ \ \ SYS\_ASSERT(\ !existing,\ fork\_database\_exception,\ \textcolor{stringliteral}{"{}we\ already\ know\ about\ this\ block:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ id)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02109}02109\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02110}02110\ \ \ \ \ \ \ \ \ \ auto\ prev\ =\ control-\/>fork\_db.get\_block\_header(\ b-\/>previous\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02111}02111\ \ \ \ \ \ \ \ \ \ SYS\_ASSERT(\ prev,\ unlinkable\_block\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02112}02112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}unlinkable\ block\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ id)(\textcolor{stringliteral}{"{}previous"{}},\ b-\/>previous)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02113}02113\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02114}02114\ \ \ \ \ \ \ \ \ \ return\ control-\/>create\_block\_state\_i(\ id,\ b,\ *prev\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02115}02115\ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02116}02116\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02117}02117\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02118}02118\ \ \ \ \textcolor{comment}{//\ thread\ safe,\ expected\ to\ be\ called\ from\ thread\ other\ than\ the\ main\ thread}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02119}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad5c91b7cff820c07efed35a7b3912d68}{02119}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad5c91b7cff820c07efed35a7b3912d68}{create\_block\_state}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \textcolor{keywordtype}{id},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02120}02120\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}null\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02121}02121\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02122}02122\ \ \ \ \ \ \ \textcolor{comment}{//\ no\ reason\ for\ a\ block\_state\ if\ fork\_db\ already\ knows\ about\ block}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02123}02123\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ existing\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_aee9daa00e2698a868ad36853e58d3908}{get\_block}}(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02124}02124\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !existing,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}we\ already\ know\ about\ this\ block:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ \textcolor{keywordtype}{id})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02125}02125\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02126}02126\ \ \ \ \ \ \ \textcolor{comment}{//\ previous\ not\ found\ could\ mean\ that\ previous\ block\ not\ applied\ yet}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02127}02127\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ prev\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a681f9146e0afd70a0e8c0421efb0a41f}{get\_block\_header}}(\ b-\/>previous\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02128}02128\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !prev\ )\ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02129}02129\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02130}02130\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8}{create\_block\_state\_i}}(\ \textcolor{keywordtype}{id},\ b,\ *prev\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02131}02131\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02132}02132\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02133}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac2d3794f1bd0ff1bd5837d8ead15d289}{02133}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac2d3794f1bd0ff1bd5837d8ead15d289}{push\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ bsp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02134}02134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\_branch\_callback}}\&\ forked\_branch\_cb,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02135}02135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\&\ trx\_lookup\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02136}02136\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02137}02137\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller::block\_status}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02138}02138\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}it\ is\ not\ valid\ to\ push\ a\ block\ when\ there\ is\ a\ pending\ block"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02139}02139\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02140}02140\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_prod\_light\_validation\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([old\_value=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\_producer\_light\_validation}},\ \textcolor{keyword}{this}]()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02141}02141\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\_producer\_light\_validation}}\ =\ old\_value;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02142}02142\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02143}02143\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02144}02144\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ bsp,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}null\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02145}02145\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ b\ =\ bsp-\/>block;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02146}02146\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02147}02147\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ >\ 0\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02148}02148\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Reached\ configured\ maximum\ block\ \$\{num\};\ terminating"{}},\ (\textcolor{stringliteral}{"{}num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02149}02149\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02150}02150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02151}02151\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02152}02152\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02153}02153\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4fc6dcda025714506dce2a3ed924a21c}{pre\_accepted\_block}},\ b\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02154}02154\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02155}02155\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a97cf1402b71020048ae0054e4d7c8079}{add}}(\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02156}02156\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02157}02157\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1196ffe0c4905238026e4923cf24cb3e}{is\_trusted\_producer}}(b-\/>producer))\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02158}02158\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\_producer\_light\_validation}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02159}02159\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02160}02160\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02161}02161\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0a0659166483870bf065f4d5e671484e}{accepted\_block\_header}},\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02162}02162\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02163}02163\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02164}02164\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\_switch\_forks}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}(),\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ forked\_branch\_cb,\ trx\_lookup\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02165}02165\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02166}02166\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\_irreversible}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02167}02167\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02168}02168\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02169}02169\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}(\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02170}02170\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02171}02171\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02172}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}{02172}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}{replay\_push\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller::block\_status}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02173}02173\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02174}02174\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02175}02175\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}it\ is\ not\ valid\ to\ push\ a\ block\ when\ there\ is\ a\ pending\ block"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02176}02176\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02177}02177\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02178}02178\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}trying\ to\ push\ empty\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02179}02179\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02180}02180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}invalid\ block\ status\ for\ replay"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02181}02181\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02182}02182\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ >\ 0\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02183}02183\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Reached\ configured\ maximum\ block\ \$\{num\};\ terminating"{}},\ (\textcolor{stringliteral}{"{}num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02184}02184\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02185}02185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02186}02186\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02187}02187\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02188}02188\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4fc6dcda025714506dce2a3ed924a21c}{pre\_accepted\_block}},\ b\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02189}02189\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ skip\_validate\_signee\ =\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5845874d26f30413374713814cde5749}{force\_all\_checks}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02190}02190\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02191}02191\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ std::make\_shared<block\_state>(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02192}02192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02193}02193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02194}02194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02195}02195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02196}02196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02197}02197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_features\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02198}02198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ check\_protocol\_features(\ timestamp,\ cur\_features,\ new\_features\ );\ \},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02199}02199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ skip\_validate\_signee}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02200}02200\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02201}02201\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02202}02202\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ !=\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02203}02203\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a97cf1402b71020048ae0054e4d7c8079}{add}}(\ bsp,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02204}02204\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02205}02205\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02206}02206\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0a0659166483870bf065f4d5e671484e}{accepted\_block\_header}},\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02207}02207\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02208}02208\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02209}02209\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ bsp,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02210}02210\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ bsp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02211}02211\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02212}02212\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ On\ replay,\ log\_irreversible\ is\ not\ called\ and\ so\ no\ irreversible\_block\ signal\ is\ emitted.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02213}02213\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ So\ emit\ it\ explicitly\ here.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02214}02214\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a27266ebf16b6dd19a860635f7d1f9930}{irreversible\_block}},\ bsp\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02215}02215\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02216}02216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}))\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02217}02217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_aca6d7bcd700644f077b89203b2e8b7ef}{commit}}(bsp-\/>block\_num);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02218}02218\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02219}02219\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02220}02220\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02221}02221\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02222}02222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}invariant\ failure:\ cannot\ replay\ reversible\ blocks\ while\ in\ irreversible\ mode"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02223}02223\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\_switch\_forks}}(\ bsp,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\_branch\_callback}}\{\},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02224}02224\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02225}02225\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02226}02226\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}(\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02227}02227\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02228}02228\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02229}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{02229}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\_switch\_forks}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ new\_head,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller::block\_status}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02230}02230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\_branch\_callback}}\&\ forked\_branch\_cb,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\&\ trx\_lookup\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02231}02231\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02232}02232\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ head\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02233}02233\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ new\_head-\/>header.previous\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02234}02234\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02235}02235\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ new\_head,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ trx\_lookup\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02236}02236\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ new\_head\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02237}02237\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ new\_head;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02238}02238\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02239}02239\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a193f10ce12656c580b023d36193a5cdc}{remove}}(\ new\_head-\/>id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02240}02240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02241}02241\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02242}02242\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ new\_head-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02243}02243\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ old\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02244}02244\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}switching\ forks\ from\ \$\{current\_head\_id\}\ (block\ number\ \$\{current\_head\_num\})\ to\ \$\{new\_head\_id\}\ (block\ number\ \$\{new\_head\_num\})"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02245}02245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}current\_head\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id)(\textcolor{stringliteral}{"{}current\_head\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)(\textcolor{stringliteral}{"{}new\_head\_id"{}},\ new\_head-\/>id)(\textcolor{stringliteral}{"{}new\_head\_num"{}},\ new\_head-\/>block\_num)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02246}02246\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02247}02247\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02248}02248\ \ \ \ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_switch\_forks(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id,\ new\_head-\/>id);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02249}02249\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02250}02250\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02251}02251\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ branches\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a77f152572f2703a40e9c198456fad748}{fetch\_branch\_from}}(\ new\_head-\/>id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02252}02252\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02253}02253\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ branches.second.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02254}02254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ itr\ =\ branches.second.begin();\ itr\ !=\ branches.second.end();\ ++itr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02255}02255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}{pop\_block}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02256}02256\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02257}02257\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ ==\ branches.second.back()-\/>header.previous,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02258}02258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}loss\ of\ sync\ between\ fork\_db\ and\ chainbase\ during\ fork\ switch"{}}\ );\ \textcolor{comment}{//\ \_should\_\ never\ fail}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02259}02259\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02260}02260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ forked\_branch\_cb\ )\ forked\_branch\_cb(\ branches.second\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02261}02261\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02262}02262\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02263}02263\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ ritr\ =\ branches.first.rbegin();\ ritr\ !=\ branches.first.rend();\ ++ritr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02264}02264\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ except\ =\ std::exception\_ptr\{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02265}02265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02266}02266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ *ritr,\ (*ritr)-\/>is\_valid()\ ?\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02267}02267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}},\ trx\_lookup\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02268}02268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ *ritr\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02269}02269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ *ritr;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02270}02270\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02271}02271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02272}02272\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02273}02273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02274}02274\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02275}02275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}exception\ thrown\ while\ switching\ forks\ \$\{e\}"{}},\ (\textcolor{stringliteral}{"{}e"{}},\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02276}02276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\ =\ std::current\_exception();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02277}02277\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02278}02278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}exception\ thrown\ while\ switching\ forks\ \$\{e\}"{}},\ (\textcolor{stringliteral}{"{}e"{}},\ e.\mbox{\hyperlink{classfc_1_1exception_ab1104818bf0d9b6a29f0dfe036cf97f6}{what}}()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02279}02279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\ =\ std::current\_exception();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02280}02280\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02281}02281\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02282}02282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ except\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02283}02283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ritr\ currently\ points\ to\ the\ block\ that\ threw}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02284}02284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ block\ that\ threw\ and\ all\ forks\ built\ off\ it.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02285}02285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a193f10ce12656c580b023d36193a5cdc}{remove}}(\ (*ritr)-\/>id\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02286}02286\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02287}02287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pop\ all\ blocks\ from\ the\ bad\ fork,\ discarding\ their\ transactions}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02288}02288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ritr\ base\ is\ a\ forward\ itr\ to\ the\ last\ block\ successfully\ applied}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02289}02289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ applied\_itr\ =\ ritr.base();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02290}02290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ itr\ =\ applied\_itr;\ itr\ !=\ branches.first.end();\ ++itr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02291}02291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}{pop\_block}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02292}02292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02293}02293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ ==\ branches.second.back()-\/>header.previous,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02294}02294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}loss\ of\ sync\ between\ fork\_db\ and\ chainbase\ during\ fork\ switch\ reversal"{}}\ );\ \textcolor{comment}{//\ \_should\_\ never\ fail}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02295}02295\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02296}02296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ re-\/apply\ good\ blocks}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02297}02297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ ritr\ =\ branches.second.rbegin();\ ritr\ !=\ branches.second.rend();\ ++ritr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02298}02298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ *ritr,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}\ \textcolor{comment}{/*\ we\ previously\ validated\ these\ blocks*/},\ trx\_lookup\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02299}02299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ *ritr;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02300}02300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02301}02301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::rethrow\_exception(except);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02302}02302\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ end\ if\ exception}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02303}02303\ \ \ \ \ \ \ \ \ \ \}\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02304}02304\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02305}02305\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}successfully\ switched\ fork\ to\ new\ head\ \$\{new\_head\_id\}"{}},\ (\textcolor{stringliteral}{"{}new\_head\_id"{}},\ new\_head-\/>id));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02306}02306\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02307}02307\ \ \ \ \ \ \ \ \ \ head\_changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02308}02308\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02309}02309\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02310}02310\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ head\_changed\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02311}02311\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\_irreversible}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02312}02312\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02313}02313\ \ \ \ \}\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02314}02314\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02315}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{02315}}\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_metadata\_ptr>}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\_block}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02316}02316\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_metadata\_ptr>}}\ applied\_trxs;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02317}02317\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02318}02318\ \ \ \ \ \ \ \ \ \ applied\_trxs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>extract\_trx\_metas();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02319}02319\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.reset();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02320}02320\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a5b8ed9cc5cb5822d6cb645a3b7a5f98c}{popped\_blocks\_to}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02321}02321\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02322}02322\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ applied\_trxs;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02323}02323\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02324}02324\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02325}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}{02325}}\ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1sha256}{checksum256\_type}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}{calculate\_trx\_merkle}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_receipt>}}\&\ trxs\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02326}02326\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\ trx\_digests;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02327}02327\ \ \ \ \ \ \ trx\_digests.reserve(\ trxs.size()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02328}02328\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ :\ trxs\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02329}02329\ \ \ \ \ \ \ \ \ \ trx\_digests.emplace\_back(\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.digest()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02330}02330\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02331}02331\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_a80d7ea5476f97bf51a25149b55469c40}{merkle}}(\ move(trx\_digests)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02332}02332\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02333}02333\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02334}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f}{02334}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f}{update\_producers\_authority}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02335}02335\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>get\_pending\_block\_header\_state().active\_schedule.producers;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02336}02336\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02337}02337\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ update\_permission\ =\ [\&](\ \textcolor{keyword}{auto}\&\ permission,\ \textcolor{keyword}{auto}\ threshold\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02338}02338\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ auth\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}(\ threshold,\ \{\},\ \{\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02339}02339\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}\ :\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02340}02340\ \ \ \ \ \ \ \ \ \ \ \ \ auth.accounts.push\_back(\{\{\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name,\ config::active\_name\},\ 1\});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02341}02341\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02342}02342\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02343}02343\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}\textcolor{keyword}{>}(permission.auth)\ !=\ auth\ )\ \{\ \textcolor{comment}{//\ TODO:\ use\ a\ more\ efficient\ way\ to\ check\ that\ authority\ has\ not\ changed}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02344}02344\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(permission,\ [\&](\ \textcolor{keyword}{auto}\&\ po\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02345}02345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ po.auth\ =\ auth;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02346}02346\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02347}02347\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02348}02348\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02349}02349\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02350}02350\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ num\_producers\ =\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02351}02351\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ calculate\_threshold\ =\ [=](\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ numerator,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ denominator\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02352}02352\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\ (num\_producers\ *\ numerator)\ /\ denominator\ )\ +\ 1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02353}02353\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02354}02354\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02355}02355\ \ \ \ \ \ \ update\_permission(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02356}02356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::active\_name\}),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02357}02357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ calculate\_threshold(\ 2,\ 3\ )\ \textcolor{comment}{/*\ more\ than\ two-\/thirds\ */}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02358}02358\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02359}02359\ \ \ \ \ \ \ update\_permission(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02360}02360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::majority\_producers\_permission\_name\}),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02361}02361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ calculate\_threshold(\ 1,\ 2\ )\ \textcolor{comment}{/*\ more\ than\ one-\/half\ */}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02362}02362\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02363}02363\ \ \ \ \ \ \ update\_permission(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02364}02364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::minority\_producers\_permission\_name\}),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02365}02365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ calculate\_threshold(\ 1,\ 3\ )\ \textcolor{comment}{/*\ more\ than\ one-\/third\ */}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02366}02366\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02367}02367\ \ \ \ \ \ \ \textcolor{comment}{//TODO:\ Add\ tests}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02368}02368\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02369}02369\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02370}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84}{02370}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84}{create\_block\_summary}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02371}02371\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{block\_header::num\_from\_id}}(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02372}02372\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ sid\ =\ block\_num\ \&\ 0xffff;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02373}02373\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1block__summary__object}{block\_summary\_object}},by\_id>(sid),\ [\&](\mbox{\hyperlink{classsysio_1_1chain_1_1block__summary__object}{block\_summary\_object}}\&\ bso\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02374}02374\ \ \ \ \ \ \ \ \ \ \ bso.block\_id\ =\ id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02375}02375\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02376}02376\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02377}02377\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02378}02378\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02379}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}{02379}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}{clear\_expired\_input\_transactions}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\&\ deadline)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02380}02380\ \ \ \ \ \ \ \textcolor{comment}{//Look\ for\ expired\ transactions\ in\ the\ deduplication\ list,\ and\ remove\ them.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02381}02381\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ transaction\_idx\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afaea057692a8bbbf3f506b64c60308b6}{get\_mutable\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a7ae1398893dd587589ee5593a952a2ef}{transaction\_multi\_index}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02382}02382\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ dedupe\_index\ =\ transaction\_idx.indices().get<by\_expiration>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02383}02383\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ now\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a286751cd6498b500b70a0d3678672263}{is\_building\_block}}()\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aea3612e7cb52dfcaa2e6afdc1b3e2f51}{head\_block\_time}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02384}02384\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ total\ =\ dedupe\_index.size();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02385}02385\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ num\_removed\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02386}02386\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ (!dedupe\_index.empty())\ \&\&\ (\ now\ >\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}(dedupe\_index.begin()-\/>expiration)\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02387}02387\ \ \ \ \ \ \ \ \ \ transaction\_idx.remove(*dedupe\_index.begin());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02388}02388\ \ \ \ \ \ \ \ \ \ ++num\_removed;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02389}02389\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ deadline\ <=\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02390}02390\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02391}02391\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02392}02392\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02393}02393\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a3da1571bad6ca6c94df9a3660b2115ee}{dlog}}(\textcolor{stringliteral}{"{}removed\ \$\{n\}\ expired\ transactions\ of\ the\ \$\{t\}\ input\ dedup\ list,\ pending\ block\ time\ \$\{pt\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02394}02394\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}n"{}},\ num\_removed)(\textcolor{stringliteral}{"{}t"{}},\ total)(\textcolor{stringliteral}{"{}pt"{}},\ now));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02395}02395\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02396}02396\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02397}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735}{02397}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735}{sender\_avoids\_whitelist\_blacklist\_enforcement}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ sender\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02398}02398\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a8440b353861fe179036cb8af088323ff}{sender\_bypass\_whiteblacklist}}.size()\ >\ 0\ \&\&}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02399}02399\ \ \ \ \ \ \ \ \ \ \ (\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a8440b353861fe179036cb8af088323ff}{sender\_bypass\_whiteblacklist}}.find(\ sender\ )\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a8440b353861fe179036cb8af088323ff}{sender\_bypass\_whiteblacklist}}.end()\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02400}02400\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02401}02401\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02402}02402\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02403}02403\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02404}02404\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02405}02405\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02406}02406\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02407}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1}{02407}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1}{check\_actor\_list}}(\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ actors\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02408}02408\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ actors.size()\ ==\ 0\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02409}02409\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02410}02410\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a64ea139aa98e2d67dfed0a5c2f36eb77}{actor\_whitelist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02411}02411\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ throw\ if\ actors\ is\ not\ a\ subset\ of\ whitelist}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02412}02412\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ whitelist\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a64ea139aa98e2d67dfed0a5c2f36eb77}{actor\_whitelist}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02413}02413\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_subset\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02414}02414\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02415}02415\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ quick\ extents\ check,\ then\ brute\ force\ the\ check\ actors}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02416}02416\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*actors.cbegin()\ >=\ *whitelist.cbegin()\ \&\&\ *actors.crbegin()\ <=\ *whitelist.crbegin()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02417}02417\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lower\_bound\ =\ whitelist.cbegin();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02418}02418\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{classfc_1_1actor}{actor}}:\ actors)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02419}02419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lower\_bound\ =\ std::lower\_bound(lower\_bound,\ whitelist.cend(),\ \mbox{\hyperlink{classfc_1_1actor}{actor}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02420}02420\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02421}02421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ actor\ is\ not\ found,\ this\ is\ not\ a\ subset}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02422}02422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lower\_bound\ ==\ whitelist.cend()\ ||\ *lower\_bound\ !=\ \mbox{\hyperlink{classfc_1_1actor}{actor}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02423}02423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_subset\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02424}02424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02425}02425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02426}02426\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02427}02427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ actor\ was\ found,\ we\ are\ guaranteed\ that\ other\ actors\ are\ either\ not\ present\ in\ the\ whitelist}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02428}02428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ or\ will\ be\ present\ in\ the\ range\ defined\ as\ [next\ actor,end)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02429}02429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lower\_bound\ =\ std::next(lower\_bound);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02430}02430\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02431}02431\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02432}02432\ \ \ \ \ \ \ \ \ \ \ \ \ is\_subset\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02433}02433\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02434}02434\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02435}02435\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ helper\ lambda\ to\ lazily\ calculate\ the\ actors\ for\ error\ messaging}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02436}02436\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ generate\_missing\_actors\ =\ [](\textcolor{keyword}{const}\ flat\_set<account\_name>\&\ actors,\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ whitelist)\ -\/>\ \mbox{\hyperlink{classfc_1_1vector}{vector<account\_name>}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02437}02437\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<account\_name>}}\ excluded;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02438}02438\ \ \ \ \ \ \ \ \ \ \ \ \ excluded.reserve(\ actors.size()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02439}02439\ \ \ \ \ \ \ \ \ \ \ \ \ set\_difference(\ actors.begin(),\ actors.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02440}02440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ whitelist.begin(),\ whitelist.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02441}02441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::back\_inserter(excluded)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02442}02442\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ excluded;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02443}02443\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02444}02444\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02445}02445\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ is\_subset,\ \ actor\_whitelist\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02446}02446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}authorizing\ actor(s)\ in\ transaction\ are\ not\ on\ the\ actor\ whitelist:\ \$\{actors\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02447}02447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}actors"{}},\ generate\_missing\_actors(actors,\ whitelist))}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02448}02448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02449}02449\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5922ec305c682477fd9ef6ce74293c9d}{actor\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02450}02450\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ throw\ if\ actors\ intersects\ blacklist}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02451}02451\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ blacklist\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5922ec305c682477fd9ef6ce74293c9d}{actor\_blacklist}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02452}02452\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ intersects\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02453}02453\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02454}02454\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ quick\ extents\ check\ then\ brute\ force\ check\ actors}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02455}02455\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ *actors.cbegin()\ <=\ *blacklist.crbegin()\ \&\&\ *actors.crbegin()\ >=\ *blacklist.cbegin()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02456}02456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lower\_bound\ =\ blacklist.cbegin();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02457}02457\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{classfc_1_1actor}{actor}}:\ actors)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02458}02458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lower\_bound\ =\ std::lower\_bound(lower\_bound,\ blacklist.cend(),\ \mbox{\hyperlink{classfc_1_1actor}{actor}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02459}02459\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02460}02460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ lower\ bound\ in\ the\ blacklist\ is\ at\ the\ end,\ all\ other\ actors\ are\ guaranteed\ to}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02461}02461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ not\ exist\ in\ the\ blacklist}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02462}02462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lower\_bound\ ==\ blacklist.cend())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02463}02463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02464}02464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02465}02465\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02466}02466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ lower\ bound\ of\ an\ actor\ IS\ the\ actor,\ then\ we\ have\ an\ intersection}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02467}02467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*lower\_bound\ ==\ \mbox{\hyperlink{classfc_1_1actor}{actor}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02468}02468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ intersects\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02469}02469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02470}02470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02471}02471\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02472}02472\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02473}02473\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02474}02474\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ helper\ lambda\ to\ lazily\ calculate\ the\ actors\ for\ error\ messaging}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02475}02475\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ generate\_blacklisted\_actors\ =\ [](\textcolor{keyword}{const}\ flat\_set<account\_name>\&\ actors,\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ \mbox{\hyperlink{spec__test__generator_8cpp_a38761dc1394ef77d1a39dd282d9e64f5}{blacklist}})\ -\/>\ \mbox{\hyperlink{classfc_1_1vector}{vector<account\_name>}}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02476}02476\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<account\_name>}}\ blacklisted;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02477}02477\ \ \ \ \ \ \ \ \ \ \ \ \ blacklisted.reserve(\ actors.size()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02478}02478\ \ \ \ \ \ \ \ \ \ \ \ \ set\_intersection(\ actors.begin(),\ actors.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02479}02479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ blacklist.begin(),\ blacklist.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02480}02480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::back\_inserter(blacklisted)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02481}02481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02482}02482\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ blacklisted;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02483}02483\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02484}02484\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02485}02485\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !intersects,\ actor\_blacklist\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02486}02486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}authorizing\ actor(s)\ in\ transaction\ are\ on\ the\ actor\ blacklist:\ \$\{actors\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02487}02487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}actors"{}},\ generate\_blacklisted\_actors(actors,\ blacklist))}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02488}02488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02489}02489\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02490}02490\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02491}02491\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02492}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a16289260be252f6ebbd80763f657fb38}{02492}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a16289260be252f6ebbd80763f657fb38}{check\_contract\_list}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ code\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02493}02493\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a0c34416a36f48ede90d9701b986d3487}{contract\_whitelist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02494}02494\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a0c34416a36f48ede90d9701b986d3487}{contract\_whitelist}}.find(\ code\ )\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a0c34416a36f48ede90d9701b986d3487}{contract\_whitelist}}.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02495}02495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ contract\_whitelist\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02496}02496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}account\ '\$\{code\}'\ is\ not\ on\ the\ contract\ whitelist"{}},\ (\textcolor{stringliteral}{"{}code"{}},\ code)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02497}02497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02498}02498\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a71961d4eb70d927b9d0003f6255db95f}{contract\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02499}02499\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a71961d4eb70d927b9d0003f6255db95f}{contract\_blacklist}}.find(\ code\ )\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a71961d4eb70d927b9d0003f6255db95f}{contract\_blacklist}}.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02500}02500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ contract\_blacklist\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02501}02501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}account\ '\$\{code\}'\ is\ on\ the\ contract\ blacklist"{}},\ (\textcolor{stringliteral}{"{}code"{}},\ code)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02502}02502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02503}02503\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02504}02504\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02505}02505\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02506}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aff9373c6d02a511984f20486e90585f5}{02506}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aff9373c6d02a511984f20486e90585f5}{check\_action\_list}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ code,\ \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02507}02507\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a979219adeffbc78b1fe73460a8005e39}{action\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02508}02508\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a979219adeffbc78b1fe73460a8005e39}{action\_blacklist}}.find(\ std::make\_pair(code,\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}})\ )\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a979219adeffbc78b1fe73460a8005e39}{action\_blacklist}}.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02509}02509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ action\_blacklist\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02510}02510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}action\ '\$\{code\}::\$\{action\}'\ is\ on\ the\ action\ blacklist"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02511}02511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}code"{}},\ code)(\textcolor{stringliteral}{"{}action"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}})}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02512}02512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02513}02513\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02514}02514\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02515}02515\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02516}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad83ca3895f901f87cbf1060493698f55}{02516}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad83ca3895f901f87cbf1060493698f55}{check\_key\_list}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1crypto_1_1public__key}{public\_key\_type}}\&\ key\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02517}02517\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_ae36a724cde28ee8bc40c6b73206f8a61}{key\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02518}02518\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_ae36a724cde28ee8bc40c6b73206f8a61}{key\_blacklist}}.find(\ key\ )\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_ae36a724cde28ee8bc40c6b73206f8a61}{key\_blacklist}}.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02519}02519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\_blacklist\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02520}02520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}public\ key\ '\$\{key\}'\ is\ on\ the\ key\ blacklist"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02521}02521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}key"{}},\ key)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02522}02522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02523}02523\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02524}02524\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02525}02525\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02526}02526\ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02527}02527\ \textcolor{comment}{\ \ \ bool\ should\_check\_tapos()const\ \{\ return\ true;\ \}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02528}02528\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02529}02529\ \textcolor{comment}{\ \ \ void\ validate\_tapos(\ const\ transaction\&\ trx\ )const\ \{}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02530}02530\ \textcolor{comment}{\ \ \ \ \ \ if(\ !should\_check\_tapos()\ )\ return;}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02531}02531\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02532}02532\ \textcolor{comment}{\ \ \ \ \ \ const\ auto\&\ tapos\_block\_summary\ =\ db.get<block\_summary\_object>((uint16\_t)trx.ref\_block\_num);}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02533}02533\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02534}02534\ \textcolor{comment}{\ \ \ \ \ \ //Verify\ TaPoS\ block\ summary\ has\ correct\ ID\ prefix,\ and\ that\ this\ block's\ time\ is\ not\ past\ the\ expiration}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02535}02535\ \textcolor{comment}{\ \ \ \ \ \ SYS\_ASSERT(trx.verify\_reference\_block(tapos\_block\_summary.block\_id),\ invalid\_ref\_block\_exception,}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02536}02536\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}Transaction's\ reference\ block\ did\ not\ match.\ Is\ this\ transaction\ from\ a\ different\ fork?"{},}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02537}02537\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ("{}tapos\_summary"{},\ tapos\_block\_summary));}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02538}02538\ \textcolor{comment}{\ \ \ \}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02539}02539\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02540}02540\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02541}02541\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02546}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902}{02546}}\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1signed__transaction}{signed\_transaction}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902}{get\_on\_block\_transaction}}()}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02547}02547\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02548}02548\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}\ on\_block\_act;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02549}02549\ \ \ \ \ \ \ on\_block\_act.\mbox{\hyperlink{structsysio_1_1chain_1_1action__base_a3598da3f8df67037e69dab758ce168be}{account}}\ =\ config::system\_account\_name;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02550}02550\ \ \ \ \ \ \ on\_block\_act.\mbox{\hyperlink{structsysio_1_1chain_1_1action__base_a013fae07403bd6deffcade4fd5be095c}{name}}\ =\ \textcolor{stringliteral}{"{}onblock"{}}\_n;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02551}02551\ \ \ \ \ \ \ on\_block\_act.\mbox{\hyperlink{structsysio_1_1chain_1_1action__base_a40939533bca9e44d169ee7e25ebb1945}{authorization}}\ =\ \mbox{\hyperlink{classfc_1_1vector}{vector<permission\_level>}}\{\{config::system\_account\_name,\ config::active\_name\}\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02552}02552\ \ \ \ \ \ \ on\_block\_act.\mbox{\hyperlink{structsysio_1_1chain_1_1action_abeb8e7f99c1779b22ebcd13f534f0205}{data}}\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad39b3fade2e84d4a743230a27c650f1f}{head\_block\_header}}());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02553}02553\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02554}02554\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1signed__transaction}{signed\_transaction}}\ trx;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02555}02555\ \ \ \ \ \ \ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction_a407fcf1868b81bb30b85f80d388bbac2}{actions}}.emplace\_back(std::move(on\_block\_act));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02556}02556\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa808acf858e93c567ff983ccbf8fb6d3}{is\_builtin\_activated}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cfa1e0a5b7203c3f4124dc8c1880b04e36b}{builtin\_protocol\_feature\_t::no\_duplicate\_deferred\_id}}\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02557}02557\ \ \ \ \ \ \ \ \ \ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}}\ =\ \mbox{\hyperlink{classfc_1_1time__point__sec}{time\_point\_sec}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02558}02558\ \ \ \ \ \ \ \ \ \ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a459d803b930351f4a1565d9c082debea}{ref\_block\_num}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02559}02559\ \ \ \ \ \ \ \ \ \ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a6f02077864a99b91d043cd329433a532}{ref\_block\_prefix}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02560}02560\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02561}02561\ \ \ \ \ \ \ \ \ \ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ +\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}(999'999);\ \textcolor{comment}{//\ Round\ up\ to\ nearest\ second\ to\ avoid\ appearing\ expired}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02562}02562\ \ \ \ \ \ \ \ \ \ trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a220798b433002112ac85e5545a99ec51}{set\_reference\_block}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02563}02563\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02564}02564\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02565}02565\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02566}02566\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_onblock(trx);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02567}02567\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02568}02568\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02569}02569\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trx;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02570}02570\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02571}02571\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02572}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{02572}}\ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\_mind\_handler}}*\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02573}02573\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4f73eb03cb9df364b792166a70f78320}{deep\_mind\_logger}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02574}02574\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02575}02575\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02576}\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8618218d7168450c383cde9860d57706}{02576}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8618218d7168450c383cde9860d57706}{earliest\_available\_block\_num}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02577}02577\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ !=\ 0)\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02578}02578\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02579}02579\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02580}02580\ \};\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02581}02581\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02582}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_af096f331aa6ac6b3fe3aa71b3768daa8}{02582}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager}{resource\_limits\_manager}}\&\ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_af096f331aa6ac6b3fe3aa71b3768daa8}{controller::get\_resource\_limits\_manager}}()\textcolor{keyword}{const}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02583}02583\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02584}02584\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>resource\_limits;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02585}02585\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02586}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_add2453cf4d0208ca9f277337c9a5ed7a}{02586}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager}{resource\_limits\_manager}}\&\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_add2453cf4d0208ca9f277337c9a5ed7a}{controller::get\_mutable\_resource\_limits\_manager}}()}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02587}02587\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02588}02588\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>resource\_limits;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02589}02589\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02590}02590\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02591}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8f7456b81f2657ccf6c39b35afb16af4}{02591}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager}{authorization\_manager}}\&\ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8f7456b81f2657ccf6c39b35afb16af4}{controller::get\_authorization\_manager}}()\textcolor{keyword}{const}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02592}02592\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02593}02593\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>authorization;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02594}02594\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02595}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4c7e83b4e4c21205b0fb9b2e4b7fb227}{02595}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager}{authorization\_manager}}\&\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4c7e83b4e4c21205b0fb9b2e4b7fb227}{controller::get\_mutable\_authorization\_manager}}()}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02596}02596\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02597}02597\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>authorization;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02598}02598\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02599}02599\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02600}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a67876c4bcb4b26fa679d347472ff14ee}{02600}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager}{protocol\_feature\_manager}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a67876c4bcb4b26fa679d347472ff14ee}{controller::get\_protocol\_feature\_manager}}()\textcolor{keyword}{const}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02601}02601\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02602}02602\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>protocol\_features;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02603}02603\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02604}02604\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02605}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a5e15777ff13440123a46783623744202}{02605}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a5e15777ff13440123a46783623744202}{controller::get\_max\_nonprivileged\_inline\_action\_size}}()\textcolor{keyword}{const}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02606}02606\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02607}02607\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.max\_nonprivileged\_inline\_action\_size;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02608}02608\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02609}02609\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02610}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_afe391de926abcc0efbd938ac88bad300}{02610}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afe391de926abcc0efbd938ac88bad300}{controller::controller}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{controller::config}}\&\ cfg,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\&\ chain\_id\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02611}02611\ :my(\ new\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl}{controller\_impl}}(\ cfg,\ *this,\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set}{protocol\_feature\_set}}\{\},\ chain\_id\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02612}02612\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02613}02613\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02614}02614\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02615}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac40db9ac3ab5a2c21da04976dee838f9}{02615}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afe391de926abcc0efbd938ac88bad300}{controller::controller}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{config}}\&\ cfg,\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set}{protocol\_feature\_set}}\&\&\ pfs,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\&\ chain\_id\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02616}02616\ :my(\ new\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl}{controller\_impl}}(\ cfg,\ *this,\ \mbox{\hyperlink{namespacestd}{std}}::move(pfs),\ chain\_id\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02617}02617\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02618}02618\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02619}02619\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02620}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a67be65a69cad78d9f44be1b2822d6367}{02620}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a67be65a69cad78d9f44be1b2822d6367}{controller::\string~controller}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02621}02621\ \ \ \ my-\/>abort\_block();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02622}02622\ \ \ \ \textcolor{comment}{/*\ Shouldn't\ be\ needed\ anymore.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02623}02623\ \textcolor{comment}{\ \ \ //close\ fork\_db\ here,\ because\ it\ can\ generate\ "{}irreversible"{}\ signal\ to\ this\ controller,}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02624}02624\ \textcolor{comment}{\ \ \ //in\ case\ if\ read-\/mode\ ==\ IRREVERSIBLE,\ we\ will\ apply\ latest\ irreversible\ block}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02625}02625\ \textcolor{comment}{\ \ \ //for\ that\ we\ need\ 'my'\ to\ be\ valid\ pointer\ pointing\ to\ valid\ controller\_impl.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02626}02626\ \textcolor{comment}{\ \ \ my-\/>fork\_db.close();}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02627}02627\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02628}02628\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02629}02629\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02630}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_af22cf279943012cd05e62ba48d5e747a}{02630}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_af22cf279943012cd05e62ba48d5e747a}{controller::add\_indices}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02631}02631\ \ \ \ my-\/>add\_indices();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02632}02632\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02633}02633\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02634}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_afa7e11a1dbbe3ae89d6220304a3e4bd3}{02634}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afa7e11a1dbbe3ae89d6220304a3e4bd3}{controller::startup}}(\ std::function<\textcolor{keywordtype}{void}()>\ shutdown,\ std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\_reader\_ptr}}\&\ snapshot\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02635}02635\ \ \ \ my-\/>startup(shutdown,\ check\_shutdown,\ snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02636}02636\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02637}02637\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02638}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a07763d4f62277a9dfbc882906179e95b}{02638}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afa7e11a1dbbe3ae89d6220304a3e4bd3}{controller::startup}}(\ std::function<\textcolor{keywordtype}{void}()>\ shutdown,\ std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\_state}}\&\ genesis\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02639}02639\ \ \ \ my-\/>startup(shutdown,\ check\_shutdown,\ genesis);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02640}02640\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02641}02641\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02642}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7527d6d9fe83b8862ff0bf7fabbd4701}{02642}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afa7e11a1dbbe3ae89d6220304a3e4bd3}{controller::startup}}(std::function<\textcolor{keywordtype}{void}()>\ shutdown,\ std::function<\textcolor{keywordtype}{bool}()>\ check\_shutdown)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02643}02643\ \ \ \ my-\/>startup(shutdown,\ check\_shutdown);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02644}02644\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02645}02645\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02646}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{02646}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classchainbase_1_1database}{chainbase::database}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{controller::db}}()\textcolor{keyword}{const\ }\{\ \textcolor{keywordflow}{return}\ my-\/>db;\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02647}02647\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02648}02648\ \mbox{\hyperlink{classchainbase_1_1database}{chainbase::database}}\&\ controller::mutable\_db()\textcolor{keyword}{const\ }\{\ \textcolor{keywordflow}{return}\ my-\/>db;\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02649}02649\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02650}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ade2fbb6f840258b36eb12724ecb06314}{02650}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database}{fork\_database}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ade2fbb6f840258b36eb12724ecb06314}{controller::fork\_db}}()\textcolor{keyword}{const\ }\{\ \textcolor{keywordflow}{return}\ my-\/>fork\_db;\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02651}02651\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02652}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a393457dadb84d77ad0a8a8561f05bcc2}{02652}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a393457dadb84d77ad0a8a8561f05bcc2}{controller::preactivate\_feature}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{digest\_type}}\&\ feature\_digest\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02653}02653\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pfs\ =\ my-\/>protocol\_features.get\_protocol\_feature\_set();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02654}02654\ \ \ \ \textcolor{keyword}{auto}\ cur\_time\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02655}02655\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02656}02656\ \ \ \ \textcolor{keyword}{auto}\ status\ =\ pfs.is\_recognized(\ feature\_digest,\ cur\_time\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02657}02657\ \ \ \ \textcolor{keywordflow}{switch}(\ status\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02658}02658\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a96d8e9e3b92248258403f7fc4cb25644}{protocol\_feature\_set::recognized\_t::unrecognized}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02659}02659\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{is\_producing\_block}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02660}02660\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ subjective\_block\_production\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02661}02661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ unrecognized"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02662}02662\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02663}02663\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_bad\_block\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02664}02664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ unrecognized"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02665}02665\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02666}02666\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02667}02667\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a075ae3d2fc31640504f814f60e5ef713}{protocol\_feature\_set::recognized\_t::disabled}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02668}02668\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{is\_producing\_block}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02669}02669\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ subjective\_block\_production\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02670}02670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ disabled"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02671}02671\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02672}02672\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_bad\_block\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02673}02673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ disabled"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02674}02674\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02675}02675\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02676}02676\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a5d203566b82250f4113257b6db12e488}{protocol\_feature\_set::recognized\_t::too\_early}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02677}02677\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{is\_producing\_block}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02678}02678\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ subjective\_block\_production\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02679}02679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\$\{timestamp\}\ is\ too\ early\ for\ the\ earliest\ allowed\ activation\ time\ of\ the\ protocol\ feature\ with\ digest\ '\$\{digest\}'"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)(\textcolor{stringliteral}{"{}timestamp"{}},\ cur\_time)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02680}02680\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02681}02681\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_bad\_block\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02682}02682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\$\{timestamp\}\ is\ too\ early\ for\ the\ earliest\ allowed\ activation\ time\ of\ the\ protocol\ feature\ with\ digest\ '\$\{digest\}'"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)(\textcolor{stringliteral}{"{}timestamp"{}},\ cur\_time)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02683}02683\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02684}02684\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02685}02685\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427ab2fdab230a2c39f3595a947861863cb7}{protocol\_feature\_set::recognized\_t::ready}}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02686}02686\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02687}02687\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02688}02688\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{is\_producing\_block}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02689}02689\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ subjective\_block\_production\_exception,\ \textcolor{stringliteral}{"{}unexpected\ recognized\_t\ status"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02690}02690\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02691}02691\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_bad\_block\_exception,\ \textcolor{stringliteral}{"{}unexpected\ recognized\_t\ status"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02692}02692\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02693}02693\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02694}02694\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02695}02695\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02696}02696\ \ \ \ \textcolor{comment}{//\ The\ above\ failures\ depend\ on\ subjective\ information.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02697}02697\ \ \ \ \textcolor{comment}{//\ Because\ of\ deferred\ transactions,\ this\ complicates\ things\ considerably.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02698}02698\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02699}02699\ \ \ \ \textcolor{comment}{//\ If\ producing\ a\ block,\ we\ throw\ a\ subjective\ failure\ if\ the\ feature\ is\ not\ properly\ recognized\ in\ order}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02700}02700\ \ \ \ \textcolor{comment}{//\ to\ try\ to\ avoid\ retiring\ into\ a\ block\ a\ deferred\ transacton\ driven\ by\ subjective\ information.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02701}02701\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02702}02702\ \ \ \ \textcolor{comment}{//\ But\ it\ is\ still\ possible\ for\ a\ producer\ to\ retire\ a\ deferred\ transaction\ that\ deals\ with\ this\ subjective}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02703}02703\ \ \ \ \textcolor{comment}{//\ information.\ If\ they\ recognized\ the\ feature,\ they\ would\ retire\ it\ successfully,\ but\ a\ validator\ that}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02704}02704\ \ \ \ \textcolor{comment}{//\ does\ not\ recognize\ the\ feature\ should\ reject\ the\ entire\ block\ (not\ just\ fail\ the\ deferred\ transaction).}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02705}02705\ \ \ \ \textcolor{comment}{//\ Even\ if\ they\ don't\ recognize\ the\ feature,\ the\ producer\ could\ change\ their\ nodeop\ code\ to\ treat\ it\ like\ an}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02706}02706\ \ \ \ \textcolor{comment}{//\ objective\ failure\ thus\ leading\ the\ deferred\ transaction\ to\ retire\ with\ soft\_fail\ or\ hard\_fail.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02707}02707\ \ \ \ \textcolor{comment}{//\ In\ this\ case,\ validators\ that\ don't\ recognize\ the\ feature\ would\ reject\ the\ whole\ block\ immediately,\ and}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02708}02708\ \ \ \ \textcolor{comment}{//\ validators\ that\ do\ recognize\ the\ feature\ would\ likely\ lead\ to\ a\ different\ retire\ status\ which\ would}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02709}02709\ \ \ \ \textcolor{comment}{//\ ultimately\ cause\ a\ validation\ failure\ and\ thus\ rejection\ of\ the\ block.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02710}02710\ \ \ \ \textcolor{comment}{//\ In\ either\ case,\ it\ results\ in\ rejection\ of\ the\ block\ which\ is\ the\ desired\ behavior\ in\ this\ scenario.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02711}02711\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02712}02712\ \ \ \ \textcolor{comment}{//\ If\ the\ feature\ is\ properly\ recognized\ by\ producer\ and\ validator,\ we\ have\ dealt\ with\ the\ subjectivity\ and}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02713}02713\ \ \ \ \textcolor{comment}{//\ now\ only\ consider\ the\ remaining\ failure\ modes\ which\ are\ deterministic\ and\ objective.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02714}02714\ \ \ \ \textcolor{comment}{//\ Thus\ the\ exceptions\ that\ can\ be\ thrown\ below\ can\ be\ regular\ objective\ exceptions}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02715}02715\ \ \ \ \textcolor{comment}{//\ that\ do\ not\ cause\ immediate\ rejection\ of\ the\ block.}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02716}02716\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02717}02717\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0ab467ff13b82630da7533410a8131c3}{is\_protocol\_feature\_activated}}(\ feature\_digest\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02718}02718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02719}02719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ already\ activated"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02720}02720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02721}02721\ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02722}02722\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02723}02723\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pso\ =\ my-\/>db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02724}02724\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02725}02725\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ std::find(\ pso.preactivated\_protocol\_features.begin(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02726}02726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pso.preactivated\_protocol\_features.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02727}02727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ feature\_digest}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02728}02728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )\ ==\ pso.preactivated\_protocol\_features.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02729}02729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02730}02730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ already\ pre-\/activated"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02731}02731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02732}02732\ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02733}02733\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02734}02734\ \ \ \ \textcolor{keyword}{auto}\ dependency\_checker\ =\ [\&](\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{digest\_type}}\&\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}\ )\ -\/>\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02735}02735\ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02736}02736\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0ab467ff13b82630da7533410a8131c3}{is\_protocol\_feature\_activated}}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}\ )\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02737}02737\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02738}02738\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\ std::find(\ pso.preactivated\_protocol\_features.begin(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02739}02739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pso.preactivated\_protocol\_features.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02740}02740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a107648633008a7f2d872b4b3d98c2f96}{d}}\ )\ !=\ pso.preactivated\_protocol\_features.end()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02741}02741\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02742}02742\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02743}02743\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ pfs.validate\_dependencies(\ feature\_digest,\ dependency\_checker\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02744}02744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ protocol\_feature\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02745}02745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}not\ all\ dependencies\ of\ protocol\ feature\ with\ digest\ '\$\{digest\}'\ have\ been\ activated\ or\ pre-\/activated"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02746}02746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02747}02747\ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02748}02748\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02749}02749\ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4f6404b355a3a4bf7fb60c92e85443d1}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02750}02750\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ feature\ =\ pfs.get\_protocol\_feature(feature\_digest);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02751}02751\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02752}02752\ \ \ \ \ \ \ dm\_logger-\/>on\_preactivate\_feature(feature);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02753}02753\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02754}02754\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02755}02755\ \ \ \ my-\/>db.modify(\ pso,\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02756}02756\ \ \ \ \ \ \ ps.preactivated\_protocol\_features.push\_back(\ feature\_digest\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02757}02757\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02758}02758\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02759}02759\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02760}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac81c5e33faa52c5a78a67fc2032ce1aa}{02760}}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac81c5e33faa52c5a78a67fc2032ce1aa}{controller::get\_preactivated\_protocol\_features}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02761}02761\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pso\ =\ my-\/>db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02762}02762\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02763}02763\ \ \ \ \textcolor{keywordflow}{if}(\ pso.preactivated\_protocol\_features.size()\ ==\ 0\ )\ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02764}02764\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02765}02765\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\ preactivated\_protocol\_features;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02766}02766\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02767}02767\ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ :\ pso.preactivated\_protocol\_features\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02768}02768\ \ \ \ \ \ \ preactivated\_protocol\_features.emplace\_back(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02769}02769\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02770}02770\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02771}02771\ \ \ \ \textcolor{keywordflow}{return}\ preactivated\_protocol\_features;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02772}02772\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02773}02773\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02774}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abf042d0e964b46d1a401119d3575ff82}{02774}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_abf042d0e964b46d1a401119d3575ff82}{controller::validate\_protocol\_features}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ features\_to\_activate\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02775}02775\ \ \ \ my-\/>check\_protocol\_features(\ my-\/>head-\/>header.timestamp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02776}02776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ my-\/>head-\/>activated\_protocol\_features-\/>protocol\_features,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02777}02777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ features\_to\_activate\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02778}02778\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02779}02779\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02780}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_afe40d1beedb5ec60de7e8d6575ba68ee}{02780}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afe40d1beedb5ec60de7e8d6575ba68ee}{controller::start\_block}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ when,\ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ confirm\_block\_count\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02781}02781\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02782}02782\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02783}02783\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02784}02784\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}pending\ block\ already\ exists"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02785}02785\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02786}02786\ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\ new\_protocol\_feature\_activations;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02787}02787\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02788}02788\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pso\ =\ my-\/>db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02789}02789\ \ \ \ \textcolor{keywordflow}{if}(\ pso.preactivated\_protocol\_features.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02790}02790\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ :\ pso.preactivated\_protocol\_features\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02791}02791\ \ \ \ \ \ \ \ \ \ new\_protocol\_feature\_activations.emplace\_back(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02792}02792\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02793}02793\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02794}02794\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02795}02795\ \ \ \ \textcolor{keywordflow}{if}(\ new\_protocol\_feature\_activations.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02796}02796\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_abf042d0e964b46d1a401119d3575ff82}{validate\_protocol\_features}}(\ new\_protocol\_feature\_activations\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02797}02797\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02798}02798\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02799}02799\ \ \ \ my-\/>start\_block(\ when,\ confirm\_block\_count,\ new\_protocol\_feature\_activations,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02800}02800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{block\_status::incomplete}},\ std::optional<block\_id\_type>(),\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}()\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02801}02801\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02802}02802\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02803}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad1d4d35a6c82209259dd126a886477e4}{02803}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afe40d1beedb5ec60de7e8d6575ba68ee}{controller::start\_block}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ when,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02804}02804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ confirm\_block\_count,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02805}02805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_protocol\_feature\_activations,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02806}02806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\&\ deadline\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02807}02807\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02808}02808\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02809}02809\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02810}02810\ \ \ \ \textcolor{keywordflow}{if}(\ new\_protocol\_feature\_activations.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02811}02811\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_abf042d0e964b46d1a401119d3575ff82}{validate\_protocol\_features}}(\ new\_protocol\_feature\_activations\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02812}02812\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02813}02813\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02814}02814\ \ \ \ my-\/>start\_block(\ when,\ confirm\_block\_count,\ new\_protocol\_feature\_activations,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02815}02815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{block\_status::incomplete}},\ std::optional<block\_id\_type>(),\ deadline\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02816}02816\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02817}02817\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02818}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a90ac1d5081d727041b7bef384771fda9}{02818}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a90ac1d5081d727041b7bef384771fda9}{controller::finalize\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a2cfc12be90aaa9b98843b120fecc71b0}{signer\_callback\_type}}\&\ signer\_callback\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02819}02819\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02820}02820\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02821}02821\ \ \ \ my-\/>finalize\_block();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02822}02822\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02823}02823\ \ \ \ \textcolor{keyword}{auto}\&\ ab\ =\ std::get<assembled\_block>(my-\/>pending-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02824}02824\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02825}02825\ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ std::make\_shared<block\_state>(}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02826}02826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ ab.\_pending\_block\_header\_state\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02827}02827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ ab.\_unsigned\_block\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02828}02828\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ ab.\_trx\_metas\ ),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02829}02829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ my-\/>protocol\_features.get\_protocol\_feature\_set(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02830}02830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02831}02831\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02832}02832\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_features\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02833}02833\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02834}02834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ signer\_callback}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02835}02835\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02836}02836\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02837}02837\ \ \ \ my-\/>pending-\/>\_block\_stage\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1completed__block}{completed\_block}}\{\ bsp\ \};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02838}02838\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02839}02839\ \ \ \ \textcolor{keywordflow}{return}\ bsp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02840}02840\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02841}02841\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02842}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a16975bb6b23c3e9ffaf7590006e81439}{02842}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a16975bb6b23c3e9ffaf7590006e81439}{controller::commit\_block}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02843}02843\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02844}02844\ \ \ \ my-\/>commit\_block(\textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02845}02845\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02846}02846\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02847}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3079bf203cd6e26ed902a84ff3ec7856}{02847}}\ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_metadata\_ptr>}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3079bf203cd6e26ed902a84ff3ec7856}{controller::abort\_block}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02848}02848\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>abort\_block();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02849}02849\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02850}02850\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02851}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a64826ea9f453742f28801991e2ceba02}{02851}}\ boost::asio::io\_context\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a64826ea9f453742f28801991e2ceba02}{controller::get\_thread\_pool}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02852}02852\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>thread\_pool.get\_executor();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02853}02853\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02854}02854\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02855}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad6f2e99d29c27a09b7f52101dde030db}{02855}}\ std::future<block\_state\_ptr>\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad6f2e99d29c27a09b7f52101dde030db}{controller::create\_block\_state\_future}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \textcolor{keywordtype}{id},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02856}02856\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>create\_block\_state\_future(\ \textcolor{keywordtype}{id},\ b\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02857}02857\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02858}02858\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02859}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a31dc2787a93d98c0c591d7432aea569a}{02859}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a31dc2787a93d98c0c591d7432aea569a}{controller::create\_block\_state}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \textcolor{keywordtype}{id},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02860}02860\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>create\_block\_state(\ \textcolor{keywordtype}{id},\ b\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02861}02861\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02862}02862\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02863}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a35b9a3485ef36e6456483f4307e9ad53}{02863}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a35b9a3485ef36e6456483f4307e9ad53}{controller::push\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ bsp,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02864}02864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\_branch\_callback}}\&\ forked\_branch\_cb,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02865}02865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\&\ trx\_lookup\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02866}02866\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02867}02867\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02868}02868\ \ \ \ my-\/>push\_block(\ bsp,\ forked\_branch\_cb,\ trx\_lookup\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02869}02869\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02870}02870\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02871}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a31c23187243554bdb6b54bb31bdb4bcd}{02871}}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a31c23187243554bdb6b54bb31bdb4bcd}{controller::push\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\&\ trx,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02872}02872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ block\_deadline,\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ max\_transaction\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02873}02873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ billed\_cpu\_time\_us,\ \textcolor{keywordtype}{bool}\ explicit\_billed\_cpu\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02874}02874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ subjective\_cpu\_bill\_us\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02875}02875\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02876}02876\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a28d33629f3badcb8155c08be3e05b99e}{get\_read\_mode}}()\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}},\ transaction\_type\_exception,\ \textcolor{stringliteral}{"{}push\ transaction\ not\ allowed\ in\ irreversible\ mode"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02877}02877\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ trx\ \&\&\ !trx-\/>implicit\ \&\&\ !trx-\/>scheduled,\ transaction\_type\_exception,\ \textcolor{stringliteral}{"{}Implicit/Scheduled\ transaction\ not\ allowed"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02878}02878\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>push\_transaction(trx,\ block\_deadline,\ max\_transaction\_time,\ billed\_cpu\_time\_us,\ explicit\_billed\_cpu\_time,\ subjective\_cpu\_bill\_us\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02879}02879\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02880}02880\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02881}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aade04f20db1bea1fbc9aa22a90cf87c0}{02881}}\ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aade04f20db1bea1fbc9aa22a90cf87c0}{controller::push\_scheduled\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{transaction\_id\_type}}\&\ trxid,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02882}02882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}\ block\_deadline,\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ max\_transaction\_time,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02883}02883\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ billed\_cpu\_time\_us,\ \textcolor{keywordtype}{bool}\ explicit\_billed\_cpu\_time\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02884}02884\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02885}02885\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a28d33629f3badcb8155c08be3e05b99e}{get\_read\_mode}}()\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}},\ transaction\_type\_exception,\ \textcolor{stringliteral}{"{}push\ scheduled\ transaction\ not\ allowed\ in\ irreversible\ mode"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02886}02886\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02887}02887\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>push\_scheduled\_transaction(\ trxid,\ block\_deadline,\ max\_transaction\_time,\ billed\_cpu\_time\_us,\ explicit\_billed\_cpu\_time\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02888}02888\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02889}02889\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02890}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae2572c1888aa71c5386d8d3fc7df75c5}{02890}}\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae2572c1888aa71c5386d8d3fc7df75c5}{controller::get\_actor\_whitelist}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02891}02891\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.actor\_whitelist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02892}02892\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02893}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a087c940aa88be2ccc1fbb7dd1bc28da6}{02893}}\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a087c940aa88be2ccc1fbb7dd1bc28da6}{controller::get\_actor\_blacklist}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02894}02894\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.actor\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02895}02895\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02896}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7408289ee5f740f797b9b9d9b192704a}{02896}}\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7408289ee5f740f797b9b9d9b192704a}{controller::get\_contract\_whitelist}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02897}02897\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.contract\_whitelist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02898}02898\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02899}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a99c90ed934995116348fe891223e1037}{02899}}\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a99c90ed934995116348fe891223e1037}{controller::get\_contract\_blacklist}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02900}02900\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.contract\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02901}02901\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02902}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8a195d27a416c714bdc058b7f1919267}{02902}}\ \textcolor{keyword}{const}\ flat\_set<\ pair<account\_name,\ action\_name>\ >\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8a195d27a416c714bdc058b7f1919267}{controller::get\_action\_blacklist}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02903}02903\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.action\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02904}02904\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02905}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aabfe5c42521aa0550a5f5e60ec89fd19}{02905}}\ \textcolor{keyword}{const}\ flat\_set<public\_key\_type>\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aabfe5c42521aa0550a5f5e60ec89fd19}{controller::get\_key\_blacklist}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02906}02906\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.key\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02907}02907\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02908}02908\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02909}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a06ea0e9e805452cdd189f13df09916e8}{02909}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a06ea0e9e805452cdd189f13df09916e8}{controller::set\_actor\_whitelist}}(\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ new\_actor\_whitelist\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02910}02910\ \ \ \ my-\/>conf.actor\_whitelist\ =\ new\_actor\_whitelist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02911}02911\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02912}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1a695a1daba0cf887e71851a61911a37}{02912}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1a695a1daba0cf887e71851a61911a37}{controller::set\_actor\_blacklist}}(\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ new\_actor\_blacklist\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02913}02913\ \ \ \ my-\/>conf.actor\_blacklist\ =\ new\_actor\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02914}02914\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02915}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ab156fd6d4e3f28e14373c8dbbeb5a0ed}{02915}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ab156fd6d4e3f28e14373c8dbbeb5a0ed}{controller::set\_contract\_whitelist}}(\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ new\_contract\_whitelist\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02916}02916\ \ \ \ my-\/>conf.contract\_whitelist\ =\ new\_contract\_whitelist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02917}02917\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02918}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a904bf66cadfa73c918e9d835c819a524}{02918}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a904bf66cadfa73c918e9d835c819a524}{controller::set\_contract\_blacklist}}(\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ new\_contract\_blacklist\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02919}02919\ \ \ \ my-\/>conf.contract\_blacklist\ =\ new\_contract\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02920}02920\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02921}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_af1e44676760107bf3ed8979feb1d4f00}{02921}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_af1e44676760107bf3ed8979feb1d4f00}{controller::set\_action\_blacklist}}(\ \textcolor{keyword}{const}\ flat\_set<\ pair<account\_name,\ action\_name>\ >\&\ new\_action\_blacklist\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02922}02922\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ act:\ new\_action\_blacklist)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02923}02923\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(act.first\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}(),\ name\_type\_exception,\ \textcolor{stringliteral}{"{}Action\ blacklist\ -\/\ contract\ name\ should\ not\ be\ empty"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02924}02924\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(act.second\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}(),\ action\_type\_exception,\ \textcolor{stringliteral}{"{}Action\ blacklist\ -\/\ action\ name\ should\ not\ be\ empty"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02925}02925\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02926}02926\ \ \ \ my-\/>conf.action\_blacklist\ =\ new\_action\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02927}02927\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02928}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a5711e4cc0cff77f67d04b64373252412}{02928}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a5711e4cc0cff77f67d04b64373252412}{controller::set\_key\_blacklist}}(\ \textcolor{keyword}{const}\ flat\_set<public\_key\_type>\&\ new\_key\_blacklist\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02929}02929\ \ \ \ my-\/>conf.key\_blacklist\ =\ new\_key\_blacklist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02930}02930\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02931}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a59e341a41ba27734555c54c37bacf358}{02931}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a59e341a41ba27734555c54c37bacf358}{controller::set\_s\_header}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1s__header}{s\_header}}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1s__header}{s\_header}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02932}02932\ \ \ \ \textcolor{comment}{//\ \ ilog("{}CONTROLLER\ -\/\ setting\ s\ header:\ \$\{s\}"{},\ ("{}s"{},\ s\_header.to\_string()));}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02933}02933\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}it\ is\ not\ valid\ to\ set\_s\_header\ when\ there\ is\ no\ pending\ block"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02934}02934\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ std::holds\_alternative<building\_block>(my-\/>pending-\/>\_block\_stage),\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}already\ called\ finalize\_block"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02935}02935\ \ \ \ \textcolor{comment}{//\ SYS\_ASSERT(\ std::get<assembled\_block>(pending-\/>\_block\_stage).\_id\ ==\ id,\ block\_validate\_exception,\ "{}mismatching\ block\ id"{}\ );}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02936}02936\ \ \ \ \textcolor{comment}{//\ Try\ to\ set\ it\ first\ in\ the\ pending\ block}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02937}02937\ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(my-\/>pending-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02938}02938\ \ \ \ bb.\_s\_header\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1s__header}{s\_header}};\ \textcolor{comment}{//\ Attempt\ to\ set\ s-\/header}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02939}02939\ \ \ \ \textcolor{keyword}{auto}\&\ check\_s\_header\ =\ std::get<building\_block>(my-\/>pending-\/>\_block\_stage).\_s\_header;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02940}02940\ \ \ \ \textcolor{keywordflow}{if}\ (check\_s\_header)\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02941}02941\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Pending\ building\ block\ s\_header\ set:\ \$\{s\_header\}\(\backslash\)n\(\backslash\)t\(\backslash\)tand\ matches\ what\ was\ passed:\ \$\{match\}"{}},\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02942}02942\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}s\_header"{}},\ check\_s\_header-\/>to\_string())(\textcolor{stringliteral}{"{}match"{}},\ check\_s\_header\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1s__header}{s\_header}}));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02943}02943\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02944}02944\ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02945}02945\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Pending\ building\ block\ s\_header\ NOT\ SET"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02946}02946\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02947}02947\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02948}02948\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02949}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{02949}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{controller::head\_block\_num}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02950}02950\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>head-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02951}02951\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02952}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aea3612e7cb52dfcaa2e6afdc1b3e2f51}{02952}}\ \mbox{\hyperlink{classfc_1_1time__point}{time\_point}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aea3612e7cb52dfcaa2e6afdc1b3e2f51}{controller::head\_block\_time}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02953}02953\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>head-\/>header.timestamp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02954}02954\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02955}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{02955}}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{controller::head\_block\_id}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02956}02956\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>head-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02957}02957\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02958}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a307c14eafe6dd6c43f6de377bbc2d10d}{02958}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a307c14eafe6dd6c43f6de377bbc2d10d}{controller::head\_block\_producer}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02959}02959\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>head-\/>header.producer;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02960}02960\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02961}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad39b3fade2e84d4a743230a27c650f1f}{02961}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\_header}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad39b3fade2e84d4a743230a27c650f1f}{controller::head\_block\_header}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02962}02962\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>head-\/>header;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02963}02963\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02964}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3e445e8e2da032a322a1348091a1a702}{02964}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3e445e8e2da032a322a1348091a1a702}{controller::head\_block\_state}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02965}02965\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>head;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02966}02966\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02967}02967\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02968}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae1ab54d0324632cd8826d35feb328204}{02968}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae1ab54d0324632cd8826d35feb328204}{controller::fork\_db\_head\_block\_num}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02969}02969\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.head()-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02970}02970\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02971}02971\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02972}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a6592e04d224ee0bddaab2ad94428b1fc}{02972}}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a6592e04d224ee0bddaab2ad94428b1fc}{controller::fork\_db\_head\_block\_id}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02973}02973\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.head()-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02974}02974\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02975}02975\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02976}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8160acef1ebb811902e1ad51f1161650}{02976}}\ \mbox{\hyperlink{classfc_1_1time__point}{time\_point}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8160acef1ebb811902e1ad51f1161650}{controller::fork\_db\_head\_block\_time}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02977}02977\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.head()-\/>header.timestamp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02978}02978\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02979}02979\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02980}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a738dfae20ac656096578c8959746e126}{02980}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a738dfae20ac656096578c8959746e126}{controller::fork\_db\_head\_block\_producer}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02981}02981\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.head()-\/>header.producer;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02982}02982\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02983}02983\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02984}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a5d51f89938499d2cf479a6f16d42848d}{02984}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a5d51f89938499d2cf479a6f16d42848d}{controller::fork\_db\_pending\_head\_block\_num}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02985}02985\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.pending\_head()-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02986}02986\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02987}02987\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02988}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a19f994be76ccda4705a54ac7af6bfe29}{02988}}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a19f994be76ccda4705a54ac7af6bfe29}{controller::fork\_db\_pending\_head\_block\_id}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02989}02989\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.pending\_head()-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02990}02990\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02991}02991\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02992}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aba5b781dfa681fa948e32470a76d0419}{02992}}\ \mbox{\hyperlink{classfc_1_1time__point}{time\_point}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aba5b781dfa681fa948e32470a76d0419}{controller::fork\_db\_pending\_head\_block\_time}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02993}02993\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.pending\_head()-\/>header.timestamp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02994}02994\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02995}02995\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02996}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a182f205721eaef19d84a5a6aef37be21}{02996}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a182f205721eaef19d84a5a6aef37be21}{controller::fork\_db\_pending\_head\_block\_producer}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02997}02997\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.pending\_head()-\/>header.producer;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02998}02998\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l02999}02999\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03000}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{03000}}\ \mbox{\hyperlink{classfc_1_1time__point}{time\_point}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{controller::pending\_block\_time}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03001}03001\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}no\ pending\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03002}03002\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03003}03003\ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<completed\_block>(my-\/>pending-\/>\_block\_stage)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03004}03004\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(my-\/>pending-\/>\_block\_stage).\_block\_state-\/>header.timestamp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03005}03005\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03006}03006\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>get\_pending\_block\_header\_state().timestamp;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03007}03007\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03008}03008\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03009}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a47ba4879ad3153282cba14e185f98d71}{03009}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a47ba4879ad3153282cba14e185f98d71}{controller::pending\_block\_num}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03010}03010\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}no\ pending\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03011}03011\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03012}03012\ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<completed\_block>(my-\/>pending-\/>\_block\_stage)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03013}03013\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(my-\/>pending-\/>\_block\_stage).\_block\_state-\/>header.block\_num();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03014}03014\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03015}03015\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>get\_pending\_block\_header\_state().block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03016}03016\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03017}03017\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03018}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7a7a09290738585cd0e05580eeba0a95}{03018}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7a7a09290738585cd0e05580eeba0a95}{controller::pending\_block\_producer}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03019}03019\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}no\ pending\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03020}03020\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03021}03021\ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<completed\_block>(my-\/>pending-\/>\_block\_stage)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03022}03022\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(my-\/>pending-\/>\_block\_stage).\_block\_state-\/>header.producer;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03023}03023\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03024}03024\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>get\_pending\_block\_header\_state().producer;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03025}03025\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03026}03026\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03027}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7ac238f10e3a4ccf5c746a4e6a43b184}{03027}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a5d68aec4c925d17b62f0a9b543fabfc5}{block\_signing\_authority}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7ac238f10e3a4ccf5c746a4e6a43b184}{controller::pending\_block\_signing\_authority}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03028}03028\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}no\ pending\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03029}03029\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03030}03030\ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<completed\_block>(my-\/>pending-\/>\_block\_stage)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03031}03031\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(my-\/>pending-\/>\_block\_stage).\_block\_state-\/>valid\_block\_signing\_authority;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03032}03032\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03033}03033\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>get\_pending\_block\_header\_state().valid\_block\_signing\_authority;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03034}03034\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03035}03035\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03036}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8ad92bdf81057887fdc4b732cb864bc4}{03036}}\ std::optional<block\_id\_type>\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8ad92bdf81057887fdc4b732cb864bc4}{controller::pending\_producer\_block\_id}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03037}03037\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}no\ pending\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03038}03038\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>\_producer\_block\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03039}03039\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03040}03040\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03041}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad6f4e938fb4b051c1d6b6c5cede09c76}{03041}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<transaction\_receipt>}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad6f4e938fb4b051c1d6b6c5cede09c76}{controller::get\_pending\_trx\_receipts}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03042}03042\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}no\ pending\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03043}03043\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>get\_trx\_receipts();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03044}03044\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03045}03045\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03046}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a53495de416021a4e56e889e771b25a52}{03046}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a53495de416021a4e56e889e771b25a52}{controller::last\_irreversible\_block\_num}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03047}03047\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.root()-\/>block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03048}03048\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03049}03049\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03050}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a992401ccd9d3ecf5484c7d97bea18f51}{03050}}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a992401ccd9d3ecf5484c7d97bea18f51}{controller::last\_irreversible\_block\_id}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03051}03051\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.root()-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03052}03052\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03053}03053\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03054}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a878ff6368c473051417382a9d485030d}{03054}}\ \mbox{\hyperlink{classfc_1_1time__point}{time\_point}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a878ff6368c473051417382a9d485030d}{controller::last\_irreversible\_block\_time}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03055}03055\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.root()-\/>header.timestamp.to\_time\_point();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03056}03056\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03057}03057\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03058}03058\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03059}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a148eb08aa44ff6a177015a66004d0e49}{03059}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1dynamic__global__property__object}{dynamic\_global\_property\_object}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a148eb08aa44ff6a177015a66004d0e49}{controller::get\_dynamic\_global\_properties}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03060}03060\ \ \ \textcolor{keywordflow}{return}\ my-\/>db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1dynamic__global__property__object}{dynamic\_global\_property\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03061}03061\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03062}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{03062}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{controller::get\_global\_properties}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03063}03063\ \ \ \textcolor{keywordflow}{return}\ my-\/>db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03064}03064\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03065}03065\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03066}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7d6e058e892e067510650db853794338}{03066}}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7d6e058e892e067510650db853794338}{controller::fetch\_block\_by\_id}}(\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \textcolor{keywordtype}{id}\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03067}03067\ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structstate}{state}}\ =\ my-\/>fork\_db.get\_block(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03068}03068\ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structstate}{state}}\ \&\&\ \mbox{\hyperlink{structstate}{state}}-\/>block\ )\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structstate}{state}}-\/>block;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03069}03069\ \ \ \ \textcolor{keyword}{auto}\ bptr\ =\ my-\/>blog.read\_block\_by\_num(\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{block\_header::num\_from\_id}}(\textcolor{keywordtype}{id})\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03070}03070\ \ \ \ \textcolor{keywordflow}{if}(\ bptr\ \&\&\ bptr-\/>calculate\_id()\ ==\ \textcolor{keywordtype}{id}\ )\ \textcolor{keywordflow}{return}\ bptr;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03071}03071\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03072}03072\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03073}03073\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03074}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1379e43325b7e517a058bddce15571eb}{03074}}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1379e43325b7e517a058bddce15571eb}{controller::fetch\_block\_by\_number}}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num\ )\textcolor{keyword}{const\ \ }\{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03075}03075\ \ \ \ \textcolor{keyword}{auto}\ blk\_state\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a04f3c55da09b359224510af99502490f}{fetch\_block\_state\_by\_number}}(\ block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03076}03076\ \ \ \ \textcolor{keywordflow}{if}(\ blk\_state\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03077}03077\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ blk\_state-\/>block;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03078}03078\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03079}03079\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03080}03080\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>blog.read\_block\_by\_num(block\_num);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03081}03081\ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}(\ (block\_num)\ )\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03082}03082\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03083}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_acd214861da435dc956d30c81de7c50ff}{03083}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_acd214861da435dc956d30c81de7c50ff}{controller::fetch\_block\_state\_by\_id}}(\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \textcolor{keywordtype}{id}\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03084}03084\ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structstate}{state}}\ =\ my-\/>fork\_db.get\_block(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03085}03085\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structstate}{state}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03086}03086\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03087}03087\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03088}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a04f3c55da09b359224510af99502490f}{03088}}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a04f3c55da09b359224510af99502490f}{controller::fetch\_block\_state\_by\_number}}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num\ )\textcolor{keyword}{const\ \ }\{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03089}03089\ \ \ \ \textcolor{keywordflow}{if}(\ my-\/>read\_mode\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03090}03090\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.search\_on\_branch(\ my-\/>fork\_db.pending\_head()-\/>id,\ block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03091}03091\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03092}03092\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ my-\/>fork\_db.search\_on\_branch(\ my-\/>fork\_db.head()-\/>id,\ block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03093}03093\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03094}03094\ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}(\ (block\_num)\ )\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03095}03095\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03096}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a9a55edb4766f1f3302ede12e329b1ea6}{03096}}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a9a55edb4766f1f3302ede12e329b1ea6}{controller::get\_block\_id\_for\_num}}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num\ )\textcolor{keyword}{const\ }\{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03097}03097\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ tapos\_block\_summary\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1block__summary__object}{block\_summary\_object}}>((\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}})block\_num);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03098}03098\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03099}03099\ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{block\_header::num\_from\_id}}(tapos\_block\_summary.block\_id)\ ==\ block\_num\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03100}03100\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tapos\_block\_summary.block\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03101}03101\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03102}03102\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ blog\_head\ =\ my-\/>blog.head();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03103}03103\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03104}03104\ \ \ \ \textcolor{keywordtype}{bool}\ find\_in\_blog\ =\ (blog\_head\ \&\&\ block\_num\ <=\ blog\_head-\/>block\_num());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03105}03105\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03106}03106\ \ \ \ \textcolor{keywordflow}{if}(\ !find\_in\_blog\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03107}03107\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a04f3c55da09b359224510af99502490f}{fetch\_block\_state\_by\_number}}(\ block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03108}03108\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ bsp\ )\ \textcolor{keywordflow}{return}\ bsp-\/>id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03109}03109\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03110}03110\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03111}03111\ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keywordtype}{id}\ =\ my-\/>blog.read\_block\_id\_by\_num(block\_num);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03112}03112\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03113}03113\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ BOOST\_LIKELY(\ \textcolor{keywordtype}{id}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\_id\_type}}()\ ),\ unknown\_block\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03114}03114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Could\ not\ find\ block:\ \$\{block\}"{}},\ (\textcolor{stringliteral}{"{}block"{}},\ block\_num)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03115}03115\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03116}03116\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03117}03117\ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}(\ (block\_num)\ )\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03118}03118\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03119}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae0a4a81d5d603085be18b54fb5a709b9}{03119}}\ \mbox{\hyperlink{classfc_1_1sha256}{sha256}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae0a4a81d5d603085be18b54fb5a709b9}{controller::calculate\_integrity\_hash}}()\ \{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03120}03120\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>calculate\_integrity\_hash();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03121}03121\ \}\ \mbox{\hyperlink{exception_8hpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}()\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03122}03122\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03123}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a407d1c6dfd6e7b3e1d4e1567d15e344c}{03123}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a407d1c6dfd6e7b3e1d4e1567d15e344c}{controller::write\_snapshot}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a80afaa06d96e661a0f93e0ba4b09c8dc}{snapshot\_writer\_ptr}}\&\ snapshot\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03124}03124\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !my-\/>pending,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}cannot\ take\ a\ consistent\ snapshot\ with\ a\ pending\ block"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03125}03125\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>add\_to\_snapshot(snapshot);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03126}03126\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03127}03127\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03128}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ab4cab73bf67a1686c6c595e08a63b632}{03128}}\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ab4cab73bf67a1686c6c595e08a63b632}{controller::set\_proposed\_producers}}(\ \mbox{\hyperlink{classfc_1_1vector}{vector<producer\_authority>}}\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03129}03129\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{get\_global\_properties}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03130}03130\ \ \ \ \textcolor{keyword}{auto}\ cur\_block\_num\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}()\ +\ 1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03131}03131\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03132}03132\ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.size()\ ==\ 0\ \&\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa808acf858e93c567ff983ccbf8fb6d3}{is\_builtin\_activated}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cfa65ea05874d490a8ea760dd8b76c2c504}{builtin\_protocol\_feature\_t::disallow\_empty\_producer\_schedule}}\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03133}03133\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03134}03134\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03135}03135\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03136}03136\ \ \ \ \textcolor{keywordflow}{if}(\ gpo.proposed\_schedule\_block\_num\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03137}03137\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ *gpo.proposed\_schedule\_block\_num\ !=\ cur\_block\_num\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03138}03138\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;\ \textcolor{comment}{//\ there\ is\ already\ a\ proposed\ schedule\ set\ in\ a\ previous\ block,\ wait\ for\ it\ to\ become\ pending}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03139}03139\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03140}03140\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::equal(\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.begin(),\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.end(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03141}03141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gpo.proposed\_schedule.producers.begin(),\ gpo.proposed\_schedule.producers.end()\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03142}03142\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;\ \textcolor{comment}{//\ the\ proposed\ producer\ schedule\ does\ not\ change}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03143}03143\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03144}03144\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03145}03145\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule}{producer\_authority\_schedule}}\ sch;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03146}03146\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03147}03147\ \ \ \ \textcolor{keyword}{decltype}(sch.\mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_afb0f1bdb282b3d8e1a60ee37c70657d4}{producers}}.cend())\ end;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03148}03148\ \ \ \ \textcolor{keyword}{decltype}(end)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ begin;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03149}03149\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03150}03150\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pending\_sch\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a54645293859c265a7492eb002719c3dc}{pending\_producers}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03151}03151\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03152}03152\ \ \ \ \textcolor{keywordflow}{if}(\ pending\_sch.producers.size()\ ==\ 0\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03153}03153\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ active\_sch\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae0a1946cc6f7b87bd0cfa94bc9aa20b7}{active\_producers}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03154}03154\ \ \ \ \ \ \ begin\ =\ active\_sch.producers.begin();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03155}03155\ \ \ \ \ \ \ end\ \ \ =\ active\_sch.producers.end();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03156}03156\ \ \ \ \ \ \ sch.\mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a477f957323b97c0af6700ef384326b83}{version}}\ =\ active\_sch.version\ +\ 1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03157}03157\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03158}03158\ \ \ \ \ \ \ begin\ =\ pending\_sch.producers.begin();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03159}03159\ \ \ \ \ \ \ end\ \ \ =\ pending\_sch.producers.end();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03160}03160\ \ \ \ \ \ \ sch.\mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a477f957323b97c0af6700ef384326b83}{version}}\ =\ pending\_sch.version\ +\ 1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03161}03161\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03162}03162\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03163}03163\ \ \ \ \textcolor{keywordflow}{if}(\ std::equal(\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.begin(),\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.end(),\ begin,\ end\ )\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03164}03164\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;\ \textcolor{comment}{//\ the\ producer\ schedule\ would\ not\ change}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03165}03165\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03166}03166\ \ \ \ sch.\mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_afb0f1bdb282b3d8e1a60ee37c70657d4}{producers}}\ =\ std::move(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03167}03167\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03168}03168\ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ version\ =\ sch.\mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a477f957323b97c0af6700ef384326b83}{version}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03169}03169\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03170}03170\ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}proposed\ producer\ schedule\ with\ version\ \$\{v\}"{}},\ (\textcolor{stringliteral}{"{}v"{}},\ version)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03171}03171\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03172}03172\ \ \ \ my-\/>db.modify(\ gpo,\ [\&](\ \textcolor{keyword}{auto}\&\ gp\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03173}03173\ \ \ \ \ \ \ gp.proposed\_schedule\_block\_num\ =\ cur\_block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03174}03174\ \ \ \ \ \ \ gp.proposed\_schedule\ =\ sch.\mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_aca17ff9b0f16d16b6f04d4e47bd0d522}{to\_shared}}(gp.proposed\_schedule.producers.get\_allocator());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03175}03175\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03176}03176\ \ \ \ \textcolor{keywordflow}{return}\ version;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03177}03177\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03178}03178\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03179}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae0a1946cc6f7b87bd0cfa94bc9aa20b7}{03179}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule}{producer\_authority\_schedule}}\&\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae0a1946cc6f7b87bd0cfa94bc9aa20b7}{controller::active\_producers}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03180}03180\ \ \ \ \textcolor{keywordflow}{if}(\ !(my-\/>pending)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03181}03181\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ my-\/>head-\/>active\_schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03182}03182\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03183}03183\ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<completed\_block>(my-\/>pending-\/>\_block\_stage)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03184}03184\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(my-\/>pending-\/>\_block\_stage).\_block\_state-\/>active\_schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03185}03185\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03186}03186\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>get\_pending\_block\_header\_state().active\_schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03187}03187\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03188}03188\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03189}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a54645293859c265a7492eb002719c3dc}{03189}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule}{producer\_authority\_schedule}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a54645293859c265a7492eb002719c3dc}{controller::pending\_producers}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03190}03190\ \ \ \ \textcolor{keywordflow}{if}(\ !(my-\/>pending)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03191}03191\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ my-\/>head-\/>pending\_schedule.schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03192}03192\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03193}03193\ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<completed\_block>(my-\/>pending-\/>\_block\_stage)\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03194}03194\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::get<completed\_block>(my-\/>pending-\/>\_block\_stage).\_block\_state-\/>pending\_schedule.schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03195}03195\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03196}03196\ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<assembled\_block>(my-\/>pending-\/>\_block\_stage)\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03197}03197\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ new\_prods\_cache\ =\ std::get<assembled\_block>(my-\/>pending-\/>\_block\_stage).\_new\_producer\_authority\_cache;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03198}03198\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ new\_prods\_cache\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03199}03199\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *new\_prods\_cache;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03200}03200\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03201}03201\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03202}03202\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03203}03203\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(my-\/>pending-\/>\_block\_stage);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03204}03204\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03205}03205\ \ \ \ \textcolor{keywordflow}{if}(\ bb.\_new\_pending\_producer\_schedule\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03206}03206\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *bb.\_new\_pending\_producer\_schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03207}03207\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03208}03208\ \ \ \ \textcolor{keywordflow}{return}\ bb.\_pending\_block\_header\_state.prev\_pending\_schedule.schedule;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03209}03209\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03210}03210\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03211}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3c16d661e137dbe654a1c40a972759d4}{03211}}\ std::optional<producer\_authority\_schedule>\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3c16d661e137dbe654a1c40a972759d4}{controller::proposed\_producers}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03212}03212\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{get\_global\_properties}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03213}03213\ \ \ \ \textcolor{keywordflow}{if}(\ !gpo.proposed\_schedule\_block\_num\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03214}03214\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::optional<producer\_authority\_schedule>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03215}03215\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03216}03216\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a4b0d95b22a8be15ac06dc3b105638c54}{producer\_authority\_schedule::from\_shared}}(gpo.proposed\_schedule);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03217}03217\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03218}03218\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03219}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7109e865e8dee8629db47f2503e351df}{03219}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7109e865e8dee8629db47f2503e351df}{controller::light\_validation\_allowed}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03220}03220\ \ \ \ \textcolor{keywordflow}{if}\ (!my-\/>pending\ ||\ my-\/>in\_trx\_requiring\_checks)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03221}03221\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03222}03222\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03223}03223\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03224}03224\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ pb\_status\ =\ my-\/>pending-\/>\_block\_status;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03225}03225\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03226}03226\ \ \ \ \textcolor{comment}{//\ in\ a\ pending\ irreversible\ or\ previously\ validated\ block\ and\ we\ have\ forcing\ all\ checks}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03227}03227\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ consider\_skipping\_on\_replay\ =}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03228}03228\ \ \ \ \ \ \ \ \ \ (pb\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{block\_status::irreversible}}\ ||\ pb\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{block\_status::validated}})\ \&\&\ !my-\/>conf.force\_all\_checks;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03229}03229\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03230}03230\ \ \ \ \textcolor{comment}{//\ OR\ in\ a\ signed\ block\ and\ in\ light\ validation\ mode}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03231}03231\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ consider\_skipping\_on\_validate\ =\ (pb\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{block\_status::complete}}\ \&\&}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03232}03232\ \ \ \ \ \ \ \ \ \ (my-\/>conf.block\_validation\_mode\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_a7d207c8c6bf978826102eca76da530e0af8589806bbf66241917092b2a6e18c6f}{validation\_mode::LIGHT}}\ ||\ my-\/>trusted\_producer\_light\_validation));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03233}03233\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03234}03234\ \ \ \ \textcolor{keywordflow}{return}\ consider\_skipping\_on\_replay\ ||\ consider\_skipping\_on\_validate;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03235}03235\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03236}03236\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03237}03237\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03238}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a42a29a059b847799ae3a75953b6bff1e}{03238}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a42a29a059b847799ae3a75953b6bff1e}{controller::skip\_auth\_check}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03239}03239\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7109e865e8dee8629db47f2503e351df}{light\_validation\_allowed}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03240}03240\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03241}03241\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03242}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_afc8b0aff5d6f215c336a682c83badf6e}{03242}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afc8b0aff5d6f215c336a682c83badf6e}{controller::skip\_trx\_checks}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03243}03243\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7109e865e8dee8629db47f2503e351df}{light\_validation\_allowed}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03244}03244\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03245}03245\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03246}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7cca9fe34a1d9811e0497c55596c16cb}{03246}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{controller::skip\_db\_sessions}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{block\_status}}\ bs\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03247}03247\ \ \ \ \textcolor{keywordtype}{bool}\ consider\_skipping\ =\ bs\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{block\_status::irreversible}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03248}03248\ \ \ \ \textcolor{keywordflow}{return}\ consider\_skipping}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03249}03249\ \ \ \ \ \ \ \&\&\ !my-\/>conf.disable\_replay\_opts}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03250}03250\ \ \ \ \ \ \ \&\&\ !my-\/>in\_trx\_requiring\_checks;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03251}03251\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03252}03252\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03253}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{03253}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{controller::skip\_db\_sessions}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03254}03254\ \ \ \ \textcolor{keywordflow}{if}\ (my-\/>pending)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03255}03255\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}(my-\/>pending-\/>\_block\_status);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03256}03256\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03257}03257\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03258}03258\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03259}03259\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03260}03260\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03261}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1196ffe0c4905238026e4923cf24cb3e}{03261}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1196ffe0c4905238026e4923cf24cb3e}{controller::is\_trusted\_producer}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\&\ producer)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03262}03262\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a125b3c8fdc58904ce8179b68d1ea4172}{get\_validation\_mode}}()\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_a7d207c8c6bf978826102eca76da530e0af8589806bbf66241917092b2a6e18c6f}{chain::validation\_mode::LIGHT}}\ ||\ my-\/>conf.trusted\_producers.count(producer);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03263}03263\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03264}03264\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03265}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_afb3840481287ef2685e61375a44b0305}{03265}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_afb3840481287ef2685e61375a44b0305}{controller::contracts\_console}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03266}03266\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.contracts\_console;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03267}03267\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03268}03268\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03269}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a449c46cd54dde8387e020cc86a2f1d41}{03269}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a449c46cd54dde8387e020cc86a2f1d41}{controller::is\_profiling}}(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ account)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03270}03270\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.profile\_accounts.find(account)\ !=\ my-\/>conf.profile\_accounts.end();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03271}03271\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03272}03272\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03273}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa62c0e462ac0a8c8b3345e59623ffad0}{03273}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa62c0e462ac0a8c8b3345e59623ffad0}{controller::get\_chain\_id}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03274}03274\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>chain\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03275}03275\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03276}03276\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03277}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a28d33629f3badcb8155c08be3e05b99e}{03277}}\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5e}{db\_read\_mode}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a28d33629f3badcb8155c08be3e05b99e}{controller::get\_read\_mode}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03278}03278\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>read\_mode;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03279}03279\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03280}03280\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03281}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a125b3c8fdc58904ce8179b68d1ea4172}{03281}}\ \mbox{\hyperlink{namespacesysio_1_1chain_a7d207c8c6bf978826102eca76da530e0}{validation\_mode}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a125b3c8fdc58904ce8179b68d1ea4172}{controller::get\_validation\_mode}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03282}03282\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.block\_validation\_mode;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03283}03283\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03284}03284\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03285}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b86f2ee0fa63f9d01ee437f83b0e1d1}{03285}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b86f2ee0fa63f9d01ee437f83b0e1d1}{controller::get\_terminate\_at\_block}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03286}03286\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.terminate\_at\_block;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03287}03287\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03288}03288\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03289}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4a2e2a5327580a667b803e3bf3ce5f82}{03289}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab143988ae1cae85e839b01eb768804c3}{apply\_handler}}*\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4a2e2a5327580a667b803e3bf3ce5f82}{controller::find\_apply\_handler}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ receiver,\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ scope,\ \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}\ act\ )\textcolor{keyword}{\ const}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03290}03290\ \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03291}03291\ \ \ \ \textcolor{keyword}{auto}\ native\_handler\_scope\ =\ my-\/>apply\_handlers.find(\ receiver\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03292}03292\ \ \ \ \textcolor{keywordflow}{if}(\ native\_handler\_scope\ !=\ my-\/>apply\_handlers.end()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03293}03293\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ handler\ =\ native\_handler\_scope-\/>second.find(\ make\_pair(\ scope,\ act\ )\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03294}03294\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ handler\ !=\ native\_handler\_scope-\/>second.end()\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03295}03295\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&handler-\/>second;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03296}03296\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03297}03297\ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03298}03298\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03299}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a888b36bb7d737244a2b200375b199247}{03299}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1wasm__interface}{wasm\_interface}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a888b36bb7d737244a2b200375b199247}{controller::get\_wasm\_interface}}()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03300}03300\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>wasmif;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03301}03301\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03302}03302\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03303}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aae65799cffdae12a65e38811b0c4d8b6}{03303}}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classsysio_1_1chain_1_1account__object}{account\_object}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aae65799cffdae12a65e38811b0c4d8b6}{controller::get\_account}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}}\ )\textcolor{keyword}{const}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03304}03304\ \textcolor{keyword}{}\{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03305}03305\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1account__object}{account\_object}},\ by\_name>(\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03306}03306\ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}(\ (\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}})\ )\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03307}03307\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03308}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa82f197374a4e96fd3e952e18106eae9}{03308}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa82f197374a4e96fd3e952e18106eae9}{controller::sender\_avoids\_whitelist\_blacklist\_enforcement}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ sender\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03309}03309\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>sender\_avoids\_whitelist\_blacklist\_enforcement(\ sender\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03310}03310\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03311}03311\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03312}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa378f4265708c1bc41e4ee058ed71e6a}{03312}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa378f4265708c1bc41e4ee058ed71e6a}{controller::check\_actor\_list}}(\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ actors\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03313}03313\ \ \ \ my-\/>check\_actor\_list(\ actors\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03314}03314\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03315}03315\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03316}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_affb3f9edd37be65bd34a4d6a783051c0}{03316}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_affb3f9edd37be65bd34a4d6a783051c0}{controller::check\_contract\_list}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ code\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03317}03317\ \ \ \ my-\/>check\_contract\_list(\ code\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03318}03318\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03319}03319\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03320}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0884a15f8a10b5a0037601289908a0d9}{03320}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0884a15f8a10b5a0037601289908a0d9}{controller::check\_action\_list}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ code,\ \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03321}03321\ \ \ \ my-\/>check\_action\_list(\ code,\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03322}03322\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03323}03323\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03324}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa26307ee72e8095e9125f086ea570be9}{03324}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa26307ee72e8095e9125f086ea570be9}{controller::check\_key\_list}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1crypto_1_1public__key}{public\_key\_type}}\&\ key\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03325}03325\ \ \ \ my-\/>check\_key\_list(\ key\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03326}03326\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03327}03327\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03328}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a286751cd6498b500b70a0d3678672263}{03328}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a286751cd6498b500b70a0d3678672263}{controller::is\_building\_block}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03329}03329\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending.has\_value();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03330}03330\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03331}03331\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03332}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{03332}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{controller::is\_producing\_block}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03333}03333\ \ \ \ \textcolor{keywordflow}{if}(\ !my-\/>pending\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03334}03334\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03335}03335\ \ \ \ \textcolor{keywordflow}{return}\ (my-\/>pending-\/>\_block\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{block\_status::incomplete}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03336}03336\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03337}03337\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03338}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4afbf4e4448a73468eb6947b68a0c348}{03338}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4afbf4e4448a73468eb6947b68a0c348}{controller::is\_ram\_billing\_in\_notify\_allowed}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03339}03339\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.disable\_all\_subjective\_mitigations\ ||\ !\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{is\_producing\_block}}()\ ||\ my-\/>conf.allow\_ram\_billing\_in\_notify;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03340}03340\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03341}03341\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03342}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a701a2bfcee8df0244e1a8ac8900bc657}{03342}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a701a2bfcee8df0244e1a8ac8900bc657}{controller::configured\_subjective\_signature\_length\_limit}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03343}03343\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.maximum\_variable\_signature\_length;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03344}03344\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03345}03345\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03346}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3c9f983e8d4aba41afbb0a473feca18f}{03346}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a3c9f983e8d4aba41afbb0a473feca18f}{controller::validate\_expiration}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction}{transaction}}\&\ trx\ )\textcolor{keyword}{const\ }\{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03347}03347\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ chain\_configuration\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{get\_global\_properties}}().\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object_a7f149fcf87034217c899838eb4430496}{configuration}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03348}03348\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03349}03349\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{classfc_1_1time__point}{time\_point}}(trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}})\ >=\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}(),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03350}03350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expired\_tx\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03351}03351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}transaction\ has\ expired,\ "{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03352}03352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}expiration\ is\ \$\{trx.expiration\}\ and\ pending\ block\ time\ is\ \$\{pending\_block\_time\}"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03353}03353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}trx.expiration"{}},trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}})(\textcolor{stringliteral}{"{}pending\_block\_time"{}},\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03354}03354\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{classfc_1_1time__point}{time\_point}}(trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}})\ <=\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ +\ \mbox{\hyperlink{namespacefc_a9623b8cae3f48bbed6aa1fc2afe9b174}{fc::seconds}}(chain\_configuration.max\_transaction\_lifetime),}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03355}03355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tx\_exp\_too\_far\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03356}03356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Transaction\ expiration\ is\ too\ far\ in\ the\ future\ relative\ to\ the\ reference\ time\ of\ \$\{reference\_time\},\ "{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03357}03357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}expiration\ is\ \$\{trx.expiration\}\ and\ the\ maximum\ transaction\ lifetime\ is\ \$\{max\_til\_exp\}\ seconds"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03358}03358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}trx.expiration"{}},trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_ad1ed2586e8ace769fdb9a54d09a752ce}{expiration}})(\textcolor{stringliteral}{"{}reference\_time"{}},\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}())}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03359}03359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}max\_til\_exp"{}},chain\_configuration.max\_transaction\_lifetime)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03360}03360\ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}((trx))\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03361}03361\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03362}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a92e84ef71388fa365bcf17a4fbcce047}{03362}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a92e84ef71388fa365bcf17a4fbcce047}{controller::validate\_tapos}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction}{transaction}}\&\ trx\ )\textcolor{keyword}{const\ }\{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03363}03363\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ tapos\_block\_summary\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1block__summary__object}{block\_summary\_object}}>((\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}})trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a459d803b930351f4a1565d9c082debea}{ref\_block\_num}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03364}03364\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03365}03365\ \ \ \ \textcolor{comment}{//Verify\ TaPoS\ block\ summary\ has\ correct\ ID\ prefix,\ and\ that\ this\ block's\ time\ is\ not\ past\ the\ expiration}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03366}03366\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(trx.\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__header_a92adbf497323e601b30eb8475881fb52}{verify\_reference\_block}}(tapos\_block\_summary.block\_id),\ invalid\_ref\_block\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03367}03367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Transaction's\ reference\ block\ did\ not\ match.\ Is\ this\ transaction\ from\ a\ different\ fork?"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03368}03368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}tapos\_summary"{}},\ tapos\_block\_summary));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03369}03369\ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}()\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03370}03370\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03371}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{03371}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{controller::validate\_db\_available\_size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03372}03372\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ free\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_a64133afb9e0ae374eeab86bd1d4db08b}{get\_segment\_manager}}()-\/>get\_free\_memory();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03373}03373\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ guard\ =\ my-\/>conf.state\_guard\_size;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03374}03374\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(free\ >=\ guard,\ database\_guard\_exception,\ \textcolor{stringliteral}{"{}database\ free:\ \$\{f\},\ guard\ size:\ \$\{g\}"{}},\ (\textcolor{stringliteral}{"{}f"{}},\ free)(\textcolor{stringliteral}{"{}g"{}},guard));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03375}03375\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03376}03376\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03377}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0ab467ff13b82630da7533410a8131c3}{03377}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0ab467ff13b82630da7533410a8131c3}{controller::is\_protocol\_feature\_activated}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{digest\_type}}\&\ feature\_digest\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03378}03378\ \ \ \ \textcolor{keywordflow}{if}(\ my-\/>pending\ )}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03379}03379\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ my-\/>pending-\/>is\_protocol\_feature\_activated(\ feature\_digest\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03380}03380\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03381}03381\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ activated\_features\ =\ my-\/>head-\/>activated\_protocol\_features-\/>protocol\_features;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03382}03382\ \ \ \ \textcolor{keywordflow}{return}\ (activated\_features.find(\ feature\_digest\ )\ !=\ activated\_features.end());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03383}03383\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03384}03384\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03385}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa808acf858e93c567ff983ccbf8fb6d3}{03385}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa808acf858e93c567ff983ccbf8fb6d3}{controller::is\_builtin\_activated}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\_protocol\_feature\_t}}\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03386}03386\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ current\_block\_num\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03387}03387\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03388}03388\ \ \ \ \textcolor{keywordflow}{if}(\ my-\/>pending\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03389}03389\ \ \ \ \ \ \ ++current\_block\_num;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03390}03390\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03391}03391\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03392}03392\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>protocol\_features.is\_builtin\_activated(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}},\ current\_block\_num\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03393}03393\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03394}03394\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03395}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad5e154b110a034f3a6430f7827e9c4b3}{03395}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad5e154b110a034f3a6430f7827e9c4b3}{controller::is\_known\_unexpired\_transaction}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{transaction\_id\_type}}\&\ \textcolor{keywordtype}{id})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03396}03396\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_aa5a2ca0da0092693ac49b36b7ec6817a}{find}}<\mbox{\hyperlink{classsysio_1_1chain_1_1transaction__object}{transaction\_object}},\ by\_trx\_id>(\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03397}03397\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03398}03398\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03399}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8d3310c59100f18efeb9a7007a21103}{03399}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8d3310c59100f18efeb9a7007a21103}{controller::set\_subjective\_cpu\_leeway}}(\mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ leeway)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03400}03400\ \ \ \ my-\/>subjective\_cpu\_leeway\ =\ leeway;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03401}03401\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03402}03402\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03403}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_af234ccfa5634942083d52efa1ff5a2ae}{03403}}\ std::optional<fc::microseconds>\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_af234ccfa5634942083d52efa1ff5a2ae}{controller::get\_subjective\_cpu\_leeway}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03404}03404\ \ \ \ \ \textcolor{keywordflow}{return}\ my-\/>subjective\_cpu\_leeway;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03405}03405\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03406}03406\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03407}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a03d5ea18c641a8899af9bdbdf9da9f81}{03407}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a03d5ea18c641a8899af9bdbdf9da9f81}{controller::set\_greylist\_limit}}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ limit\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03408}03408\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ 0\ <\ limit\ \&\&\ limit\ <=\ chain::config::maximum\_elastic\_resource\_multiplier,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03409}03409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ misc\_exception,}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03410}03410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Invalid\ limit\ (\$\{limit\})\ passed\ into\ set\_greylist\_limit.\ "{}}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03411}03411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Must\ be\ between\ 1\ and\ \$\{max\}."{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03412}03412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}limit"{}},\ limit)(\textcolor{stringliteral}{"{}max"{}},\ chain::config::maximum\_elastic\_resource\_multiplier)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03413}03413\ \ \ \ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03414}03414\ \ \ \ my-\/>conf.greylist\_limit\ =\ limit;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03415}03415\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03416}03416\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03417}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a9d7c53697f9d587b6f2e583af9f7e712}{03417}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a9d7c53697f9d587b6f2e583af9f7e712}{controller::get\_greylist\_limit}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03418}03418\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.greylist\_limit;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03419}03419\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03420}03420\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03421}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad0b710fd894bc8c7265b7e8c958df7bc}{03421}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad0b710fd894bc8c7265b7e8c958df7bc}{controller::add\_resource\_greylist}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \&\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03422}03422\ \ \ \ my-\/>conf.resource\_greylist.insert(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03423}03423\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03424}03424\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03425}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a9ebce710613bffd9b019b8d9fc15d20e}{03425}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a9ebce710613bffd9b019b8d9fc15d20e}{controller::remove\_resource\_greylist}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \&\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03426}03426\ \ \ \ my-\/>conf.resource\_greylist.erase(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03427}03427\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03428}03428\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03429}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa1c6dcfae09e0e0ea50ba3fda8915114}{03429}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa1c6dcfae09e0e0ea50ba3fda8915114}{controller::is\_resource\_greylisted}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ \&\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03430}03430\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.resource\_greylist.find(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}})\ !=\ \ my-\/>conf.resource\_greylist.end();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03431}03431\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03432}03432\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03433}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aac87d5e13183ec45393587036b89a14a}{03433}}\ \textcolor{keyword}{const}\ flat\_set<account\_name>\ \&\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aac87d5e13183ec45393587036b89a14a}{controller::get\_resource\_greylist}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03434}03434\ \ \ \ \textcolor{keywordflow}{return}\ \ my-\/>conf.resource\_greylist;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03435}03435\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03436}03436\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03437}03437\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03438}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a205a357919f596bf80ba1d2d6e84c9e8}{03438}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a205a357919f596bf80ba1d2d6e84c9e8}{controller::add\_to\_ram\_correction}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ account,\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ ram\_bytes\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03439}03439\ \ \ \ \textcolor{keyword}{auto}\ ptr\ =\ my-\/>db.find<\mbox{\hyperlink{classsysio_1_1chain_1_1account__ram__correction__object}{account\_ram\_correction\_object}},\ by\_name>(\ account\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03440}03440\ \ \ \ \textcolor{keywordflow}{if}(\ ptr\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03441}03441\ \ \ \ \ \ \ my-\/>db.modify<\mbox{\hyperlink{classsysio_1_1chain_1_1account__ram__correction__object}{account\_ram\_correction\_object}}>(\ *ptr,\ [\&](\ \textcolor{keyword}{auto}\&\ rco\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03442}03442\ \ \ \ \ \ \ \ \ \ rco.ram\_correction\ +=\ ram\_bytes;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03443}03443\ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03444}03444\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03445}03445\ \ \ \ \ \ \ ptr\ =\ \&my-\/>db.create<\mbox{\hyperlink{classsysio_1_1chain_1_1account__ram__correction__object}{account\_ram\_correction\_object}}>(\ [\&](\ \textcolor{keyword}{auto}\&\ rco\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03446}03446\ \ \ \ \ \ \ \ \ \ rco.name\ =\ account;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03447}03447\ \ \ \ \ \ \ \ \ \ rco.ram\_correction\ =\ ram\_bytes;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03448}03448\ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03449}03449\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03450}03450\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03451}03451\ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4f6404b355a3a4bf7fb60c92e85443d1}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03452}03452\ \ \ \ \ \ \ dm\_logger-\/>on\_add\_ram\_correction(*ptr,\ ram\_bytes);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03453}03453\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03454}03454\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03455}03455\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03456}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_af99330e9d5db1211d2c7cd7b3669830d}{03456}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_af99330e9d5db1211d2c7cd7b3669830d}{controller::all\_subjective\_mitigations\_disabled}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03457}03457\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>conf.disable\_all\_subjective\_mitigations;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03458}03458\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03459}03459\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03460}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4f6404b355a3a4bf7fb60c92e85443d1}{03460}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\_mind\_handler}}*\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4f6404b355a3a4bf7fb60c92e85443d1}{controller::get\_deep\_mind\_logger}}()\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03461}03461\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>get\_deep\_mind\_logger();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03462}03462\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03463}03463\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03464}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a86e3c557fb55c04a7e469be06cce72ed}{03464}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a86e3c557fb55c04a7e469be06cce72ed}{controller::enable\_deep\_mind}}(\mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\_mind\_handler}}*\ \mbox{\hyperlink{classfc_1_1logger}{logger}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03465}03465\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{classfc_1_1logger}{logger}}\ !=\ \textcolor{keyword}{nullptr},\ misc\_exception,\ \textcolor{stringliteral}{"{}Invalid\ logger\ passed\ into\ enable\_deep\_mind,\ must\ be\ set"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03466}03466\ \ \ \ my-\/>deep\_mind\_logger\ =\ \mbox{\hyperlink{namespacesysio_a6f5e3e21259b1b0b6d4f035e8c7d5a4e}{logger}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03467}03467\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03468}03468\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03469}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ab75ec0f541f777960752f52f2a194294}{03469}}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ab75ec0f541f777960752f52f2a194294}{controller::earliest\_available\_block\_num}}()\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03470}03470\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>earliest\_available\_block\_num();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03471}03471\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03472}03472\ \textcolor{preprocessor}{\#if\ defined(SYSIO\_SYS\_VM\_RUNTIME\_ENABLED)\ ||\ defined(SYSIO\_SYS\_VM\_JIT\_RUNTIME\_ENABLED)}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03473}03473\ \mbox{\hyperlink{classsysio_1_1vm_1_1wasm__allocator}{vm::wasm\_allocator}}\&\ controller::get\_wasm\_allocator()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03474}03474\ \ \ \ \textcolor{keywordflow}{return}\ my-\/>wasm\_alloc;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03475}03475\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03476}03476\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03477}03477\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03478}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{03478}}\ std::optional<uint64\_t>\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{controller::convert\_exception\_to\_error\_code}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03479}03479\ \ \ \ \textcolor{keyword}{const}\ chain\_exception*\ e\_ptr\ =\ \textcolor{keyword}{dynamic\_cast<}\textcolor{keyword}{const\ }chain\_exception*\textcolor{keyword}{>}(\ \&e\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03480}03480\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03481}03481\ \ \ \ \textcolor{keywordflow}{if}(\ e\_ptr\ ==\ \textcolor{keyword}{nullptr}\ )\ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03482}03482\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03483}03483\ \ \ \ \textcolor{keywordflow}{if}(\ !e\_ptr-\/>error\_code\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\textcolor{keyword}{>}(\mbox{\hyperlink{namespacesysio_1_1chain_a8b5ff492474737d62d2b925435c687cfab6c5ca8c8a308fb98a68c0d3a83ce3bc}{system\_error\_code::generic\_system\_error}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03484}03484\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03485}03485\ \ \ \ \textcolor{keywordflow}{return}\ e\_ptr-\/>error\_code;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03486}03486\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03487}03487\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03488}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a2c8b0888cae831840ac03980e206c874}{03488}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a2c8b0888cae831840ac03980e206c874}{controller::extract\_chain\_id}}(\mbox{\hyperlink{classsysio_1_1chain_1_1snapshot__reader}{snapshot\_reader}}\&\ snapshot)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03489}03489\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header}{chain\_snapshot\_header}}\ header;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03490}03490\ \ \ \ snapshot.read\_section<\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header}{chain\_snapshot\_header}}>([\&header](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03491}03491\ \ \ \ \ \ \ section.read\_row(header);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03492}03492\ \ \ \ \ \ \ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a6f183a866ea3a474243c55484f0c700e}{validate}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03493}03493\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03494}03494\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03495}03495\ \ \ \ \textcolor{comment}{//\ check\ if\ this\ is\ a\ legacy\ version\ of\ the\ snapshot,\ which\ has\ a\ genesis\ state\ instead\ of\ chain\ id}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03496}03496\ \ \ \ std::optional<genesis\_state>\ genesis\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47}{controller\_impl::extract\_legacy\_genesis\_state}}(snapshot,\ header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03497}03497\ \ \ \ \textcolor{keywordflow}{if}\ (genesis)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03498}03498\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ genesis-\/>compute\_chain\_id();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03499}03499\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03500}03500\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03501}03501\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\ chain\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03502}03502\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03503}03503\ \ \ \ \textcolor{keyword}{using\ }v4\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1legacy_1_1snapshot__global__property__object__v4}{legacy::snapshot\_global\_property\_object\_v4}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03504}03504\ \ \ \ \textcolor{keywordflow}{if}\ (header.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__snapshot__header_a57ba8d21e5d5c9e1325e9ef03f96d54e}{version}}\ <=\ v4::maximum\_version)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03505}03505\ \ \ \ \ \ \ snapshot.read\_section<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&chain\_id](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03506}03506\ \ \ \ \ \ \ \ \ \ v4\ global\_properties;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03507}03507\ \ \ \ \ \ \ \ \ \ section.read\_row(global\_properties);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03508}03508\ \ \ \ \ \ \ \ \ \ chain\_id\ =\ global\_properties.chain\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03509}03509\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03510}03510\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03511}03511\ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03512}03512\ \ \ \ \ \ \ snapshot.read\_section<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>([\&chain\_id](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03513}03513\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1snapshot__global__property__object}{snapshot\_global\_property\_object}}\ global\_properties;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03514}03514\ \ \ \ \ \ \ \ \ \ section.read\_row(global\_properties);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03515}03515\ \ \ \ \ \ \ \ \ \ chain\_id\ =\ global\_properties.\mbox{\hyperlink{structsysio_1_1chain_1_1snapshot__global__property__object_a999715132a697f29e1ad6b7b0c4fde2a}{chain\_id}};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03516}03516\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03517}03517\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03518}03518\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03519}03519\ \ \ \ \textcolor{keywordflow}{return}\ chain\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03520}03520\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03521}03521\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03522}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1fba60b779aae78110279aeda9aae351}{03522}}\ std::optional<chain\_id\_type>\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1fba60b779aae78110279aeda9aae351}{controller::extract\_chain\_id\_from\_db}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{path}}\&\ state\_dir\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03523}03523\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03524}03524\ \ \ \ \ \ \ \mbox{\hyperlink{classchainbase_1_1database}{chainbase::database}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}(\ state\_dir,\ \mbox{\hyperlink{classchainbase_1_1database_a3d0148ef1d3bf633f3d0bfab420250eea51c3754046d280c74c384e0e74a45b47}{chainbase::database::read\_only}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03525}03525\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03526}03526\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a43a85f8b7d728b69dbf7a9d69c9ebc1c}{add\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a7d61e01ac919d654401a1db8399a3945}{database\_header\_multi\_index}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03527}03527\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a43a85f8b7d728b69dbf7a9d69c9ebc1c}{add\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a0612ad4956bca2a7b23f9a14e2b32106}{global\_property\_multi\_index}}>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03528}03528\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03529}03529\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139}{controller\_impl::validate\_db\_version}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03530}03530\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03531}03531\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ <\ 1\ )\ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03532}03532\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03533}03533\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object}{global\_property\_object}}>().chain\_id;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03534}03534\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ bad\_database\_version\_exception\&\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03535}03535\ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03536}03536\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ ...\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03537}03537\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03538}03538\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03539}03539\ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03540}03540\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03541}03541\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03542}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac9ea99fba10c923e5949b3949ac3283f}{03542}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac9ea99fba10c923e5949b3949ac3283f}{controller::replace\_producer\_keys}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1crypto_1_1public__key}{public\_key\_type}}\&\ key\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03543}03543\ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Replace\ producer\ keys\ with\ \$\{k\}"{}},\ (\textcolor{stringliteral}{"{}k"{}},\ key));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03544}03544\ \ \ \ mutable\_db().\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().get<global\_property\_object>(),\ [\&](\ \textcolor{keyword}{auto}\&\ gp\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03545}03545\ \ \ \ \ \ \ gp.proposed\_schedule\_block\_num\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03546}03546\ \ \ \ \ \ \ gp.proposed\_schedule.version\ =\ 0;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03547}03547\ \ \ \ \ \ \ gp.proposed\_schedule.producers.clear();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03548}03548\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03549}03549\ \ \ \ \textcolor{keyword}{auto}\ version\ =\ my-\/>head-\/>pending\_schedule.schedule.version;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03550}03550\ \ \ \ my-\/>head-\/>pending\_schedule\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03551}03551\ \ \ \ my-\/>head-\/>pending\_schedule.schedule.version\ =\ version;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03552}03552\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ prod:\ my-\/>head-\/>active\_schedule.producers\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03553}03553\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}\$\{n\}"{}},\ (\textcolor{stringliteral}{"{}n"{}},\ prod.producer\_name));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03554}03554\ \ \ \ \ \ \ std::visit([\&](\textcolor{keyword}{auto}\ \&auth)\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03555}03555\ \ \ \ \ \ \ \ \ \ auth.threshold\ =\ 1;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03556}03556\ \ \ \ \ \ \ \ \ \ auth.keys\ =\ \{\mbox{\hyperlink{structsysio_1_1chain_1_1key__weight}{key\_weight}}\{\mbox{\hyperlink{yubico__otp_8c_a9246c20bb98ad2b4c60313c053c70f08}{key}},\ 1\}\};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03557}03557\ \ \ \ \ \ \ \},\ prod.authority);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03558}03558\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03559}03559\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03560}03560\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03561}\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a72b5d03a47c8644a68d625fc4dca44bf}{03561}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a72b5d03a47c8644a68d625fc4dca44bf}{controller::replace\_account\_keys}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}}\ account,\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}}\ permission,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1crypto_1_1public__key}{public\_key\_type}}\&\ key\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03562}03562\ \ \ \ \textcolor{keyword}{auto}\&\ rlm\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_add2453cf4d0208ca9f277337c9a5ed7a}{get\_mutable\_resource\_limits\_manager}}();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03563}03563\ \ \ \ \textcolor{keyword}{auto}*\ perm\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0c79d00dae8c0d90efc18f4d091b2391}{db}}().\mbox{\hyperlink{classchainbase_1_1database_aa5a2ca0da0092693ac49b36b7ec6817a}{find}}<\mbox{\hyperlink{classsysio_1_1chain_1_1permission__object}{permission\_object}},\ by\_owner>(boost::make\_tuple(account,\ permission));}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03564}03564\ \ \ \ \textcolor{keywordflow}{if}\ (!perm)}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03565}03565\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03566}03566\ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ old\_size\ =\ (\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}})(\mbox{\hyperlink{namespacesysio_1_1chain_1_1config_a2772c77657b1f6fda680bbe8f7282d13}{chain::config::billable\_size\_v<permission\_object>}}\ +\ perm-\/>auth.get\_billable\_size());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03567}03567\ \ \ \ mutable\_db().\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(*perm,\ [\&](\textcolor{keyword}{auto}\&\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}})\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03568}03568\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.auth\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}}(key);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03569}03569\ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03570}03570\ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ new\_size\ =\ (\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}})(\mbox{\hyperlink{namespacesysio_1_1chain_1_1config_a2772c77657b1f6fda680bbe8f7282d13}{chain::config::billable\_size\_v<permission\_object>}}\ +\ perm-\/>auth.get\_billable\_size());}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03571}03571\ \ \ \ rlm.add\_pending\_ram\_usage(account,\ new\_size\ -\/\ old\_size);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03572}03572\ \ \ \ rlm.verify\_account\_ram\_usage(account);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03573}03573\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03574}03574\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03576}03576\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03577}03577\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03578}\mbox{\hyperlink{namespacesysio_1_1chain_ad489cfc4ad2a8e6c83ba6df824cdf86a}{03578}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::preactivate\_feature>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03579}03579\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03580}03580\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}preactivate\_feature"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03581}03581\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}is\_feature\_activated"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03582}03582\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03583}03583\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03584}03584\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03585}03585\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03586}\mbox{\hyperlink{namespacesysio_1_1chain_abe48b8bdbfc90c716c2829e1b1179502}{03586}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::get\_sender>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03587}03587\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03588}03588\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}get\_sender"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03589}03589\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03590}03590\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03591}03591\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03592}03592\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03593}\mbox{\hyperlink{namespacesysio_1_1chain_a97599248411293cb485c399a25bd8988}{03593}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::replace\_deferred>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03594}03594\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ indx\ =\ db.\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a4c900d23edfaeb9e6e25aa3a21e0ab4b}{account\_ram\_correction\_index}},\ by\_id>();}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03595}03595\ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ itr\ =\ indx.begin();\ itr\ !=\ indx.end();\ itr\ =\ indx.begin()\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03596}03596\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ current\_ram\_usage\ =\ resource\_limits.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae7d1b3c435910424a1142b052a8774be}{get\_account\_ram\_usage}}(\ itr-\/>name\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03597}03597\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ ram\_delta\ =\ -\/\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\textcolor{keyword}{>}(itr-\/>ram\_correction);}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03598}03598\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ itr-\/>ram\_correction\ >\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\textcolor{keyword}{>}(current\_ram\_usage)\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03599}03599\ \ \ \ \ \ \ \ \ \ ram\_delta\ =\ -\/current\_ram\_usage;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03600}03600\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}account\ \$\{name\}\ was\ to\ be\ reduced\ by\ \$\{adjust\}\ bytes\ of\ RAM\ despite\ only\ using\ \$\{current\}\ bytes\ of\ RAM"{}},}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03601}03601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}name"{}},\ itr-\/>name)(\textcolor{stringliteral}{"{}adjust"{}},\ itr-\/>ram\_correction)(\textcolor{stringliteral}{"{}current"{}},\ current\_ram\_usage)\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03602}03602\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03603}03603\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03604}03604\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ get\_deep\_mind\_logger())\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03605}03605\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_ram\_trace(\mbox{\hyperlink{deep__mind_8hpp_aaaa2f1dbd522de03ccbaa73f01db5f50}{RAM\_EVENT\_ID}}(\textcolor{stringliteral}{"{}\$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ itr-\/>id.\_id)),\ \textcolor{stringliteral}{"{}deferred\_trx"{}},\ \textcolor{stringliteral}{"{}correction"{}},\ \textcolor{stringliteral}{"{}deferred\_trx\_ram\_correction"{}});}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03606}03606\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03607}03607\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03608}03608\ \ \ \ \ \ \ resource\_limits.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a7fea1de6a3806590de0bda86e53c7995}{add\_pending\_ram\_usage}}(\ itr-\/>name,\ ram\_delta\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03609}03609\ \ \ \ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_ac6bb29708e4fdfb6899028e3c351fe0b}{remove}}(\ *itr\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03610}03610\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03611}03611\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03612}03612\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03613}03613\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03614}\mbox{\hyperlink{namespacesysio_1_1chain_aac086788d0a960567236f63be7577125}{03614}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::webauthn\_key>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03615}03615\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03616}03616\ \ \ \ \ \ \ ps.num\_supported\_key\_types\ =\ 3;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03617}03617\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03618}03618\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03619}03619\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03620}03620\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03621}\mbox{\hyperlink{namespacesysio_1_1chain_aaa84e3c493ad81712088b1185ad986b9}{03621}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::em\_key>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03622}03622\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03623}03623\ \ \ \ \ \ \ ps.num\_supported\_key\_types\ =\ 4;}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03624}03624\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03625}03625\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03626}03626\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03627}03627\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03628}03628\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03629}\mbox{\hyperlink{namespacesysio_1_1chain_a4393e09bb7b222765c0ce7b4e6476904}{03629}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::wtmsig\_block\_signatures>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03630}03630\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03631}03631\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}set\_proposed\_producers\_ex"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03632}03632\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03633}03633\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03634}03634\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03635}03635\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03636}\mbox{\hyperlink{namespacesysio_1_1chain_aa6bdd154dacf21ee6930994377762448}{03636}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::action\_return\_value>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03637}03637\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03638}03638\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}set\_action\_return\_value"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03639}03639\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03640}03640\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03641}03641\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03642}03642\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03643}\mbox{\hyperlink{namespacesysio_1_1chain_aa0cebf01441e8d48e3f59d1e71952216}{03643}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::configurable\_wasm\_limits>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03644}03644\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03645}03645\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}set\_wasm\_parameters\_packed"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03646}03646\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}get\_wasm\_parameters\_packed"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03647}03647\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03648}03648\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03649}03649\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03650}03650\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03651}\mbox{\hyperlink{namespacesysio_1_1chain_a5b554a28a2283bf08cf5a087ad9aa263}{03651}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::blockchain\_parameters>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03652}03652\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03653}03653\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}get\_parameters\_packed"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03654}03654\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}set\_parameters\_packed"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03655}03655\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03656}03656\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03657}03657\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03658}03658\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03659}\mbox{\hyperlink{namespacesysio_1_1chain_a3035aa4ca3ab051f87561bee854ae8e3}{03659}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::get\_code\_hash>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03660}03660\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03661}03661\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}get\_code\_hash"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03662}03662\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03663}03663\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03664}03664\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03665}03665\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03666}\mbox{\hyperlink{namespacesysio_1_1chain_a9506d121391f12b3301d4e52e4b73910}{03666}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::get\_block\_num>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03667}03667\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03668}03668\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}get\_block\_num"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03669}03669\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03670}03670\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03671}03671\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03672}03672\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03673}\mbox{\hyperlink{namespacesysio_1_1chain_a709635b6f069bd2cde699931d8182e87}{03673}}\ \textcolor{keywordtype}{void}\ controller\_impl::on\_activation<builtin\_protocol\_feature\_t::crypto\_primitives>()\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03674}03674\ \ \ \ db.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ db.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>(),\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03675}03675\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}alt\_bn128\_add"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03676}03676\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}alt\_bn128\_mul"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03677}03677\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}alt\_bn128\_pair"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03678}03678\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}mod\_exp"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03679}03679\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}blake2\_f"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03680}03680\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}sha3"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03681}03681\ \ \ \ \ \ \ add\_intrinsic\_to\_whitelist(\ ps.whitelisted\_intrinsics,\ \textcolor{stringliteral}{"{}k1\_recover"{}}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03682}03682\ \ \ \ \}\ );}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03683}03683\ \}}
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03684}03684\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03686}03686\ }
\DoxyCodeLine{\Hypertarget{controller_8cpp_source_l03687}03687\ \}\ \}\ }

\end{DoxyCode}
