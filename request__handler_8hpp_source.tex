\doxysection{request\+\_\+handler.\+hpp}
\hypertarget{request__handler_8hpp_source}{}\label{request__handler_8hpp_source}\index{plugins/trace\_api\_plugin/include/sysio/trace\_api/request\_handler.hpp@{plugins/trace\_api\_plugin/include/sysio/trace\_api/request\_handler.hpp}}
\mbox{\hyperlink{request__handler_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00001}00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{fc_2include_2fc_2variant_8hpp}{fc/variant.hpp}}>}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{metadata__log_8hpp}{sysio/trace\_api/metadata\_log.hpp}}>}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{data__log_8hpp}{sysio/trace\_api/data\_log.hpp}}>}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{plugins_2trace__api__plugin_2include_2sysio_2trace__api_2common_8hpp}{sysio/trace\_api/common.hpp}}>}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00008}00008\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio_1_1trace__api}{sysio::trace\_api}}\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00009}\mbox{\hyperlink{namespacesysio_1_1trace__api_ae306675da343477bc1ebdf6512c76066}{00009}}\ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacesysio_1_1trace__api_ae306675da343477bc1ebdf6512c76066}{data\_handler\_function}}\ =\ std::function<std::tuple<fc::variant,\ std::optional<fc::variant>>(\ \textcolor{keyword}{const}\ std::variant<action\_trace\_v0,\ action\_trace\_v1>\ \&\ action\_trace\_t,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{yield\_function}}\&)>;}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00011}\mbox{\hyperlink{namespacesysio_1_1trace__api_1_1detail}{00011}}\ \ \ \ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedetail}{detail}}\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00012}\mbox{\hyperlink{classsysio_1_1trace__api_1_1detail_1_1response__formatter}{00012}}\ \ \ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classsysio_1_1trace__api_1_1detail_1_1response__formatter}{response\_formatter}}\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00013}00013\ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00014}00014\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1variant}{fc::variant}}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1detail_1_1response__formatter_a0d5fa7307ab3dfca56f3892da858ccef}{process\_block}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a98bdcc53a9d9aa6aff851a743516c3b9}{data\_log\_entry}}\&\ trace,\ \textcolor{keywordtype}{bool}\ irreversible,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1trace__api_ae306675da343477bc1ebdf6512c76066}{data\_handler\_function}}\&\ data\_handler,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{yield\_function}}\&\ yield\ );}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00015}00015\ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00016}00016\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00018}00018\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ LogfileProv\textcolor{keywordtype}{id}er,\ \textcolor{keyword}{typename}\ DataHandlerProv\textcolor{keywordtype}{id}er>}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00019}\mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler}{00019}}\ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler}{request\_handler}}\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00020}00020\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00021}\mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler_a168e09856038bd115e121943bb4b28de}{00021}}\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler_a168e09856038bd115e121943bb4b28de}{request\_handler}}(LogfileProvider\&\&\ logfile\_provider,\ DataHandlerProvider\&\&\ data\_handler\_provider,\ \mbox{\hyperlink{classfc_1_1optional__delegate}{log\_handler}}\ log)}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00022}00022\ \ \ \ \ \ \ :logfile\_provider(\mbox{\hyperlink{namespacestd}{std}}::move(logfile\_provider))}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00023}00023\ \ \ \ \ \ \ ,data\_handler\_provider(\mbox{\hyperlink{namespacestd}{std}}::move(data\_handler\_provider))}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00024}00024\ \ \ \ \ \ \ ,\_log(log)}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00025}00025\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \_log(\textcolor{stringliteral}{"{}Constructed\ request\_handler"{}});}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00027}00027\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00040}\mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler_a8c834f0e13d54dd42ac3c6d2e978793f}{00040}}\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1variant}{fc::variant}}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler_a8c834f0e13d54dd42ac3c6d2e978793f}{get\_block\_trace}}(\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_height,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{yield\_function}}\&\ yield\ =\ \{\})\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ data\ =\ logfile\_provider.get\_block(block\_height,\ yield);}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!data)\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00043}00043\ \ \ \ \ \ \ \ \ \ \ \ \ \_log(\textcolor{stringliteral}{"{}No\ block\ found\ at\ block\ height\ "{}}\ +\ std::to\_string(block\_height)\ );}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00045}00045\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00047}00047\ \ \ \ \ \ \ \ \ \ yield();}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ data\_handler\ =\ [\textcolor{keyword}{this}](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{structaction}{action}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a24d1d2b642518b3d627011e7ef39ae9a}{yield\_function}}\&\ yield)\ -\/>\ std::tuple<\mbox{\hyperlink{classfc_1_1variant}{fc::variant}},\ std::optional<fc::variant>>\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::visit([\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ action\_trace\_t)\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ data\_handler\_provider.serialize\_to\_variant(action\_trace\_t,\ yield);}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \},\ \mbox{\hyperlink{structaction}{action}});}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1detail_1_1response__formatter_a0d5fa7307ab3dfca56f3892da858ccef}{detail::response\_formatter::process\_block}}(std::get<0>(*data),\ std::get<1>(*data),\ data\_handler,\ yield);}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00056}00056\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00070}\mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler_aba4acfed2d43f5f8d74bd6d80e28f777}{00070}}\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1variant}{fc::variant}}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler_aba4acfed2d43f5f8d74bd6d80e28f777}{get\_transaction\_trace}}(\mbox{\hyperlink{classfc_1_1sha256}{chain::transaction\_id\_type}}\ trxid,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_height,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{yield\_function}}\&\ yield\ =\ \{\})\{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \_log(\textcolor{stringliteral}{"{}get\_transaction\_trace\ called"{}}\ );}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1variant}{fc::variant}}\ result\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ extract\ the\ transaction\ trace\ from\ the\ block\ trace}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ resp\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1request__handler_a8c834f0e13d54dd42ac3c6d2e978793f}{get\_block\_trace}}(block\_height,\ yield);}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!resp.is\_null())\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ b\_mvo\ =\ resp.get\_object();}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (b\_mvo.contains(\textcolor{stringliteral}{"{}transactions"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ transactions\ =\ b\_mvo[\textcolor{stringliteral}{"{}transactions"{}}];}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ input\_id\ =\ trxid.\mbox{\hyperlink{classfc_1_1sha256_a71ac4efc1d964d24fdf00aeffcf0a9c9}{str}}();}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ i\ =\ 0;\ i\ <\ transactions.size();\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transactions[i].is\_null())\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ t\_mvo\ =\ transactions[i].get\_object();}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\_mvo.contains(\textcolor{stringliteral}{"{}id"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ t\_id\ =\ t\_mvo[\textcolor{stringliteral}{"{}id"{}}].get\_string();}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\_id\ ==\ input\_id)\ \{}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ transactions[i];}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ result.is\_null()\ )}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_log(\textcolor{stringliteral}{"{}Exhausted\ all\ "{}}\ +\ std::to\_string(transactions.size())\ +\ \textcolor{stringliteral}{"{}\ transactions\ in\ block\ "{}}\ +\ b\_mvo[\textcolor{stringliteral}{"{}number"{}}].as\_string()\ +\ \textcolor{stringliteral}{"{}\ without\ finding\ trxid\ "{}}\ +\ trxid.\mbox{\hyperlink{classfc_1_1sha256_a71ac4efc1d964d24fdf00aeffcf0a9c9}{str}}());}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00096}00096\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00098}00098\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00099}00099\ \ \ \ \ \ \ LogfileProvider\ logfile\_provider;}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00100}00100\ \ \ \ \ \ \ DataHandlerProvider\ data\_handler\_provider;}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00101}00101\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1trace__api_ac599662bf2df3135abffd5ff3adbca19}{log\_handler}}\ \_log;}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00102}00102\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{request__handler_8hpp_source_l00105}00105\ \}}

\end{DoxyCode}
