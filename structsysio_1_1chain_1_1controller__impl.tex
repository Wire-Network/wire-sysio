\doxysection{sysio\+::chain\+::controller\+\_\+impl Struct Reference}
\hypertarget{structsysio_1_1chain_1_1controller__impl}{}\label{structsysio_1_1chain_1_1controller__impl}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}


Collaboration diagram for sysio\+::chain\+::controller\+\_\+impl\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler}{reset\+\_\+new\+\_\+handler}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
typedef pair$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a58379f7b40727cd3645e0f5a9b24e653}{scope\+\_\+name}}, \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\+\_\+name}} $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c}{handler\+\_\+key}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}{pop\+\_\+block}} ()
\item 
{\footnotesize template$<$\mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}} F$>$ }\\void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744}{on\+\_\+activation}} ()
\item 
{\footnotesize template$<$\mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}} F$>$ }\\void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\+\_\+activation\+\_\+handler}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff}{trigger\+\_\+activation\+\_\+handler}} (\mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}} \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a866a2ded537cb72ff21ae968a7940432}{set\+\_\+apply\+\_\+handler}} (\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} receiver, \mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} contract, \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\+\_\+name}} \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}, \mbox{\hyperlink{namespacesysio_1_1chain_ab143988ae1cae85e839b01eb768804c3}{apply\+\_\+handler}} v)
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afcd800bda7495ddc4ddee1074d5bfcb7}{controller\+\_\+impl}} (const \mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{controller\+::config}} \&cfg, \mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}} \&\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}, \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set}{protocol\+\_\+feature\+\_\+set}} \&\&pfs, const \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\+\_\+id}})
\item 
{\footnotesize template$<$typename Signal , typename Arg $>$ }\\void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}} (const Signal \&\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}, Arg \&\&\mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}})
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\+\_\+applied\+\_\+transaction}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} \&t)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\+\_\+irreversible}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d}{initialize\+\_\+blockchain\+\_\+state}} (const \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} \&genesis)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647}{replay}} (std\+::function$<$ bool()$>$ check\+\_\+shutdown)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a18bcf25847599b0f9caa6566364bb0ac}{startup}} (std\+::function$<$ void()$>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}, std\+::function$<$ bool()$>$ check\+\_\+shutdown, const \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\+\_\+reader\+\_\+ptr}} \&snapshot)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a7863870ecde398ac7def54e4814db6bc}{startup}} (std\+::function$<$ void()$>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}, std\+::function$<$ bool()$>$ check\+\_\+shutdown, const \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} \&genesis)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a90da90c73cb32b5e5ec498da5e02753f}{startup}} (std\+::function$<$ void()$>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}, std\+::function$<$ bool()$>$ check\+\_\+shutdown)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9efbc515682ae5dede91184c36af73f7}{init}} (std\+::function$<$ bool()$>$ check\+\_\+shutdown)
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af239089382ffa593908091df9d6d0cbd}{\texorpdfstring{$\sim$}{\string~}controller\+\_\+impl}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac7dedae4e6f8bcbd20e69d1e5551e378}{add\+\_\+indices}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ade7505662796ff416f1d43862b0507fb}{clear\+\_\+all\+\_\+undo}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148}{add\+\_\+contract\+\_\+tables\+\_\+to\+\_\+snapshot}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a80afaa06d96e661a0f93e0ba4b09c8dc}{snapshot\+\_\+writer\+\_\+ptr}} \&snapshot) const
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22}{read\+\_\+contract\+\_\+tables\+\_\+from\+\_\+snapshot}} (const \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\+\_\+reader\+\_\+ptr}} \&snapshot)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795}{add\+\_\+to\+\_\+snapshot}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a80afaa06d96e661a0f93e0ba4b09c8dc}{snapshot\+\_\+writer\+\_\+ptr}} \&snapshot)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}{read\+\_\+from\+\_\+snapshot}} (const \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\+\_\+reader\+\_\+ptr}} \&snapshot, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} blog\+\_\+start, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} blog\+\_\+end)
\item 
\mbox{\hyperlink{classfc_1_1sha256}{sha256}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6}{calculate\+\_\+integrity\+\_\+hash}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\+\_\+native\+\_\+account}} (const \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} \&initial\+\_\+timestamp, \mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}}, const \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}} \&owner, const \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}} \&active, bool is\+\_\+privileged=false)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde}{initialize\+\_\+database}} (const \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} \&genesis)
\item 
\mbox{\hyperlink{classfc_1_1scoped__exit}{fc\+::scoped\+\_\+exit}}$<$ std\+::function$<$ void()$>$ $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\+\_\+block\+\_\+restore\+\_\+point}} ()
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b}{apply\+\_\+onerror}} (const \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction}{generated\+\_\+transaction}} \&gtrx, \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} block\+\_\+deadline, \mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}} max\+\_\+transaction\+\_\+time, \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} start, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} \&cpu\+\_\+time\+\_\+to\+\_\+bill\+\_\+us, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} billed\+\_\+cpu\+\_\+time\+\_\+us, bool explicit\+\_\+billed\+\_\+cpu\+\_\+time=false, bool enforce\+\_\+whiteblacklist=true)
\item 
\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\+\_\+t}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43}{remove\+\_\+scheduled\+\_\+transaction}} (const \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction__object}{generated\+\_\+transaction\+\_\+object}} \&gto)
\item 
bool \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\+\_\+is\+\_\+subjective}} (const \mbox{\hyperlink{classfc_1_1exception}{fc\+::exception}} \&e) const
\item 
bool \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}{scheduled\+\_\+failure\+\_\+is\+\_\+subjective}} (const \mbox{\hyperlink{classfc_1_1exception}{fc\+::exception}} \&e) const
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}{push\+\_\+scheduled\+\_\+transaction}} (const \mbox{\hyperlink{namespacesysio_1_1chain_aa85a3b49b3b219d1e3840567579e7e63}{transaction\+\_\+id\+\_\+type}} \&trxid, \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} block\+\_\+deadline, \mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}} max\+\_\+transaction\+\_\+time, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} billed\+\_\+cpu\+\_\+time\+\_\+us, bool explicit\+\_\+billed\+\_\+cpu\+\_\+time=false)
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a43b89d301b09c599969412d7db819bd3}{push\+\_\+scheduled\+\_\+transaction}} (const \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction__object}{generated\+\_\+transaction\+\_\+object}} \&gto, \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} block\+\_\+deadline, \mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}} max\+\_\+transaction\+\_\+time, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} billed\+\_\+cpu\+\_\+time\+\_\+us, bool explicit\+\_\+billed\+\_\+cpu\+\_\+time=false)
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}} $>$ }\\const \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt}{transaction\+\_\+receipt}} \& \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\+\_\+receipt}} (const \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}} \&trx, \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55}{transaction\+\_\+receipt\+\_\+header\+::status\+\_\+enum}} status, \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\+\_\+t}} cpu\+\_\+usage\+\_\+us, \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\+\_\+t}} net\+\_\+usage)
\begin{DoxyCompactList}\small\item\em push\+\_\+scheduled\+\_\+transaction \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}{push\+\_\+transaction}} (const \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\+\_\+metadata\+\_\+ptr}} \&trx, \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} block\+\_\+deadline, \mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}} max\+\_\+transaction\+\_\+time, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} billed\+\_\+cpu\+\_\+time\+\_\+us, bool explicit\+\_\+billed\+\_\+cpu\+\_\+time, \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\+\_\+t}} subjective\+\_\+cpu\+\_\+bill\+\_\+us)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566}{start\+\_\+block}} (\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}} when, \mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}} confirm\+\_\+block\+\_\+count, const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&new\+\_\+protocol\+\_\+feature\+\_\+activations, \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}, const std\+::optional$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} $>$ \&producer\+\_\+block\+\_\+id, const \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} \&deadline)
\begin{DoxyCompactList}\small\item\em push\+\_\+transaction \end{DoxyCompactList}\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192}{finalize\+\_\+block}} ()
\begin{DoxyCompactList}\small\item\em start\+\_\+block \end{DoxyCompactList}\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4}{commit\+\_\+block}} (bool add\+\_\+to\+\_\+fork\+\_\+db)
\begin{DoxyCompactList}\small\item\em finalize\+\_\+block \end{DoxyCompactList}\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60}{check\+\_\+protocol\+\_\+features}} (\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}} timestamp, const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&currently\+\_\+activated\+\_\+protocol\+\_\+features, const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&new\+\_\+protocol\+\_\+features)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973}{report\+\_\+block\+\_\+header\+\_\+diff}} (const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\+\_\+header}} \&b, const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\+\_\+header}} \&ab)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\+\_\+block}} (const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&bsp, \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}, const \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\+\_\+meta\+\_\+cache\+\_\+lookup}} \&trx\+\_\+lookup)
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8}{create\+\_\+block\+\_\+state\+\_\+i}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}, const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&b, const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\+\_\+header\+\_\+state}} \&prev)
\begin{DoxyCompactList}\small\item\em apply\+\_\+block \end{DoxyCompactList}\item 
std\+::future$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af1df7b3285411e4e9ae6781353ad4d80}{create\+\_\+block\+\_\+state\+\_\+future}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}, const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&b)
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad5c91b7cff820c07efed35a7b3912d68}{create\+\_\+block\+\_\+state}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}}, const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&b)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac2d3794f1bd0ff1bd5837d8ead15d289}{push\+\_\+block}} (const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&bsp, const \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\+\_\+branch\+\_\+callback}} \&forked\+\_\+branch\+\_\+cb, const \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\+\_\+meta\+\_\+cache\+\_\+lookup}} \&trx\+\_\+lookup)
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}{replay\+\_\+push\+\_\+block}} (const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&b, \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}})
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\+\_\+switch\+\_\+forks}} (const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&new\+\_\+head, \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}} \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}, const \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\+\_\+branch\+\_\+callback}} \&forked\+\_\+branch\+\_\+cb, const \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\+\_\+meta\+\_\+cache\+\_\+lookup}} \&trx\+\_\+lookup)
\item 
\mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\+\_\+metadata\+\_\+ptr}} $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\+\_\+block}} ()
\begin{DoxyCompactList}\small\item\em push\+\_\+block \end{DoxyCompactList}\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f}{update\+\_\+producers\+\_\+authority}} ()
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84}{create\+\_\+block\+\_\+summary}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&\mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}})
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}{clear\+\_\+expired\+\_\+input\+\_\+transactions}} (const \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} \&deadline)
\item 
bool \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735}{sender\+\_\+avoids\+\_\+whitelist\+\_\+blacklist\+\_\+enforcement}} (\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} sender) const
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1}{check\+\_\+actor\+\_\+list}} (const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} $>$ \&actors) const
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a16289260be252f6ebbd80763f657fb38}{check\+\_\+contract\+\_\+list}} (\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} code) const
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aff9373c6d02a511984f20486e90585f5}{check\+\_\+action\+\_\+list}} (\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} code, \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\+\_\+name}} \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}) const
\item 
void \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad83ca3895f901f87cbf1060493698f55}{check\+\_\+key\+\_\+list}} (const \mbox{\hyperlink{namespacesysio_1_1chain_a0628a11f388cd2e43b1ccc1260a1042f}{public\+\_\+key\+\_\+type}} \&key) const
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1signed__transaction}{signed\+\_\+transaction}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902}{get\+\_\+on\+\_\+block\+\_\+transaction}} ()
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\+\_\+mind\+\_\+handler}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\+\_\+deep\+\_\+mind\+\_\+logger}} () const
\item 
\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8618218d7168450c383cde9860d57706}{earliest\+\_\+available\+\_\+block\+\_\+num}} () const
\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static auto \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139}{validate\+\_\+db\+\_\+version}} (const \mbox{\hyperlink{classchainbase_1_1database}{chainbase\+::database}} \&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}})
\item 
static std\+::optional$<$ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47}{extract\+\_\+legacy\+\_\+genesis\+\_\+state}} (\mbox{\hyperlink{classsysio_1_1chain_1_1snapshot__reader}{snapshot\+\_\+reader}} \&snapshot, \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} version)
\item 
static \mbox{\hyperlink{namespacesysio_1_1chain_a9c3cb5131331ed8d52a589437ccfb03e}{checksum256\+\_\+type}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}{calculate\+\_\+trx\+\_\+merkle}} (const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt}{transaction\+\_\+receipt}} $>$ \&trxs)
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler}{reset\+\_\+new\+\_\+handler}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a342fd89592616d7ca931ff64fe75ead7}{rnh}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}} \& \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}
\item 
std\+::function$<$ void()$>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}
\item 
\mbox{\hyperlink{classchainbase_1_1database}{chainbase\+::database}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{block\+\_\+log}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}
\item 
std\+::optional$<$ \mbox{\hyperlink{structsysio_1_1chain_1_1pending__state}{pending\+\_\+state}} $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database}{fork\+\_\+database}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\+\_\+db}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1wasm__interface}{wasm\+\_\+interface}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}{wasmif}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager}{resource\+\_\+limits\+\_\+manager}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\+\_\+limits}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager}{authorization\+\_\+manager}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager}{protocol\+\_\+feature\+\_\+manager}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\+\_\+features}}
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{controller\+::config}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}
\item 
const \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\+\_\+id\+\_\+type}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\+\_\+id}}
\item 
bool \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}} = false
\item 
\mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5e}{db\+\_\+read\+\_\+mode}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\+\_\+mode}} = \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\+\_\+read\+\_\+mode\+::\+SPECULATIVE}}
\item 
bool \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\+\_\+trx\+\_\+requiring\+\_\+checks}} = false
\begin{DoxyCompactList}\small\item\em if true, checks that are normally skipped on replay (e.\+g. auth checks) cannot be skipped \end{DoxyCompactList}\item 
std\+::optional$<$ \mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}} $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}{subjective\+\_\+cpu\+\_\+leeway}}
\item 
bool \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\+\_\+producer\+\_\+light\+\_\+validation}} = false
\item 
\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\+\_\+head\+\_\+block}} = 0
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool}{named\+\_\+thread\+\_\+pool}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\+\_\+pool}}
\item 
\mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer}{platform\+\_\+timer}} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}}
\item 
\mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\+\_\+mind\+\_\+handler}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4f73eb03cb9df364b792166a70f78320}{deep\+\_\+mind\+\_\+logger}} = nullptr
\item 
map$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}, map$<$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c}{handler\+\_\+key}}, \mbox{\hyperlink{namespacesysio_1_1chain_ab143988ae1cae85e839b01eb768804c3}{apply\+\_\+handler}} $>$ $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a67d7a4050a78ec74aaf524a46bbcdf54}{apply\+\_\+handlers}}
\item 
unordered\+\_\+map$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}}, std\+::function$<$ void(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl}{controller\+\_\+impl}} \&)$>$, \mbox{\hyperlink{structsysio_1_1chain_1_1enum__hash}{enum\+\_\+hash}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}} $>$ $>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\+\_\+feature\+\_\+activation\+\_\+handlers}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


Definition at line \mbox{\hyperlink{controller_8cpp_source_l00220}{220}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.



\doxysubsection{Member Typedef Documentation}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!handler\_key@{handler\_key}}
\index{handler\_key@{handler\_key}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{handler\_key}{handler\_key}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c} 
pair$<$\mbox{\hyperlink{namespacesysio_1_1chain_a58379f7b40727cd3645e0f5a9b24e653}{scope\+\_\+name}},\mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\+\_\+name}}$>$ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c}{sysio\+::chain\+::controller\+\_\+impl\+::handler\+\_\+key}}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00255}{255}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_afcd800bda7495ddc4ddee1074d5bfcb7}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!controller\_impl@{controller\_impl}}
\index{controller\_impl@{controller\_impl}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{controller\_impl()}{controller\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_afcd800bda7495ddc4ddee1074d5bfcb7} 
sysio\+::chain\+::controller\+\_\+impl\+::controller\+\_\+impl (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{controller\+::config}} \&}]{cfg}{, }\item[{\mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}} \&}]{s}{, }\item[{\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set}{protocol\+\_\+feature\+\_\+set}} \&\&}]{pfs}{, }\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\+\_\+id\+\_\+type}} \&}]{chain\+\_\+id}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00297}{297}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00298\ \ \ \ :\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a342fd89592616d7ca931ff64fe75ead7}{rnh}}(),}
\DoxyCodeLine{00299\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}),}
\DoxyCodeLine{00300\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}(\ cfg.state\_dir,}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ cfg.read\_only\ ?\ \mbox{\hyperlink{classchainbase_1_1database_a3d0148ef1d3bf633f3d0bfab420250eea51c3754046d280c74c384e0e74a45b47}{database::read\_only}}\ :\ \mbox{\hyperlink{classchainbase_1_1database_a3d0148ef1d3bf633f3d0bfab420250eea3ed40e30ae731cdc45c9dc5b782d88f4}{database::read\_write}},}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ cfg.state\_size,\ \textcolor{keyword}{false},\ cfg.db\_map\_mode\ ),}
\DoxyCodeLine{00303\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}(\ cfg.blocks\_dir,\ cfg.prune\_config\ ),}
\DoxyCodeLine{00304\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}(\ cfg.blocks\_dir\ /\ config::reversible\_blocks\_dir\_name\ ),}
\DoxyCodeLine{00305\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}{wasmif}}(\ cfg.wasm\_runtime,\ cfg.eosvmoc\_tierup,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ cfg.state\_dir,\ cfg.eosvmoc\_config,\ !cfg.profile\_accounts.empty()\ ),}
\DoxyCodeLine{00306\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\&\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}]()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}.get\_deep\_mind\_logger();\ \}),}
\DoxyCodeLine{00307\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ ),}
\DoxyCodeLine{00308\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}(\ std::move(pfs),\ [\&\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}]()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}.get\_deep\_mind\_logger();\ \}\ ),}
\DoxyCodeLine{00309\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}(\ cfg\ ),}
\DoxyCodeLine{00310\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}\ ),}
\DoxyCodeLine{00311\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}(\ cfg.read\_mode\ ),}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}(\ \textcolor{stringliteral}{"{}chain"{}},\ cfg.thread\_pool\_size\ )}
\DoxyCodeLine{00313\ \ \ \ \{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a378b089fe1ff7ac016ee51058ff52cb2}{open}}(\ [\textcolor{keyword}{this}](\ \mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ vector<digest\_type>\&\ new\_features\ )}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60}{check\_protocol\_features}}(\ timestamp,\ cur\_features,\ new\_features\ );\ \}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ );}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::preactivate\_feature>}}();}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::replace\_deferred>}}();}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::get\_sender>}}();}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::webauthn\_key>}}();}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::wtmsig\_block\_signatures>}}();}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::action\_return\_value>}}();}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::configurable\_wasm\_limits>}}();}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::blockchain\_parameters>}}();}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::get\_code\_hash>}}();}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::get\_block\_num>}}();}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::crypto\_primitives>}}();}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}{set\_activation\_handler<builtin\_protocol\_feature\_t::em\_key>}}();}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a27266ebf16b6dd19a860635f7d1f9930}{irreversible\_block}}.connect([\textcolor{keyword}{this}](\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\_state\_ptr}}\&\ bsp)\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}{wasmif}}.\mbox{\hyperlink{classsysio_1_1chain_1_1wasm__interface_ab8938ee3dc1cd9964f4d13671f0058bd}{current\_lib}}(bsp-\/>block\_num);}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \textcolor{preprocessor}{\#define\ SET\_APP\_HANDLER(\ receiver,\ contract,\ action)\ \(\backslash\)}}
\DoxyCodeLine{00339\ \textcolor{preprocessor}{\ \ \ set\_apply\_handler(\ account\_name(\#receiver),\ account\_name(\#contract),\ action\_name(\#action),\ \(\backslash\)}}
\DoxyCodeLine{00340\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&BOOST\_PP\_CAT(apply\_,\ BOOST\_PP\_CAT(contract,\ BOOST\_PP\_CAT(\_,action)\ )\ )\ )}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ newaccount\ );}
\DoxyCodeLine{00343\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ setcode\ );}
\DoxyCodeLine{00344\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ setabi\ );}
\DoxyCodeLine{00345\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ updateauth\ );}
\DoxyCodeLine{00346\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ deleteauth\ );}
\DoxyCodeLine{00347\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ linkauth\ );}
\DoxyCodeLine{00348\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ unlinkauth\ );}
\DoxyCodeLine{00349\ \textcolor{comment}{/*}}
\DoxyCodeLine{00350\ \textcolor{comment}{\ \ \ SET\_APP\_HANDLER(\ sysio,\ sysio,\ postrecovery\ );}}
\DoxyCodeLine{00351\ \textcolor{comment}{\ \ \ SET\_APP\_HANDLER(\ sysio,\ sysio,\ passrecovery\ );}}
\DoxyCodeLine{00352\ \textcolor{comment}{\ \ \ SET\_APP\_HANDLER(\ sysio,\ sysio,\ vetorecovery\ );}}
\DoxyCodeLine{00353\ \textcolor{comment}{*/}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \mbox{\hyperlink{controller_8cpp_a903c4d2c725a565b423b8c7978ba252c}{SET\_APP\_HANDLER}}(\ \mbox{\hyperlink{namespacesysio}{sysio}},\ \mbox{\hyperlink{namespacesysio}{sysio}},\ canceldelay\ );}
\DoxyCodeLine{00356\ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_af239089382ffa593908091df9d6d0cbd}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!````~controller\_impl@{\texorpdfstring{$\sim$}{\string~}controller\_impl}}
\index{````~controller\_impl@{\texorpdfstring{$\sim$}{\string~}controller\_impl}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{\texorpdfstring{$\sim$}{\string~}controller\_impl()}{\string~controller\_impl()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af239089382ffa593908091df9d6d0cbd} 
sysio\+::chain\+::controller\+\_\+impl\+::\texorpdfstring{$\sim$}{\string~}controller\+\_\+impl (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00724}{724}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}.\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool_a2cf9d662cfa57de6d29cd900f8375208}{stop}}();}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.reset();}
\DoxyCodeLine{00727\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=334pt]{structsysio_1_1chain_1_1controller__impl_af239089382ffa593908091df9d6d0cbd_cgraph}
\end{center}
\end{figure}


\doxysubsection{Member Function Documentation}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!abort\_block@{abort\_block}}
\index{abort\_block@{abort\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{abort\_block()}{abort\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126} 
\mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\+\_\+metadata\+\_\+ptr}} $>$ sysio\+::chain\+::controller\+\_\+impl\+::abort\+\_\+block (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02315}{2315}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02316\ \ \ \ \ \ \ vector<transaction\_metadata\_ptr>\ applied\_trxs;}
\DoxyCodeLine{02317\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}\ )\ \{}
\DoxyCodeLine{02318\ \ \ \ \ \ \ \ \ \ applied\_trxs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>extract\_trx\_metas();}
\DoxyCodeLine{02319\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.reset();}
\DoxyCodeLine{02320\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a5b8ed9cc5cb5822d6cb645a3b7a5f98c}{popped\_blocks\_to}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{02321\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02322\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ applied\_trxs;}
\DoxyCodeLine{02323\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!add\_contract\_tables\_to\_snapshot@{add\_contract\_tables\_to\_snapshot}}
\index{add\_contract\_tables\_to\_snapshot@{add\_contract\_tables\_to\_snapshot}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{add\_contract\_tables\_to\_snapshot()}{add\_contract\_tables\_to\_snapshot()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148} 
void sysio\+::chain\+::controller\+\_\+impl\+::add\+\_\+contract\+\_\+tables\+\_\+to\+\_\+snapshot (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a80afaa06d96e661a0f93e0ba4b09c8dc}{snapshot\+\_\+writer\+\_\+ptr}} \&}]{snapshot}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00747}{747}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00748\ \ \ \ \ \ \ snapshot-\/>write\_section(\textcolor{stringliteral}{"{}contract\_tables"{}},\ [\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\ \{}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1index__utils_a20f6cbb7f55f78ff4d35a4bf7e928a86}{index\_utils<table\_id\_multi\_index>::walk}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section](\ \textcolor{keyword}{const}\ table\_id\_object\&\ table\_row\ )\{}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ a\ row\ for\ the\ table}}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(table\_row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00752\ }
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ followed\ by\ a\ size\ row\ and\ then\ N\ data\ rows\ for\ each\ type\ of\ table}}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ contract\_database\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&section,\ \&table\_row](\ \textcolor{keyword}{auto}\ utils\ )\ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }utils\_t\ =\ \textcolor{keyword}{decltype}(utils);}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }value\_t\ =\ \textcolor{keyword}{typename}\ \textcolor{keyword}{decltype}(utils)::index\_t::value\_type;}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }by\_table\_id\ =\ \mbox{\hyperlink{namespacesysio_1_1chain_a551a62ef64d082b2bbc5a50e2b6ccaa9}{object\_to\_table\_id\_tag\_t<value\_t>}};}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tid\_key\ =\ boost::make\_tuple(table\_row.id);}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ next\_tid\_key\ =\ boost::make\_tuple(\mbox{\hyperlink{structchainbase_1_1object_a7c6a0efb95ee67d538a976cfa5be9df9}{table\_id\_object::id\_type}}(table\_row.id.\_id\ +\ 1));}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ unsigned\_int\ size\ =\ utils\_t::template\ size\_range<by\_table\_id>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ tid\_key,\ next\_tid\_key);}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(size,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00764\ }
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ utils\_t::template\ walk\_range<by\_table\_id>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ tid\_key,\ next\_tid\_key,\ [\textcolor{keyword}{this},\ \&section](\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&row\ )\ \{}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00771\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ac7dedae4e6f8bcbd20e69d1e5551e378}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!add\_indices@{add\_indices}}
\index{add\_indices@{add\_indices}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{add\_indices()}{add\_indices()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ac7dedae4e6f8bcbd20e69d1e5551e378} 
void sysio\+::chain\+::controller\+\_\+impl\+::add\+\_\+indices (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00729}{729}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ controller\_index\_set::add\_indices(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00731\ \ \ \ \ \ \ contract\_database\_index\_set::add\_indices(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a112c1fae696fe6f53103076e9afa5a16}{add\_indices}}();}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_acc5c0d662f97873d93dadbf8b6451978}{add\_indices}}();}
\DoxyCodeLine{00735\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ac7dedae4e6f8bcbd20e69d1e5551e378_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!add\_to\_snapshot@{add\_to\_snapshot}}
\index{add\_to\_snapshot@{add\_to\_snapshot}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{add\_to\_snapshot()}{add\_to\_snapshot()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795} 
void sysio\+::chain\+::controller\+\_\+impl\+::add\+\_\+to\+\_\+snapshot (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a80afaa06d96e661a0f93e0ba4b09c8dc}{snapshot\+\_\+writer\+\_\+ptr}} \&}]{snapshot}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00802}{802}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ in\ case\ the\ previous\ call\ to\ clear\ did\ not\ finish\ in\ time\ of\ deadline}}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}{clear\_expired\_input\_transactions}}(\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}()\ );}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ \ \ snapshot-\/>write\_section<chain\_snapshot\_header>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ section.add\_row(chain\_snapshot\_header(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \ \ \ \ \ \ snapshot-\/>write\_section<block\_state>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ section.template\ add\_row<block\_header\_state>(*\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00813\ }
\DoxyCodeLine{00814\ \ \ \ \ \ \ controller\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&snapshot](\ \textcolor{keyword}{auto}\ utils\ )\{}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }value\_t\ =\ \textcolor{keyword}{typename}\ \textcolor{keyword}{decltype}(utils)::index\_t::value\_type;}
\DoxyCodeLine{00816\ }
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ table\_id\_object\ as\ its\ inlined\ with\ contract\ tables\ section}}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ table\_id\_object>::value)\ \{}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ database\_header\ as\ it\ is\ only\ relevant\ to\ in-\/memory\ database}}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ database\_header\_object>::value)\ \{}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ snapshot-\/>write\_section<value\_t>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\{}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{decltype}(utils)::walk(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section](\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&row\ )\ \{}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.add\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00833\ }
\DoxyCodeLine{00834\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afb7b8a4e7c718c1262fe755aa1c2f148}{add\_contract\_tables\_to\_snapshot}}(snapshot);}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a24e23281d4ccfdddcc761c83e14a4080}{add\_to\_snapshot}}(snapshot);}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a7160417d30f5ef3a91467fefebf65dc6}{add\_to\_snapshot}}(snapshot);}
\DoxyCodeLine{00838\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!apply\_block@{apply\_block}}
\index{apply\_block@{apply\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{apply\_block()}{apply\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929} 
void sysio\+::chain\+::controller\+\_\+impl\+::apply\+\_\+block (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&}]{bsp}{, }\item[{\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}}}]{s}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\+\_\+meta\+\_\+cache\+\_\+lookup}} \&}]{trx\+\_\+lookup}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01948}{1948}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01949\ \ \ \ \{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01950\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b\ =\ bsp-\/>block;}
\DoxyCodeLine{01952\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ new\_protocol\_feature\_activations\ =\ bsp-\/>get\_new\_protocol\_feature\_activations();}
\DoxyCodeLine{01953\ }
\DoxyCodeLine{01954\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ producer\_block\_id\ =\ bsp-\/>id;}
\DoxyCodeLine{01955\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566}{start\_block}}(\ b-\/>timestamp,\ b-\/>confirmed,\ new\_protocol\_feature\_activations,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ producer\_block\_id,\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}()\ );}
\DoxyCodeLine{01956\ }
\DoxyCodeLine{01957\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ existing\_trxs\_metas\ =\ !bsp-\/>trxs\_metas().empty();}
\DoxyCodeLine{01958\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ pub\_keys\_recovered\ =\ bsp-\/>is\_pub\_keys\_recovered();}
\DoxyCodeLine{01959\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ skip\_auth\_checks\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a42a29a059b847799ae3a75953b6bff1e}{skip\_auth\_check}}();}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ \ std::vector<std::tuple<transaction\_metadata\_ptr,\ recover\_keys\_future>>\ trx\_metas;}
\DoxyCodeLine{01961\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ use\_bsp\_cached\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01962\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ pub\_keys\_recovered\ ||\ (skip\_auth\_checks\ \&\&\ existing\_trxs\_metas)\ )\ \{}
\DoxyCodeLine{01963\ \ \ \ \ \ \ \ \ \ \ \ \ use\_bsp\_cached\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01964\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01965\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.reserve(\ b-\/>transactions.size()\ );}
\DoxyCodeLine{01966\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ receipt\ :\ b-\/>transactions\ )\ \{}
\DoxyCodeLine{01967\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<packed\_transaction>(receipt.trx))\ \{}
\DoxyCodeLine{01968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pt\ =\ std::get<packed\_transaction>(receipt.trx);}
\DoxyCodeLine{01969\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\ trx\_meta\_ptr\ =\ trx\_lookup\ ?\ trx\_lookup(\ pt.id()\ )\ :\ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\{\};}
\DoxyCodeLine{01970\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx\_meta\_ptr\ \&\&\ *trx\_meta\_ptr-\/>packed\_trx()\ !=\ pt\ )\ trx\_meta\_ptr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01971\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx\_meta\_ptr\ \&\&\ (\ skip\_auth\_checks\ ||\ !trx\_meta\_ptr-\/>recovered\_keys().empty()\ )\ )\ \{}
\DoxyCodeLine{01972\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.emplace\_back(\ std::move(\ trx\_meta\_ptr\ ),\ \mbox{\hyperlink{namespacesysio_1_1chain_a036ea97f093bf3270bd2c9a097cbcaba}{recover\_keys\_future}}\{\}\ );}
\DoxyCodeLine{01973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ skip\_auth\_checks\ )\ \{}
\DoxyCodeLine{01974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a7041c0316bd294d0866609ab3e0cc7a7}{packed\_transaction\_ptr}}\ ptrx(\ b,\ \&pt\ );\ \textcolor{comment}{//\ alias\ signed\_block\_ptr}}
\DoxyCodeLine{01975\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.emplace\_back(}
\DoxyCodeLine{01976\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_acb14de2d02033c2d43c65319825d3d5b}{transaction\_metadata::create\_no\_recover\_keys}}(\ std::move(ptrx),\ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053edaa43c1b0aa53a0c908810c06ab1ff3967}{transaction\_metadata::trx\_type::input}}\ ),}
\DoxyCodeLine{01977\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a036ea97f093bf3270bd2c9a097cbcaba}{recover\_keys\_future}}\{\}\ );}
\DoxyCodeLine{01978\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a7041c0316bd294d0866609ab3e0cc7a7}{packed\_transaction\_ptr}}\ ptrx(\ b,\ \&pt\ );\ \textcolor{comment}{//\ alias\ signed\_block\_ptr}}
\DoxyCodeLine{01980\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fut\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a122861328470aa67ebf9ac5cb798755d}{transaction\_metadata::start\_recover\_keys}}(}
\DoxyCodeLine{01981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ ptrx\ ),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}.\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool_ae2f5fa4611193d13bb40e34708d897ea}{get\_executor}}(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{microseconds::maximum}}(),\ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053edaa43c1b0aa53a0c908810c06ab1ff3967}{transaction\_metadata::trx\_type::input}}\ \ );}
\DoxyCodeLine{01982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_metas.emplace\_back(\ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\{\},\ std::move(\ fut\ )\ );}
\DoxyCodeLine{01983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01985\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01986\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01987\ }
\DoxyCodeLine{01988\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace;}
\DoxyCodeLine{01989\ }
\DoxyCodeLine{01990\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ packed\_idx\ =\ 0;}
\DoxyCodeLine{01991\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ receipt\ :\ b-\/>transactions\ )\ \{}
\DoxyCodeLine{01992\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_receipts\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_pending\_trx\_receipts;}
\DoxyCodeLine{01993\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ num\_pending\_receipts\ =\ trx\_receipts.size();}
\DoxyCodeLine{01994\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ std::holds\_alternative<packed\_transaction>(receipt.trx)\ )\ \{}
\DoxyCodeLine{01995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trx\_meta\ =\ (\ use\_bsp\_cached\ ?\ bsp-\/>trxs\_metas().at(\ packed\_idx\ )}
\DoxyCodeLine{01996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ (\ !!std::get<0>(\ trx\_metas.at(\ packed\_idx\ )\ )\ ?}
\DoxyCodeLine{01997\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::get<0>(\ trx\_metas.at(\ packed\_idx\ )\ )}
\DoxyCodeLine{01998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ std::get<1>(\ trx\_metas.at(\ packed\_idx\ )\ ).get()\ )\ );}
\DoxyCodeLine{01999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}{push\_transaction}}(\ trx\_meta,\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}(),\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{fc::microseconds::maximum}}(),\ receipt.cpu\_usage\_us,\ \textcolor{keyword}{true},\ 0\ );}
\DoxyCodeLine{02000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++packed\_idx;}
\DoxyCodeLine{02001\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ std::holds\_alternative<transaction\_id\_type>(receipt.trx)\ )\ \{}
\DoxyCodeLine{02002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}{push\_scheduled\_transaction}}(\ std::get<transaction\_id\_type>(receipt.trx),\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}(),\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{fc::microseconds::maximum}}(),\ receipt.cpu\_usage\_us,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{02003\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \textcolor{keyword}{false},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}encountered\ unexpected\ receipt\ type"{}}\ );}
\DoxyCodeLine{02005\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02006\ }
\DoxyCodeLine{02007\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ transaction\_failed\ =\ \ trace\ \&\&\ trace-\/>except;}
\DoxyCodeLine{02008\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ transaction\_can\_fail\ =\ receipt.status\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55ac705728ca8b5f3a44d8026e14990c463}{transaction\_receipt\_header::hard\_fail}}\ \&\&\ std::holds\_alternative<transaction\_id\_type>(receipt.trx);}
\DoxyCodeLine{02009\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ transaction\_failed\ \&\&\ !transaction\_can\_fail)\ \{}
\DoxyCodeLine{02010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((*trace));}
\DoxyCodeLine{02011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ *trace-\/>except;}
\DoxyCodeLine{02012\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02013\ }
\DoxyCodeLine{02014\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ trx\_receipts.size()\ >\ 0,}
\DoxyCodeLine{02015\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}expected\ a\ receipt,\ block\_num\ \$\{bn\},\ block\_id\ \$\{id\},\ receipt\ \$\{e\}"{}},}
\DoxyCodeLine{02016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}bn"{}},\ b-\/>block\_num())(\textcolor{stringliteral}{"{}id"{}},\ producer\_block\_id)(\textcolor{stringliteral}{"{}e"{}},\ receipt)}
\DoxyCodeLine{02017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02018\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ trx\_receipts.size()\ ==\ num\_pending\_receipts\ +\ 1,}
\DoxyCodeLine{02019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}expected\ receipt\ was\ not\ added,\ block\_num\ \$\{bn\},\ block\_id\ \$\{id\},\ receipt\ \$\{e\}"{}},}
\DoxyCodeLine{02020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}bn"{}},\ b-\/>block\_num())(\textcolor{stringliteral}{"{}id"{}},\ producer\_block\_id)(\textcolor{stringliteral}{"{}e"{}},\ receipt)}
\DoxyCodeLine{02021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02022\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ transaction\_receipt\_header\&\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}\ =\ trx\_receipts.back();}
\DoxyCodeLine{02023\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}\ ==\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }transaction\_receipt\_header\&\textcolor{keyword}{>}(receipt),}
\DoxyCodeLine{02024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}receipt\ does\ not\ match,\ \$\{lhs\}\ !=\ \$\{rhs\}"{}},}
\DoxyCodeLine{02025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}lhs"{}},\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}})(\textcolor{stringliteral}{"{}rhs"{}},\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }transaction\_receipt\_header\&\textcolor{keyword}{>}(receipt))\ );}
\DoxyCodeLine{02026\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02027\ }
\DoxyCodeLine{02028\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ validated\ in\ create\_block\_state\_future()}}
\DoxyCodeLine{02029\ \ \ \ \ \ \ \ \ \ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_transaction\_mroot\ =\ b-\/>transaction\_mroot;}
\DoxyCodeLine{02030\ }
\DoxyCodeLine{02031\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ New:\ Process\ the\ s\_header\ from\ block\ header\ extensions}}
\DoxyCodeLine{02032\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\_header\_it\ =\ std::find\_if(b-\/>header\_extensions.begin(),\ b-\/>header\_extensions.end(),}
\DoxyCodeLine{02033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ ext)\ \{\ return\ ext.first\ ==\ s\_root\_extension::extension\_id();\ \});}
\DoxyCodeLine{02034\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s\_header\_it\ !=\ b-\/>header\_extensions.end())\ \{}
\DoxyCodeLine{02035\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Found\ s\_root\_extension\ in\ header\_extensions,\ attempting\ to\ extract..."{}});}
\DoxyCodeLine{02036\ \ \ \ \ \ \ \ \ \ \ \ \ s\_header\ extracted\_s\_header\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack<s\_header>}}(s\_header\_it-\/>second);}
\DoxyCodeLine{02037\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Extracted\ s\_header:\ \$\{s\_header\}"{}},\ (\textcolor{stringliteral}{"{}s\_header"{}},\ extracted\_s\_header.to\_string()));}
\DoxyCodeLine{02038\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a59e341a41ba27734555c54c37bacf358}{set\_s\_header}}(extracted\_s\_header);\ \textcolor{comment}{//\ Attempt\ to\ set\ s-\/header}}
\DoxyCodeLine{02039\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02040\ }
\DoxyCodeLine{02041\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192}{finalize\_block}}();}
\DoxyCodeLine{02042\ }
\DoxyCodeLine{02043\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ ab\ =\ std::get<assembled\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{02044\ }
\DoxyCodeLine{02045\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{02046\ }
\DoxyCodeLine{02047\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ producer\_block\_id\ !=\ ab.\_id\ )\ \{}
\DoxyCodeLine{02048\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}Validation\ block\ id\ does\ not\ match\ producer\ block\ id"{}}\ );}
\DoxyCodeLine{02049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973}{report\_block\_header\_diff}}(\ *b,\ *ab.\_unsigned\_block\ );}
\DoxyCodeLine{02050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ implicitly\ asserts\ that\ all\ header\ fields\ (less\ the\ signature)\ are\ identical}}
\DoxyCodeLine{02051\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ producer\_block\_id\ ==\ ab.\_id,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}Block\ ID\ does\ not\ match"{}},}
\DoxyCodeLine{02052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}producer\_block\_id"{}},\ producer\_block\_id)(\textcolor{stringliteral}{"{}validator\_block\_id"{}},\ ab.\_id)\ );}
\DoxyCodeLine{02053\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02054\ }
\DoxyCodeLine{02055\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !use\_bsp\_cached\ )\ \{}
\DoxyCodeLine{02056\ \ \ \ \ \ \ \ \ \ \ \ \ bsp-\/>set\_trxs\_metas(\ std::move(\ ab.\_trx\_metas\ ),\ !skip\_auth\_checks\ );}
\DoxyCodeLine{02057\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02058\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ create\ completed\_block\ with\ the\ existing\ block\_state\ as\ we\ just\ verified\ it\ is\ the\ same\ as\ assembled\_block}}
\DoxyCodeLine{02059\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage\ =\ completed\_block\{\ bsp\ \};}
\DoxyCodeLine{02060\ }
\DoxyCodeLine{02061\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4}{commit\_block}}(\textcolor{keyword}{false});}
\DoxyCodeLine{02062\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02063\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{02064\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{02065\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{02066\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{02067\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{02068\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}()));}
\DoxyCodeLine{02069\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\_block}}();}
\DoxyCodeLine{02070\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{02071\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{02072\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.what()));}
\DoxyCodeLine{02073\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\_block}}();}
\DoxyCodeLine{02074\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{02075\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02076\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}()\ \}\ }

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!apply\_onerror@{apply\_onerror}}
\index{apply\_onerror@{apply\_onerror}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{apply\_onerror()}{apply\_onerror()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b} 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} sysio\+::chain\+::controller\+\_\+impl\+::apply\+\_\+onerror (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction}{generated\+\_\+transaction}} \&}]{gtrx}{, }\item[{\mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}}}]{block\+\_\+deadline}{, }\item[{\mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}}}]{max\+\_\+transaction\+\_\+time}{, }\item[{\mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}}}]{start}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} \&}]{cpu\+\_\+time\+\_\+to\+\_\+bill\+\_\+us}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{billed\+\_\+cpu\+\_\+time\+\_\+us}{, }\item[{bool}]{explicit\+\_\+billed\+\_\+cpu\+\_\+time}{ = {\ttfamily false}, }\item[{bool}]{enforce\+\_\+whiteblacklist}{ = {\ttfamily true}}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01102}{1102}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01111\ \ \ \ \{}
\DoxyCodeLine{01112\ \ \ \ \ \ \ signed\_transaction\ etrx;}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \textcolor{comment}{//\ Deliver\ onerror\ action\ containing\ the\ failed\ deferred\ transaction\ directly\ back\ to\ the\ sender.}}
\DoxyCodeLine{01114\ \ \ \ \ \ \ etrx.actions.emplace\_back(\ vector<permission\_level>\{\{gtrx.sender,\ config::active\_name\}\},}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ onerror(\ gtrx.sender\_id,\ gtrx.packed\_trx.data(),\ gtrx.packed\_trx.size()\ )\ );}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa808acf858e93c567ff983ccbf8fb6d3}{is\_builtin\_activated}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cfa1e0a5b7203c3f4124dc8c1880b04e36b}{builtin\_protocol\_feature\_t::no\_duplicate\_deferred\_id}}\ )\ )\ \{}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ \ etrx.expiration\ =\ time\_point\_sec();}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \ etrx.ref\_block\_num\ =\ 0;}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ \ etrx.ref\_block\_prefix\ =\ 0;}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ etrx.expiration\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ +\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}(999'999);\ \textcolor{comment}{//\ Round\ up\ to\ nearest\ second\ to\ avoid\ appearing\ expired}}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ etrx.set\_reference\_block(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ );}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01124\ }
\DoxyCodeLine{01125\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_onerror(etrx);}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ \ \ \ \ transaction\_checktime\_timer\ trx\_timer(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}});}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \textcolor{keyword}{const}\ packed\_transaction\ trx(\ std::move(\ etrx\ )\ );}
\DoxyCodeLine{01131\ \ \ \ \ \ \ transaction\_context\ trx\_context(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}},\ trx,\ std::move(trx\_timer),\ start\ );}
\DoxyCodeLine{01132\ }
\DoxyCodeLine{01133\ \ \ \ \ \ \ trx\_context.block\_deadline\ =\ block\_deadline;}
\DoxyCodeLine{01134\ \ \ \ \ \ \ trx\_context.max\_transaction\_time\_subjective\ =\ max\_transaction\_time;}
\DoxyCodeLine{01135\ \ \ \ \ \ \ trx\_context.explicit\_billed\_cpu\_time\ =\ explicit\_billed\_cpu\_time;}
\DoxyCodeLine{01136\ \ \ \ \ \ \ trx\_context.billed\_cpu\_time\_us\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{01137\ \ \ \ \ \ \ trx\_context.enforce\_whiteblacklist\ =\ enforce\_whiteblacklist;}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace\ =\ trx\_context.trace;}
\DoxyCodeLine{01139\ }
\DoxyCodeLine{01140\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ handle\_exception\ =\ [\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ e)}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us\ =\ trx\_context.update\_billed\_cpu\_time(\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ );}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ trace-\/>error\_code\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{controller::convert\_exception\_to\_error\_code}}(\ e\ );}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \ trace-\/>except\ =\ e;}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \ trace-\/>except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \};}
\DoxyCodeLine{01147\ }
\DoxyCodeLine{01148\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \ \ \ trx\_context.init\_for\_implicit\_trx();}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \ \ \ trx\_context.published\ =\ gtrx.published;}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ \ trx\_context.execute\_action(\ trx\_context.schedule\_action(\ trx.get\_transaction().actions.back(),\ gtrx.sender,\ \textcolor{keyword}{false},\ 0,\ 0\ ),\ 0\ );}
\DoxyCodeLine{01152\ \ \ \ \ \ \ \ \ \ trx\_context.finalize();\ \textcolor{comment}{//\ Automatically\ rounds\ up\ network\ and\ CPU\ usage\ in\ trace\ and\ bills\ payers\ if\ successful}}
\DoxyCodeLine{01153\ }
\DoxyCodeLine{01154\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ restore\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\_block\_restore\_point}}();}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(\ gtrx.trx\_id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a98d0df834b74445e549f5d2123443b4e}{transaction\_receipt::soft\_fail}},}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.billed\_cpu\_time\_us,\ trace-\/>net\_usage\ );}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a219f556e23004060631ffb2baaeaff02}{fc::move\_append}}(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests,}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(trx\_context.executed\_action\_receipt\_digests)\ );}
\DoxyCodeLine{01159\ }
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \ trx\_context.squash();}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ \ restore.cancel();}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ disallowed\_transaction\_extensions\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ protocol\_feature\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ handle\_exception(e);}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ wrapper\ =\ \mbox{\hyperlink{classfc_1_1std__exception__wrapper_ae5ad64f84b1d373f5b92031566284c7c}{fc::std\_exception\_wrapper::from\_current\_exception}}(e);}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ handle\_exception(wrapper);}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01178\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!calculate\_integrity\_hash@{calculate\_integrity\_hash}}
\index{calculate\_integrity\_hash@{calculate\_integrity\_hash}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{calculate\_integrity\_hash()}{calculate\_integrity\_hash()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6} 
\mbox{\hyperlink{classfc_1_1sha256}{sha256}} sysio\+::chain\+::controller\+\_\+impl\+::calculate\+\_\+integrity\+\_\+hash (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00978}{978}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00978\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00979\ \ \ \ \ \ \ sha256::encoder\ enc;}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hash\_writer\ =\ std::make\_shared<integrity\_hash\_snapshot\_writer>(enc);}
\DoxyCodeLine{00981\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8477bef06de9c6d5f1c8a0a8cf1c8795}{add\_to\_snapshot}}(hash\_writer);}
\DoxyCodeLine{00982\ \ \ \ \ \ \ hash\_writer-\/>finalize();}
\DoxyCodeLine{00983\ }
\DoxyCodeLine{00984\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ enc.result();}
\DoxyCodeLine{00985\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!calculate\_trx\_merkle@{calculate\_trx\_merkle}}
\index{calculate\_trx\_merkle@{calculate\_trx\_merkle}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{calculate\_trx\_merkle()}{calculate\_trx\_merkle()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f} 
static \mbox{\hyperlink{namespacesysio_1_1chain_a9c3cb5131331ed8d52a589437ccfb03e}{checksum256\+\_\+type}} sysio\+::chain\+::controller\+\_\+impl\+::calculate\+\_\+trx\+\_\+merkle (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt}{transaction\+\_\+receipt}} $>$ \&}]{trxs}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02325}{2325}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02326\ \ \ \ \ \ \ vector<digest\_type>\ trx\_digests;}
\DoxyCodeLine{02327\ \ \ \ \ \ \ trx\_digests.reserve(\ trxs.size()\ );}
\DoxyCodeLine{02328\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ :\ trxs\ )}
\DoxyCodeLine{02329\ \ \ \ \ \ \ \ \ \ trx\_digests.emplace\_back(\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.digest()\ );}
\DoxyCodeLine{02330\ }
\DoxyCodeLine{02331\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_a80d7ea5476f97bf51a25149b55469c40}{merkle}}(\ move(trx\_digests)\ );}
\DoxyCodeLine{02332\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_aff9373c6d02a511984f20486e90585f5}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!check\_action\_list@{check\_action\_list}}
\index{check\_action\_list@{check\_action\_list}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{check\_action\_list()}{check\_action\_list()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_aff9373c6d02a511984f20486e90585f5} 
void sysio\+::chain\+::controller\+\_\+impl\+::check\+\_\+action\+\_\+list (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}}]{code}{, }\item[{\mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\+\_\+name}}}]{action}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02506}{2506}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02507\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a979219adeffbc78b1fe73460a8005e39}{action\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{02508\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a979219adeffbc78b1fe73460a8005e39}{action\_blacklist}}.find(\ std::make\_pair(code,\ \mbox{\hyperlink{structaction}{action}})\ )\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a979219adeffbc78b1fe73460a8005e39}{action\_blacklist}}.end(),}
\DoxyCodeLine{02509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ action\_blacklist\_exception,}
\DoxyCodeLine{02510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}action\ '\$\{code\}::\$\{action\}'\ is\ on\ the\ action\ blacklist"{}},}
\DoxyCodeLine{02511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}code"{}},\ code)(\textcolor{stringliteral}{"{}action"{}},\ \mbox{\hyperlink{structaction}{action}})}
\DoxyCodeLine{02512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02513\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02514\ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!check\_actor\_list@{check\_actor\_list}}
\index{check\_actor\_list@{check\_actor\_list}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{check\_actor\_list()}{check\_actor\_list()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1} 
void sysio\+::chain\+::controller\+\_\+impl\+::check\+\_\+actor\+\_\+list (\begin{DoxyParamCaption}\item[{const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}} $>$ \&}]{actors}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02407}{2407}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02408\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ actors.size()\ ==\ 0\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02409\ }
\DoxyCodeLine{02410\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a64ea139aa98e2d67dfed0a5c2f36eb77}{actor\_whitelist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{02411\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ throw\ if\ actors\ is\ not\ a\ subset\ of\ whitelist}}
\DoxyCodeLine{02412\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ whitelist\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a64ea139aa98e2d67dfed0a5c2f36eb77}{actor\_whitelist}};}
\DoxyCodeLine{02413\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_subset\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02414\ }
\DoxyCodeLine{02415\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ quick\ extents\ check,\ then\ brute\ force\ the\ check\ actors}}
\DoxyCodeLine{02416\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*actors.cbegin()\ >=\ *whitelist.cbegin()\ \&\&\ *actors.crbegin()\ <=\ *whitelist.crbegin()\ )\ \{}
\DoxyCodeLine{02417\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lower\_bound\ =\ whitelist.cbegin();}
\DoxyCodeLine{02418\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ actor:\ actors)\ \{}
\DoxyCodeLine{02419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lower\_bound\ =\ std::lower\_bound(lower\_bound,\ whitelist.cend(),\ actor);}
\DoxyCodeLine{02420\ }
\DoxyCodeLine{02421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ actor\ is\ not\ found,\ this\ is\ not\ a\ subset}}
\DoxyCodeLine{02422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lower\_bound\ ==\ whitelist.cend()\ ||\ *lower\_bound\ !=\ actor\ )\ \{}
\DoxyCodeLine{02423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_subset\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02426\ }
\DoxyCodeLine{02427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ actor\ was\ found,\ we\ are\ guaranteed\ that\ other\ actors\ are\ either\ not\ present\ in\ the\ whitelist}}
\DoxyCodeLine{02428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ or\ will\ be\ present\ in\ the\ range\ defined\ as\ [next\ actor,end)}}
\DoxyCodeLine{02429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lower\_bound\ =\ std::next(lower\_bound);}
\DoxyCodeLine{02430\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02431\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02432\ \ \ \ \ \ \ \ \ \ \ \ \ is\_subset\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02433\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02434\ }
\DoxyCodeLine{02435\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ helper\ lambda\ to\ lazily\ calculate\ the\ actors\ for\ error\ messaging}}
\DoxyCodeLine{02436\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ generate\_missing\_actors\ =\ [](\textcolor{keyword}{const}\ flat\_set<account\_name>\&\ actors,\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ whitelist)\ -\/>\ vector<account\_name>\ \{}
\DoxyCodeLine{02437\ \ \ \ \ \ \ \ \ \ \ \ \ vector<account\_name>\ excluded;}
\DoxyCodeLine{02438\ \ \ \ \ \ \ \ \ \ \ \ \ excluded.reserve(\ actors.size()\ );}
\DoxyCodeLine{02439\ \ \ \ \ \ \ \ \ \ \ \ \ set\_difference(\ actors.begin(),\ actors.end(),}
\DoxyCodeLine{02440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ whitelist.begin(),\ whitelist.end(),}
\DoxyCodeLine{02441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::back\_inserter(excluded)\ );}
\DoxyCodeLine{02442\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ excluded;}
\DoxyCodeLine{02443\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{02444\ }
\DoxyCodeLine{02445\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ is\_subset,\ \ actor\_whitelist\_exception,}
\DoxyCodeLine{02446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}authorizing\ actor(s)\ in\ transaction\ are\ not\ on\ the\ actor\ whitelist:\ \$\{actors\}"{}},}
\DoxyCodeLine{02447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}actors"{}},\ generate\_missing\_actors(actors,\ whitelist))}
\DoxyCodeLine{02448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02449\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5922ec305c682477fd9ef6ce74293c9d}{actor\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{02450\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ throw\ if\ actors\ intersects\ blacklist}}
\DoxyCodeLine{02451\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ blacklist\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5922ec305c682477fd9ef6ce74293c9d}{actor\_blacklist}};}
\DoxyCodeLine{02452\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ intersects\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02453\ }
\DoxyCodeLine{02454\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ quick\ extents\ check\ then\ brute\ force\ check\ actors}}
\DoxyCodeLine{02455\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ *actors.cbegin()\ <=\ *blacklist.crbegin()\ \&\&\ *actors.crbegin()\ >=\ *blacklist.cbegin()\ )\ \{}
\DoxyCodeLine{02456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lower\_bound\ =\ blacklist.cbegin();}
\DoxyCodeLine{02457\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ actor:\ actors)\ \{}
\DoxyCodeLine{02458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lower\_bound\ =\ std::lower\_bound(lower\_bound,\ blacklist.cend(),\ actor);}
\DoxyCodeLine{02459\ }
\DoxyCodeLine{02460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ lower\ bound\ in\ the\ blacklist\ is\ at\ the\ end,\ all\ other\ actors\ are\ guaranteed\ to}}
\DoxyCodeLine{02461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ not\ exist\ in\ the\ blacklist}}
\DoxyCodeLine{02462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lower\_bound\ ==\ blacklist.cend())\ \{}
\DoxyCodeLine{02463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02465\ }
\DoxyCodeLine{02466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ lower\ bound\ of\ an\ actor\ IS\ the\ actor,\ then\ we\ have\ an\ intersection}}
\DoxyCodeLine{02467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*lower\_bound\ ==\ actor)\ \{}
\DoxyCodeLine{02468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ intersects\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02471\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02472\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02473\ }
\DoxyCodeLine{02474\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ helper\ lambda\ to\ lazily\ calculate\ the\ actors\ for\ error\ messaging}}
\DoxyCodeLine{02475\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{auto}\ generate\_blacklisted\_actors\ =\ [](\textcolor{keyword}{const}\ flat\_set<account\_name>\&\ actors,\ \textcolor{keyword}{const}\ flat\_set<account\_name>\&\ \mbox{\hyperlink{spec__test__generator_8cpp_a38761dc1394ef77d1a39dd282d9e64f5}{blacklist}})\ -\/>\ vector<account\_name>\ \{}
\DoxyCodeLine{02476\ \ \ \ \ \ \ \ \ \ \ \ \ vector<account\_name>\ blacklisted;}
\DoxyCodeLine{02477\ \ \ \ \ \ \ \ \ \ \ \ \ blacklisted.reserve(\ actors.size()\ );}
\DoxyCodeLine{02478\ \ \ \ \ \ \ \ \ \ \ \ \ set\_intersection(\ actors.begin(),\ actors.end(),}
\DoxyCodeLine{02479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ blacklist.begin(),\ blacklist.end(),}
\DoxyCodeLine{02480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::back\_inserter(blacklisted)}
\DoxyCodeLine{02481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02482\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ blacklisted;}
\DoxyCodeLine{02483\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{02484\ }
\DoxyCodeLine{02485\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !intersects,\ actor\_blacklist\_exception,}
\DoxyCodeLine{02486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}authorizing\ actor(s)\ in\ transaction\ are\ on\ the\ actor\ blacklist:\ \$\{actors\}"{}},}
\DoxyCodeLine{02487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}actors"{}},\ generate\_blacklisted\_actors(actors,\ blacklist))}
\DoxyCodeLine{02488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02489\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02490\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a16289260be252f6ebbd80763f657fb38}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!check\_contract\_list@{check\_contract\_list}}
\index{check\_contract\_list@{check\_contract\_list}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{check\_contract\_list()}{check\_contract\_list()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a16289260be252f6ebbd80763f657fb38} 
void sysio\+::chain\+::controller\+\_\+impl\+::check\+\_\+contract\+\_\+list (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}}]{code}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02492}{2492}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02493\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a0c34416a36f48ede90d9701b986d3487}{contract\_whitelist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{02494\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a0c34416a36f48ede90d9701b986d3487}{contract\_whitelist}}.find(\ code\ )\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a0c34416a36f48ede90d9701b986d3487}{contract\_whitelist}}.end(),}
\DoxyCodeLine{02495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ contract\_whitelist\_exception,}
\DoxyCodeLine{02496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}account\ '\$\{code\}'\ is\ not\ on\ the\ contract\ whitelist"{}},\ (\textcolor{stringliteral}{"{}code"{}},\ code)}
\DoxyCodeLine{02497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02498\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a71961d4eb70d927b9d0003f6255db95f}{contract\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{02499\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a71961d4eb70d927b9d0003f6255db95f}{contract\_blacklist}}.find(\ code\ )\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a71961d4eb70d927b9d0003f6255db95f}{contract\_blacklist}}.end(),}
\DoxyCodeLine{02500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ contract\_blacklist\_exception,}
\DoxyCodeLine{02501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}account\ '\$\{code\}'\ is\ on\ the\ contract\ blacklist"{}},\ (\textcolor{stringliteral}{"{}code"{}},\ code)}
\DoxyCodeLine{02502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02503\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02504\ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ad83ca3895f901f87cbf1060493698f55}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!check\_key\_list@{check\_key\_list}}
\index{check\_key\_list@{check\_key\_list}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{check\_key\_list()}{check\_key\_list()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ad83ca3895f901f87cbf1060493698f55} 
void sysio\+::chain\+::controller\+\_\+impl\+::check\+\_\+key\+\_\+list (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a0628a11f388cd2e43b1ccc1260a1042f}{public\+\_\+key\+\_\+type}} \&}]{key}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02516}{2516}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02517\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_ae36a724cde28ee8bc40c6b73206f8a61}{key\_blacklist}}.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{02518\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_ae36a724cde28ee8bc40c6b73206f8a61}{key\_blacklist}}.find(\ key\ )\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_ae36a724cde28ee8bc40c6b73206f8a61}{key\_blacklist}}.end(),}
\DoxyCodeLine{02519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\_blacklist\_exception,}
\DoxyCodeLine{02520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}public\ key\ '\$\{key\}'\ is\ on\ the\ key\ blacklist"{}},}
\DoxyCodeLine{02521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}key"{}},\ key)}
\DoxyCodeLine{02522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02523\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02524\ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!check\_protocol\_features@{check\_protocol\_features}}
\index{check\_protocol\_features@{check\_protocol\_features}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{check\_protocol\_features()}{check\_protocol\_features()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60} 
void sysio\+::chain\+::controller\+\_\+impl\+::check\+\_\+protocol\+\_\+features (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}}}]{timestamp}{, }\item[{const flat\+\_\+set$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&}]{currently\+\_\+activated\+\_\+protocol\+\_\+features}{, }\item[{const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&}]{new\+\_\+protocol\+\_\+features}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

This method is called from other threads. The \doxylink{structsysio_1_1chain_1_1controller__impl}{controller\+\_\+impl} should outlive those threads. However, to avoid race conditions, it means that the behavior of this function should not change after \doxylink{structsysio_1_1chain_1_1controller__impl}{controller\+\_\+impl} construction.

This should not be an issue since the purpose of this function is to ensure all of the protocol features in the supplied vector are recognized by the software, and the set of recognized protocol features is determined at startup and cannot be changed without a restart. 

Definition at line \mbox{\hyperlink{controller_8cpp_source_l01875}{1875}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01878\ \ \ \ \{}
\DoxyCodeLine{01879\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pfs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}();}
\DoxyCodeLine{01880\ }
\DoxyCodeLine{01881\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ itr\ =\ new\_protocol\_features.begin();\ itr\ !=\ new\_protocol\_features.end();\ ++itr\ )\ \{}
\DoxyCodeLine{01882\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ =\ *itr;}
\DoxyCodeLine{01883\ }
\DoxyCodeLine{01884\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ status\ =\ pfs.is\_recognized(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}},\ timestamp\ );}
\DoxyCodeLine{01885\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}(\ status\ )\ \{}
\DoxyCodeLine{01886\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a96d8e9e3b92248258403f7fc4cb25644}{protocol\_feature\_set::recognized\_t::unrecognized}}:}
\DoxyCodeLine{01887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,}
\DoxyCodeLine{01888\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ unrecognized"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})\ );}
\DoxyCodeLine{01889\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01890\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a075ae3d2fc31640504f814f60e5ef713}{protocol\_feature\_set::recognized\_t::disabled}}:}
\DoxyCodeLine{01891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,}
\DoxyCodeLine{01892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ is\ disabled"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})\ );}
\DoxyCodeLine{01893\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01894\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427a5d203566b82250f4113257b6db12e488}{protocol\_feature\_set::recognized\_t::too\_early}}:}
\DoxyCodeLine{01895\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,}
\DoxyCodeLine{01896\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\$\{timestamp\}\ is\ too\ early\ for\ the\ earliest\ allowed\ activation\ time\ of\ the\ protocol\ feature\ with\ digest\ '\$\{digest\}'"{}},\ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})(\textcolor{stringliteral}{"{}timestamp"{}},\ timestamp)\ );}
\DoxyCodeLine{01897\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01898\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__set_a1d6d013242864bc12ae2a1f6fcc95427ab2fdab230a2c39f3595a947861863cb7}{protocol\_feature\_set::recognized\_t::ready}}:}
\DoxyCodeLine{01899\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01900\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(\ protocol\_feature\_exception,\ \textcolor{stringliteral}{"{}unexpected\ recognized\_t\ status"{}}\ );}
\DoxyCodeLine{01902\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01903\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01904\ }
\DoxyCodeLine{01905\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ currently\_activated\_protocol\_features.find(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ ==\ currently\_activated\_protocol\_features.end(),}
\DoxyCodeLine{01906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ protocol\_feature\_exception,}
\DoxyCodeLine{01907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}protocol\ feature\ with\ digest\ '\$\{digest\}'\ has\ already\ been\ activated"{}},}
\DoxyCodeLine{01908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})}
\DoxyCodeLine{01909\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{01910\ }
\DoxyCodeLine{01911\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ dependency\_checker\ =\ [\&currently\_activated\_protocol\_features,\ \&new\_protocol\_features,\ \&itr]}
\DoxyCodeLine{01912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\_type}}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ -\/>\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{01913\ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01914\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ currently\_activated\_protocol\_features.find(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ !=\ currently\_activated\_protocol\_features.end()\ )}
\DoxyCodeLine{01915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01916\ }
\DoxyCodeLine{01917\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (std::find(\ new\_protocol\_features.begin(),\ itr,\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ )\ !=\ itr);}
\DoxyCodeLine{01918\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{01919\ }
\DoxyCodeLine{01920\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ pfs.validate\_dependencies(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}},\ dependency\_checker\ ),\ protocol\_feature\_exception,}
\DoxyCodeLine{01921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}not\ all\ dependencies\ of\ protocol\ feature\ with\ digest\ '\$\{digest\}'\ have\ been\ activated"{}},}
\DoxyCodeLine{01922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})}
\DoxyCodeLine{01923\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{01924\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01925\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ae66494cb9657c0157ee468c21b545f60_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ade7505662796ff416f1d43862b0507fb}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!clear\_all\_undo@{clear\_all\_undo}}
\index{clear\_all\_undo@{clear\_all\_undo}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{clear\_all\_undo()}{clear\_all\_undo()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ade7505662796ff416f1d43862b0507fb} 
void sysio\+::chain\+::controller\+\_\+impl\+::clear\+\_\+all\+\_\+undo (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00737}{737}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \textcolor{comment}{//\ Rewind\ the\ database\ to\ the\ last\ irreversible\ block}}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a832c383b7d8573d399e6149d4c715bd6}{undo\_all}}();}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00741\ \textcolor{comment}{\ \ \ \ \ \ FC\_ASSERT(db.revision()\ ==\ self.head\_block\_num(),}}
\DoxyCodeLine{00742\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}Chainbase\ revision\ does\ not\ match\ head\ block\ num"{},}}
\DoxyCodeLine{00743\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ("{}rev"{},\ db.revision())("{}head\_block"{},\ self.head\_block\_num()));}}
\DoxyCodeLine{00744\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00745\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=336pt]{structsysio_1_1chain_1_1controller__impl_ade7505662796ff416f1d43862b0507fb_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!clear\_expired\_input\_transactions@{clear\_expired\_input\_transactions}}
\index{clear\_expired\_input\_transactions@{clear\_expired\_input\_transactions}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{clear\_expired\_input\_transactions()}{clear\_expired\_input\_transactions()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e} 
void sysio\+::chain\+::controller\+\_\+impl\+::clear\+\_\+expired\+\_\+input\+\_\+transactions (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} \&}]{deadline}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02379}{2379}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02380\ \ \ \ \ \ \ \textcolor{comment}{//Look\ for\ expired\ transactions\ in\ the\ deduplication\ list,\ and\ remove\ them.}}
\DoxyCodeLine{02381\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ transaction\_idx\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afaea057692a8bbbf3f506b64c60308b6}{get\_mutable\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a7ae1398893dd587589ee5593a952a2ef}{transaction\_multi\_index}}>();}
\DoxyCodeLine{02382\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ dedupe\_index\ =\ transaction\_idx.indices().get<by\_expiration>();}
\DoxyCodeLine{02383\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ now\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a286751cd6498b500b70a0d3678672263}{is\_building\_block}}()\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aea3612e7cb52dfcaa2e6afdc1b3e2f51}{head\_block\_time}}();}
\DoxyCodeLine{02384\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ total\ =\ dedupe\_index.size();}
\DoxyCodeLine{02385\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ num\_removed\ =\ 0;}
\DoxyCodeLine{02386\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ (!dedupe\_index.empty())\ \&\&\ (\ now\ >\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}(dedupe\_index.begin()-\/>expiration)\ )\ )\ \{}
\DoxyCodeLine{02387\ \ \ \ \ \ \ \ \ \ transaction\_idx.remove(*dedupe\_index.begin());}
\DoxyCodeLine{02388\ \ \ \ \ \ \ \ \ \ ++num\_removed;}
\DoxyCodeLine{02389\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ deadline\ <=\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ )\ \{}
\DoxyCodeLine{02390\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02391\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02392\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02393\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a3da1571bad6ca6c94df9a3660b2115ee}{dlog}}(\textcolor{stringliteral}{"{}removed\ \$\{n\}\ expired\ transactions\ of\ the\ \$\{t\}\ input\ dedup\ list,\ pending\ block\ time\ \$\{pt\}"{}},}
\DoxyCodeLine{02394\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}n"{}},\ num\_removed)(\textcolor{stringliteral}{"{}t"{}},\ total)(\textcolor{stringliteral}{"{}pt"{}},\ now));}
\DoxyCodeLine{02395\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!commit\_block@{commit\_block}}
\index{commit\_block@{commit\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{commit\_block()}{commit\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4} 
void sysio\+::chain\+::controller\+\_\+impl\+::commit\+\_\+block (\begin{DoxyParamCaption}\item[{bool}]{add\+\_\+to\+\_\+fork\+\_\+db}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\begin{DoxyPostcond}{Postcondition}
regardless of the success of commit block there is no active pending block 
\end{DoxyPostcond}


Definition at line \mbox{\hyperlink{controller_8cpp_source_l01827}{1827}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01828\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_pending\_on\_exit\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([\textcolor{keyword}{this}]\{}
\DoxyCodeLine{01829\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.reset();}
\DoxyCodeLine{01830\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01831\ }
\DoxyCodeLine{01832\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01833\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ std::holds\_alternative<completed\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage),\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{01834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cannot\ call\ commit\_block\ until\ pending\ block\ is\ completed"{}}\ );}
\DoxyCodeLine{01835\ }
\DoxyCodeLine{01836\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ std::get<completed\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_block\_state;}
\DoxyCodeLine{01837\ }
\DoxyCodeLine{01838\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ add\_to\_fork\_db\ )\ \{}
\DoxyCodeLine{01839\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a97cf1402b71020048ae0054e4d7c8079}{add}}(\ bsp\ );}
\DoxyCodeLine{01840\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ bsp\ );}
\DoxyCodeLine{01841\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0a0659166483870bf065f4d5e671484e}{accepted\_block\_header}},\ bsp\ );}
\DoxyCodeLine{01842\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}();}
\DoxyCodeLine{01843\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ bsp\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}committed\ block\ did\ not\ become\ the\ new\ head\ in\ fork\ database"{}});}
\DoxyCodeLine{01844\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01845\ }
\DoxyCodeLine{01846\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{01847\ \ \ \ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_accepted\_block(bsp);}
\DoxyCodeLine{01848\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01849\ }
\DoxyCodeLine{01850\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1ff3607461fff45552db45cec5aca012}{accepted\_block}},\ bsp\ );}
\DoxyCodeLine{01851\ }
\DoxyCodeLine{01852\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ add\_to\_fork\_db\ )\ \{}
\DoxyCodeLine{01853\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\_irreversible}}();}
\DoxyCodeLine{01854\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01855\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (...)\ \{}
\DoxyCodeLine{01856\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ dont\ bother\ resetting\ pending,\ instead\ abort\ the\ block}}
\DoxyCodeLine{01857\ \ \ \ \ \ \ \ \ \ reset\_pending\_on\_exit.cancel();}
\DoxyCodeLine{01858\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aed82882c38a7b9a2ab8ccf26b7d68126}{abort\_block}}();}
\DoxyCodeLine{01859\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01860\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01861\ }
\DoxyCodeLine{01862\ \ \ \ \ \ \ \textcolor{comment}{//\ push\ the\ state\ for\ pending.}}
\DoxyCodeLine{01863\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>push();}
\DoxyCodeLine{01864\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_abde6bacce9f720ad552d0e342c52d3b4_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ad5c91b7cff820c07efed35a7b3912d68}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!create\_block\_state@{create\_block\_state}}
\index{create\_block\_state@{create\_block\_state}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{create\_block\_state()}{create\_block\_state()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ad5c91b7cff820c07efed35a7b3912d68} 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} sysio\+::chain\+::controller\+\_\+impl\+::create\+\_\+block\+\_\+state (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&}]{b}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02119}{2119}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02120\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}null\ block"{}}\ );}
\DoxyCodeLine{02121\ }
\DoxyCodeLine{02122\ \ \ \ \ \ \ \textcolor{comment}{//\ no\ reason\ for\ a\ block\_state\ if\ fork\_db\ already\ knows\ about\ block}}
\DoxyCodeLine{02123\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ existing\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_aee9daa00e2698a868ad36853e58d3908}{get\_block}}(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{02124\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !existing,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}we\ already\ know\ about\ this\ block:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ \textcolor{keywordtype}{id})\ );}
\DoxyCodeLine{02125\ }
\DoxyCodeLine{02126\ \ \ \ \ \ \ \textcolor{comment}{//\ previous\ not\ found\ could\ mean\ that\ previous\ block\ not\ applied\ yet}}
\DoxyCodeLine{02127\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ prev\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a681f9146e0afd70a0e8c0421efb0a41f}{get\_block\_header}}(\ b-\/>previous\ );}
\DoxyCodeLine{02128\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !prev\ )\ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{02129\ }
\DoxyCodeLine{02130\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8}{create\_block\_state\_i}}(\ \textcolor{keywordtype}{id},\ b,\ *prev\ );}
\DoxyCodeLine{02131\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ad5c91b7cff820c07efed35a7b3912d68_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_af1df7b3285411e4e9ae6781353ad4d80}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!create\_block\_state\_future@{create\_block\_state\_future}}
\index{create\_block\_state\_future@{create\_block\_state\_future}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{create\_block\_state\_future()}{create\_block\_state\_future()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af1df7b3285411e4e9ae6781353ad4d80} 
std\+::future$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} $>$ sysio\+::chain\+::controller\+\_\+impl\+::create\+\_\+block\+\_\+state\+\_\+future (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&}]{b}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02102}{2102}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02103\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}null\ block"{}}\ );}
\DoxyCodeLine{02104\ }
\DoxyCodeLine{02105\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_a7c89dacf49f9737b2395006400c5a26c}{async\_thread\_pool}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}{thread\_pool}}.\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool_ae2f5fa4611193d13bb40e34708d897ea}{get\_executor}}(),\ [b,\ \textcolor{keywordtype}{id},\ control=\textcolor{keyword}{this}]()\ \{}
\DoxyCodeLine{02106\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ no\ reason\ for\ a\ block\_state\ if\ fork\_db\ already\ knows\ about\ block}}
\DoxyCodeLine{02107\ \ \ \ \ \ \ \ \ \ auto\ existing\ =\ control-\/>fork\_db.get\_block(\ id\ );}
\DoxyCodeLine{02108\ \ \ \ \ \ \ \ \ \ SYS\_ASSERT(\ !existing,\ fork\_database\_exception,\ \textcolor{stringliteral}{"{}we\ already\ know\ about\ this\ block:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ id)\ );}
\DoxyCodeLine{02109\ }
\DoxyCodeLine{02110\ \ \ \ \ \ \ \ \ \ auto\ prev\ =\ control-\/>fork\_db.get\_block\_header(\ b-\/>previous\ );}
\DoxyCodeLine{02111\ \ \ \ \ \ \ \ \ \ SYS\_ASSERT(\ prev,\ unlinkable\_block\_exception,}
\DoxyCodeLine{02112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}unlinkable\ block\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ id)(\textcolor{stringliteral}{"{}previous"{}},\ b-\/>previous)\ );}
\DoxyCodeLine{02113\ }
\DoxyCodeLine{02114\ \ \ \ \ \ \ \ \ \ return\ control-\/>create\_block\_state\_i(\ id,\ b,\ *prev\ );}
\DoxyCodeLine{02115\ \ \ \ \ \ \ \}\ );}
\DoxyCodeLine{02116\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_af1df7b3285411e4e9ae6781353ad4d80_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!create\_block\_state\_i@{create\_block\_state\_i}}
\index{create\_block\_state\_i@{create\_block\_state\_i}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{create\_block\_state\_i()}{create\_block\_state\_i()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8} 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} sysio\+::chain\+::controller\+\_\+impl\+::create\+\_\+block\+\_\+state\+\_\+i (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&}]{b}{, }\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header__state}{block\+\_\+header\+\_\+state}} \&}]{prev}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02080}{2080}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02081\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ trx\_mroot\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}{calculate\_trx\_merkle}}(\ b-\/>transactions\ );}
\DoxyCodeLine{02082\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b-\/>transaction\_mroot\ ==\ trx\_mroot,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{02083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}invalid\ block\ transaction\ merkle\ root\ \$\{b\}\ !=\ \$\{c\}"{}},\ (\textcolor{stringliteral}{"{}b"{}},\ b-\/>transaction\_mroot)(\textcolor{stringliteral}{"{}c"{}},\ trx\_mroot)\ );}
\DoxyCodeLine{02084\ }
\DoxyCodeLine{02085\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ skip\_validate\_signee\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02086\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ std::make\_shared<block\_state>(}
\DoxyCodeLine{02087\ \ \ \ \ \ \ \ \ \ \ \ \ prev,}
\DoxyCodeLine{02088\ \ \ \ \ \ \ \ \ \ \ \ \ b,}
\DoxyCodeLine{02089\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}(),}
\DoxyCodeLine{02090\ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\ \mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{02091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{02092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ vector<digest\_type>\&\ new\_features\ )}
\DoxyCodeLine{02093\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ check\_protocol\_features(\ timestamp,\ cur\_features,\ new\_features\ );\ \},}
\DoxyCodeLine{02094\ \ \ \ \ \ \ \ \ \ \ \ \ skip\_validate\_signee}
\DoxyCodeLine{02095\ \ \ \ \ \ \ );}
\DoxyCodeLine{02096\ }
\DoxyCodeLine{02097\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \textcolor{keywordtype}{id}\ ==\ bsp-\/>id,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{02098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}provided\ id\ \$\{id\}\ does\ not\ match\ block\ id\ \$\{bid\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ \textcolor{keywordtype}{id})(\textcolor{stringliteral}{"{}bid"{}},\ bsp-\/>id)\ );}
\DoxyCodeLine{02099\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ bsp;}
\DoxyCodeLine{02100\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a2eee00b79604bc3dfa0a93f397a2d4d8_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!create\_block\_summary@{create\_block\_summary}}
\index{create\_block\_summary@{create\_block\_summary}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{create\_block\_summary()}{create\_block\_summary()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84} 
void sysio\+::chain\+::controller\+\_\+impl\+::create\+\_\+block\+\_\+summary (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} \&}]{id}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02370}{2370}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02371\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{block\_header::num\_from\_id}}(\textcolor{keywordtype}{id});}
\DoxyCodeLine{02372\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ sid\ =\ block\_num\ \&\ 0xffff;}
\DoxyCodeLine{02373\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<block\_summary\_object,by\_id>(sid),\ [\&](block\_summary\_object\&\ bso\ )\ \{}
\DoxyCodeLine{02374\ \ \ \ \ \ \ \ \ \ \ bso.block\_id\ =\ id;}
\DoxyCodeLine{02375\ \ \ \ \ \ \ \});}
\DoxyCodeLine{02376\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!create\_native\_account@{create\_native\_account}}
\index{create\_native\_account@{create\_native\_account}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{create\_native\_account()}{create\_native\_account()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23} 
void sysio\+::chain\+::controller\+\_\+impl\+::create\+\_\+native\+\_\+account (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} \&}]{initial\+\_\+timestamp}{, }\item[{\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}}]{name}{, }\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}} \&}]{owner}{, }\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1authority}{authority}} \&}]{active}{, }\item[{bool}]{is\+\_\+privileged}{ = {\ttfamily false}}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00987}{987}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00988\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<account\_object>([\&](\textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}})\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.name\ =\ \mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}};}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.creation\_date\ =\ initial\_timestamp;}
\DoxyCodeLine{00991\ }
\DoxyCodeLine{00992\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}}\ ==\ config::system\_account\_name\ )\ \{}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ initial\ sysio\ ABI\ value\ affects\ consensus;\ see\ \ https://github.com/SYSIO/eos/issues/7794}}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ This\ doesn't\ charge\ RAM;\ a\ fix\ requires\ a\ consensus\ upgrade.}}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.abi.assign(\mbox{\hyperlink{namespacesysio_1_1chain_aa290df66096212c62e680f2c839ec925}{sysio\_abi\_bin}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespacesysio_1_1chain_aa290df66096212c62e680f2c839ec925}{sysio\_abi\_bin}}));}
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<account\_metadata\_object>([\&](\textcolor{keyword}{auto}\ \&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}})\ \{}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.name\ =\ \mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}};}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.set\_privileged(\ is\_privileged\ );}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ owner\_permission\ \ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}},\ config::owner\_name,\ 0,}
\DoxyCodeLine{01004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ owner,\ initial\_timestamp\ );}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ active\_permission\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}},\ config::active\_name,\ owner\_permission.id,}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active,\ initial\_timestamp\ );}
\DoxyCodeLine{01007\ }
\DoxyCodeLine{01008\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a30cd4db6f08948e05aba424431ec0605}{initialize\_account}}(\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}});}
\DoxyCodeLine{01009\ }
\DoxyCodeLine{01010\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ ram\_delta\ =\ config::overhead\_per\_account\_ram\_bytes;}
\DoxyCodeLine{01011\ \ \ \ \ \ \ ram\_delta\ +=\ 2*\mbox{\hyperlink{namespacesysio_1_1chain_1_1config_a2772c77657b1f6fda680bbe8f7282d13}{config::billable\_size\_v<permission\_object>}};}
\DoxyCodeLine{01012\ \ \ \ \ \ \ ram\_delta\ +=\ owner\_permission.auth.get\_billable\_size();}
\DoxyCodeLine{01013\ \ \ \ \ \ \ ram\_delta\ +=\ active\_permission.auth.get\_billable\_size();}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01015\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_ram\_trace(\mbox{\hyperlink{deep__mind_8hpp_aaaa2f1dbd522de03ccbaa73f01db5f50}{RAM\_EVENT\_ID}}(\textcolor{stringliteral}{"{}\$\{name\}"{}},\ (\textcolor{stringliteral}{"{}name"{}},\ \mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}})),\ \textcolor{stringliteral}{"{}account"{}},\ \textcolor{stringliteral}{"{}add"{}},\ \textcolor{stringliteral}{"{}newaccount"{}});}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01018\ }
\DoxyCodeLine{01019\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a7fea1de6a3806590de0bda86e53c7995}{add\_pending\_ram\_usage}}(\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}},\ ram\_delta);}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_af72734af83f353fae77fbf837776db10}{verify\_account\_ram\_usage}}(\mbox{\hyperlink{catch__reporter__console_8cpp_a9b45b3e13bd9167aab02e17e08916231}{name}});}
\DoxyCodeLine{01021\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!dmlog\_applied\_transaction@{dmlog\_applied\_transaction}}
\index{dmlog\_applied\_transaction@{dmlog\_applied\_transaction}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{dmlog\_applied\_transaction()}{dmlog\_applied\_transaction()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9} 
void sysio\+::chain\+::controller\+\_\+impl\+::dmlog\+\_\+applied\+\_\+transaction (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} \&}]{t}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00389}{389}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_applied\_transaction(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}()\ +\ 1,\ t);}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a8618218d7168450c383cde9860d57706}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!earliest\_available\_block\_num@{earliest\_available\_block\_num}}
\index{earliest\_available\_block\_num@{earliest\_available\_block\_num}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{earliest\_available\_block\_num()}{earliest\_available\_block\_num()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a8618218d7168450c383cde9860d57706} 
\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} sysio\+::chain\+::controller\+\_\+impl\+::earliest\+\_\+available\+\_\+block\+\_\+num (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02576}{2576}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02577\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ !=\ 0)\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num;}
\DoxyCodeLine{02578\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=345pt]{structsysio_1_1chain_1_1controller__impl_a8618218d7168450c383cde9860d57706_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!emit@{emit}}
\index{emit@{emit}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{emit()}{emit()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0} 
template$<$typename Signal , typename Arg $>$ \\
void sysio\+::chain\+::controller\+\_\+impl\+::emit (\begin{DoxyParamCaption}\item[{const Signal \&}]{s}{, }\item[{Arg \&\&}]{a}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Plugins / observers listening to signals emited (such as accepted\+\_\+transaction) might trigger errors and throw exceptions. Unless those exceptions are caught it could impact consensus and/or cause a node to fork.

If it is ever desirable to let a signal handler bubble an exception out of this method a full audit of its uses needs to be undertaken. 

Definition at line \mbox{\hyperlink{controller_8cpp_source_l00368}{368}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}(\ std::forward<Arg>(\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ ));}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (std::bad\_alloc\&\ e)\ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}std::bad\_alloc:\ \$\{w\}"{}},\ (\textcolor{stringliteral}{"{}w"{}},\ e.what())\ );}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ e;}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (boost::interprocess::bad\_alloc\&\ e)\ \{}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}boost::interprocess::bad\ alloc:\ \$\{w\}"{}},\ (\textcolor{stringliteral}{"{}w"{}},\ e.what())\ );}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ e;}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ controller\_emit\_signal\_exception\&\ e\ )\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}controller\_emit\_signal\_exception:\ \$\{details\}"{}},\ (\textcolor{stringliteral}{"{}details"{}},\ e.to\_detail\_string())\ );}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ e;}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}fc::exception:\ \$\{details\}"{}},\ (\textcolor{stringliteral}{"{}details"{}},\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}())\ );}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}std::exception:\ \$\{details\}"{}},\ (\textcolor{stringliteral}{"{}details"{}},\ e.what())\ );}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ ...\ )\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}signal\ handler\ threw\ exception"{}}\ );}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00387\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!extract\_legacy\_genesis\_state@{extract\_legacy\_genesis\_state}}
\index{extract\_legacy\_genesis\_state@{extract\_legacy\_genesis\_state}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{extract\_legacy\_genesis\_state()}{extract\_legacy\_genesis\_state()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47} 
static std\+::optional$<$ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} $>$ sysio\+::chain\+::controller\+\_\+impl\+::extract\+\_\+legacy\+\_\+genesis\+\_\+state (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classsysio_1_1chain_1_1snapshot__reader}{snapshot\+\_\+reader}} \&}]{snapshot}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{version}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00840}{840}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00841\ \ \ \ \ \ \ std::optional<genesis\_state>\ genesis;}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \textcolor{keyword}{using\ }v2\ =\ legacy::snapshot\_global\_property\_object\_v2;}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(version,\ v2::minimum\_version,\ v2::maximum\_version)\ ==\ version\ )\ \{}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \ genesis.emplace();}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \ snapshot.read\_section<genesis\_state>([\&genesis=*genesis](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(genesis);}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ genesis;}
\DoxyCodeLine{00851\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!failure\_is\_subjective@{failure\_is\_subjective}}
\index{failure\_is\_subjective@{failure\_is\_subjective}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{failure\_is\_subjective()}{failure\_is\_subjective()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6} 
bool sysio\+::chain\+::controller\+\_\+impl\+::failure\+\_\+is\+\_\+subjective (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classfc_1_1exception}{fc\+::exception}} \&}]{e}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01193}{1193}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ code\ =\ e.\mbox{\hyperlink{classfc_1_1exception_a79a36225cde10dcd23057bbe19d3390f}{code}}();}
\DoxyCodeLine{01195\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ \ \ (code\ ==\ subjective\_block\_production\_exception::code\_value)}
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ block\_net\_usage\_exceeded::code\_value)}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ greylist\_net\_usage\_exceeded::code\_value)}
\DoxyCodeLine{01198\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ block\_cpu\_usage\_exceeded::code\_value)}
\DoxyCodeLine{01199\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ greylist\_cpu\_usage\_exceeded::code\_value)}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ deadline\_exception::code\_value)}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ leeway\_deadline\_exception::code\_value)}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ actor\_whitelist\_exception::code\_value)}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ actor\_blacklist\_exception::code\_value)}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ contract\_whitelist\_exception::code\_value)}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ contract\_blacklist\_exception::code\_value)}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ action\_blacklist\_exception::code\_value)}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ key\_blacklist\_exception::code\_value)}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ sig\_variable\_size\_limit\_exception::code\_value)}
\DoxyCodeLine{01209\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ (code\ ==\ inline\_action\_too\_big\_nonprivileged::code\_value);}
\DoxyCodeLine{01210\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=349pt]{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!finalize\_block@{finalize\_block}}
\index{finalize\_block@{finalize\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{finalize\_block()}{finalize\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192} 
void sysio\+::chain\+::controller\+\_\+impl\+::finalize\+\_\+block (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01759}{1759}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01760\ \ \ \ \{}
\DoxyCodeLine{01761\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}it\ is\ not\ valid\ to\ finalize\ when\ there\ is\ no\ pending\ block"{}});}
\DoxyCodeLine{01762\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ std::holds\_alternative<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage),\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}already\ called\ finalize\_block"{}});}
\DoxyCodeLine{01763\ }
\DoxyCodeLine{01764\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01765\ }
\DoxyCodeLine{01766\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ pbhs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>get\_pending\_block\_header\_state();}
\DoxyCodeLine{01767\ }
\DoxyCodeLine{01768\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ resource\ limits:}}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a983919d376e5757bceee573e52b3c571}{process\_account\_limit\_updates}}();}
\DoxyCodeLine{01770\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacesysio_1_1chain_a99c6aa941a16bc629e8051a0a656dea7}{chain\_config}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{get\_global\_properties}}().\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object_a7f149fcf87034217c899838eb4430496}{configuration}};}
\DoxyCodeLine{01771\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ CPU\_TARGET\ =\ \mbox{\hyperlink{chain_2include_2sysio_2chain_2config_8hpp_a0b4bacb63f31764f50a185f320551fbc}{SYS\_PERCENT}}(\mbox{\hyperlink{namespacesysio_1_1chain_a99c6aa941a16bc629e8051a0a656dea7}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a292759d9e893bccf78a5d22279fb5752}{max\_block\_cpu\_usage}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a99c6aa941a16bc629e8051a0a656dea7}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_af2b14c2153bc64969ca85c8df8fbb7f9}{target\_block\_cpu\_usage\_pct}});}
\DoxyCodeLine{01772\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a4396d0acb70ebbd8054b13ff4c564e20}{set\_block\_parameters}}(}
\DoxyCodeLine{01773\ \ \ \ \ \ \ \ \ \ \{\ CPU\_TARGET,\ \mbox{\hyperlink{namespacesysio_1_1chain_a99c6aa941a16bc629e8051a0a656dea7}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a292759d9e893bccf78a5d22279fb5752}{max\_block\_cpu\_usage}},\ config::block\_cpu\_usage\_average\_window\_ms\ /\ config::block\_interval\_ms,\ config::maximum\_elastic\_resource\_multiplier,\ \{99,\ 100\},\ \{1000,\ 999\}\},}
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \ \{\mbox{\hyperlink{chain_2include_2sysio_2chain_2config_8hpp_a0b4bacb63f31764f50a185f320551fbc}{SYS\_PERCENT}}(\mbox{\hyperlink{namespacesysio_1_1chain_a99c6aa941a16bc629e8051a0a656dea7}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a796dada63527fcff40f838efc42a04ec}{max\_block\_net\_usage}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a99c6aa941a16bc629e8051a0a656dea7}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a216d150c1c6ad9ea64aaf82d86926d19}{target\_block\_net\_usage\_pct}}),\ \mbox{\hyperlink{namespacesysio_1_1chain_a99c6aa941a16bc629e8051a0a656dea7}{chain\_config}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a796dada63527fcff40f838efc42a04ec}{max\_block\_net\_usage}},\ config::block\_size\_average\_window\_ms\ /\ config::block\_interval\_ms,\ config::maximum\_elastic\_resource\_multiplier,\ \{99,\ 100\},\ \{1000,\ 999\}\}}
\DoxyCodeLine{01775\ \ \ \ \ \ \ );}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a5ebf5f04366d7120f58430d9ba4f8c7a}{process\_block\_usage}}(pbhs.block\_num);}
\DoxyCodeLine{01777\ }
\DoxyCodeLine{01778\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{01779\ }
\DoxyCodeLine{01780\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bb.\_s\_header)\{}
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}s\_header\ present\ in\ finalize\ block,\ adding\ to\ block\ header:\ \$\{s\}"{}},\ (\textcolor{stringliteral}{"{}s"{}},\ bb.\_s\_header-\/>to\_string()));}
\DoxyCodeLine{01782\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01783\ }
\DoxyCodeLine{01784\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ (unsigned)\ block:}}
\DoxyCodeLine{01785\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ block\_ptr\ =\ std::make\_shared<signed\_block>(\ pbhs.make\_block\_header(}
\DoxyCodeLine{01786\ \ \ \ \ \ \ \ \ \ bb.\_transaction\_mroot\ ?\ *bb.\_transaction\_mroot\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9ae4fff15a76a1c3089fdf0f3353a17f}{calculate\_trx\_merkle}}(\ bb.\_pending\_trx\_receipts\ ),}
\DoxyCodeLine{01787\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a80d7ea5476f97bf51a25149b55469c40}{merkle}}(\ std::move(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests\ )\ ),}
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ \ bb.\_new\_pending\_producer\_schedule,}
\DoxyCodeLine{01789\ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_new\_protocol\_feature\_activations\ ),}
\DoxyCodeLine{01790\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}(),}
\DoxyCodeLine{01791\ \ \ \ \ \ \ \ \ \ bb.\_s\_header\ \textcolor{comment}{//\ Include\ optional\ s\_header\ in\ block\ header}}
\DoxyCodeLine{01792\ \ \ \ \ \ \ )\ );}
\DoxyCodeLine{01793\ }
\DoxyCodeLine{01794\ \ \ \ \ \ \ block\_ptr-\/>transactions\ =\ std::move(\ bb.\_pending\_trx\_receipts\ );}
\DoxyCodeLine{01795\ }
\DoxyCodeLine{01796\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \textcolor{keywordtype}{id}\ =\ block\_ptr-\/>calculate\_id();}
\DoxyCodeLine{01797\ }
\DoxyCodeLine{01798\ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ TaPoS\ table:}}
\DoxyCodeLine{01799\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a78427c6c856e3f2398f434c7d9366a84}{create\_block\_summary}}(\ \textcolor{keywordtype}{id}\ );}
\DoxyCodeLine{01800\ }
\DoxyCodeLine{01801\ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01802\ \textcolor{comment}{\ \ \ \ \ \ ilog(\ "{}finalized\ block\ \$\{n\}\ (\$\{id\})\ at\ \$\{t\}\ by\ \$\{p\}\ (\$\{signing\_key\});\ schedule\_version:\ \$\{v\}\ lib:\ \$\{lib\}\ \#dtrxs:\ \$\{ndtrxs\}\ \$\{np\}"{},}}
\DoxyCodeLine{01803\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}n"{},pbhs.block\_num)}}
\DoxyCodeLine{01804\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}id"{},id)}}
\DoxyCodeLine{01805\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}t"{},pbhs.timestamp)}}
\DoxyCodeLine{01806\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}p"{},pbhs.producer)}}
\DoxyCodeLine{01807\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}signing\_key"{},\ pbhs.block\_signing\_key)}}
\DoxyCodeLine{01808\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}v"{},pbhs.active\_schedule\_version)}}
\DoxyCodeLine{01809\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}lib"{},pbhs.dpos\_irreversible\_blocknum)}}
\DoxyCodeLine{01810\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}ndtrxs"{},db.get\_index<generated\_transaction\_multi\_index,by\_trx\_id>().size())}}
\DoxyCodeLine{01811\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ ("{}np"{},block\_ptr-\/>new\_producers)}}
\DoxyCodeLine{01812\ \textcolor{comment}{\ \ \ \ \ \ );}}
\DoxyCodeLine{01813\ \textcolor{comment}{\ \ \ \ \ \ */}}
\DoxyCodeLine{01814\ }
\DoxyCodeLine{01815\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage\ =\ assembled\_block\{}
\DoxyCodeLine{01816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{code__cache_8cpp_aa0efefe21f4700d78692edc823e763be}{id}},}
\DoxyCodeLine{01817\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_pending\_block\_header\_state\ ),}
\DoxyCodeLine{01818\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_pending\_trx\_metas\ ),}
\DoxyCodeLine{01819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ block\_ptr\ ),}
\DoxyCodeLine{01820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\ bb.\_new\_pending\_producer\_schedule\ )}
\DoxyCodeLine{01821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{01822\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}()\ \}\ }

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a5eb5bb7961c3ae6496caca42b84ab192_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!get\_deep\_mind\_logger@{get\_deep\_mind\_logger}}
\index{get\_deep\_mind\_logger@{get\_deep\_mind\_logger}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{get\_deep\_mind\_logger()}{get\_deep\_mind\_logger()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954} 
\mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\+\_\+mind\+\_\+handler}} \texorpdfstring{$\ast$}{*} sysio\+::chain\+::controller\+\_\+impl\+::get\+\_\+deep\+\_\+mind\+\_\+logger (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02572}{2572}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02573\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4f73eb03cb9df364b792166a70f78320}{deep\_mind\_logger}};}
\DoxyCodeLine{02574\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!get\_on\_block\_transaction@{get\_on\_block\_transaction}}
\index{get\_on\_block\_transaction@{get\_on\_block\_transaction}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{get\_on\_block\_transaction()}{get\_on\_block\_transaction()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902} 
\mbox{\hyperlink{structsysio_1_1chain_1_1signed__transaction}{signed\+\_\+transaction}} sysio\+::chain\+::controller\+\_\+impl\+::get\+\_\+on\+\_\+block\+\_\+transaction (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

At the start of each block we notify the system contract with a transaction that passes in the block header of the prior block (which is currently our head block) 

Definition at line \mbox{\hyperlink{controller_8cpp_source_l02546}{2546}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02547\ \ \ \ \{}
\DoxyCodeLine{02548\ \ \ \ \ \ \ \mbox{\hyperlink{structaction}{action}}\ on\_block\_act;}
\DoxyCodeLine{02549\ \ \ \ \ \ \ on\_block\_act.account\ =\ config::system\_account\_name;}
\DoxyCodeLine{02550\ \ \ \ \ \ \ on\_block\_act.name\ =\ \textcolor{stringliteral}{"{}onblock"{}}\_n;}
\DoxyCodeLine{02551\ \ \ \ \ \ \ on\_block\_act.authorization\ =\ vector<permission\_level>\{\{config::system\_account\_name,\ config::active\_name\}\};}
\DoxyCodeLine{02552\ \ \ \ \ \ \ on\_block\_act.data\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ad39b3fade2e84d4a743230a27c650f1f}{head\_block\_header}}());}
\DoxyCodeLine{02553\ }
\DoxyCodeLine{02554\ \ \ \ \ \ \ signed\_transaction\ trx;}
\DoxyCodeLine{02555\ \ \ \ \ \ \ trx.actions.emplace\_back(std::move(on\_block\_act));}
\DoxyCodeLine{02556\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_aa808acf858e93c567ff983ccbf8fb6d3}{is\_builtin\_activated}}(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cfa1e0a5b7203c3f4124dc8c1880b04e36b}{builtin\_protocol\_feature\_t::no\_duplicate\_deferred\_id}}\ )\ )\ \{}
\DoxyCodeLine{02557\ \ \ \ \ \ \ \ \ \ trx.expiration\ =\ time\_point\_sec();}
\DoxyCodeLine{02558\ \ \ \ \ \ \ \ \ \ trx.ref\_block\_num\ =\ 0;}
\DoxyCodeLine{02559\ \ \ \ \ \ \ \ \ \ trx.ref\_block\_prefix\ =\ 0;}
\DoxyCodeLine{02560\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02561\ \ \ \ \ \ \ \ \ \ trx.expiration\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ +\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}(999'999);\ \textcolor{comment}{//\ Round\ up\ to\ nearest\ second\ to\ avoid\ appearing\ expired}}
\DoxyCodeLine{02562\ \ \ \ \ \ \ \ \ \ trx.set\_reference\_block(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ );}
\DoxyCodeLine{02563\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02564\ }
\DoxyCodeLine{02565\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{02566\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_onblock(trx);}
\DoxyCodeLine{02567\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02568\ }
\DoxyCodeLine{02569\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trx;}
\DoxyCodeLine{02570\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a9efbc515682ae5dede91184c36af73f7}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!init@{init}}
\index{init@{init}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{init()}{init()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a9efbc515682ae5dede91184c36af73f7} 
void sysio\+::chain\+::controller\+\_\+impl\+::init (\begin{DoxyParamCaption}\item[{std\+::function$<$ bool()$>$}]{check\+\_\+shutdown}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00662}{662}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ header\_itr\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139}{validate\_db\_version}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ );}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ state\_chain\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<global\_property\_object>().\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}};}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ state\_chain\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ chain\_id\_type\_exception,}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}chain\ ID\ in\ state\ (\$\{state\_chain\_id\})\ does\ not\ match\ the\ chain\ ID\ that\ controller\ was\ constructed\ with\ (\$\{controller\_chain\_id\})"{}},}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}state\_chain\_id"{}},\ state\_chain\_id)(\textcolor{stringliteral}{"{}controller\_chain\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}})}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ \ \ \ \ \ \ \textcolor{comment}{//\ upgrade\ to\ the\ latest\ compatible\ version}}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (header\_itr-\/>version\ !=\ database\_header\_object::current\_version)\ \{}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(*header\_itr,\ [](\textcolor{keyword}{auto}\&\ header)\ \{}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ header.version\ =\ database\_header\_object::current\_version;}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00679\ }
\DoxyCodeLine{00680\ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ head\ !=\ nullptr}}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}fork\ database\ head\ (\$\{head\})\ is\ inconsistent\ with\ state\ (\$\{db\})"{}},}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}db"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}())(\textcolor{stringliteral}{"{}head"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)\ );}
\DoxyCodeLine{00684\ }
\DoxyCodeLine{00685\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ )\ \{}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}database\ revision\ (\$\{db\})\ is\ greater\ than\ head\ block\ number\ (\$\{head\}),\ "{}}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}attempting\ to\ undo\ pending\ changes"{}},}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}db"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}())(\textcolor{stringliteral}{"{}head"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)\ );}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ )\ \{}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a167bce30384de1f373ebe0c25d4d0de6}{undo}}();}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00693\ }
\DoxyCodeLine{00694\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a573b85f64307919aa077810980b74b43}{init}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ );}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_startup(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num);}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00699\ }
\DoxyCodeLine{00700\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647}{replay}}(\ check\_shutdown\ );\ \textcolor{comment}{//\ replay\ any\ irreversible\ and\ reversible\ blocks\ ahead\ of\ current\ head}}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_shutdown()\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00704\ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ head\ !=\ nullptr\ \&\&\ fork\_db.head()\ !=\ nullptr\ \&\&\ fork\_db.root()\ !=\ nullptr.}}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \textcolor{comment}{//\ Furthermore,\ fork\_db.root()-\/>block\_num\ <=\ lib\_num.}}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \textcolor{comment}{//\ Also,\ even\ though\ blog.head()\ may\ still\ be\ nullptr,\ blog.first\_block\_num()\ is\ guaranteed\ to\ be\ lib\_num\ +\ 1.}}
\DoxyCodeLine{00707\ }
\DoxyCodeLine{00708\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}()-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id}
\DoxyCodeLine{00711\ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}read\_mode\ has\ changed\ from\ irreversible:\ applying\ best\ branch\ from\ fork\ database"{}}\ );}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ pending\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}();}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pending\_head-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id;}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pending\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}()}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ )\ \{}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}applying\ branch\ from\ fork\ database\ ending\ with\ block:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ pending\_head-\/>id)\ );}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\_switch\_forks}}(\ pending\_head,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\_branch\_callback}}\{\},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00722\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a9efbc515682ae5dede91184c36af73f7_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!initialize\_blockchain\_state@{initialize\_blockchain\_state}}
\index{initialize\_blockchain\_state@{initialize\_blockchain\_state}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{initialize\_blockchain\_state()}{initialize\_blockchain\_state()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d} 
void sysio\+::chain\+::controller\+\_\+impl\+::initialize\+\_\+blockchain\+\_\+state (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} \&}]{genesis}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Sets fork database head to the genesis state. 

Definition at line \mbox{\hyperlink{controller_8cpp_source_l00452}{452}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}Initializing\ new\ blockchain\ with\ genesis\ state"{}}\ );}
\DoxyCodeLine{00454\ \ \ \ \ \ \ producer\_authority\_schedule\ initial\_schedule\ =\ \{\ 0,\ \{\ producer\_authority\{config::system\_account\_name,\ block\_signing\_authority\_v0\{\ 1,\ \{\{genesis.initial\_key,\ 1\}\}\ \}\ \}\ \}\ \};}
\DoxyCodeLine{00455\ \ \ \ \ \ \ legacy::producer\_schedule\_type\ initial\_legacy\_schedule\{\ 0,\ \{\{config::system\_account\_name,\ genesis.initial\_key\}\}\ \};}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ \ \ \ \ block\_header\_state\ genheader;}
\DoxyCodeLine{00458\ \ \ \ \ \ \ genheader.active\_schedule\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ initial\_schedule;}
\DoxyCodeLine{00459\ \ \ \ \ \ \ genheader.pending\_schedule.schedule\ \ \ \ \ \ =\ initial\_schedule;}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ if\ wtmsig\ block\ signatures\ are\ enabled\ at\ genesis\ time\ this\ should\ be\ the\ hash\ of\ a\ producer\ authority\ schedule}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ genheader.pending\_schedule.schedule\_hash\ =\ \mbox{\hyperlink{classfc_1_1sha256_a474784de7d6213b855abd7e952df5e36}{fc::sha256::hash}}(initial\_legacy\_schedule);}
\DoxyCodeLine{00462\ \ \ \ \ \ \ genheader.header.timestamp\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ genesis.initial\_timestamp;}
\DoxyCodeLine{00463\ \ \ \ \ \ \ genheader.header.action\_mroot\ \ \ \ \ \ \ \ \ \ \ \ =\ genesis.compute\_chain\_id();}
\DoxyCodeLine{00464\ \ \ \ \ \ \ genheader.id\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ genheader.header.calculate\_id();}
\DoxyCodeLine{00465\ \ \ \ \ \ \ genheader.block\_num\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ genheader.header.block\_num();}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ std::make\_shared<block\_state>();}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}block\_header\_state\&\textcolor{keyword}{>}(*head)\ =\ genheader;}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>activated\_protocol\_features\ =\ std::make\_shared<protocol\_feature\_activation\_set>();}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\ =\ std::make\_shared<signed\_block>(genheader.header);}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a24e7f6336cad0bd2fc280dab381665ed}{set\_revision}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde}{initialize\_database}}(genesis);}
\DoxyCodeLine{00473\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!initialize\_database@{initialize\_database}}
\index{initialize\_database@{initialize\_database}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{initialize\_database()}{initialize\_database()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde} 
void sysio\+::chain\+::controller\+\_\+impl\+::initialize\+\_\+database (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} \&}]{genesis}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01023}{1023}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01024\ \ \ \ \ \ \ \textcolor{comment}{//\ create\ the\ database\ header\ sigil}}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<database\_header\_object>([\&](\ \textcolor{keyword}{auto}\&\ header\ )\{}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nothing\ to\ do\ for\ now}}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01028\ }
\DoxyCodeLine{01029\ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ block\ summary\ index}}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 0x10000;\ i++)}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<block\_summary\_object>([\&](block\_summary\_object\&)\ \{\});}
\DoxyCodeLine{01032\ }
\DoxyCodeLine{01033\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ tapos\_block\_summary\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<block\_summary\_object>(1);}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ tapos\_block\_summary,\ [\&](\ \textcolor{keyword}{auto}\&\ bs\ )\ \{}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ bs.block\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id;}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01037\ }
\DoxyCodeLine{01038\ \ \ \ \ \ \ genesis.initial\_configuration.validate();}
\DoxyCodeLine{01039\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<global\_property\_object>([\&genesis,\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}=this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}}](\textcolor{keyword}{auto}\&\ gpo\ )\{}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \ gpo.configuration\ =\ genesis.initial\_configuration;}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Update\ this\ when\ genesis\ protocol\ features\ are\ enabled.}}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ gpo.wasm\_configuration\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state_a3e6e5eb6e7b0107b1f105eb8a4dcca41}{genesis\_state::default\_initial\_wasm\_configuration}};}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \ gpo.chain\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}};}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<protocol\_state\_object>([\&](\textcolor{keyword}{auto}\&\ pso\ )\{}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ pso.num\_supported\_key\_types\ =\ config::genesis\_num\_supported\_key\_types;}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ i\ :\ \mbox{\hyperlink{namespacesysio_1_1chain_a01ed37e95a76bcd3dec49672be7acfaa}{genesis\_intrinsics}}\ )\ \{}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a32f7ac67403d93f11d6098fb6abd1cc3}{add\_intrinsic\_to\_whitelist}}(\ pso.whitelisted\_intrinsics,\ i\ );}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<dynamic\_global\_property\_object>([](\textcolor{keyword}{auto}\&)\{\});}
\DoxyCodeLine{01054\ }
\DoxyCodeLine{01055\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a27cfd5f70c12c10a9939e7bf6b3a52e4}{initialize\_database}}();}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a1b9d0326965430166923c2241a3a6a45}{initialize\_database}}();}
\DoxyCodeLine{01057\ }
\DoxyCodeLine{01058\ \ \ \ \ \ \ authority\ system\_auth(genesis.initial\_key);}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\_native\_account}}(\ genesis.initial\_timestamp,\ config::system\_account\_name,\ system\_auth,\ system\_auth,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{01060\ }
\DoxyCodeLine{01061\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ empty\_authority\ =\ authority(1,\ \{\},\ \{\});}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ active\_producers\_authority\ =\ authority(1,\ \{\},\ \{\});}
\DoxyCodeLine{01063\ \ \ \ \ \ \ active\_producers\_authority.accounts.push\_back(\{\{config::system\_account\_name,\ config::active\_name\},\ 1\});}
\DoxyCodeLine{01064\ }
\DoxyCodeLine{01065\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\_native\_account}}(\ genesis.initial\_timestamp,\ config::null\_account\_name,\ empty\_authority,\ empty\_authority\ );}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae2c30acb1a0557f6c3967c6a154f7b23}{create\_native\_account}}(\ genesis.initial\_timestamp,\ config::producers\_account\_name,\ empty\_authority,\ active\_producers\_authority\ );}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ active\_permission\ \ \ \ \ \ \ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,\ config::active\_name\});}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ majority\_permission\ \ \ \ \ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\ config::producers\_account\_name,}
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::majority\_producers\_permission\_name,}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active\_permission.id,}
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active\_producers\_authority,}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ genesis.initial\_timestamp\ );}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_aac57733c5aa05c1c78a023a80b2f447f}{create\_permission}}(\ config::producers\_account\_name,}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::minority\_producers\_permission\_name,}
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ majority\_permission.id,}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ active\_producers\_authority,}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ genesis.initial\_timestamp\ );}
\DoxyCodeLine{01078\ }
\DoxyCodeLine{01079\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a01cf826f5503f482715ca2b724279cde_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!log\_irreversible@{log\_irreversible}}
\index{log\_irreversible@{log\_irreversible}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{log\_irreversible()}{log\_irreversible()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814} 
void sysio\+::chain\+::controller\+\_\+impl\+::log\+\_\+irreversible (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00395}{395}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}fork\ database\ not\ properly\ initialized"{}}\ );}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ log\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}();}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lib\_num\ =\ log\_head\ ?\ log\_head-\/>block\_num()\ :\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ -\/\ 1);}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ root\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id;}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ log\_head\ )\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ root\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a4d0b6ecf420faffc4f00ba6af3d0af99}{head\_id}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}fork\ database\ root\ does\ not\ match\ block\ log\ head"{}}\ );}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ ==\ lib\_num,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}empty\ block\ log\ expects\ the\ first\ appended\ block\ to\ build\ off\ a\ block\ that\ is\ not\ the\ fork\ database\ root.\ root\ block\ number:\ \$\{block\_num\},\ lib:\ \$\{lib\_num\}"{}},\ (\textcolor{stringliteral}{"{}block\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num)\ (\textcolor{stringliteral}{"{}lib\_num"{}},\ lib\_num)\ );}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fork\_head\ =\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}})\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}()\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}();}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ fork\_head-\/>dpos\_irreversible\_blocknum\ <=\ lib\_num\ )}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ branch\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a18e51b748469f97473d120ef69e1da22}{fetch\_branch}}(\ fork\_head-\/>id,\ fork\_head-\/>dpos\_irreversible\_blocknum\ );}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ bitr\ =\ branch.rbegin();\ bitr\ !=\ branch.rend();\ ++bitr\ )\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ )\ \{}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ *bitr,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ (*bitr);}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a27266ebf16b6dd19a860635f7d1f9930}{irreversible\_block}},\ *bitr\ );}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ blog.append\ could\ fail\ due\ to\ failures\ like\ running\ out\ of\ space.}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ it\ before\ commit\ so\ that\ in\ case\ it\ throws,\ DB\ can\ be\ rolled\ back.}}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_aca2eca093aee072fc3f599a7c642a227}{append}}(\ (*bitr)-\/>block\ );}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_aca6d7bcd700644f077b89203b2e8b7ef}{commit}}(\ (*bitr)-\/>block\_num\ );}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ root\_id\ =\ (*bitr)-\/>id;}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ std::exception\&\ )\ \{}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ root\_id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_ae911acbc996994cb6dfd21fddfb89a45}{advance\_root}}(\ root\_id\ );}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ \ \ \ \ \ \ \textcolor{comment}{//db.commit(\ fork\_head-\/>dpos\_irreversible\_blocknum\ );\ //\ redundant}}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ root\_id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_ae911acbc996994cb6dfd21fddfb89a45}{advance\_root}}(\ root\_id\ );}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00447\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!make\_block\_restore\_point@{make\_block\_restore\_point}}
\index{make\_block\_restore\_point@{make\_block\_restore\_point}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{make\_block\_restore\_point()}{make\_block\_restore\_point()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5} 
\mbox{\hyperlink{classfc_1_1scoped__exit}{fc\+::scoped\+\_\+exit}}$<$ std\+::function$<$ void()$>$ $>$ sysio\+::chain\+::controller\+\_\+impl\+::make\+\_\+block\+\_\+restore\+\_\+point (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01082}{1082}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{01084\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ orig\_block\_transactions\_size\ =\ bb.\_pending\_trx\_receipts.size();}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ orig\_state\_transactions\_size\ =\ bb.\_pending\_trx\_metas.size();}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ orig\_action\_receipt\_digests\_size\ =\ bb.\_action\_receipt\_digests.size();}
\DoxyCodeLine{01087\ }
\DoxyCodeLine{01088\ \ \ \ \ \ \ std::function<void()>\ callback\ =\ [\textcolor{keyword}{this},}
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orig\_block\_transactions\_size,}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orig\_state\_transactions\_size,}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orig\_action\_receipt\_digests\_size]()}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ bb.\_pending\_trx\_receipts.resize(orig\_block\_transactions\_size);}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ bb.\_pending\_trx\_metas.resize(orig\_state\_transactions\_size);}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ bb.\_action\_receipt\_digests.resize(orig\_action\_receipt\_digests\_size);}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \};}
\DoxyCodeLine{01098\ }
\DoxyCodeLine{01099\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}(\ std::move(callback)\ );}
\DoxyCodeLine{01100\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!maybe\_switch\_forks@{maybe\_switch\_forks}}
\index{maybe\_switch\_forks@{maybe\_switch\_forks}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{maybe\_switch\_forks()}{maybe\_switch\_forks()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587} 
void sysio\+::chain\+::controller\+\_\+impl\+::maybe\+\_\+switch\+\_\+forks (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&}]{new\+\_\+head}{, }\item[{\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}}}]{s}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\+\_\+branch\+\_\+callback}} \&}]{forked\+\_\+branch\+\_\+cb}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\+\_\+meta\+\_\+cache\+\_\+lookup}} \&}]{trx\+\_\+lookup}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

end for each block in branch

Definition at line \mbox{\hyperlink{controller_8cpp_source_l02229}{2229}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02231\ \ \ \ \{}
\DoxyCodeLine{02232\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ head\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02233\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ new\_head-\/>header.previous\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id\ )\ \{}
\DoxyCodeLine{02234\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{02235\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ new\_head,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ trx\_lookup\ );}
\DoxyCodeLine{02236\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ new\_head\ );}
\DoxyCodeLine{02237\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ new\_head;}
\DoxyCodeLine{02238\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{02239\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a193f10ce12656c580b023d36193a5cdc}{remove}}(\ new\_head-\/>id\ );}
\DoxyCodeLine{02240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{02241\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02242\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ new\_head-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id\ )\ \{}
\DoxyCodeLine{02243\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ old\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}};}
\DoxyCodeLine{02244\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}switching\ forks\ from\ \$\{current\_head\_id\}\ (block\ number\ \$\{current\_head\_num\})\ to\ \$\{new\_head\_id\}\ (block\ number\ \$\{new\_head\_num\})"{}},}
\DoxyCodeLine{02245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}current\_head\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id)(\textcolor{stringliteral}{"{}current\_head\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)(\textcolor{stringliteral}{"{}new\_head\_id"{}},\ new\_head-\/>id)(\textcolor{stringliteral}{"{}new\_head\_num"{}},\ new\_head-\/>block\_num)\ );}
\DoxyCodeLine{02246\ }
\DoxyCodeLine{02247\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{02248\ \ \ \ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_switch\_forks(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id,\ new\_head-\/>id);}
\DoxyCodeLine{02249\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02250\ }
\DoxyCodeLine{02251\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ branches\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a77f152572f2703a40e9c198456fad748}{fetch\_branch\_from}}(\ new\_head-\/>id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id\ );}
\DoxyCodeLine{02252\ }
\DoxyCodeLine{02253\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ branches.second.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{02254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ itr\ =\ branches.second.begin();\ itr\ !=\ branches.second.end();\ ++itr\ )\ \{}
\DoxyCodeLine{02255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}{pop\_block}}();}
\DoxyCodeLine{02256\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02257\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ ==\ branches.second.back()-\/>header.previous,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{02258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}loss\ of\ sync\ between\ fork\_db\ and\ chainbase\ during\ fork\ switch"{}}\ );\ \textcolor{comment}{//\ \_should\_\ never\ fail}}
\DoxyCodeLine{02259\ }
\DoxyCodeLine{02260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ forked\_branch\_cb\ )\ forked\_branch\_cb(\ branches.second\ );}
\DoxyCodeLine{02261\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02262\ }
\DoxyCodeLine{02263\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ ritr\ =\ branches.first.rbegin();\ ritr\ !=\ branches.first.rend();\ ++ritr\ )\ \{}
\DoxyCodeLine{02264\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ except\ =\ std::exception\_ptr\{\};}
\DoxyCodeLine{02265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{02266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ *ritr,\ (*ritr)-\/>is\_valid()\ ?\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}}
\DoxyCodeLine{02267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}},\ trx\_lookup\ );}
\DoxyCodeLine{02268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ *ritr\ );}
\DoxyCodeLine{02269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ *ritr;}
\DoxyCodeLine{02270\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{02271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{02272\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{02273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{02274\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{02275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}exception\ thrown\ while\ switching\ forks\ \$\{e\}"{}},\ (\textcolor{stringliteral}{"{}e"{}},\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}()));}
\DoxyCodeLine{02276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\ =\ std::current\_exception();}
\DoxyCodeLine{02277\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{02278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}exception\ thrown\ while\ switching\ forks\ \$\{e\}"{}},\ (\textcolor{stringliteral}{"{}e"{}},\ e.what()));}
\DoxyCodeLine{02279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\ =\ std::current\_exception();}
\DoxyCodeLine{02280\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02281\ }
\DoxyCodeLine{02282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ except\ )\ \{}
\DoxyCodeLine{02283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ritr\ currently\ points\ to\ the\ block\ that\ threw}}
\DoxyCodeLine{02284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ block\ that\ threw\ and\ all\ forks\ built\ off\ it.}}
\DoxyCodeLine{02285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a193f10ce12656c580b023d36193a5cdc}{remove}}(\ (*ritr)-\/>id\ );}
\DoxyCodeLine{02286\ }
\DoxyCodeLine{02287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pop\ all\ blocks\ from\ the\ bad\ fork,\ discarding\ their\ transactions}}
\DoxyCodeLine{02288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ritr\ base\ is\ a\ forward\ itr\ to\ the\ last\ block\ successfully\ applied}}
\DoxyCodeLine{02289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ applied\_itr\ =\ ritr.base();}
\DoxyCodeLine{02290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ itr\ =\ applied\_itr;\ itr\ !=\ branches.first.end();\ ++itr\ )\ \{}
\DoxyCodeLine{02291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}{pop\_block}}();}
\DoxyCodeLine{02292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a37d0a44faef74cf0f96127982c1ce124}{head\_block\_id}}()\ ==\ branches.second.back()-\/>header.previous,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{02294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}loss\ of\ sync\ between\ fork\_db\ and\ chainbase\ during\ fork\ switch\ reversal"{}}\ );\ \textcolor{comment}{//\ \_should\_\ never\ fail}}
\DoxyCodeLine{02295\ }
\DoxyCodeLine{02296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ re-\/apply\ good\ blocks}}
\DoxyCodeLine{02297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ ritr\ =\ branches.second.rbegin();\ ritr\ !=\ branches.second.rend();\ ++ritr\ )\ \{}
\DoxyCodeLine{02298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ *ritr,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}\ \textcolor{comment}{/*\ we\ previously\ validated\ these\ blocks*/},\ trx\_lookup\ );}
\DoxyCodeLine{02299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ *ritr;}
\DoxyCodeLine{02300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::rethrow\_exception(except);}
\DoxyCodeLine{02302\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ end\ if\ exception}}
\DoxyCodeLine{02303\ \ \ \ \ \ \ \ \ \ \}\ }
\DoxyCodeLine{02304\ }
\DoxyCodeLine{02305\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}successfully\ switched\ fork\ to\ new\ head\ \$\{new\_head\_id\}"{}},\ (\textcolor{stringliteral}{"{}new\_head\_id"{}},\ new\_head-\/>id));}
\DoxyCodeLine{02306\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02307\ \ \ \ \ \ \ \ \ \ head\_changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02308\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02309\ }
\DoxyCodeLine{02310\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ head\_changed\ )}
\DoxyCodeLine{02311\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\_irreversible}}();}
\DoxyCodeLine{02312\ }
\DoxyCodeLine{02313\ \ \ \ \}\ }

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!on\_activation@{on\_activation}}
\index{on\_activation@{on\_activation}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{on\_activation()}{on\_activation()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744} 
template$<$\mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}} F$>$ \\
void sysio\+::chain\+::controller\+\_\+impl\+::on\+\_\+activation (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!pop\_block@{pop\_block}}
\index{pop\_block@{pop\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{pop\_block()}{pop\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7} 
void sysio\+::chain\+::controller\+\_\+impl\+::pop\+\_\+block (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00259}{259}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ prev\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_aee9daa00e2698a868ad36853e58d3908}{get\_block}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>header.previous\ );}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !prev\ )\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>header.previous,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}attempt\ to\ pop\ beyond\ last\ irreversible\ block"{}}\ );}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ prev\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}();}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\_read\_mode::SPECULATIVE}}\ )\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}attempting\ to\ pop\ a\ block\ that\ was\ sparsely\ loaded\ from\ a\ snapshot"{}});}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ prev;}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a167bce30384de1f373ebe0c25d4d0de6}{undo}}();}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a5b8ed9cc5cb5822d6cb645a3b7a5f98c}{popped\_blocks\_to}}(\ prev-\/>block\_num\ );}
\DoxyCodeLine{00276\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a571b0d08f97b43706abab71f59d4d9f7_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ac2d3794f1bd0ff1bd5837d8ead15d289}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!push\_block@{push\_block}}
\index{push\_block@{push\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{push\_block()}{push\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ac2d3794f1bd0ff1bd5837d8ead15d289} 
void sysio\+::chain\+::controller\+\_\+impl\+::push\+\_\+block (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} \&}]{bsp}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\+\_\+branch\+\_\+callback}} \&}]{forked\+\_\+branch\+\_\+cb}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\+\_\+meta\+\_\+cache\+\_\+lookup}} \&}]{trx\+\_\+lookup}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02133}{2133}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02136\ \ \ \ \{}
\DoxyCodeLine{02137\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller::block\_status}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ad9a22d7a8178d5b42a8750123cbfe5b1}{controller::block\_status::complete}};}
\DoxyCodeLine{02138\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}it\ is\ not\ valid\ to\ push\ a\ block\ when\ there\ is\ a\ pending\ block"{}});}
\DoxyCodeLine{02139\ }
\DoxyCodeLine{02140\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_prod\_light\_validation\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([old\_value=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\_producer\_light\_validation}},\ \textcolor{keyword}{this}]()\ \{}
\DoxyCodeLine{02141\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\_producer\_light\_validation}}\ =\ old\_value;}
\DoxyCodeLine{02142\ \ \ \ \ \ \ \});}
\DoxyCodeLine{02143\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{02144\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ bsp,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}null\ block"{}}\ );}
\DoxyCodeLine{02145\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ b\ =\ bsp-\/>block;}
\DoxyCodeLine{02146\ }
\DoxyCodeLine{02147\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ >\ 0\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}())\ \{}
\DoxyCodeLine{02148\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Reached\ configured\ maximum\ block\ \$\{num\};\ terminating"{}},\ (\textcolor{stringliteral}{"{}num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}})\ );}
\DoxyCodeLine{02149\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}();}
\DoxyCodeLine{02150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02151\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02152\ }
\DoxyCodeLine{02153\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4fc6dcda025714506dce2a3ed924a21c}{pre\_accepted\_block}},\ b\ );}
\DoxyCodeLine{02154\ }
\DoxyCodeLine{02155\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a97cf1402b71020048ae0054e4d7c8079}{add}}(\ bsp\ );}
\DoxyCodeLine{02156\ }
\DoxyCodeLine{02157\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a1196ffe0c4905238026e4923cf24cb3e}{is\_trusted\_producer}}(b-\/>producer))\ \{}
\DoxyCodeLine{02158\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}{trusted\_producer\_light\_validation}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02159\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{02160\ }
\DoxyCodeLine{02161\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0a0659166483870bf065f4d5e671484e}{accepted\_block\_header}},\ bsp\ );}
\DoxyCodeLine{02162\ }
\DoxyCodeLine{02163\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ )\ \{}
\DoxyCodeLine{02164\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\_switch\_forks}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}(),\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ forked\_branch\_cb,\ trx\_lookup\ );}
\DoxyCodeLine{02165\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02166\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0130874bac31eb408dd6e766084b814}{log\_irreversible}}();}
\DoxyCodeLine{02167\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02168\ }
\DoxyCodeLine{02169\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}(\ )}
\DoxyCodeLine{02170\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ac2d3794f1bd0ff1bd5837d8ead15d289_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!push\_receipt@{push\_receipt}}
\index{push\_receipt@{push\_receipt}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{push\_receipt()}{push\_receipt()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7} 
template$<$typename \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}} $>$ \\
const \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt}{transaction\+\_\+receipt}} \& sysio\+::chain\+::controller\+\_\+impl\+::push\+\_\+receipt (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}} \&}]{trx}{, }\item[{\mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55}{transaction\+\_\+receipt\+\_\+header\+::status\+\_\+enum}}}]{status}{, }\item[{\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\+\_\+t}}}]{cpu\+\_\+usage\+\_\+us}{, }\item[{\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\+\_\+t}}}]{net\+\_\+usage}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Adds the transaction receipt to the pending block and returns it. 

Definition at line \mbox{\hyperlink{controller_8cpp_source_l01437}{1437}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ net\_usage\_words\ =\ net\_usage\ /\ 8;}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ net\_usage\_words*8\ ==\ net\_usage,\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}net\_usage\ is\ not\ divisible\ by\ 8"{}}\ );}
\DoxyCodeLine{01441\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ receipts\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_pending\_trx\_receipts;}
\DoxyCodeLine{01442\ \ \ \ \ \ \ receipts.emplace\_back(\ trx\ );}
\DoxyCodeLine{01443\ \ \ \ \ \ \ transaction\_receipt\&\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}\ =\ receipts.back();}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.cpu\_usage\_us\ \ \ \ \ \ \ \ \ =\ cpu\_usage\_us;}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.net\_usage\_words\ \ \ \ \ \ =\ net\_usage\_words;}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.status\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ =\ status;}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}};}
\DoxyCodeLine{01448\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a43b89d301b09c599969412d7db819bd3}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!push\_scheduled\_transaction@{push\_scheduled\_transaction}}
\index{push\_scheduled\_transaction@{push\_scheduled\_transaction}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{push\_scheduled\_transaction()}{push\_scheduled\_transaction()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a43b89d301b09c599969412d7db819bd3} 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} sysio\+::chain\+::controller\+\_\+impl\+::push\+\_\+scheduled\+\_\+transaction (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction__object}{generated\+\_\+transaction\+\_\+object}} \&}]{gto}{, }\item[{\mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}}}]{block\+\_\+deadline}{, }\item[{\mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}}}]{max\+\_\+transaction\+\_\+time}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{billed\+\_\+cpu\+\_\+time\+\_\+us}{, }\item[{bool}]{explicit\+\_\+billed\+\_\+cpu\+\_\+time}{ = {\ttfamily false}}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01228}{1228}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01231\ \ \ \ \{\ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01232\ }
\DoxyCodeLine{01233\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ validating\ =\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0fcc85a590581560765686050fe105a8}{is\_producing\_block}}();}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !validating\ ||\ explicit\_billed\_cpu\_time,\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}validating\ requires\ explicit\ billing"{}}\ );}
\DoxyCodeLine{01235\ }
\DoxyCodeLine{01236\ \ \ \ \ \ \ maybe\_session\ undo\_session;}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}()\ )}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \ undo\_session\ =\ maybe\_session(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{01239\ }
\DoxyCodeLine{01240\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ gtrx\ =\ generated\_transaction(gto);}
\DoxyCodeLine{01241\ }
\DoxyCodeLine{01242\ \ \ \ \ \ \ \textcolor{comment}{//\ remove\ the\ generated\ transaction\ object\ after\ making\ a\ copy}}
\DoxyCodeLine{01243\ \ \ \ \ \ \ \textcolor{comment}{//\ this\ will\ ensure\ that\ anything\ which\ affects\ the\ GTO\ multi-\/index-\/container\ will\ not\ invalidate}}
\DoxyCodeLine{01244\ \ \ \ \ \ \ \textcolor{comment}{//\ data\ we\ need\ to\ successfully\ retire\ this\ transaction.}}
\DoxyCodeLine{01245\ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01246\ \ \ \ \ \ \ \textcolor{comment}{//\ IF\ the\ transaction\ FAILs\ in\ a\ subjective\ way,\ \`{}undo\_session`\ should\ expire\ without\ being\ squashed}}
\DoxyCodeLine{01247\ \ \ \ \ \ \ \textcolor{comment}{//\ resulting\ in\ the\ GTO\ being\ restored\ and\ available\ for\ a\ future\ block\ to\ retire.}}
\DoxyCodeLine{01248\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ trx\_removal\_ram\_delta\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43}{remove\_scheduled\_transaction}}(gto);}
\DoxyCodeLine{01249\ }
\DoxyCodeLine{01250\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{fc::datastream<const\ char*>}}\ \mbox{\hyperlink{namespace_xbyak_1_1util_a4b2aef26182d21706896022467868f7c}{ds}}(\ gtrx.packed\_trx.data(),\ gtrx.packed\_trx.size()\ );}
\DoxyCodeLine{01251\ }
\DoxyCodeLine{01252\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ gtrx.delay\_until\ <=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}this\ transaction\ isn't\ ready"{}},}
\DoxyCodeLine{01253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}gtrx.delay\_until"{}},gtrx.delay\_until)(\textcolor{stringliteral}{"{}pbt"{}},\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}())\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{01254\ }
\DoxyCodeLine{01255\ \ \ \ \ \ \ signed\_transaction\ dtrx;}
\DoxyCodeLine{01256\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\textcolor{keyword}{static\_cast<}transaction\&\textcolor{keyword}{>}(dtrx)\ );}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\ trx\ =}
\DoxyCodeLine{01258\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_acb14de2d02033c2d43c65319825d3d5b}{transaction\_metadata::create\_no\_recover\_keys}}(\ std::make\_shared<packed\_transaction>(\ std::move(dtrx)\ \ ),}
\DoxyCodeLine{01259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053eda638a6d925c422c868b28b9562498ea1d}{transaction\_metadata::trx\_type::scheduled}}\ );}
\DoxyCodeLine{01260\ \ \ \ \ \ \ trx-\/>accepted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01261\ }
\DoxyCodeLine{01262\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace;}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ gtrx.expiration\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()\ )\ \{}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \ trace\ =\ std::make\_shared<transaction\_trace>();}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \ trace-\/>id\ =\ gtrx.trx\_id;}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \ trace-\/>block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}()\ +\ 1;}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ trace-\/>block\_time\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}();}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \ trace-\/>producer\_block\_id\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8ad92bdf81057887fdc4b732cb864bc4}{pending\_producer\_block\_id}}();}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ trace-\/>scheduled\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(\ gtrx.trx\_id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55ac9a3d403c49bf068d1f8f07e20df72b5}{transaction\_receipt::expired}},\ billed\_cpu\_time\_us,\ 0\ );\ \textcolor{comment}{//\ expire\ the\ transaction}}
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ account\_delta(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ \ undo\_session.squash();}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01278\ }
\DoxyCodeLine{01279\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_in\_trx\_requiring\_checks\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([old\_value=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}},\textcolor{keyword}{this}]()\{}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ old\_value;}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01282\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01283\ }
\DoxyCodeLine{01284\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ cpu\_time\_to\_bill\_us\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{01285\ }
\DoxyCodeLine{01286\ \ \ \ \ \ \ transaction\_checktime\_timer\ trx\_timer(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}});}
\DoxyCodeLine{01287\ \ \ \ \ \ \ transaction\_context\ trx\_context(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}},\ *trx-\/>packed\_trx(),\ std::move(trx\_timer)\ );}
\DoxyCodeLine{01288\ \ \ \ \ \ \ trx\_context.leeway\ =\ \ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}(0);\ \textcolor{comment}{//\ avoid\ stealing\ cpu\ resource}}
\DoxyCodeLine{01289\ \ \ \ \ \ \ trx\_context.block\_deadline\ =\ block\_deadline;}
\DoxyCodeLine{01290\ \ \ \ \ \ \ trx\_context.max\_transaction\_time\_subjective\ =\ max\_transaction\_time;}
\DoxyCodeLine{01291\ \ \ \ \ \ \ trx\_context.explicit\_billed\_cpu\_time\ =\ explicit\_billed\_cpu\_time;}
\DoxyCodeLine{01292\ \ \ \ \ \ \ trx\_context.billed\_cpu\_time\_us\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{01293\ \ \ \ \ \ \ trx\_context.enforce\_whiteblacklist\ =\ gtrx.sender.empty()\ ?\ true\ :\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735}{sender\_avoids\_whitelist\_blacklist\_enforcement}}(\ gtrx.sender\ );}
\DoxyCodeLine{01294\ \ \ \ \ \ \ trace\ =\ trx\_context.trace;}
\DoxyCodeLine{01295\ }
\DoxyCodeLine{01296\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ handle\_exception\ =\ [\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ e)}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01298\ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us\ =\ trx\_context.update\_billed\_cpu\_time(\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ );}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ \ trace-\/>error\_code\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{controller::convert\_exception\_to\_error\_code}}(\ e\ );}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \ trace-\/>except\ =\ e;}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \ trace-\/>except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ trace-\/>elapsed\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ -\/\ trx\_context.start;}
\DoxyCodeLine{01303\ }
\DoxyCodeLine{01304\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_fail\_deferred();}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01307\ \ \ \ \ \ \ \};}
\DoxyCodeLine{01308\ }
\DoxyCodeLine{01309\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \ trx\_context.init\_for\_deferred\_trx(\ gtrx.published\ );}
\DoxyCodeLine{01311\ }
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx\_context.enforce\_whiteblacklist\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}}\ )\ \{}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \ \ \ \ flat\_set<account\_name>\ actors;}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ act\ :\ trx-\/>packed\_trx()-\/>get\_transaction().actions\ )\ \{}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ auth\ :\ act.authorization\ )\ \{}
\DoxyCodeLine{01316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ actors.insert(\ auth.actor\ );}
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac79d2ab18d201291e9fbd0b38044e1f1}{check\_actor\_list}}(\ actors\ );}
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01321\ }
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \ trx\_context.exec();}
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \ trx\_context.finalize();\ \textcolor{comment}{//\ Automatically\ rounds\ up\ network\ and\ CPU\ usage\ in\ trace\ and\ bills\ payers\ if\ successful}}
\DoxyCodeLine{01324\ }
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ restore\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\_block\_restore\_point}}();}
\DoxyCodeLine{01326\ }
\DoxyCodeLine{01327\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(\ gtrx.trx\_id,}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{transaction\_receipt::executed}},}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.billed\_cpu\_time\_us,}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>net\_usage\ );}
\DoxyCodeLine{01331\ }
\DoxyCodeLine{01332\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a219f556e23004060631ffb2baaeaff02}{fc::move\_append}}(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests,}
\DoxyCodeLine{01333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(trx\_context.executed\_action\_receipt\_digests)\ );}
\DoxyCodeLine{01334\ }
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ account\_delta(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{01336\ }
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{01340\ }
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ \ trx\_context.squash();}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ \ undo\_session.squash();}
\DoxyCodeLine{01343\ }
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ \ restore.cancel();}
\DoxyCodeLine{01345\ }
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ disallowed\_transaction\_extensions\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ protocol\_feature\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ handle\_exception(e);}
\DoxyCodeLine{01357\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ wrapper\ =\ \mbox{\hyperlink{classfc_1_1std__exception__wrapper_ae5ad64f84b1d373f5b92031566284c7c}{fc::std\_exception\_wrapper::from\_current\_exception}}(e);}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ handle\_exception(wrapper);}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01361\ }
\DoxyCodeLine{01362\ \ \ \ \ \ \ trx\_context.undo();}
\DoxyCodeLine{01363\ }
\DoxyCodeLine{01364\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ subjective\ OR\ soft\ OR\ hard\ failure\ logic\ below:}}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01366\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ gtrx.sender\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\_name}}()\ \&\&\ !(validating\ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\_is\_subjective}}(*trace-\/>except)\ :\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}{scheduled\_failure\_is\_subjective}}(*trace-\/>except)))\ \{}
\DoxyCodeLine{01367\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Attempt\ error\ handling\ for\ the\ generated\ transaction.}}
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ error\_trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aa7c2a2da2eed15c5d55146b0ebd6646b}{apply\_onerror}}(\ gtrx,\ block\_deadline,\ max\_transaction\_time,\ trx\_context.pseudo\_start,}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us,\ billed\_cpu\_time\_us,\ explicit\_billed\_cpu\_time,}
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.enforce\_whiteblacklist\ );}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ \ error\_trace-\/>failed\_dtrx\_trace\ =\ trace;}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ \ trace\ =\ error\_trace;}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !trace-\/>except\_ptr\ )\ \{}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ account\_delta(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \ \ \ \ undo\_session.squash();}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \ trace-\/>elapsed\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ -\/\ trx\_context.start;}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01384\ }
\DoxyCodeLine{01385\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ subjective\ OR\ hard\ failure\ logic\ below:}}
\DoxyCodeLine{01386\ }
\DoxyCodeLine{01387\ \ \ \ \ \ \ \textcolor{comment}{//\ subjectivity\ changes\ based\ on\ producing\ vs\ validating}}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ subjective\ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (validating)\ \{}
\DoxyCodeLine{01390\ \ \ \ \ \ \ \ \ \ subjective\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\_is\_subjective}}(*trace-\/>except);}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ \ subjective\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}{scheduled\_failure\_is\_subjective}}(*trace-\/>except);}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01394\ }
\DoxyCodeLine{01395\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !subjective\ )\ \{}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ hard\ failure\ logic}}
\DoxyCodeLine{01397\ }
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !validating\ )\ \{}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ rl\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_add2453cf4d0208ca9f277337c9a5ed7a}{get\_mutable\_resource\_limits\_manager}}();}
\DoxyCodeLine{01400\ \ \ \ \ \ \ \ \ \ \ \ \ rl.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_aaa7345adbf341592a81c087c50655597}{update\_account\_usage}}(\ trx\_context.bill\_to\_accounts,\ \mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\_timestamp\_type}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()).\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp_a1bdb67323980085a2d4002d877b6c232}{slot}}\ );}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ account\_cpu\_limit\ =\ 0;}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \ \ \ \ std::tie(\ std::ignore,\ account\_cpu\_limit,\ std::ignore,\ std::ignore\ )\ =\ trx\_context.max\_bandwidth\_billed\_accounts\_can\_pay(\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{01403\ }
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ limited\_cpu\_time\_to\_bill\_us\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\textcolor{keyword}{>}(\ std::min(}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::min(\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\textcolor{keyword}{>}(cpu\_time\_to\_bill\_us),\ account\_cpu\_limit\ ),}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.initial\_objective\_duration\_limit.count()\ )\ );}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !explicit\_billed\_cpu\_time\ ||\ (cpu\_time\_to\_bill\_us\ ==\ limited\_cpu\_time\_to\_bill\_us),}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}cpu\ to\ bill\ \$\{cpu\}\ !=\ limited\ \$\{limit\}"{}},\ (\textcolor{stringliteral}{"{}cpu"{}},\ cpu\_time\_to\_bill\_us)(\textcolor{stringliteral}{"{}limit"{}},\ limited\_cpu\_time\_to\_bill\_us)\ );}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ \ \ \ \ cpu\_time\_to\_bill\_us\ =\ limited\_cpu\_time\_to\_bill\_us;}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01411\ }
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_ae6e413bd0a6e43b36deff7aacdd0bfd6}{add\_transaction\_usage}}(\ trx\_context.bill\_to\_accounts,\ cpu\_time\_to\_bill\_us,\ 0,}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\_timestamp\_type}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_abb1d81f96986df3bce46bd37caaf6a69}{pending\_block\_time}}()).\mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp_a1bdb67323980085a2d4002d877b6c232}{slot}}\ );\ \textcolor{comment}{//\ Should\ never\ fail}}
\DoxyCodeLine{01414\ }
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(gtrx.trx\_id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55ac705728ca8b5f3a44d8026e14990c463}{transaction\_receipt::hard\_fail}},\ cpu\_time\_to\_bill\_us,\ 0);}
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \ trace-\/>account\_ram\_delta\ =\ account\_delta(\ gtrx.payer,\ trx\_removal\_ram\_delta\ );}
\DoxyCodeLine{01417\ }
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{01419\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{01420\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{01421\ }
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \ undo\_session.squash();}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx\ );}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx())\ );}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01428\ }
\DoxyCodeLine{01429\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01430\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}()\ \}\ }

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{structsysio_1_1chain_1_1controller__impl_a43b89d301b09c599969412d7db819bd3_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!push\_scheduled\_transaction@{push\_scheduled\_transaction}}
\index{push\_scheduled\_transaction@{push\_scheduled\_transaction}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{push\_scheduled\_transaction()}{push\_scheduled\_transaction()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152} 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} sysio\+::chain\+::controller\+\_\+impl\+::push\+\_\+scheduled\+\_\+transaction (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aa85a3b49b3b219d1e3840567579e7e63}{transaction\+\_\+id\+\_\+type}} \&}]{trxid}{, }\item[{\mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}}}]{block\+\_\+deadline}{, }\item[{\mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}}}]{max\+\_\+transaction\+\_\+time}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{billed\+\_\+cpu\+\_\+time\+\_\+us}{, }\item[{bool}]{explicit\+\_\+billed\+\_\+cpu\+\_\+time}{ = {\ttfamily false}}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01218}{1218}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01221\ \ \ \ \{}
\DoxyCodeLine{01222\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{namespacehost__functions__tests__1_a8496a24b5236a2dc07bb4f2930d88342}{idx}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a9e9842ee49526c2423e014a696edc602}{generated\_transaction\_multi\_index}},by\_trx\_id>();}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ \mbox{\hyperlink{namespacehost__functions__tests__1_a8496a24b5236a2dc07bb4f2930d88342}{idx}}.find(\ trxid\ );}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ itr\ !=\ \mbox{\hyperlink{namespacehost__functions__tests__1_a8496a24b5236a2dc07bb4f2930d88342}{idx}}.end(),\ unknown\_transaction\_exception,\ \textcolor{stringliteral}{"{}unknown\ transaction"{}}\ );}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152}{push\_scheduled\_transaction}}(\ *itr,\ block\_deadline,\ max\_transaction\_time,\ billed\_cpu\_time\_us,\ explicit\_billed\_cpu\_time\ );}
\DoxyCodeLine{01226\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a148db3e15c5b5a5cd3fd6b42799d1152_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!push\_transaction@{push\_transaction}}
\index{push\_transaction@{push\_transaction}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{push\_transaction()}{push\_transaction()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd} 
\mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\+\_\+trace\+\_\+ptr}} sysio\+::chain\+::controller\+\_\+impl\+::push\+\_\+transaction (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\+\_\+metadata\+\_\+ptr}} \&}]{trx}{, }\item[{\mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}}}]{block\+\_\+deadline}{, }\item[{\mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}}}]{max\+\_\+transaction\+\_\+time}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{billed\+\_\+cpu\+\_\+time\+\_\+us}{, }\item[{bool}]{explicit\+\_\+billed\+\_\+cpu\+\_\+time}{, }\item[{\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\+\_\+t}}}]{subjective\+\_\+cpu\+\_\+bill\+\_\+us}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

This is the entry point for new transactions to the block state. It will check authorization and determine whether to execute it now or to delay it. Lastly it inserts a transaction receipt into the pending block. 

Definition at line \mbox{\hyperlink{controller_8cpp_source_l01455}{1455}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01461\ \ \ \ \{}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(block\_deadline\ !=\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_a5dfe17906469eaf079c180c1afb4ad94}{transaction\_exception}},\ \textcolor{stringliteral}{"{}deadline\ cannot\ be\ uninitialized"{}});}
\DoxyCodeLine{01463\ }
\DoxyCodeLine{01464\ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a4ee2867a6bec961c7a78b203cfd76be9}{transaction\_trace\_ptr}}\ trace;}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}}\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ check\_auth\ =\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a42a29a059b847799ae3a75953b6bff1e}{skip\_auth\_check}}()\ \&\&\ !trx-\/>implicit;}
\DoxyCodeLine{01468\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ sig\_cpu\_usage\ =\ trx-\/>signature\_cpu\_usage();}
\DoxyCodeLine{01469\ }
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !explicit\_billed\_cpu\_time\ )\ \{}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ already\_consumed\_time(\ \mbox{\hyperlink{chain_2include_2sysio_2chain_2config_8hpp_a0b4bacb63f31764f50a185f320551fbc}{SYS\_PERCENT}}(sig\_cpu\_usage.\mbox{\hyperlink{classfc_1_1microseconds_a20fba59ec7e1f50c6b8f2c9443cc9b92}{count}}(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a681e42f55477a7b01ba14c05a76e9b18}{sig\_cpu\_bill\_pct}})\ );}
\DoxyCodeLine{01472\ }
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}}.time\_since\_epoch()\ <\ \ already\_consumed\_time\ )\ \{}
\DoxyCodeLine{01474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}}\ =\ \mbox{\hyperlink{classfc_1_1time__point}{fc::time\_point}}();}
\DoxyCodeLine{01475\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}}\ -\/=\ already\_consumed\_time;}
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01478\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01479\ }
\DoxyCodeLine{01480\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ signed\_transaction\&\ trn\ =\ trx-\/>packed\_trx()-\/>get\_signed\_transaction();}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \ transaction\_checktime\_timer\ trx\_timer(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}{timer}});}
\DoxyCodeLine{01482\ \ \ \ \ \ \ \ \ \ transaction\_context\ trx\_context(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}},\ *trx-\/>packed\_trx(),\ std::move(trx\_timer),\ start,\ trx-\/>read\_only);}
\DoxyCodeLine{01483\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{bool})\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}{subjective\_cpu\_leeway}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}})\ \{}
\DoxyCodeLine{01484\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.leeway\ =\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}{subjective\_cpu\_leeway}};}
\DoxyCodeLine{01485\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01486\ \ \ \ \ \ \ \ \ \ trx\_context.block\_deadline\ =\ block\_deadline;}
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \ trx\_context.max\_transaction\_time\_subjective\ =\ max\_transaction\_time;}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \ \ \ trx\_context.explicit\_billed\_cpu\_time\ =\ explicit\_billed\_cpu\_time;}
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \ trx\_context.billed\_cpu\_time\_us\ =\ billed\_cpu\_time\_us;}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \ trx\_context.subjective\_cpu\_bill\_us\ =\ subjective\_cpu\_bill\_us;}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ trace\ =\ trx\_context.trace;}
\DoxyCodeLine{01492\ }
\DoxyCodeLine{01493\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ handle\_exception\ =[\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ e)}
\DoxyCodeLine{01494\ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>error\_code\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_ae60743ce36f1fa0912ff26b1da40afe6}{controller::convert\_exception\_to\_error\_code}}(\ e\ );}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>except\ =\ e;}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>elapsed\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}()\ -\/\ trx\_context.start;}
\DoxyCodeLine{01499\ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{01500\ }
\DoxyCodeLine{01501\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01502\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trx-\/>implicit\ )\ \{}
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.init\_for\_implicit\_trx();}
\DoxyCodeLine{01504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.enforce\_whiteblacklist\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01505\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.init\_for\_input\_trx(\ trx-\/>packed\_trx()-\/>get\_unprunable\_size(),}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>packed\_trx()-\/>get\_prunable\_size()\ );}
\DoxyCodeLine{01508\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01509\ }
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.delay\ =\ \mbox{\hyperlink{namespacefc_a9623b8cae3f48bbed6aa1fc2afe9b174}{fc::seconds}}(trn.delay\_sec);}
\DoxyCodeLine{01511\ }
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_auth\ )\ \{}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a8566f4407e33eb1e4029455e4feae2f1}{check\_authorization}}(}
\DoxyCodeLine{01514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trn.actions,}
\DoxyCodeLine{01515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>recovered\_keys(),}
\DoxyCodeLine{01516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\},}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.delay,}
\DoxyCodeLine{01518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\&trx\_context]()\{\ trx\_context.checktime();\ \},}
\DoxyCodeLine{01519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},}
\DoxyCodeLine{01520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>read\_only}
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{01522\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01523\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.exec();}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.finalize();\ \textcolor{comment}{//\ Automatically\ rounds\ up\ network\ and\ CPU\ usage\ in\ trace\ and\ bills\ payers\ if\ successful}}
\DoxyCodeLine{01525\ }
\DoxyCodeLine{01526\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ restore\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a89d9e83d4de2f7aec957e54dce4a76f5}{make\_block\_restore\_point}}();}
\DoxyCodeLine{01527\ }
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>implicit)\ \{}
\DoxyCodeLine{01529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55}{transaction\_receipt::status\_enum}}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ (trx\_context.delay\ ==\ \mbox{\hyperlink{namespacefc_a9623b8cae3f48bbed6aa1fc2afe9b174}{fc::seconds}}(0))}
\DoxyCodeLine{01530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{transaction\_receipt::executed}}}
\DoxyCodeLine{01531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ transaction\_receipt::delayed;}
\DoxyCodeLine{01532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aae2b1bfeee1e7c1c0237f12776e75dd7}{push\_receipt}}(*trx-\/>packed\_trx(),\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ trx\_context.billed\_cpu\_time\_us,\ trace-\/>net\_usage);}
\DoxyCodeLine{01533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>billed\_cpu\_time\_us\ =\ trx\_context.billed\_cpu\_time\_us;}
\DoxyCodeLine{01534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_pending\_trx\_metas.emplace\_back(trx);}
\DoxyCodeLine{01535\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ transaction\_receipt\_header\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}};}
\DoxyCodeLine{01537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.status\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1transaction__receipt__header_a2bb00bac16048e6f624c2ded867ebf55a7a6de58f1f84063a5f85bbfb59b43608}{transaction\_receipt::executed}};}
\DoxyCodeLine{01538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.cpu\_usage\_us\ =\ trx\_context.billed\_cpu\_time\_us;}
\DoxyCodeLine{01539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}}.net\_usage\_words\ =\ trace-\/>net\_usage\ /\ 8;}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace-\/>receipt\ =\ \mbox{\hyperlink{bn_8cpp_af0a5201ca8846f05f25435b41d7f39f7}{r}};}
\DoxyCodeLine{01541\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01542\ }
\DoxyCodeLine{01543\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_a219f556e23004060631ffb2baaeaff02}{fc::move\_append}}(\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_action\_receipt\_digests,}
\DoxyCodeLine{01544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(trx\_context.executed\_action\_receipt\_digests)\ );}
\DoxyCodeLine{01545\ }
\DoxyCodeLine{01546\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ call\ the\ accept\ signal\ but\ only\ once\ for\ this\ transaction}}
\DoxyCodeLine{01547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>read\_only)\ \{}
\DoxyCodeLine{01548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>accepted)\ \{}
\DoxyCodeLine{01549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx-\/>accepted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx);}
\DoxyCodeLine{01551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01552\ }
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{01554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx()));}
\DoxyCodeLine{01555\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01556\ }
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\_read\_mode::SPECULATIVE}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}})\ ||\ trx-\/>read\_only\ )\ \{}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//this\ may\ happen\ automatically\ in\ destructor,\ but\ I\ prefer\ make\ it\ more\ explicit}}
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.undo();}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ restore.cancel();}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_context.squash();}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01565\ }
\DoxyCodeLine{01566\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01567\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ disallowed\_transaction\_extensions\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{01568\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01569\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ protocol\_feature\_bad\_block\_exception\&\ )\ \{}
\DoxyCodeLine{01570\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01571\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01573\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ )\ \{}
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e)\ \{}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ \ \ \ handle\_exception(e);}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ std::exception\&\ e)\ \{}
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ wrapper\ =\ \mbox{\hyperlink{classfc_1_1std__exception__wrapper_ae5ad64f84b1d373f5b92031566284c7c}{fc::std\_exception\_wrapper::from\_current\_exception}}(e);}
\DoxyCodeLine{01579\ \ \ \ \ \ \ \ \ \ \ \ handle\_exception(wrapper);}
\DoxyCodeLine{01580\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01581\ }
\DoxyCodeLine{01582\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trx-\/>read\_only)\ \{}
\DoxyCodeLine{01583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a063e3e3149bf8b88460900cef4b4571b}{accepted\_transaction}},\ trx);}
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8cdd409341efde24915eadc5f25a51f9}{dmlog\_applied\_transaction}}(trace);}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac5fbe5586943483c7d167bc0088098b1}{applied\_transaction}},\ std::tie(trace,\ trx-\/>packed\_trx()));}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01587\ }
\DoxyCodeLine{01588\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trace;}
\DoxyCodeLine{01589\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_a094902280cad82ad6529ebbd12a697eb}{FC\_CAPTURE\_AND\_RETHROW}}((trace))}
\DoxyCodeLine{01590\ \ \ \ \}\ }

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!read\_contract\_tables\_from\_snapshot@{read\_contract\_tables\_from\_snapshot}}
\index{read\_contract\_tables\_from\_snapshot@{read\_contract\_tables\_from\_snapshot}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{read\_contract\_tables\_from\_snapshot()}{read\_contract\_tables\_from\_snapshot()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22} 
void sysio\+::chain\+::controller\+\_\+impl\+::read\+\_\+contract\+\_\+tables\+\_\+from\+\_\+snapshot (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\+\_\+reader\+\_\+ptr}} \&}]{snapshot}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00773}{773}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00774\ \ \ \ \ \ \ snapshot-\/>read\_section(\textcolor{stringliteral}{"{}contract\_tables"{}},\ [\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\ \{}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ more\ =\ !section.empty();}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (more)\ \{}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ read\ the\ row\ for\ the\ table}}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structchainbase_1_1object_a7c6a0efb95ee67d538a976cfa5be9df9}{table\_id\_object::id\_type}}\ t\_id;}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1index__utils_a4ba170946682ddcea81d558b0ee8899a}{index\_utils<table\_id\_multi\_index>::create}}(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section,\ \&t\_id](\textcolor{keyword}{auto}\&\ row)\ \{}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\_id\ =\ row.id;}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ read\ the\ size\ and\ data\ rows\ for\ each\ type\ of\ table}}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ \ \ contract\_database\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&section,\ \&t\_id,\ \&more](\textcolor{keyword}{auto}\ utils)\ \{}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }utils\_t\ =\ \textcolor{keyword}{decltype}(utils);}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ unsigned\_int\ size;}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ more\ =\ section.read\_row(size,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ idx\ =\ 0;\ \mbox{\hyperlink{namespacehost__functions__tests__1_a8496a24b5236a2dc07bb4f2930d88342}{idx}}\ <\ size.value;\ \mbox{\hyperlink{namespacehost__functions__tests__1_a8496a24b5236a2dc07bb4f2930d88342}{idx}}++)\ \{}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ utils\_t::create(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section,\ \&more,\ \&t\_id](\textcolor{keyword}{auto}\&\ row)\ \{}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ row.t\_id\ =\ t\_id;}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ more\ =\ section.read\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00800\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!read\_from\_snapshot@{read\_from\_snapshot}}
\index{read\_from\_snapshot@{read\_from\_snapshot}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{read\_from\_snapshot()}{read\_from\_snapshot()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f} 
void sysio\+::chain\+::controller\+\_\+impl\+::read\+\_\+from\+\_\+snapshot (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\+\_\+reader\+\_\+ptr}} \&}]{snapshot}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{blog\+\_\+start}{, }\item[{\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}}}]{blog\+\_\+end}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

load and upgrade the block header state

Definition at line \mbox{\hyperlink{controller_8cpp_source_l00853}{853}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00854\ \ \ \ \ \ \ chain\_snapshot\_header\ header;}
\DoxyCodeLine{00855\ \ \ \ \ \ \ snapshot-\/>read\_section<chain\_snapshot\_header>([\textcolor{keyword}{this},\ \&header](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ section.read\_row(header,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \ header.validate();}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ \ \ \{\ }
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \ block\_header\_state\ head\_header\_state;}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v2\ =\ legacy::snapshot\_block\_header\_state\_v2;}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.version,\ v2::minimum\_version,\ v2::maximum\_version)\ ==\ header.version\ )\ \{}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<block\_state>([\textcolor{keyword}{this},\ \&head\_header\_state](\ \textcolor{keyword}{auto}\ \&section\ )\ \{}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ legacy::snapshot\_block\_header\_state\_v2\ legacy\_header\_state;}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_header\_state,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ head\_header\_state\ =\ block\_header\_state(std::move(legacy\_header\_state));}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<block\_state>([\textcolor{keyword}{this},\&head\_header\_state](\ \textcolor{keyword}{auto}\ \&section\ )\{}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(head\_header\_state,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}}\ =\ head\_header\_state.block\_num;}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ blog\_start\ <=\ (\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}}\ +\ 1)\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}}\ <=\ blog\_end,}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block\_log\_exception,}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Block\ log\ is\ provided\ with\ snapshot\ but\ does\ not\ contain\ the\ head\ block\ from\ the\ snapshot\ nor\ a\ block\ right\ after\ it"{}},}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}snapshot\_head\_block"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}{snapshot\_head\_block}})}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_first\_num"{}},\ blog\_start)}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_last\_num"{}},\ blog\_end)}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ std::make\_shared<block\_state>();}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}block\_header\_state\&\textcolor{keyword}{>}(*head)\ =\ head\_header\_state;}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \ \ \ \ \ \ controller\_index\_set::walk\_indices([\textcolor{keyword}{this},\ \&snapshot,\ \&header](\ \textcolor{keyword}{auto}\ utils\ )\{}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }value\_t\ =\ \textcolor{keyword}{typename}\ \textcolor{keyword}{decltype}(utils)::index\_t::value\_type;}
\DoxyCodeLine{00891\ }
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ table\_id\_object\ as\ its\ inlined\ with\ contract\ tables\ section}}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ table\_id\_object>::value)\ \{}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00896\ }
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ the\ database\_header\ as\ it\ is\ only\ relevant\ to\ in-\/memory\ database}}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ database\_header\_object>::value)\ \{}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ special\ case\ for\ in-\/place\ upgrade\ of\ global\_property\_object}}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::is\_same<value\_t,\ global\_property\_object>::value)\ \{}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v2\ =\ legacy::snapshot\_global\_property\_object\_v2;}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v3\ =\ legacy::snapshot\_global\_property\_object\_v3;}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }v4\ =\ legacy::snapshot\_global\_property\_object\_v4;}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.version,\ v2::minimum\_version,\ v2::maximum\_version)\ ==\ header.version\ )\ \{}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::optional<genesis\_state>\ genesis\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6353a2e6b51e1b83231f41a8bcc66c47}{extract\_legacy\_genesis\_state}}(*snapshot,\ header.version);}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ genesis,\ snapshot\_exception,}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Snapshot\ indicates\ chain\_snapshot\_header\ version\ 2,\ but\ does\ not\ contain\ a\ genesis\_state.\ "{}}}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}It\ must\ be\ corrupted."{}});}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<global\_property\_object>([\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}=this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},gs\_chain\_id=genesis-\/>compute\_chain\_id()](\ \textcolor{keyword}{auto}\ \&section\ )\ \{}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v2\ legacy\_global\_properties;}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_global\_properties,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00916\ }
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<global\_property\_object>([\&legacy\_global\_properties,\&gs\_chain\_id](\textcolor{keyword}{auto}\&\ gpo\ )\{}
\DoxyCodeLine{00918\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gpo.initalize\_from(legacy\_global\_properties,\ gs\_chain\_id,\ kv\_database\_config\{\},}
\DoxyCodeLine{00919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state_a3e6e5eb6e7b0107b1f105eb8a4dcca41}{genesis\_state::default\_initial\_wasm\_configuration}});}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ early\ out\ to\ avoid\ default\ processing}}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00924\ }
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.version,\ v3::minimum\_version,\ v3::maximum\_version)\ ==\ header.version\ )\ \{}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<global\_property\_object>([\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}=this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}](\ \textcolor{keyword}{auto}\ \&section\ )\ \{}
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v3\ legacy\_global\_properties;}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_global\_properties,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00929\ }
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<global\_property\_object>([\&legacy\_global\_properties](\textcolor{keyword}{auto}\&\ gpo\ )\{}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gpo.initalize\_from(legacy\_global\_properties,\ kv\_database\_config\{\},}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state_a3e6e5eb6e7b0107b1f105eb8a4dcca41}{genesis\_state::default\_initial\_wasm\_configuration}});}
\DoxyCodeLine{00933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ early\ out\ to\ avoid\ default\ processing}}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00937\ }
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::clamp(header.version,\ v4::minimum\_version,\ v4::maximum\_version)\ ==\ header.version)\ \{}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<global\_property\_object>([\&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}\ =\ this-\/>\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}](\textcolor{keyword}{auto}\&\ section)\ \{}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v4\ legacy\_global\_properties;}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ section.read\_row(legacy\_global\_properties,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<global\_property\_object>([\&legacy\_global\_properties](\textcolor{keyword}{auto}\&\ gpo)\ \{}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gpo.initalize\_from(legacy\_global\_properties);}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ early\ out\ to\ avoid\ default\ processing}}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00950\ }
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ \ snapshot-\/>read\_section<value\_t>([\textcolor{keyword}{this}](\ \textcolor{keyword}{auto}\&\ section\ )\ \{}
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ more\ =\ !section.empty();}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(more)\ \{}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{decltype}(utils)::create(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}},\ [\textcolor{keyword}{this},\ \&section,\ \&more](\ \textcolor{keyword}{auto}\ \&row\ )\ \{}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ more\ =\ section.read\_row(row,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}});}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00960\ }
\DoxyCodeLine{00961\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab2a0087a0d30ff324e2b0bff4a3c4e22}{read\_contract\_tables\_from\_snapshot}}(snapshot);}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00963\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a7a4d84d47bcd9069ab0c8d8f9f9ac5f3}{read\_from\_snapshot}}(snapshot);}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a32baa74135a1423302de3a849dc8b40c}{read\_from\_snapshot}}(snapshot);}
\DoxyCodeLine{00965\ }
\DoxyCodeLine{00966\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a24e7f6336cad0bd2fc280dab381665ed}{set\_revision}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_adc8f336b33d7013d1b0400399b16c5a7}{create}}<database\_header\_object>([](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ header)\{}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nothing\ to\ do}}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<global\_property\_object>();}
\DoxyCodeLine{00972\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ gpo.chain\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ chain\_id\_type\_exception,}
\DoxyCodeLine{00973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}chain\ ID\ in\ snapshot\ (\$\{snapshot\_chain\_id\})\ does\ not\ match\ the\ chain\ ID\ that\ controller\ was\ constructed\ with\ (\$\{controller\_chain\_id\})"{}},}
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}snapshot\_chain\_id"{}},\ gpo.chain\_id)(\textcolor{stringliteral}{"{}controller\_chain\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}})}
\DoxyCodeLine{00975\ \ \ \ \ \ \ );}
\DoxyCodeLine{00976\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!remove\_scheduled\_transaction@{remove\_scheduled\_transaction}}
\index{remove\_scheduled\_transaction@{remove\_scheduled\_transaction}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{remove\_scheduled\_transaction()}{remove\_scheduled\_transaction()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43} 
\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\+\_\+t}} sysio\+::chain\+::controller\+\_\+impl\+::remove\+\_\+scheduled\+\_\+transaction (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classsysio_1_1chain_1_1generated__transaction__object}{generated\+\_\+transaction\+\_\+object}} \&}]{gto}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01180}{1180}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_ram\_trace(\mbox{\hyperlink{deep__mind_8hpp_aaaa2f1dbd522de03ccbaa73f01db5f50}{RAM\_EVENT\_ID}}(\textcolor{stringliteral}{"{}\$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ gto.id)),\ \textcolor{stringliteral}{"{}deferred\_trx"{}},\ \textcolor{stringliteral}{"{}remove"{}},\ \textcolor{stringliteral}{"{}deferred\_trx\_removed"{}});}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01184\ }
\DoxyCodeLine{01185\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ ram\_delta\ =\ -\/(\mbox{\hyperlink{namespacesysio_1_1chain_1_1config_a2772c77657b1f6fda680bbe8f7282d13}{config::billable\_size\_v<generated\_transaction\_object>}}\ +\ gto.packed\_trx.size());}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}{resource\_limits}}.\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_a7fea1de6a3806590de0bda86e53c7995}{add\_pending\_ram\_usage}}(\ gto.payer,\ ram\_delta\ );}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ need\ to\ verify\_account\_ram\_usage\ since\ we\ are\ only\ reducing\ memory}}
\DoxyCodeLine{01188\ }
\DoxyCodeLine{01189\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_ac6bb29708e4fdfb6899028e3c351fe0b}{remove}}(\ gto\ );}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ram\_delta;}
\DoxyCodeLine{01191\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a1dac6da3cb5899f6bcd62b9012c75e43_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!replay@{replay}}
\index{replay@{replay}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{replay()}{replay()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647} 
void sysio\+::chain\+::controller\+\_\+impl\+::replay (\begin{DoxyParamCaption}\item[{std\+::function$<$ bool()$>$}]{check\+\_\+shutdown}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00475}{475}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ \&\&\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()\ )\ \{}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ blog\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}();}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ start\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1;}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespace_w_a_s_m_a9690a14428419003297ae35f505b5103aea2b2676c28c0db26d39331a336c6b92}{start}}\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \ \ \ \ \ \ std::exception\_ptr\ except\_ptr;}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ blog\_head\ \&\&\ start\_block\_num\ <=\ blog\_head-\/>block\_num()\ )\ \{}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}existing\ block\ log,\ attempting\ to\ replay\ from\ \$\{s\}\ to\ \$\{n\}\ blocks"{}},}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}s"{}},\ start\_block\_num)(\textcolor{stringliteral}{"{}n"{}},\ blog\_head-\/>block\_num())\ );}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \textcolor{keyword}{auto}\ next\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a99c59d29b262144ad99eacc827f76107}{read\_block\_by\_num}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1\ )\ )\ \{}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}{replay\_push\_block}}(\ next,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ );}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_shutdown()\ )\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacecpp_1_1ast_a25b104cfd21fb8487a07063b6ce62062}{next}}-\/>block\_num()\ \%\ 500\ ==\ 0\ )\ \{}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}\$\{n\}\ of\ \$\{head\}"{}},\ (\textcolor{stringliteral}{"{}n"{}},\ \mbox{\hyperlink{namespacecpp_1_1ast_a25b104cfd21fb8487a07063b6ce62062}{next}}-\/>block\_num())(\textcolor{stringliteral}{"{}head"{}},\ blog\_head-\/>block\_num())\ );}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \ \textcolor{keyword}{const}\ database\_guard\_exception\&\ e\ )\ \{}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ except\_ptr\ =\ std::current\_exception();}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}\$\{n\}\ irreversible\ blocks\ replayed"{}},\ (\textcolor{stringliteral}{"{}n"{}},\ 1\ +\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ -\/\ start\_block\_num)\ );}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ pending\_head\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a16e619525d86741f3e5344b39ab91868}{pending\_head}}();}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ pending\_head\ )\ \{}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}fork\ database\ head\ \$\{h\},\ root\ \$\{r\}"{}},\ (\textcolor{stringliteral}{"{}h"{}},\ pending\_head-\/>block\_num)(\ \textcolor{stringliteral}{"{}r"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ )\ );}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ pending\_head-\/>block\_num\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ ||\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ )\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}resetting\ fork\ database\ with\ new\ last\ irreversible\ block\ as\ the\ new\ root:\ \$\{id\}"{}},\ (\textcolor{stringliteral}{"{}id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>id)\ );}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num\ )\ \{}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ new\_root\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a17185d8543965b7cd40066019bbf5740}{search\_on\_branch}}(\ pending\_head-\/>id,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ new\_root,\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}unexpected\ error:\ could\ not\ find\ new\ LIB\ in\ fork\ database"{}}\ );}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}advancing\ fork\ database\ root\ to\ new\ last\ irreversible\ block\ within\ existing\ fork\ database:\ \$\{id\}"{}},}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ new\_root-\/>id)\ );}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a764fc46000bb93901ba6440fec07b5f9}{mark\_valid}}(\ new\_root\ );}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_ae911acbc996994cb6dfd21fddfb89a45}{advance\_root}}(\ new\_root-\/>id\ );}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ irreverible\ log\ is\ played\ without\ undo\ sessions\ enabled,\ we\ need\ to\ sync\ the}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ revision\ ordinal\ to\ the\ appropriate\ expected\ value\ here.}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ )\ )}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a24e7f6336cad0bd2fc280dab381665ed}{set\_revision}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ );}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}no\ irreversible\ blocks\ need\ to\ be\ replayed"{}}\ );}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !except\_ptr\ \&\&\ !check\_shutdown()\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ head\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num;}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ branch\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a18e51b748469f97473d120ef69e1da22}{fetch\_branch}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ );}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rev\ =\ 0;}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ i\ =\ branch.rbegin();\ i\ !=\ branch.rend();\ ++i\ )\ \{}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ check\_shutdown()\ )\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (*i)-\/>block\_num\ <=\ head\_block\_num\ )\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ ++rev;}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}{replay\_push\_block}}(\ (*i)-\/>block,\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}\ );}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}\$\{n\}\ reversible\ blocks\ replayed"{}},\ (\textcolor{stringliteral}{"{}n"{}},rev)\ );}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ end\ =\ \mbox{\hyperlink{classfc_1_1time__point_aa164ff1268a16d4b32afcff181f6100e}{fc::time\_point::now}}();}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}replayed\ \$\{n\}\ blocks\ in\ \$\{duration\}\ seconds,\ \$\{mspb\}\ ms/block"{}},}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}n"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1\ -\/\ start\_block\_num)(\textcolor{stringliteral}{"{}duration"{}},\ (end-\/start).count()/1000000)}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}mspb"{}},\ ((end-\/start).count()/1000.0)/(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num-\/start\_block\_num))\ );}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ except\_ptr\ )\ \{}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ std::rethrow\_exception(\ except\_ptr\ );}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00555\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=345pt]{structsysio_1_1chain_1_1controller__impl_a9a9e4b6fe15eb93e63ac98af9f170647_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!replay\_push\_block@{replay\_push\_block}}
\index{replay\_push\_block@{replay\_push\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{replay\_push\_block()}{replay\_push\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2} 
void sysio\+::chain\+::controller\+\_\+impl\+::replay\+\_\+push\+\_\+block (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\+\_\+block\+\_\+ptr}} \&}]{b}{, }\item[{\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}}}]{s}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02172}{2172}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02173\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a7b2f18a21e18a1bdc6837a567bb259eb}{validate\_db\_available\_size}}();}
\DoxyCodeLine{02174\ }
\DoxyCodeLine{02175\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}it\ is\ not\ valid\ to\ push\ a\ block\ when\ there\ is\ a\ pending\ block"{}});}
\DoxyCodeLine{02176\ }
\DoxyCodeLine{02177\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{02178\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ b,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}trying\ to\ push\ empty\ block"{}}\ );}
\DoxyCodeLine{02179\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ (\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ ||\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6ac9e825f4641cd3bec0ba01a0c2d67755}{controller::block\_status::validated}}),}
\DoxyCodeLine{02180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}invalid\ block\ status\ for\ replay"{}}\ );}
\DoxyCodeLine{02181\ }
\DoxyCodeLine{02182\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ >\ 0\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}}\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a33704b4936bb9bbd2ea6b0874ca521b4}{head\_block\_num}}()\ )\ \{}
\DoxyCodeLine{02183\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Reached\ configured\ maximum\ block\ \$\{num\};\ terminating"{}},\ (\textcolor{stringliteral}{"{}num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5352099a52d4b3f078ec78122393ba21}{terminate\_at\_block}})\ );}
\DoxyCodeLine{02184\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}();}
\DoxyCodeLine{02185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02186\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02187\ }
\DoxyCodeLine{02188\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a4fc6dcda025714506dce2a3ed924a21c}{pre\_accepted\_block}},\ b\ );}
\DoxyCodeLine{02189\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ skip\_validate\_signee\ =\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a5845874d26f30413374713814cde5749}{force\_all\_checks}};}
\DoxyCodeLine{02190\ }
\DoxyCodeLine{02191\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bsp\ =\ std::make\_shared<block\_state>(}
\DoxyCodeLine{02192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},}
\DoxyCodeLine{02193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b,}
\DoxyCodeLine{02194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}(),}
\DoxyCodeLine{02195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\ \mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{02196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{02197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ vector<digest\_type>\&\ new\_features\ )}
\DoxyCodeLine{02198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ check\_protocol\_features(\ timestamp,\ cur\_features,\ new\_features\ );\ \},}
\DoxyCodeLine{02199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ skip\_validate\_signee}
\DoxyCodeLine{02200\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02201\ }
\DoxyCodeLine{02202\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ !=\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ )\ \{}
\DoxyCodeLine{02203\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a97cf1402b71020048ae0054e4d7c8079}{add}}(\ bsp,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{02204\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02205\ }
\DoxyCodeLine{02206\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0a0659166483870bf065f4d5e671484e}{accepted\_block\_header}},\ bsp\ );}
\DoxyCodeLine{02207\ }
\DoxyCodeLine{02208\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ ==\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a7e6e4eb3ff27864637756cb4d2a2a45d}{controller::block\_status::irreversible}}\ )\ \{}
\DoxyCodeLine{02209\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_aaf795677a1a49a35ac1a819a1a157929}{apply\_block}}(\ bsp,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{02210\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ bsp;}
\DoxyCodeLine{02211\ }
\DoxyCodeLine{02212\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ On\ replay,\ log\_irreversible\ is\ not\ called\ and\ so\ no\ irreversible\_block\ signal\ is\ emitted.}}
\DoxyCodeLine{02213\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ So\ emit\ it\ explicitly\ here.}}
\DoxyCodeLine{02214\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a27266ebf16b6dd19a860635f7d1f9930}{irreversible\_block}},\ bsp\ );}
\DoxyCodeLine{02215\ }
\DoxyCodeLine{02216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}))\ \{}
\DoxyCodeLine{02217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_aca6d7bcd700644f077b89203b2e8b7ef}{commit}}(bsp-\/>block\_num);}
\DoxyCodeLine{02218\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02219\ }
\DoxyCodeLine{02220\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02221\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ !=\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{02222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}invariant\ failure:\ cannot\ replay\ reversible\ blocks\ while\ in\ irreversible\ mode"{}}\ );}
\DoxyCodeLine{02223\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af15d89f9220ba97aa5c521e643746587}{maybe\_switch\_forks}}(\ bsp,\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}},\ \mbox{\hyperlink{namespacesysio_1_1chain_ae043a3bf1321067bf1e4e7e5ab0ce3cd}{forked\_branch\_callback}}\{\},\ \mbox{\hyperlink{namespacesysio_1_1chain_ad7e9cbb02002c4e7ab9825becb9f9f50}{trx\_meta\_cache\_lookup}}\{\}\ );}
\DoxyCodeLine{02224\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02225\ }
\DoxyCodeLine{02226\ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}(\ )}
\DoxyCodeLine{02227\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a2fe4194f0202db6c18bc17572b2adaa2_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!report\_block\_header\_diff@{report\_block\_header\_diff}}
\index{report\_block\_header\_diff@{report\_block\_header\_diff}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{report\_block\_header\_diff()}{report\_block\_header\_diff()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973} 
void sysio\+::chain\+::controller\+\_\+impl\+::report\+\_\+block\+\_\+header\+\_\+diff (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\+\_\+header}} \&}]{b}{, }\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\+\_\+header}} \&}]{ab}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01927}{1927}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01928\ }
\DoxyCodeLine{01929\ \textcolor{preprocessor}{\#define\ SYS\_REPORT(DESC,A,B)\ \(\backslash\)}}
\DoxyCodeLine{01930\ \textcolor{preprocessor}{\ \ \ if(\ A\ !=\ B\ )\ \{\ \(\backslash\)}}
\DoxyCodeLine{01931\ \textcolor{preprocessor}{\ \ \ \ \ \ elog("{}\$\{desc\}:\ \$\{bv\}\ !=\ \$\{abv\}"{},\ ("{}desc"{},\ DESC)("{}bv"{},\ A)("{}abv"{},\ B));\ \(\backslash\)}}
\DoxyCodeLine{01932\ \textcolor{preprocessor}{\ \ \ \}}}
\DoxyCodeLine{01933\ }
\DoxyCodeLine{01934\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ \textcolor{stringliteral}{"{}timestamp"{}},\ b.timestamp,\ ab.timestamp\ )}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}producer"{},\ b.producer,\ ab.producer\ )}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}confirmed"{},\ b.confirmed,\ ab.confirmed\ )}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}previous"{},\ b.previous,\ ab.previous\ )}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}transaction\_mroot"{},\ b.transaction\_mroot,\ ab.transaction\_mroot\ )}
\DoxyCodeLine{01939\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}action\_mroot"{},\ b.action\_mroot,\ ab.action\_mroot\ )}
\DoxyCodeLine{01940\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}schedule\_version"{},\ b.schedule\_version,\ ab.schedule\_version\ )}
\DoxyCodeLine{01941\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}new\_producers"{},\ b.new\_producers,\ ab.new\_producers\ )}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \mbox{\hyperlink{controller_8cpp_aefcef1ac3f0ac4f01876837e1e9f66d7}{SYS\_REPORT}}(\ "{}header\_extensions"{},\ b.header\_extensions,\ ab.header\_extensions\ )}
\DoxyCodeLine{01943\ }
\DoxyCodeLine{01944\ \textcolor{preprocessor}{\#undef\ SYS\_REPORT}}
\DoxyCodeLine{01945\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_af932f3160706510eaf30e2b76f386973_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!scheduled\_failure\_is\_subjective@{scheduled\_failure\_is\_subjective}}
\index{scheduled\_failure\_is\_subjective@{scheduled\_failure\_is\_subjective}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{scheduled\_failure\_is\_subjective()}{scheduled\_failure\_is\_subjective()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1} 
bool sysio\+::chain\+::controller\+\_\+impl\+::scheduled\+\_\+failure\+\_\+is\+\_\+subjective (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classfc_1_1exception}{fc\+::exception}} \&}]{e}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01212}{1212}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ code\ =\ e.\mbox{\hyperlink{classfc_1_1exception_a79a36225cde10dcd23057bbe19d3390f}{code}}();}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ \ \ (code\ ==\ tx\_cpu\_usage\_exceeded::code\_value)}
\DoxyCodeLine{01215\ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ad0d5a921dd01458d1464f63b0f0121c6}{failure\_is\_subjective}}(e);}
\DoxyCodeLine{01216\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_ab9468e19953b5bb9ace497c98ee4ecc1_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!sender\_avoids\_whitelist\_blacklist\_enforcement@{sender\_avoids\_whitelist\_blacklist\_enforcement}}
\index{sender\_avoids\_whitelist\_blacklist\_enforcement@{sender\_avoids\_whitelist\_blacklist\_enforcement}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{sender\_avoids\_whitelist\_blacklist\_enforcement()}{sender\_avoids\_whitelist\_blacklist\_enforcement()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735} 
bool sysio\+::chain\+::controller\+\_\+impl\+::sender\+\_\+avoids\+\_\+whitelist\+\_\+blacklist\+\_\+enforcement (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}}]{sender}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02397}{2397}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02398\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a8440b353861fe179036cb8af088323ff}{sender\_bypass\_whiteblacklist}}.size()\ >\ 0\ \&\&}
\DoxyCodeLine{02399\ \ \ \ \ \ \ \ \ \ \ (\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a8440b353861fe179036cb8af088323ff}{sender\_bypass\_whiteblacklist}}.find(\ sender\ )\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}{conf}}.\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config_a8440b353861fe179036cb8af088323ff}{sender\_bypass\_whiteblacklist}}.end()\ )\ )}
\DoxyCodeLine{02400\ \ \ \ \ \ \ \{}
\DoxyCodeLine{02401\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02402\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02403\ }
\DoxyCodeLine{02404\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02405\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_aea41b3020ee2994f7a15980fcbf9b735_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!set\_activation\_handler@{set\_activation\_handler}}
\index{set\_activation\_handler@{set\_activation\_handler}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{set\_activation\_handler()}{set\_activation\_handler()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189} 
template$<$\mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}} F$>$ \\
void sysio\+::chain\+::controller\+\_\+impl\+::set\+\_\+activation\+\_\+handler (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00282}{282}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ res\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\_feature\_activation\_handlers}}.emplace(\ F,\ \&\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab1190a7a5947a5d8441eafcf33fba744}{controller\_impl::on\_activation<F>}}\ );}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ res.second,\ misc\_exception,\ \textcolor{stringliteral}{"{}attempting\ to\ set\ activation\ handler\ twice"{}}\ );}
\DoxyCodeLine{00285\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a2bfcf9116962baafa5ca07d198183189_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a866a2ded537cb72ff21ae968a7940432}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!set\_apply\_handler@{set\_apply\_handler}}
\index{set\_apply\_handler@{set\_apply\_handler}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{set\_apply\_handler()}{set\_apply\_handler()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a866a2ded537cb72ff21ae968a7940432} 
void sysio\+::chain\+::controller\+\_\+impl\+::set\+\_\+apply\+\_\+handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}}]{receiver}{, }\item[{\mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}}]{contract}{, }\item[{\mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\+\_\+name}}}]{action}{, }\item[{\mbox{\hyperlink{namespacesysio_1_1chain_ab143988ae1cae85e839b01eb768804c3}{apply\+\_\+handler}}}]{v}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00293}{293}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a67d7a4050a78ec74aaf524a46bbcdf54}{apply\_handlers}}[receiver][make\_pair(contract,\mbox{\hyperlink{structaction}{action}})]\ =\ \mbox{\hyperlink{namespacedevelop_build_ade64cd34608f9442ef3049116a2da428}{v}};}
\DoxyCodeLine{00295\ \ \ \ \}}

\end{DoxyCode}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!start\_block@{start\_block}}
\index{start\_block@{start\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{start\_block()}{start\_block()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566} 
void sysio\+::chain\+::controller\+\_\+impl\+::start\+\_\+block (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesysio_1_1chain_a11965fc424809ea1802175f8b36ae4e5}{block\+\_\+timestamp\+\_\+type}}}]{when}{, }\item[{\mbox{\hyperlink{stdint_8h_a273cf69d639a59973b6019625df33e30}{uint16\+\_\+t}}}]{confirm\+\_\+block\+\_\+count}{, }\item[{const \mbox{\hyperlink{classfc_1_1vector}{vector}}$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a357fd9478475457e5bb386a3143079b6}{digest\+\_\+type}} $>$ \&}]{new\+\_\+protocol\+\_\+feature\+\_\+activations}{, }\item[{\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6}{controller\+::block\+\_\+status}}}]{s}{, }\item[{const std\+::optional$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a4b8e4b7ed9dcd18ee75d0de62e88aa17}{block\+\_\+id\+\_\+type}} $>$ \&}]{producer\+\_\+block\+\_\+id}{, }\item[{const \mbox{\hyperlink{classfc_1_1time__point}{fc\+::time\+\_\+point}} \&}]{deadline}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l01592}{1592}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01598\ \ \ \ \{}
\DoxyCodeLine{01599\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}},\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},\ \textcolor{stringliteral}{"{}pending\ block\ already\ exists"{}}\ );}
\DoxyCodeLine{01600\ }
\DoxyCodeLine{01601\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a6380e434da95a328ff48ccab33df9cb0}{emit}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_adbf19ff6a0a51a5d85e2be416a586dcc}{block\_start}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1\ );}
\DoxyCodeLine{01602\ }
\DoxyCodeLine{01603\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ dm\_logger\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1b67831f3be3a668c170723427236954}{get\_deep\_mind\_logger}}())\ \{}
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ head\ block\ represents\ the\ block\ just\ before\ this\ one\ that\ is\ about\ to\ start,\ so\ add\ 1\ to\ get\ this\ block\ num}}
\DoxyCodeLine{01605\ \ \ \ \ \ \ \ \ \ dm\_logger-\/>on\_start\_block(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1);}
\DoxyCodeLine{01606\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01607\ }
\DoxyCodeLine{01608\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ guard\_pending\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([\textcolor{keyword}{this},\ head\_block\_num=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num]()\{}
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \ protocol\_features.popped\_blocks\_to(\ head\_block\_num\ );}
\DoxyCodeLine{01610\ \ \ \ \ \ \ \ \ \ pending.reset();}
\DoxyCodeLine{01611\ \ \ \ \ \ \ \});}
\DoxyCodeLine{01612\ }
\DoxyCodeLine{01613\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_ac8eea0639eeef0fc0d304f645b80d884}{skip\_db\_sessions}}(\mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}))\ \{}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num,\ \mbox{\hyperlink{namespacesysio_1_1chain_a6b9cb254135911c4a6d577a9ab7fdd4e}{database\_exception}},\ \textcolor{stringliteral}{"{}db\ revision\ is\ not\ on\ par\ with\ head\ block"{}},}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}db.revision()"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}())(\textcolor{stringliteral}{"{}controller\_head\_block"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num)(\textcolor{stringliteral}{"{}fork\_db\_head\_block"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>block\_num)\ );}
\DoxyCodeLine{01616\ }
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.emplace(\ maybe\_session(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}),\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ when,\ confirm\_block\_count,\ new\_protocol\_feature\_activations\ );}
\DoxyCodeLine{01618\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01619\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}.emplace(\ maybe\_session(),\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}},\ when,\ confirm\_block\_count,\ new\_protocol\_feature\_activations\ );}
\DoxyCodeLine{01620\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01621\ }
\DoxyCodeLine{01622\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ =\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{01623\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_producer\_block\_id\ =\ producer\_block\_id;}
\DoxyCodeLine{01624\ }
\DoxyCodeLine{01625\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ bb\ =\ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage);}
\DoxyCodeLine{01626\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pbhs\ =\ bb.\_pending\_block\_header\_state;}
\DoxyCodeLine{01627\ }
\DoxyCodeLine{01628\ \ \ \ \ \ \ \textcolor{comment}{//\ modify\ state\ of\ speculative\ block\ only\ if\ we\ are\ in\ speculative\ read\ mode\ (otherwise\ we\ need\ clean\ state\ for\ head\ or\ read-\/only\ modes)}}
\DoxyCodeLine{01629\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\_read\_mode::SPECULATIVE}}\ ||\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_status\ !=\ \mbox{\hyperlink{classsysio_1_1chain_1_1controller_a8b5124e077de1a73bb193e9c72b366b6a5ed4e9858ad8d239145ef285b6210a00}{controller::block\_status::incomplete}}\ )}
\DoxyCodeLine{01630\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01631\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pso\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<protocol\_state\_object>();}
\DoxyCodeLine{01632\ }
\DoxyCodeLine{01633\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ num\_preactivated\_protocol\_features\ =\ pso.preactivated\_protocol\_features.size();}
\DoxyCodeLine{01634\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ handled\_all\_preactivated\_features\ =\ (num\_preactivated\_protocol\_features\ ==\ 0);}
\DoxyCodeLine{01635\ }
\DoxyCodeLine{01636\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ new\_protocol\_feature\_activations.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{01637\ \ \ \ \ \ \ \ \ \ \ \ \ flat\_map<digest\_type,\ bool>\ activated\_protocol\_features;}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \ \ \ \ \ \ activated\_protocol\_features.reserve(\ std::max(\ num\_preactivated\_protocol\_features,}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_protocol\_feature\_activations.size()\ )\ );}
\DoxyCodeLine{01640\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ feature\_digest\ :\ pso.preactivated\_protocol\_features\ )\ \{}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ activated\_protocol\_features.emplace(\ feature\_digest,\ \textcolor{keyword}{false}\ );}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01643\ }
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_preactivated\_features\_that\_have\_activated\ =\ 0;}
\DoxyCodeLine{01645\ }
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ pfs\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9e6c1310749c4fd04035aa2c01310ce4}{get\_protocol\_feature\_set}}();}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ feature\_digest\ :\ new\_protocol\_feature\_activations\ )\ \{}
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ =\ pfs.get\_protocol\_feature(\ feature\_digest\ );}
\DoxyCodeLine{01649\ }
\DoxyCodeLine{01650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ res\ =\ activated\_protocol\_features.emplace(\ feature\_digest,\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{01651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ res.second\ )\ \{}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ feature\_digest\ was\ not\ preactivated}}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !\mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}.preactivation\_required,\ protocol\_feature\_exception,}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}attempted\ to\ activate\ protocol\ feature\ without\ prior\ required\ preactivation:\ \$\{digest\}"{}},}
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{01657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ !res.first-\/>second,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}attempted\ duplicate\ activation\ within\ a\ single\ block:\ \$\{digest\}"{}},}
\DoxyCodeLine{01660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}digest"{}},\ feature\_digest)}
\DoxyCodeLine{01661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{01662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ feature\_digest\ was\ preactivated}}
\DoxyCodeLine{01663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ res.first-\/>second\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++num\_preactivated\_features\_that\_have\_activated;}
\DoxyCodeLine{01665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01666\ }
\DoxyCodeLine{01667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}.builtin\_feature\ )\ \{}
\DoxyCodeLine{01668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff}{trigger\_activation\_handler}}(\ *\mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}.builtin\_feature\ );}
\DoxyCodeLine{01669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01670\ }
\DoxyCodeLine{01671\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}{protocol\_features}}.\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager_a9fd76dbd437aa9d52791de3e7893be48}{activate\_feature}}(\ feature\_digest,\ pbhs.block\_num\ );}
\DoxyCodeLine{01672\ }
\DoxyCodeLine{01673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++bb.\_num\_new\_protocol\_features\_that\_have\_activated;}
\DoxyCodeLine{01674\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01675\ }
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ num\_preactivated\_features\_that\_have\_activated\ ==\ num\_preactivated\_protocol\_features\ )\ \{}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ handled\_all\_preactivated\_features\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01678\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01679\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01680\ }
\DoxyCodeLine{01681\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ handled\_all\_preactivated\_features,\ \mbox{\hyperlink{namespacesysio_1_1chain_a910243f6a0327fb2d4fc80f7e89f103e}{block\_validate\_exception}},}
\DoxyCodeLine{01682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}There\ are\ pre-\/activated\ protocol\ features\ that\ were\ not\ activated\ at\ the\ start\ of\ this\ block"{}}}
\DoxyCodeLine{01683\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{01684\ }
\DoxyCodeLine{01685\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ new\_protocol\_feature\_activations.size()\ >\ 0\ )\ \{}
\DoxyCodeLine{01686\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ pso,\ [\&](\ \textcolor{keyword}{auto}\&\ ps\ )\ \{}
\DoxyCodeLine{01687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ps.preactivated\_protocol\_features.clear();}
\DoxyCodeLine{01688\ }
\DoxyCodeLine{01689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ps.activated\_protocol\_features.reserve(\ ps.activated\_protocol\_features.size()}
\DoxyCodeLine{01690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ new\_protocol\_feature\_activations.size()\ );}
\DoxyCodeLine{01691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ feature\_digest\ :\ new\_protocol\_feature\_activations\ )\ \{}
\DoxyCodeLine{01692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ps.activated\_protocol\_features.emplace\_back(\ feature\_digest,\ pbhs.block\_num\ );}
\DoxyCodeLine{01693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01694\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{01695\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01696\ }
\DoxyCodeLine{01697\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_afcfe00f81a526c1376d4f51197dd3a9a}{get}}<global\_property\_object>();}
\DoxyCodeLine{01698\ }
\DoxyCodeLine{01699\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ gpo.proposed\_schedule\_block\_num\ \&\&\ \textcolor{comment}{//\ if\ there\ is\ a\ proposed\ schedule\ that\ was\ proposed\ in\ a\ block\ ...}}
\DoxyCodeLine{01700\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\ *gpo.proposed\_schedule\_block\_num\ <=\ pbhs.dpos\_irreversible\_blocknum\ )\ \&\&\ \textcolor{comment}{//\ ...\ that\ has\ now\ become\ irreversible\ ...}}
\DoxyCodeLine{01701\ \ \ \ \ \ \ \ \ \ \ \ \ \ pbhs.prev\_pending\_schedule.schedule.producers.size()\ ==\ 0\ \textcolor{comment}{//\ ...\ and\ there\ was\ room\ for\ a\ new\ pending\ schedule\ prior\ to\ any\ possible\ promotion}}
\DoxyCodeLine{01702\ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{01703\ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01704\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Promote\ proposed\ schedule\ to\ pending\ schedule.}}
\DoxyCodeLine{01705\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}{replaying}}\ )\ \{}
\DoxyCodeLine{01706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}promoting\ proposed\ schedule\ (set\ in\ block\ \$\{proposed\_num\})\ to\ pending;\ current\ block:\ \$\{n\}\ lib:\ \$\{lib\}\ schedule:\ \$\{schedule\}\ "{}},}
\DoxyCodeLine{01707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}proposed\_num"{}},\ *gpo.proposed\_schedule\_block\_num)(\textcolor{stringliteral}{"{}n"{}},\ pbhs.block\_num)}
\DoxyCodeLine{01708\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}lib"{}},\ pbhs.dpos\_irreversible\_blocknum)}
\DoxyCodeLine{01709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}schedule"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a4b0d95b22a8be15ac06dc3b105638c54}{producer\_authority\_schedule::from\_shared}}(gpo.proposed\_schedule)\ )\ );}
\DoxyCodeLine{01710\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01711\ }
\DoxyCodeLine{01712\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ gpo.proposed\_schedule.version\ ==\ pbhs.active\_schedule\_version\ +\ 1,}
\DoxyCodeLine{01713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ producer\_schedule\_exception,\ \textcolor{stringliteral}{"{}wrong\ producer\ schedule\ version\ specified"{}}\ );}
\DoxyCodeLine{01714\ }
\DoxyCodeLine{01715\ \ \ \ \ \ \ \ \ \ \ \ \ std::get<building\_block>(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>\_block\_stage).\_new\_pending\_producer\_schedule\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority__schedule_a4b0d95b22a8be15ac06dc3b105638c54}{producer\_authority\_schedule::from\_shared}}(gpo.proposed\_schedule);}
\DoxyCodeLine{01716\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(\ gpo,\ [\&](\ \textcolor{keyword}{auto}\&\ gp\ )\ \{}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gp.proposed\_schedule\_block\_num\ =\ std::optional<block\_num\_type>();}
\DoxyCodeLine{01718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gp.proposed\_schedule.version=0;}
\DoxyCodeLine{01719\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gp.proposed\_schedule.producers.clear();}
\DoxyCodeLine{01720\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01722\ }
\DoxyCodeLine{01723\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_ad795329e0af850251f4f47cc32e8d770}{transaction\_metadata\_ptr}}\ onbtrx\ =}
\DoxyCodeLine{01725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_acb14de2d02033c2d43c65319825d3d5b}{transaction\_metadata::create\_no\_recover\_keys}}(\ std::make\_shared<packed\_transaction>(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a3f2b256d3a667ffeed8f7fd03e36c902}{get\_on\_block\_transaction}}()\ ),}
\DoxyCodeLine{01726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1transaction__metadata_a841053d8fa06ceea3cb8096625f053edacd1fed5e3277af3a9210b25059d86ff9}{transaction\_metadata::trx\_type::implicit}}\ );}
\DoxyCodeLine{01727\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ reset\_in\_trx\_requiring\_checks\ =\ \mbox{\hyperlink{namespacefc_a23d89b54a8ffd84f7e7efeb21747d846}{fc::make\_scoped\_exit}}([old\_value=\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}},\textcolor{keyword}{this}]()\{}
\DoxyCodeLine{01728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ old\_value;}
\DoxyCodeLine{01729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{01730\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}{in\_trx\_requiring\_checks}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01731\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ trace\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af381eb0fcede18ab0ae4cddaaa9df6cd}{push\_transaction}}(\ onbtrx,\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}(),\ \mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{fc::microseconds::maximum}}(),}
\DoxyCodeLine{01732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}{self}}.\mbox{\hyperlink{classsysio_1_1chain_1_1controller_a0bb11e832a05b6437c79bf81758b1b7d}{get\_global\_properties}}().\mbox{\hyperlink{classsysio_1_1chain_1_1global__property__object_a7f149fcf87034217c899838eb4430496}{configuration}}.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_a460f6b269c9da35d40b1cc5927c2205a}{min\_transaction\_cpu\_usage}},\ \textcolor{keyword}{true},\ 0\ );}
\DoxyCodeLine{01733\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ trace-\/>except\ )\ \{}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\textcolor{stringliteral}{"{}onblock\ \$\{block\_num\}\ is\ REJECTING:\ \$\{entire\_trace\}"{}},(\textcolor{stringliteral}{"{}block\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num\ +\ 1)(\textcolor{stringliteral}{"{}entire\_trace"{}},\ trace));}
\DoxyCodeLine{01735\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01736\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ std::bad\_alloc\&\ e\ )\ \{}
\DoxyCodeLine{01737\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ a\ std::bad\_alloc"{}}\ );}
\DoxyCodeLine{01738\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01739\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ boost::interprocess::bad\_alloc\&\ e\ )\ \{}
\DoxyCodeLine{01740\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ a\ bad\ allocation"{}}\ );}
\DoxyCodeLine{01741\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw};}
\DoxyCodeLine{01742\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{01743\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed,\ but\ shouldn't\ impact\ block\ generation,\ system\ contract\ needs\ update"{}}\ );}
\DoxyCodeLine{01744\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}()));}
\DoxyCodeLine{01745\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{01746\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ unexpected\ exception"{}}\ );}
\DoxyCodeLine{01747\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a26aaf645dd9dc96836635d6b18bd1090}{edump}}((e.what()));}
\DoxyCodeLine{01748\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ ...\ )\ \{}
\DoxyCodeLine{01749\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}on\ block\ transaction\ failed\ due\ to\ unknown\ exception"{}}\ );}
\DoxyCodeLine{01750\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01751\ }
\DoxyCodeLine{01752\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a338cb13e3b27ade2ee719b5421edcf7e}{clear\_expired\_input\_transactions}}(deadline);}
\DoxyCodeLine{01753\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f}{update\_producers\_authority}}();}
\DoxyCodeLine{01754\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01755\ }
\DoxyCodeLine{01756\ \ \ \ \ \ \ guard\_pending.cancel();}
\DoxyCodeLine{01757\ \ \ \ \}\ }

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a9dbf7da25185959b9a8ea1bf7a47a566_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a90da90c73cb32b5e5ec498da5e02753f}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!startup@{startup}}
\index{startup@{startup}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{startup()}{startup()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a90da90c73cb32b5e5ec498da5e02753f} 
void sysio\+::chain\+::controller\+\_\+impl\+::startup (\begin{DoxyParamCaption}\item[{std\+::function$<$ void()$>$}]{shutdown}{, }\item[{std\+::function$<$ bool()$>$}]{check\+\_\+shutdown}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00618}{618}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ >=\ 1,\ \mbox{\hyperlink{namespacesysio_1_1chain_a6b9cb254135911c4a6d577a9ab7fdd4e}{database\_exception}},\ \textcolor{stringliteral}{"{}This\ version\ of\ controller::startup\ does\ not\ work\ with\ a\ fresh\ state\ database."{}}\ );}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}(),\ \mbox{\hyperlink{namespacesysio_1_1chain_acad19c1ca23d796138841046c67b3ea9}{fork\_database\_exception}},\ \textcolor{stringliteral}{"{}No\ existing\ fork\ database\ despite\ existing\ chain\ state.\ Replay\ required."{}}\ );}
\DoxyCodeLine{00621\ }
\DoxyCodeLine{00622\ \ \ \ \ \ \ this-\/>shutdown\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}};}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>block\_num;}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ first\_block\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}();}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ )\ \{}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ first\_block\_num\ <=\ lib\_num\ \&\&\ lib\_num\ <=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num(),}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ block\_log\_exception,}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ log\ (ranging\ from\ \$\{block\_log\_first\_num\}\ to\ \$\{block\_log\_last\_num\})\ does\ not\ contain\ the\ last\ irreversible\ block\ (\$\{fork\_db\_lib\})"{}},}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_first\_num"{}},\ first\_block\_num)}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_log\_last\_num"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num())}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}fork\_db\_lib"{}},\ lib\_num)}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ lib\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num();}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ first\_block\_num\ !=\ (lib\_num\ +\ 1)\ )\ \{}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ lib\_num\ +\ 1\ );}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00639\ }
\DoxyCodeLine{00640\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a611cc70b13dee823c43ffe99df5522d4}{rollback\_head\_to\_root}}();}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}();}
\DoxyCodeLine{00644\ }
\DoxyCodeLine{00645\ \ \ \ \ \ \ \mbox{\hyperlink{lib_8h_a02fd73d861ef2e4aabb38c0c9ff82947}{init}}(check\_shutdown);}
\DoxyCodeLine{00646\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a90da90c73cb32b5e5ec498da5e02753f_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a7863870ecde398ac7def54e4814db6bc}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!startup@{startup}}
\index{startup@{startup}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{startup()}{startup()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a7863870ecde398ac7def54e4814db6bc} 
void sysio\+::chain\+::controller\+\_\+impl\+::startup (\begin{DoxyParamCaption}\item[{std\+::function$<$ void()$>$}]{shutdown}{, }\item[{std\+::function$<$ bool()$>$}]{check\+\_\+shutdown}{, }\item[{const \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\+\_\+state}} \&}]{genesis}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00585}{585}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a224fc0c346a93fd027bfa2515f54bf98}{revision}}()\ <\ 1,\ \mbox{\hyperlink{namespacesysio_1_1chain_a6b9cb254135911c4a6d577a9ab7fdd4e}{database\_exception}},\ \textcolor{stringliteral}{"{}This\ version\ of\ controller::startup\ only\ works\ with\ a\ fresh\ state\ database."{}}\ );}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ genesis\_chain\_id\ =\ genesis.compute\_chain\_id();}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ genesis\_chain\_id\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ chain\_id\_type\_exception,}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}genesis\ state\ provided\ to\ startup\ corresponds\ to\ a\ chain\ ID\ (\$\{genesis\_chain\_id\})\ that\ does\ not\ match\ the\ chain\ ID\ that\ controller\ was\ constructed\ with\ (\$\{controller\_chain\_id\})"{}},}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}genesis\_chain\_id"{}},\ genesis\_chain\_id)(\textcolor{stringliteral}{"{}controller\_chain\_id"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}})}
\DoxyCodeLine{00591\ \ \ \ \ \ \ );}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \ \ \ \ \ \ this-\/>shutdown\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}};}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}{read\_mode}}\ ==\ \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea88537e4e57a14e27d354f8ef6fc03d63}{db\_read\_mode::IRREVERSIBLE}}\ \&\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ !=\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a31db3526cc966f5db1046cebcfc45219}{root}}()-\/>id\ )\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a611cc70b13dee823c43ffe99df5522d4}{rollback\_head\_to\_root}}();}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}No\ existing\ chain\ state.\ Initializing\ fresh\ blockchain\ state."{}}\ );}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a1759e5c9691d8ad754bdf5eff8bb23ac}{wlog}}(\ \textcolor{stringliteral}{"{}No\ existing\ chain\ state\ or\ fork\ database.\ Initializing\ fresh\ blockchain\ state\ and\ resetting\ fork\ database."{}});}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8d08d7c15ecb706c0bd54e992019c30d}{initialize\_blockchain\_state}}(genesis);\ \textcolor{comment}{//\ sets\ head\ to\ genesis\ state}}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()\ )\ \{}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}{fork\_db}}.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a7dd3012e6d7e68e24b2f223d5be09c02}{reset}}(\ *\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}\ );}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ )\ \{}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ ==\ 1,\ block\_log\_exception,}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}block\ log\ does\ not\ start\ with\ genesis\ block"{}}}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ genesis,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\ );}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \mbox{\hyperlink{lib_8h_a02fd73d861ef2e4aabb38c0c9ff82947}{init}}(check\_shutdown);}
\DoxyCodeLine{00616\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a7863870ecde398ac7def54e4814db6bc_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a18bcf25847599b0f9caa6566364bb0ac}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!startup@{startup}}
\index{startup@{startup}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{startup()}{startup()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a18bcf25847599b0f9caa6566364bb0ac} 
void sysio\+::chain\+::controller\+\_\+impl\+::startup (\begin{DoxyParamCaption}\item[{std\+::function$<$ void()$>$}]{shutdown}{, }\item[{std\+::function$<$ bool()$>$}]{check\+\_\+shutdown}{, }\item[{const \mbox{\hyperlink{namespacesysio_1_1chain_aaa27dacddc54cea475602788c8e7a02c}{snapshot\+\_\+reader\+\_\+ptr}} \&}]{snapshot}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00557}{557}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ snapshot,\ snapshot\_exception,\ \textcolor{stringliteral}{"{}No\ snapshot\ reader\ provided"{}}\ );}
\DoxyCodeLine{00559\ \ \ \ \ \ \ this-\/>shutdown\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}};}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}Starting\ initialization\ from\ snapshot,\ this\ may\ take\ a\ significant\ amount\ of\ time"{}}\ );}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ snapshot-\/>validate();}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\ )\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}{read\_from\_snapshot}}(\ snapshot,\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}(),\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()-\/>block\_num()\ );}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a247c87d241e707c5e482c3d6d8872a7f}{read\_from\_snapshot}}(\ snapshot,\ 0,\ std::numeric\_limits<uint32\_t>::max()\ );}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib\_num\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}{head}}-\/>block\_num;}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ lib\_num\ >\ 0,\ snapshot\_exception,}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Snapshot\ indicates\ controller\ head\ at\ block\ number\ 0,\ but\ that\ is\ not\ allowed.\ "{}}}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Snapshot\ is\ invalid."{}}\ );}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}{blog}}.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}{chain\_id}},\ lib\_num\ +\ 1\ );}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ hash\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ae80ad4ddd1eff225dc19c50439d82ef6}{calculate\_integrity\_hash}}();}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}database\ initialized\ with\ hash:\ \$\{hash\}"{}},\ (\textcolor{stringliteral}{"{}hash"{}},\ hash)\ );}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{lib_8h_a02fd73d861ef2e4aabb38c0c9ff82947}{init}}(check\_shutdown);}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}Finished\ initialization\ from\ snapshot"{}}\ );}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (boost::interprocess::bad\_alloc\&\ e)\ \{}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}Failed\ initialization\ from\ snapshot\ -\/\ db\ storage\ not\ configured\ to\ have\ enough\ storage\ for\ the\ provided\ snapshot,\ please\ increase\ and\ retry\ snapshot"{}}\ );}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}{shutdown}}();}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00583\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a18bcf25847599b0f9caa6566364bb0ac_cgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!trigger\_activation\_handler@{trigger\_activation\_handler}}
\index{trigger\_activation\_handler@{trigger\_activation\_handler}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{trigger\_activation\_handler()}{trigger\_activation\_handler()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff} 
void sysio\+::chain\+::controller\+\_\+impl\+::trigger\+\_\+activation\+\_\+handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}}}]{f}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00287}{287}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ itr\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\_feature\_activation\_handlers}}.find(\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}\ );}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ itr\ ==\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}{protocol\_feature\_activation\_handlers}}.end()\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00290\ \ \ \ \ \ \ (itr-\/>second)(\ *\textcolor{keyword}{this}\ );}
\DoxyCodeLine{00291\ \ \ \ \}}

\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a9335673a748ff21decfddf837016e2ff_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!update\_producers\_authority@{update\_producers\_authority}}
\index{update\_producers\_authority@{update\_producers\_authority}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{update\_producers\_authority()}{update\_producers\_authority()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f} 
void sysio\+::chain\+::controller\+\_\+impl\+::update\+\_\+producers\+\_\+authority (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l02334}{2334}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02335\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}{pending}}-\/>get\_pending\_block\_header\_state().active\_schedule.producers;}
\DoxyCodeLine{02336\ }
\DoxyCodeLine{02337\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ update\_permission\ =\ [\&](\ \textcolor{keyword}{auto}\&\ permission,\ \textcolor{keyword}{auto}\ threshold\ )\ \{}
\DoxyCodeLine{02338\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ auth\ =\ authority(\ threshold,\ \{\},\ \{\});}
\DoxyCodeLine{02339\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}\ :\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}\ )\ \{}
\DoxyCodeLine{02340\ \ \ \ \ \ \ \ \ \ \ \ \ auth.accounts.push\_back(\{\{\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name,\ config::active\_name\},\ 1\});}
\DoxyCodeLine{02341\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02342\ }
\DoxyCodeLine{02343\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \textcolor{keyword}{static\_cast<}authority\textcolor{keyword}{>}(permission.auth)\ !=\ auth\ )\ \{\ \textcolor{comment}{//\ TODO:\ use\ a\ more\ efficient\ way\ to\ check\ that\ authority\ has\ not\ changed}}
\DoxyCodeLine{02344\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a9ebc006075e8fc2e84357a0e068b58d4}{modify}}(permission,\ [\&](\ \textcolor{keyword}{auto}\&\ po\ )\ \{}
\DoxyCodeLine{02345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ po.auth\ =\ auth;}
\DoxyCodeLine{02346\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{02347\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02348\ \ \ \ \ \ \ \};}
\DoxyCodeLine{02349\ }
\DoxyCodeLine{02350\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ num\_producers\ =\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.size();}
\DoxyCodeLine{02351\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ calculate\_threshold\ =\ [=](\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ numerator,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ denominator\ )\ \{}
\DoxyCodeLine{02352\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\ (num\_producers\ *\ numerator)\ /\ denominator\ )\ +\ 1;}
\DoxyCodeLine{02353\ \ \ \ \ \ \ \};}
\DoxyCodeLine{02354\ }
\DoxyCodeLine{02355\ \ \ \ \ \ \ update\_permission(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,}
\DoxyCodeLine{02356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::active\_name\}),}
\DoxyCodeLine{02357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ calculate\_threshold(\ 2,\ 3\ )\ \textcolor{comment}{/*\ more\ than\ two-\/thirds\ */}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02358\ }
\DoxyCodeLine{02359\ \ \ \ \ \ \ update\_permission(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,}
\DoxyCodeLine{02360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::majority\_producers\_permission\_name\}),}
\DoxyCodeLine{02361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ calculate\_threshold(\ 1,\ 2\ )\ \textcolor{comment}{/*\ more\ than\ one-\/half\ */}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02362\ }
\DoxyCodeLine{02363\ \ \ \ \ \ \ update\_permission(\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}{authorization}}.\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager_a96924f6aca32a602e24d991d12278a69}{get\_permission}}(\{config::producers\_account\_name,}
\DoxyCodeLine{02364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ config::minority\_producers\_permission\_name\}),}
\DoxyCodeLine{02365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ calculate\_threshold(\ 1,\ 3\ )\ \textcolor{comment}{/*\ more\ than\ one-\/third\ */}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{02366\ }
\DoxyCodeLine{02367\ \ \ \ \ \ \ \textcolor{comment}{//TODO:\ Add\ tests}}
\DoxyCodeLine{02368\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_a69d180992926a229a5e3573ea09d762f_icgraph}
\end{center}
\end{figure}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!validate\_db\_version@{validate\_db\_version}}
\index{validate\_db\_version@{validate\_db\_version}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{validate\_db\_version()}{validate\_db\_version()}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139} 
static auto sysio\+::chain\+::controller\+\_\+impl\+::validate\+\_\+db\+\_\+version (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classchainbase_1_1database}{chainbase\+::database}} \&}]{db}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00649}{649}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \textcolor{comment}{//\ check\ database\ version}}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ header\_idx\ =\ \mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}{db}}.\mbox{\hyperlink{classchainbase_1_1database_a4d5297635dcf70be481d9b600da9bc13}{get\_index}}<\mbox{\hyperlink{namespacesysio_1_1chain_a7d61e01ac919d654401a1db8399a3945}{database\_header\_multi\_index}}>().indices().get<by\_id>();}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(header\_idx.begin()\ !=\ header\_idx.end(),\ bad\_database\_version\_exception,}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}state\ database\ version\ pre-\/dates\ versioning,\ please\ restore\ from\ a\ compatible\ snapshot\ or\ replay!"{}});}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ header\_itr\ =\ header\_idx.begin();}
\DoxyCodeLine{00657\ \ \ \ \ \ \ header\_itr-\/>validate();}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ header\_itr;}
\DoxyCodeLine{00660\ \ \ \ \}}

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{structsysio_1_1chain_1_1controller__impl_addaaa85d266d34e5f247ec9214354139_icgraph}
\end{center}
\end{figure}


\doxysubsection{Member Data Documentation}
\Hypertarget{structsysio_1_1chain_1_1controller__impl_a67d7a4050a78ec74aaf524a46bbcdf54}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!apply\_handlers@{apply\_handlers}}
\index{apply\_handlers@{apply\_handlers}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{apply\_handlers}{apply\_handlers}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a67d7a4050a78ec74aaf524a46bbcdf54} 
map$<$ \mbox{\hyperlink{namespacesysio_1_1chain_ac32ce8e75243f2b3f76aff0c1984f11b}{account\+\_\+name}}, map$<$\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_a80cb28cfbb823c8688106b0229d0169c}{handler\+\_\+key}}, \mbox{\hyperlink{namespacesysio_1_1chain_ab143988ae1cae85e839b01eb768804c3}{apply\+\_\+handler}}$>$ $>$ sysio\+::chain\+::controller\+\_\+impl\+::apply\+\_\+handlers}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00256}{256}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!authorization@{authorization}}
\index{authorization@{authorization}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{authorization}{authorization}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ab90d295ac18fa98f2520e4eade5b3773} 
\mbox{\hyperlink{classsysio_1_1chain_1_1authorization__manager}{authorization\+\_\+manager}} sysio\+::chain\+::controller\+\_\+impl\+::authorization}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00238}{238}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!blog@{blog}}
\index{blog@{blog}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{blog}{blog}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a958ab2b868a2a7ec9644199a80e0ad9e} 
\mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{block\+\_\+log}} sysio\+::chain\+::controller\+\_\+impl\+::blog}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00232}{232}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!chain\_id@{chain\_id}}
\index{chain\_id@{chain\_id}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{chain\_id}{chain\_id}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a2f7115cf9c5daa3abca8e0467dce5a5a} 
const \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\+\_\+id\+\_\+type}} sysio\+::chain\+::controller\+\_\+impl\+::chain\+\_\+id}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00241}{241}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!conf@{conf}}
\index{conf@{conf}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{conf}{conf}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a048ac8e4d4436902a1888df13575b252} 
\mbox{\hyperlink{structsysio_1_1chain_1_1controller_1_1config}{controller\+::config}} sysio\+::chain\+::controller\+\_\+impl\+::conf}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00240}{240}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!db@{db}}
\index{db@{db}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{db}{db}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a1c3e5eaaf816a6fa2f790cd2ef6dbdce} 
\mbox{\hyperlink{classchainbase_1_1database}{chainbase\+::database}} sysio\+::chain\+::controller\+\_\+impl\+::db}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00231}{231}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a4f73eb03cb9df364b792166a70f78320}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!deep\_mind\_logger@{deep\_mind\_logger}}
\index{deep\_mind\_logger@{deep\_mind\_logger}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{deep\_mind\_logger}{deep\_mind\_logger}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a4f73eb03cb9df364b792166a70f78320} 
\mbox{\hyperlink{classsysio_1_1chain_1_1deep__mind__handler}{deep\+\_\+mind\+\_\+handler}}\texorpdfstring{$\ast$}{*} sysio\+::chain\+::controller\+\_\+impl\+::deep\+\_\+mind\+\_\+logger = nullptr}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00250}{250}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!fork\_db@{fork\_db}}
\index{fork\_db@{fork\_db}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{fork\_db}{fork\_db}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af7f72e6389799b7921aa98f30534f0d9} 
\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database}{fork\+\_\+database}} sysio\+::chain\+::controller\+\_\+impl\+::fork\+\_\+db}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00235}{235}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!head@{head}}
\index{head@{head}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{head}{head}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a56a0f369b58e6597b62569ff2853ee90} 
\mbox{\hyperlink{namespacesysio_1_1chain_ab9b14f4554cc4a0da2c361e9757b1662}{block\+\_\+state\+\_\+ptr}} sysio\+::chain\+::controller\+\_\+impl\+::head}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00234}{234}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!in\_trx\_requiring\_checks@{in\_trx\_requiring\_checks}}
\index{in\_trx\_requiring\_checks@{in\_trx\_requiring\_checks}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{in\_trx\_requiring\_checks}{in\_trx\_requiring\_checks}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ab02dbb970f5b16869e123b77eb090e9b} 
bool sysio\+::chain\+::controller\+\_\+impl\+::in\+\_\+trx\+\_\+requiring\+\_\+checks = false}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00244}{244}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!pending@{pending}}
\index{pending@{pending}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{pending}{pending}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a0e355919fd924a05344ef2b59f7dd587} 
std\+::optional$<$\mbox{\hyperlink{structsysio_1_1chain_1_1pending__state}{pending\+\_\+state}}$>$ sysio\+::chain\+::controller\+\_\+impl\+::pending}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00233}{233}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!protocol\_feature\_activation\_handlers@{protocol\_feature\_activation\_handlers}}
\index{protocol\_feature\_activation\_handlers@{protocol\_feature\_activation\_handlers}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{protocol\_feature\_activation\_handlers}{protocol\_feature\_activation\_handlers}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ac9a42879c69a343b4405b035e7cff29a} 
unordered\+\_\+map$<$ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}}, std\+::function$<$void(\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl}{controller\+\_\+impl}}\&)$>$, \mbox{\hyperlink{structsysio_1_1chain_1_1enum__hash}{enum\+\_\+hash}}$<$\mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cf}{builtin\+\_\+protocol\+\_\+feature\+\_\+t}}$>$ $>$ sysio\+::chain\+::controller\+\_\+impl\+::protocol\+\_\+feature\+\_\+activation\+\_\+handlers}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00257}{257}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!protocol\_features@{protocol\_features}}
\index{protocol\_features@{protocol\_features}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{protocol\_features}{protocol\_features}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a24a100a7be5e562ac3966924b0c9ccb6} 
\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__feature__manager}{protocol\+\_\+feature\+\_\+manager}} sysio\+::chain\+::controller\+\_\+impl\+::protocol\+\_\+features}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00239}{239}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!read\_mode@{read\_mode}}
\index{read\_mode@{read\_mode}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{read\_mode}{read\_mode}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a4a18397f763ebe4880b6ccd970bedf85} 
\mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5e}{db\+\_\+read\+\_\+mode}} sysio\+::chain\+::controller\+\_\+impl\+::read\+\_\+mode = \mbox{\hyperlink{namespacesysio_1_1chain_af3e35f3e1b78dd00fa247009a2d9ba5ea26ca3b6826ca765f741f39ec4754d581}{db\+\_\+read\+\_\+mode\+::\+SPECULATIVE}}}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00243}{243}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!replaying@{replaying}}
\index{replaying@{replaying}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{replaying}{replaying}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a3bd1eefa999ba89597c3686e0acc463e} 
bool sysio\+::chain\+::controller\+\_\+impl\+::replaying = false}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00242}{242}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!resource\_limits@{resource\_limits}}
\index{resource\_limits@{resource\_limits}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{resource\_limits}{resource\_limits}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a83a037a61ce8e07b39d2d38b0f54f8f7} 
\mbox{\hyperlink{classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager}{resource\+\_\+limits\+\_\+manager}} sysio\+::chain\+::controller\+\_\+impl\+::resource\+\_\+limits}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00237}{237}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a342fd89592616d7ca931ff64fe75ead7}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!rnh@{rnh}}
\index{rnh@{rnh}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{rnh}{rnh}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a342fd89592616d7ca931ff64fe75ead7} 
\mbox{\hyperlink{structsysio_1_1chain_1_1controller__impl_1_1reset__new__handler}{reset\+\_\+new\+\_\+handler}} sysio\+::chain\+::controller\+\_\+impl\+::rnh}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00228}{228}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!self@{self}}
\index{self@{self}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{self}{self}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a64851fb4e041dc49ab22cf2ba335720d} 
\mbox{\hyperlink{classsysio_1_1chain_1_1controller}{controller}}\& sysio\+::chain\+::controller\+\_\+impl\+::self}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00229}{229}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!shutdown@{shutdown}}
\index{shutdown@{shutdown}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{shutdown}{shutdown}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_a8054e1b3da405a7765275b76d6628928} 
std\+::function$<$void()$>$ sysio\+::chain\+::controller\+\_\+impl\+::shutdown}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00230}{230}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!snapshot\_head\_block@{snapshot\_head\_block}}
\index{snapshot\_head\_block@{snapshot\_head\_block}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{snapshot\_head\_block}{snapshot\_head\_block}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_afe8c6fe322a239e2f910f26a385786f0} 
\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\+\_\+t}} sysio\+::chain\+::controller\+\_\+impl\+::snapshot\+\_\+head\+\_\+block = 0}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00247}{247}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!subjective\_cpu\_leeway@{subjective\_cpu\_leeway}}
\index{subjective\_cpu\_leeway@{subjective\_cpu\_leeway}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{subjective\_cpu\_leeway}{subjective\_cpu\_leeway}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ab952243b3b18aaec46cce82670687075} 
std\+::optional$<$\mbox{\hyperlink{classfc_1_1microseconds}{fc\+::microseconds}}$>$ sysio\+::chain\+::controller\+\_\+impl\+::subjective\+\_\+cpu\+\_\+leeway}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00245}{245}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!thread\_pool@{thread\_pool}}
\index{thread\_pool@{thread\_pool}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{thread\_pool}{thread\_pool}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ab76d9091b7e62fb25a0fdd63c8210af9} 
\mbox{\hyperlink{classsysio_1_1chain_1_1named__thread__pool}{named\+\_\+thread\+\_\+pool}} sysio\+::chain\+::controller\+\_\+impl\+::thread\+\_\+pool}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00248}{248}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!timer@{timer}}
\index{timer@{timer}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{timer}{timer}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_ad3c19aea29c2fbb28ca7120d591ba088} 
\mbox{\hyperlink{structsysio_1_1chain_1_1platform__timer}{platform\+\_\+timer}} sysio\+::chain\+::controller\+\_\+impl\+::timer}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00249}{249}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!trusted\_producer\_light\_validation@{trusted\_producer\_light\_validation}}
\index{trusted\_producer\_light\_validation@{trusted\_producer\_light\_validation}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{trusted\_producer\_light\_validation}{trusted\_producer\_light\_validation}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af3f88c130012bd7de2401b5b80fd3129} 
bool sysio\+::chain\+::controller\+\_\+impl\+::trusted\+\_\+producer\+\_\+light\+\_\+validation = false}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00246}{246}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.

\Hypertarget{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27}\index{sysio::chain::controller\_impl@{sysio::chain::controller\_impl}!wasmif@{wasmif}}
\index{wasmif@{wasmif}!sysio::chain::controller\_impl@{sysio::chain::controller\_impl}}
\doxysubsubsection{\texorpdfstring{wasmif}{wasmif}}
{\footnotesize\ttfamily \label{structsysio_1_1chain_1_1controller__impl_af94aa57dba3a7504a8047a11d37c3b27} 
\mbox{\hyperlink{classsysio_1_1chain_1_1wasm__interface}{wasm\+\_\+interface}} sysio\+::chain\+::controller\+\_\+impl\+::wasmif}



Definition at line \mbox{\hyperlink{controller_8cpp_source_l00236}{236}} of file \mbox{\hyperlink{controller_8cpp_source}{controller.\+cpp}}.



The documentation for this struct was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
libraries/chain/\mbox{\hyperlink{controller_8cpp}{controller.\+cpp}}\end{DoxyCompactItemize}
