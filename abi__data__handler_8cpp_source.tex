\doxysection{abi\+\_\+data\+\_\+handler.\+cpp}
\hypertarget{abi__data__handler_8cpp_source}{}\label{abi__data__handler_8cpp_source}\index{plugins/trace\_api\_plugin/abi\_data\_handler.cpp@{plugins/trace\_api\_plugin/abi\_data\_handler.cpp}}
\mbox{\hyperlink{abi__data__handler_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{abi__data__handler_8hpp}{sysio/trace\_api/abi\_data\_handler.hpp}}>}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{abi__serializer_8hpp}{sysio/chain/abi\_serializer.hpp}}>}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00004}\mbox{\hyperlink{namespacesysio_1_1trace__api}{00004}}\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio_1_1trace__api}{sysio::trace\_api}}\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00006}\mbox{\hyperlink{classsysio_1_1trace__api_1_1abi__data__handler_a45fdfd7e086c2f51e3d1da63c4c5ef36}{00006}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1abi__data__handler_a45fdfd7e086c2f51e3d1da63c4c5ef36}{abi\_data\_handler::add\_abi}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{chain::name}}\&\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1abi__def}{chain::abi\_def}}\&\ abi\ )\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00007}00007\ \ \ \ \ \ \ \textcolor{comment}{//\ currently\ abis\ are\ operator\ provided\ so\ no\ need\ to\ protect\ against\ abuse}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00008}00008\ \ \ \ \ \ \ abi\_serializer\_by\_account.emplace(\mbox{\hyperlink{structsysio_1_1chain_1_1name}{name}},}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00009}00009\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_shared<chain::abi\_serializer>(abi,\ \mbox{\hyperlink{structsysio_1_1chain_1_1abi__serializer_a2dc34bf706557f0c83d61b3791299c98}{chain::abi\_serializer::create\_yield\_function}}(\mbox{\hyperlink{classfc_1_1microseconds_afc3eb0bfd792c7b1cda062e559e30c2e}{fc::microseconds::maximum}}())));}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00010}00010\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00012}\mbox{\hyperlink{classsysio_1_1trace__api_1_1abi__data__handler_a71b5e1285cd06e8e0aef49f35b5f31c2}{00012}}\ \ \ \ std::tuple<fc::variant,\ std::optional<fc::variant>>\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1abi__data__handler_a71b5e1285cd06e8e0aef49f35b5f31c2}{abi\_data\_handler::serialize\_to\_variant}}(\textcolor{keyword}{const}\ std::variant<action\_trace\_v0,\ action\_trace\_v1>\ \&\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{yield\_function}}\&\ yield\ )\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00013}00013\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ account\ =\ std::visit([](\textcolor{keyword}{auto}\ \&\&\mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}})\ -\/>\ \textcolor{keyword}{auto}\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}.\mbox{\hyperlink{structsysio_1_1chain_1_1action__base_a3598da3f8df67037e69dab758ce168be}{account}};\ \},\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}});}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00015}00015\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abi\_serializer\_by\_account.count(account)\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00016}00016\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&serializer\_p\ =\ abi\_serializer\_by\_account.at(account);}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00017}00017\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}}\ =\ std::visit([](\textcolor{keyword}{auto}\ \&\&\mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}})\ -\/>\ \textcolor{keyword}{auto}\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}.\mbox{\hyperlink{structsysio_1_1chain_1_1action_a2937abc747fb2c2aed4d986c047ea99a}{action}};\ \},\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}});}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00018}00018\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacesysio_1_1chain_a007674e7dd512662e202e2a3268da2c4}{type\_name}}\ =\ serializer\_p-\/>get\_action\_type(\mbox{\hyperlink{namespacesysio_1_1chain_a7a1685bcc352cda9e45f055932069428}{action\_name}});}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00020}00020\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespacesysio_1_1chain_a007674e7dd512662e202e2a3268da2c4}{type\_name}}.empty())\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00021}00021\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00022}00022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ abi\_serializer\ expects\ a\ yield\ function\ that\ takes\ a\ recursion\ depth}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00023}00023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ abi\_yield\ =\ [yield](\textcolor{keywordtype}{size\_t}\ recursion\_depth)\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00024}00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ yield();}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00025}00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ recursion\_depth\ <\ \mbox{\hyperlink{structsysio_1_1chain_1_1abi__serializer_a1d6521ad70c99a7d68c0e59b595ce6f5}{chain::abi\_serializer::max\_recursion\_depth}},\ chain::abi\_recursion\_depth\_exception,}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}exceeded\ max\_recursion\_depth\ \$\{r\}\ "{}},\ (\textcolor{stringliteral}{"{}r"{}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1abi__serializer_a1d6521ad70c99a7d68c0e59b595ce6f5}{chain::abi\_serializer::max\_recursion\_depth}})\ );}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00027}00027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00028}00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::visit([\&](\textcolor{keyword}{auto}\ \&\&\mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}})\ -\/>\ std::tuple<\mbox{\hyperlink{classfc_1_1variant}{fc::variant}},\ std::optional<fc::variant>>\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00029}00029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{prettywritertest_8cpp_a6283df8c4e365cc8a01727e2d7ad44bf}{T}}\ =\ std::decay\_t<\textcolor{keyword}{decltype}(\mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}})>;}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00030}00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::optional<fc::variant>\ ret\_data;}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00031}00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params}{params}}\ =\ serializer\_p-\/>binary\_to\_variant(\mbox{\hyperlink{namespacesysio_1_1chain_a007674e7dd512662e202e2a3268da2c4}{type\_name}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}.\mbox{\hyperlink{structsysio_1_1chain_1_1action_abeb8e7f99c1779b22ebcd13f534f0205}{data}},\ abi\_yield);}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00032}00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same\_v<T,\ action\_trace\_v1>)\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00033}00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}.return\_value.size()\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00034}00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ret\_data\ =\ serializer\_p-\/>binary\_to\_variant(\mbox{\hyperlink{namespacesysio_1_1chain_a007674e7dd512662e202e2a3268da2c4}{type\_name}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}}.return\_value,\ abi\_yield);}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00035}00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00036}00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00037}00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{namespacefc_a3a1a89eb370c7c0b0c7cf9bfa0bb0c71}{params}},\ ret\_data\};}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00038}00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \},\ \mbox{\hyperlink{structsysio_1_1chain_1_1action}{action}});}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00039}00039\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (...)\ \{}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ except\_handler(\mbox{\hyperlink{plugins_2trace__api__plugin_2include_2sysio_2trace__api_2common_8hpp_acf999535bf43beecf0513ac65ae0c813}{MAKE\_EXCEPTION\_WITH\_CONTEXT}}(std::current\_exception()));}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00043}00043\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00045}00045\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00046}00046\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{abi__data__handler_8cpp_source_l00047}00047\ \}}

\end{DoxyCode}
