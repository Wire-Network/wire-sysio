\doxysection{privileged.\+cpp}
\hypertarget{privileged_8cpp_source}{}\label{privileged_8cpp_source}\index{libraries/chain/webassembly/privileged.cpp@{libraries/chain/webassembly/privileged.cpp}}
\mbox{\hyperlink{privileged_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{interface_8hpp}{sysio/chain/webassembly/interface.hpp}}>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{global__property__object_8hpp}{sysio/chain/global\_property\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{protocol__state__object_8hpp}{sysio/chain/protocol\_state\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{transaction__context_8hpp}{sysio/chain/transaction\_context.hpp}}>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{resource__limits_8hpp}{sysio/chain/resource\_limits.hpp}}>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00006}00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{apply__context_8hpp}{sysio/chain/apply\_context.hpp}}>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00011}00011\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio}{sysio}}\ \{\ \textcolor{keyword}{namespace\ }chain\ \{\ \textcolor{keyword}{namespace\ }webassembly\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00013}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a4d89d5579b7f00c2cbd84c277de99647}{00013}}\ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a4d89d5579b7f00c2cbd84c277de99647}{interface::is\_feature\_active}}(\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ feature\_name\ )\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00015}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a6f095fe13d127417f0b2abd00c2fcb8e}{00015}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a6f095fe13d127417f0b2abd00c2fcb8e}{interface::activate\_feature}}(\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ feature\_name\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00016}00016\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \textcolor{keyword}{false},\ unsupported\_feature,\ \textcolor{stringliteral}{"{}Unsupported\ Hardfork\ Detected"{}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00017}00017\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00019}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_ae815a045a98f4c5183c20dbf9af1031d}{00019}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_ae815a045a98f4c5183c20dbf9af1031d}{interface::preactivate\_feature}}(\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_ptr<const\ digest\_type>}}\ feature\_digest\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00020}00020\ \ \ \ \ \ \ \mbox{\hyperlink{structcontext}{context}}.control.preactivate\_feature(\ *feature\_digest\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00021}00021\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00023}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_ae2febb2c80d7fa0780b9fdf095ccafa3}{00023}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_ae2febb2c80d7fa0780b9fdf095ccafa3}{interface::set\_resource\_limits}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ account,\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ ram\_bytes,\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ net\_weight,\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ cpu\_weight\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00024}00024\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(ram\_bytes\ >=\ -\/1,\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}invalid\ value\ for\ ram\ resource\ limit\ expected\ [-\/1,INT64\_MAX]"{}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00025}00025\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(net\_weight\ >=\ -\/1,\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}invalid\ value\ for\ net\ resource\ weight\ expected\ [-\/1,INT64\_MAX]"{}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00026}00026\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(cpu\_weight\ >=\ -\/1,\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}invalid\ value\ for\ cpu\ resource\ weight\ expected\ [-\/1,INT64\_MAX]"{}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00027}00027\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structcontext}{context}}.control.get\_mutable\_resource\_limits\_manager().set\_account\_limits(account,\ ram\_bytes,\ net\_weight,\ cpu\_weight)\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00028}00028\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcontext}{context}}.trx\_context.validate\_ram\_usage.insert(\ account\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00029}00029\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00030}00030\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00032}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a964af835d251d9fb76b66174c6b9cc3c}{00032}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a964af835d251d9fb76b66174c6b9cc3c}{interface::get\_resource\_limits}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ account,\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_ptr<int64\_t>}}\ ram\_bytes,\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_ptr<int64\_t>}}\ net\_weight,\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_ptr<int64\_t>}}\ cpu\_weight\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00033}00033\ \ \ \ \ \ \ \mbox{\hyperlink{structcontext}{context}}.control.get\_resource\_limits\_manager().get\_account\_limits(\ account,\ *ram\_bytes,\ *net\_weight,\ *cpu\_weight);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00034}00034\ \ \ \ \ \ \ (void)\mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_ptr<int64\_t>}}(std::move(ram\_bytes));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00035}00035\ \ \ \ \ \ \ (void)\mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_ptr<int64\_t>}}(std::move(net\_weight));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00036}00036\ \ \ \ \ \ \ (void)\mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_ptr<int64\_t>}}(std::move(cpu\_weight));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00037}00037\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00039}\mbox{\hyperlink{namespacesysio_1_1chain_1_1webassembly_a36703bea4b4322951a6be4a908f23299}{00039}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ \mbox{\hyperlink{namespacesysio_1_1chain_1_1webassembly_a36703bea4b4322951a6be4a908f23299}{set\_proposed\_producers\_common}}(\ \mbox{\hyperlink{classsysio_1_1chain_1_1apply__context}{apply\_context}}\&\ \mbox{\hyperlink{structcontext}{context}},\ \mbox{\hyperlink{classfc_1_1vector}{vector<producer\_authority>}}\ \&\&\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}},\ \textcolor{keywordtype}{bool}\ validate\_keys\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00040}00040\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.size()\ <=\ config::max\_producers,\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}Producer\ schedule\ exceeds\ the\ maximum\ producer\ count\ for\ this\ chain"{}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00041}00041\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.size()\ >\ 0}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ !\mbox{\hyperlink{structcontext}{context}}.control.is\_builtin\_activated(\ \mbox{\hyperlink{namespacesysio_1_1chain_a406d45a184cdba0af316b5bf34bf56cfa65ea05874d490a8ea760dd8b76c2c504}{builtin\_protocol\_feature\_t::disallow\_empty\_producer\_schedule}}\ ),}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00043}00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wasm\_execution\_error,}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Producer\ schedule\ cannot\ be\ empty"{}}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00045}00045\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00047}00047\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ num\_supported\_key\_types\ =\ \mbox{\hyperlink{structcontext}{context}}.db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1protocol__state__object}{protocol\_state\_object}}>().num\_supported\_key\_types;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00049}00049\ \ \ \ \ \ \ \textcolor{comment}{//\ check\ that\ producers\ are\ unique}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00050}00050\ \ \ \ \ \ \ std::set<account\_name>\ unique\_producers;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00051}00051\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}:\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}})\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structcontext}{context}}.is\_account(\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name),\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}producer\ schedule\ includes\ a\ nonexisting\ account"{}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ std::visit([\&\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}},\ num\_supported\_key\_types,\ validate\_keys](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}})\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ sum\_weights\ =\ 0;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ std::set<public\_key\_type>\ unique\_keys;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ kw:\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.keys\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ kw.key.which()\ <\ num\_supported\_key\_types,\ unactivated\_key\_type,}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Unactivated\ key\ type\ used\ in\ proposed\ producer\ schedule"{}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ validate\_keys\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ kw.key.valid(),\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}producer\ schedule\ includes\ an\ invalid\ key"{}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::numeric\_limits<uint32\_t>::max()\ -\/\ sum\_weights\ <=\ kw.weight)\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sum\_weights\ =\ std::numeric\_limits<uint32\_t>::max();}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sum\_weights\ +=\ kw.weight;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ unique\_keys.insert(kw.key);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.keys.size()\ ==\ unique\_keys.size(),\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}producer\ schedule\ includes\ a\ duplicated\ key\ for\ \$\{account\}"{}},\ (\textcolor{stringliteral}{"{}account"{}},\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.threshold\ >\ 0,\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}producer\ schedule\ includes\ an\ authority\ with\ a\ threshold\ of\ 0\ for\ \$\{account\}"{}},\ (\textcolor{stringliteral}{"{}account"{}},\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ sum\_weights\ >=\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}.threshold,\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}producer\ schedule\ includes\ an\ unsatisfiable\ authority\ for\ \$\{account\}"{}},\ (\textcolor{stringliteral}{"{}account"{}},\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \},\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.authority);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \ unique\_producers.insert(\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00079}00079\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00080}00080\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.size()\ ==\ unique\_producers.size(),\ wasm\_execution\_error,\ \textcolor{stringliteral}{"{}duplicate\ producer\ name\ in\ producer\ schedule"{}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00082}00082\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structcontext}{context}}.control.set\_proposed\_producers(\ std::move(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}})\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00083}00083\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00085}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a90f227ea255f8735c3ef8fd081775ef4}{00085}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a90f227ea255f8735c3ef8fd081775ef4}{interface::get\_wasm\_parameters\_packed}}(\ \mbox{\hyperlink{classsysio_1_1vm_1_1span}{span<char>}}\ packed\_parameters,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ max\_version\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00086}00086\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{structcontext}{context}}.control.get\_global\_properties();}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00087}00087\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params}{params}}\ =\ gpo.wasm\_configuration;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00088}00088\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ version\ =\ std::min(\ max\_version,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}(0)\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00090}00090\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a64937a5adc8041247f7007882224e225}{fc::raw::pack\_size}}(\ version\ )\ +\ \mbox{\hyperlink{namespacefc_1_1raw_a64937a5adc8041247f7007882224e225}{fc::raw::pack\_size}}(\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params}{params}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00091}00091\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a584ee0404e01edf225142e86d23d6d7d}{size}}()\ ==\ 0\ )}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00094}00094\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ <=\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a584ee0404e01edf225142e86d23d6d7d}{size}}()\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<char*>}}\ ds(\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a65d9e2641d763c860ae175a9a936a309}{data}}(),\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ version);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ \mbox{\hyperlink{structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params}{params}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00098}00098\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00099}00099\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00100}00100\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00101}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a84c2726984e7b8facb8cb6180e964b5f}{00101}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a84c2726984e7b8facb8cb6180e964b5f}{interface::set\_wasm\_parameters\_packed}}(\ \mbox{\hyperlink{classsysio_1_1vm_1_1span}{span<const\ char>}}\ packed\_parameters\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00102}00102\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<const\ char*>}}\ ds(\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a65d9e2641d763c860ae175a9a936a309}{data}}(),\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a584ee0404e01edf225142e86d23d6d7d}{size}}()\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00103}00103\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ version;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00104}00104\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1wasm__config}{chain::wasm\_config}}\ cfg;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00105}00105\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ version);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00106}00106\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(version\ ==\ 0,\ wasm\_config\_unknown\_version,\ \textcolor{stringliteral}{"{}set\_wasm\_parameters\_packed:\ Unknown\ version:\ \$\{version\}"{}},\ (\textcolor{stringliteral}{"{}version"{}},\ version));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00107}00107\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ cfg);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00108}00108\ \ \ \ \ \ \ cfg.\mbox{\hyperlink{structsysio_1_1chain_1_1wasm__config_ab0237cb4af348d20ab9b509c6e19e83d}{validate}}();}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00109}00109\ \ \ \ \ \ \ \mbox{\hyperlink{structcontext}{context}}.db.modify(\ \mbox{\hyperlink{structcontext}{context}}.control.get\_global\_properties(),}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00110}00110\ \ \ \ \ \ \ \ \ \ [\&](\ \textcolor{keyword}{auto}\&\ gprops\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ gprops.wasm\_configuration\ =\ cfg;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00113}00113\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00114}00114\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00115}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_aebd6787969bf07ac25f180a822b54a2b}{00115}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_aebd6787969bf07ac25f180a822b54a2b}{interface::set\_proposed\_producers}}(\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_span<const\ char>}}\ packed\_producer\_schedule)\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00116}00116\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<const\ char*>}}\ ds(\ packed\_producer\_schedule.data(),\ packed\_producer\_schedule.size()\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00117}00117\ \ \ \ \ \ \ std::vector<producer\_authority>\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}};}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00118}00118\ \ \ \ \ \ \ std::vector<legacy::producer\_key>\ old\_version;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00119}00119\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ old\_version);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00121}00121\ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00122}00122\ \textcolor{comment}{\ \ \ \ \ \ \ *\ Up-\/convert\ the\ producers}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00123}00123\ \textcolor{comment}{\ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00124}00124\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}\ :\ old\_version\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}.emplace\_back(\ \mbox{\hyperlink{structsysio_1_1chain_1_1producer__authority}{producer\_authority}}\{\ \mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.producer\_name,\ \mbox{\hyperlink{structsysio_1_1chain_1_1block__signing__authority__v0}{block\_signing\_authority\_v0}}\{\ 1,\ \{\{\mbox{\hyperlink{bn_8cpp_a8b0eadcc506862e9d751ab45185053aa}{p}}.block\_signing\_key,\ 1\}\}\ \}\ \}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00126}00126\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00127}00127\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00128}00128\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_1_1webassembly_a36703bea4b4322951a6be4a908f23299}{set\_proposed\_producers\_common}}(\ \mbox{\hyperlink{structcontext}{context}},\ std::move(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}),\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00129}00129\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00130}00130\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00131}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a6a07f35005fe7f45c085b1969a671d85}{00131}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a6a07f35005fe7f45c085b1969a671d85}{interface::set\_proposed\_producers\_ex}}(\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ packed\_producer\_format,\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_span<const\ char>}}\ packed\_producer\_schedule)\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00132}00132\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (packed\_producer\_format\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_aebd6787969bf07ac25f180a822b54a2b}{set\_proposed\_producers}}(std::move(packed\_producer\_schedule));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00134}00134\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (packed\_producer\_format\ ==\ 1)\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<const\ char*>}}\ ds(\ packed\_producer\_schedule.data(),\ packed\_producer\_schedule.size()\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1vector}{vector<producer\_authority>}}\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}};}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00137}00137\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1chain_1_1webassembly_a36703bea4b4322951a6be4a908f23299}{set\_proposed\_producers\_common}}(\ \mbox{\hyperlink{structcontext}{context}},\ std::move(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a6d42fdcc89e90507ee6f095c8e92fa2b}{producers}}),\ \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00140}00140\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a1bfa656552ea0534b2c91ee0fe33f850}{SYS\_THROW}}(wasm\_execution\_error,\ \textcolor{stringliteral}{"{}Producer\ schedule\ is\ in\ an\ unknown\ format!"{}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00142}00142\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00143}00143\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00144}00144\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00145}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a11cfb435daae512c18709f7e1be3d03b}{00145}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a11cfb435daae512c18709f7e1be3d03b}{interface::get\_blockchain\_parameters\_packed}}(\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_span<char>}}\ packed\_blockchain\_parameters\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00146}00146\ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ gpo\ =\ \mbox{\hyperlink{structcontext}{context}}.control.get\_global\_properties();}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00147}00147\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00148}00148\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a64937a5adc8041247f7007882224e225}{fc::raw::pack\_size}}(\ gpo.configuration.v0()\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00149}00149\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ packed\_blockchain\_parameters.size()\ ==\ 0\ )\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00151}00151\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ <=\ packed\_blockchain\_parameters.size()\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<char*>}}\ ds(\ packed\_blockchain\_parameters.data(),\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00153}00153\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(ds,\ gpo.configuration.v0());}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yubihsm__pkcs11_8c_a506da415c9307c897ca9be93acfe1d0f}{s}};}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00155}00155\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00156}00156\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00157}00157\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00159}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a8c32114ca7c8968d53ac7313bd21be4c}{00159}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a8c32114ca7c8968d53ac7313bd21be4c}{interface::set\_blockchain\_parameters\_packed}}(\ \mbox{\hyperlink{structsysio_1_1vm_1_1argument__proxy}{legacy\_span<const\ char>}}\ packed\_blockchain\_parameters\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00160}00160\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<const\ char*>}}\ ds(\ packed\_blockchain\_parameters.data(),\ packed\_blockchain\_parameters.size()\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00161}00161\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0}{chain::chain\_config\_v0}}\ cfg;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00162}00162\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ cfg);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00163}00163\ \ \ \ \ \ \ cfg.\mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v0_ae96e3222e7161e113ef4182829823595}{validate}}();}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00164}00164\ \ \ \ \ \ \ \mbox{\hyperlink{structcontext}{context}}.db.modify(\ \mbox{\hyperlink{structcontext}{context}}.control.get\_global\_properties(),}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00165}00165\ \ \ \ \ \ \ \ \ \ [\&](\ \textcolor{keyword}{auto}\&\ gprops\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gprops.configuration\ =\ cfg;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00167}00167\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00168}00168\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00169}00169\ \ \ \ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00170}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_aa8725e5c597dcc71a3e57f601607642d}{00170}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_aa8725e5c597dcc71a3e57f601607642d}{interface::get\_parameters\_packed}}(\ \mbox{\hyperlink{classsysio_1_1vm_1_1span}{span<const\ char>}}\ packed\_parameter\_ids,\ \mbox{\hyperlink{classsysio_1_1vm_1_1span}{span<char>}}\ packed\_parameters)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00171}00171\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<const\ char*>}}\ ds\_ids(\ packed\_parameter\_ids.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a65d9e2641d763c860ae175a9a936a309}{data}}(),\ packed\_parameter\_ids.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a584ee0404e01edf225142e86d23d6d7d}{size}}()\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00173}00173\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain::chain\_config}}\ cfg\ =\ \mbox{\hyperlink{structcontext}{context}}.control.get\_global\_properties().configuration;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00174}00174\ \ \ \ \ \ \ std::vector<fc::unsigned\_int>\ ids;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00175}00175\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds\_ids,\ ids);}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00176}00176\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1data__range}{config\_range}}\ \mbox{\hyperlink{namespacesysio_1_1chain_a2955dbe1692a871551e99a1acc835100}{config\_range}}(cfg,\ std::move(ids),\ \{\mbox{\hyperlink{structcontext}{context}}.control\});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00177}00177\ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00178}00178\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ size\ =\ \mbox{\hyperlink{namespacefc_1_1raw_a64937a5adc8041247f7007882224e225}{fc::raw::pack\_size}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1data__range}{config\_range}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00179}00179\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a584ee0404e01edf225142e86d23d6d7d}{size}}()\ ==\ 0\ )\ \textcolor{keywordflow}{return}\ size;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00180}00180\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00181}00181\ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(size\ <=\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a584ee0404e01edf225142e86d23d6d7d}{size}}(),}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chain::config\_parse\_error,}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}get\_parameters\_packed:\ buffer\ size\ is\ smaller\ than\ \$\{size\}"{}},\ (\textcolor{stringliteral}{"{}size"{}},\ size));}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00184}00184\ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00185}00185\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<char*>}}\ ds(\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a65d9e2641d763c860ae175a9a936a309}{data}}(),\ size\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00186}00186\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a3a18d8161aa5b4f4f02b6fcfdff5e5d1}{fc::raw::pack}}(\ ds,\ \mbox{\hyperlink{structsysio_1_1chain_1_1data__range}{config\_range}}\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00187}00187\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ size;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00188}00188\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00189}00189\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00190}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a6fe0029c6e0ed6e35310c3936e1849b6}{00190}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a6fe0029c6e0ed6e35310c3936e1849b6}{interface::set\_parameters\_packed}}(\ \mbox{\hyperlink{classsysio_1_1vm_1_1span}{span<const\ char>}}\ packed\_parameters\ )\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00191}00191\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1datastream}{datastream<const\ char*>}}\ ds(\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a65d9e2641d763c860ae175a9a936a309}{data}}(),\ packed\_parameters.\mbox{\hyperlink{classsysio_1_1vm_1_1span_a584ee0404e01edf225142e86d23d6d7d}{size}}()\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00193}00193\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__config__v1}{chain::chain\_config}}\ cfg\ =\ \mbox{\hyperlink{structcontext}{context}}.control.get\_global\_properties().configuration;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00194}00194\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1data__range}{config\_range}}\ \mbox{\hyperlink{namespacesysio_1_1chain_a2955dbe1692a871551e99a1acc835100}{config\_range}}(cfg,\ \{\mbox{\hyperlink{structcontext}{context}}.control\});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00195}00195\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00196}00196\ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ \mbox{\hyperlink{structsysio_1_1chain_1_1data__range}{config\_range}});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00197}00197\ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00198}00198\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1data__range}{config\_range}}.\mbox{\hyperlink{structsysio_1_1chain_1_1data__range_a92fde83c45a1e84de239c34c4905b1c1}{config}}.validate();}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00199}00199\ \ \ \ \ \ \ \mbox{\hyperlink{structcontext}{context}}.db.modify(\ \mbox{\hyperlink{structcontext}{context}}.control.get\_global\_properties(),}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00200}00200\ \ \ \ \ \ \ \ \ \ [\&](\ \textcolor{keyword}{auto}\&\ gprops\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00201}00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gprops.configuration\ =\ config\_range.config;}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00202}00202\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00203}00203\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00204}00204\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00205}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_ae3c135f8ad6cb62b413d4a1016b3a2b3}{00205}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_ae3c135f8ad6cb62b413d4a1016b3a2b3}{interface::is\_privileged}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ n\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00206}00206\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structcontext}{context}}.db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1account__metadata__object}{account\_metadata\_object}},\ by\_name>(\ n\ ).\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_ae3c135f8ad6cb62b413d4a1016b3a2b3}{is\_privileged}}();}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00207}00207\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00208}00208\ }
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00209}\mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a513bf4a6dd87742111a4d90a48d55108}{00209}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1webassembly_1_1interface_a513bf4a6dd87742111a4d90a48d55108}{interface::set\_privileged}}(\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ n,\ \textcolor{keywordtype}{bool}\ is\_priv\ )\ \{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00210}00210\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}}\ =\ \mbox{\hyperlink{structcontext}{context}}.db.get<\mbox{\hyperlink{classsysio_1_1chain_1_1account__metadata__object}{account\_metadata\_object}},\ by\_name>(\ n\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00211}00211\ \ \ \ \ \ \ \mbox{\hyperlink{structcontext}{context}}.db.modify(\ \mbox{\hyperlink{pointer_8h_aeeddce917cf130d62c370b8f216026dd}{a}},\ [\&](\ \textcolor{keyword}{auto}\&\ ma\ )\{}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00212}00212\ \ \ \ \ \ \ \ \ \ ma.set\_privileged(\ is\_priv\ );}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00213}00213\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00214}00214\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{privileged_8cpp_source_l00215}00215\ \}\}\}\ \textcolor{comment}{//\ ns\ sysio::chain::webassembly}}

\end{DoxyCode}
