<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wire Sysio: sysiosystem::block_info Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Wire Sysio<span id="projectnumber">&#160;Wire Sysion 1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('namespacesysiosystem_1_1block__info.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">sysiosystem::block_info Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsysiosystem_1_1block__info_1_1block__batch__info.html">block_batch_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsysiosystem_1_1block__info_1_1block__info__record.html">block_info_record</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsysiosystem_1_1block__info_1_1latest__block__batch__info__result.html">latest_block_batch_info_result</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ac0e11ae72cab33401d2389907474a957" id="r_ac0e11ae72cab33401d2389907474a957"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac0e11ae72cab33401d2389907474a957">block_info_table</a> = sysio::multi_index&lt;&quot;blockinfo&quot;_n, <a class="el" href="structsysiosystem_1_1block__info_1_1block__info__record.html">block_info_record</a>&gt;</td></tr>
<tr class="separator:ac0e11ae72cab33401d2389907474a957"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aaac02db22145c90ec190da119ea3bd33" id="r_aaac02db22145c90ec190da119ea3bd33"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsysiosystem_1_1block__info_1_1latest__block__batch__info__result.html">latest_block_batch_info_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaac02db22145c90ec190da119ea3bd33">get_latest_block_batch_info</a> (<a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> batch_start_height_offset, <a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> batch_size, <a class="el" href="structsysio_1_1chain_1_1name.html">sysio::name</a> system_account_name=&quot;sysio&quot;_n)</td></tr>
<tr class="separator:aaac02db22145c90ec190da119ea3bd33"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ac0e11ae72cab33401d2389907474a957" name="ac0e11ae72cab33401d2389907474a957"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0e11ae72cab33401d2389907474a957">&#9670;&#160;</a></span>block_info_table</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#ac0e11ae72cab33401d2389907474a957">sysiosystem::block_info::block_info_table</a> = sysio::multi_index&lt;&quot;blockinfo&quot;_n, <a class="el" href="structsysiosystem_1_1block__info_1_1block__info__record.html">block_info_record</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="block__info_8hpp_source.html#l00034">34</a> of file <a class="el" href="block__info_8hpp_source.html">block_info.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aaac02db22145c90ec190da119ea3bd33" name="aaac02db22145c90ec190da119ea3bd33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaac02db22145c90ec190da119ea3bd33">&#9670;&#160;</a></span>get_latest_block_batch_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsysiosystem_1_1block__info_1_1latest__block__batch__info__result.html">latest_block_batch_info_result</a> sysiosystem::block_info::get_latest_block_batch_info </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>batch_start_height_offset</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>batch_size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsysio_1_1chain_1_1name.html">sysio::name</a></td>          <td class="paramname"><span class="paramname"><em>system_account_name</em></span><span class="paramdefsep"> = </span><span class="paramdefval">&quot;sysio&quot;_n</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get information on the latest block batch.</p>
<p><a class="el" href="struct_a.html">A</a> block batch is a contiguous range of blocks of a particular size. <a class="el" href="struct_a.html">A</a> sequence of blocks can be partitioned into a sequence of block batches, where all except for perhaps the last batch in the sequence have the same size. The last batch in the sequence can have a smaller size if the blocks of the blockchain that would complete that batch have not yet been generated or recorded.</p>
<p>This function enables the caller to specify a particular partitioning of the sequence of blocks into a sequence of block batches of a particular non-zero size (<code>batch_size</code>) and then isolates the last block batch in that sequence and returns the information about that latest block batch if possible. The partitioning will ensure that <code>batch_start_height_offset</code> will be equal to the starting block height of exactly one of block batches in the sequence.</p>
<p>The information about the latest block batch is the same data captured in <code><a class="el" href="structsysiosystem_1_1block__info_1_1block__batch__info.html">block_batch_info</a></code>. Particularly, it returns the height and timestamp of starting and ending blocks within that latest block batch. Note that the range spanning from the start to end block of the latest block batch may be less than batch_size because latest block batch may be incomplete. Also, it is possible for the record capturing info for the starting block to not exist in the blockinfo table. This can either be due to the records being erased as they fall out of the rolling window or, in rare cases, due to gaps in block info records due to failures of the onblock action. In such a case, this function will be unable to return a <code><a class="el" href="structsysiosystem_1_1block__info_1_1block__batch__info.html">block_batch_info</a></code> and will instead be forced to return the <code>insufficient_data</code> error code. Furthermore, if <code>batch_start_height_offset</code> is greater than the height of the latest block for which information is recorded in the blockinfo table, there will be no latest block batch identified for the function to return information about and so it will again be forced to return the <code>insufficient_data</code> error code instead. </p>

<p class="definition">Definition at line <a class="el" href="block__info_8hpp_source.html#l00084">84</a> of file <a class="el" href="block__info_8hpp_source.html">block_info.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   87</span>{</div>
<div class="line"><span class="lineno">   88</span>   <a class="code hl_struct" href="structsysiosystem_1_1block__info_1_1latest__block__batch__info__result.html">latest_block_batch_info_result</a> result;</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>   <span class="keywordflow">if</span> (batch_size == 0) {</div>
<div class="line"><span class="lineno">   91</span>      result.error_code = latest_block_batch_info_result::invalid_input;</div>
<div class="line"><span class="lineno">   92</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">   93</span>   }</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>   block_info_table t(system_account_name, 0);</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>   <span class="comment">// Find information on latest block recorded in the blockinfo table.</span></div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>   <span class="keywordflow">if</span> (t.cbegin() == t.cend()) {</div>
<div class="line"><span class="lineno">  100</span>      <span class="comment">// The blockinfo table is empty.</span></div>
<div class="line"><span class="lineno">  101</span>      result.error_code = latest_block_batch_info_result::insufficient_data;</div>
<div class="line"><span class="lineno">  102</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  103</span>   }</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span>   <span class="keyword">auto</span> latest_block_info_itr = --t.cend();</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>   <span class="keywordflow">if</span> (latest_block_info_itr-&gt;version != 0) {</div>
<div class="line"><span class="lineno">  108</span>      <span class="comment">// Compiled code for this function within the calling contract has not been updated to support new version of</span></div>
<div class="line"><span class="lineno">  109</span>      <span class="comment">// the blockinfo table.</span></div>
<div class="line"><span class="lineno">  110</span>      result.error_code = latest_block_batch_info_result::unsupported_version;</div>
<div class="line"><span class="lineno">  111</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  112</span>   }</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>   <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> latest_block_batch_end_height = latest_block_info_itr-&gt;block_height;</div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>   <span class="keywordflow">if</span> (latest_block_batch_end_height &lt; batch_start_height_offset) {</div>
<div class="line"><span class="lineno">  117</span>      <span class="comment">// Caller asking for a block batch that has not even begun to be recorded yet.</span></div>
<div class="line"><span class="lineno">  118</span>      result.error_code = latest_block_batch_info_result::insufficient_data;</div>
<div class="line"><span class="lineno">  119</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  120</span>   }</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>   <span class="comment">// Calculate height for the starting block of the latest block batch.</span></div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>   <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> latest_block_batch_start_height =</div>
<div class="line"><span class="lineno">  125</span>      latest_block_batch_end_height - ((latest_block_batch_end_height - batch_start_height_offset) % batch_size);</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>   <span class="comment">// Note: 1 &lt;= (latest_block_batch_end_height - latest_block_batch_start_height + 1) &lt;= batch_size</span></div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>   <span class="keywordflow">if</span> (latest_block_batch_start_height == latest_block_batch_end_height) {</div>
<div class="line"><span class="lineno">  130</span>      <span class="comment">// When batch_size == 1, this function effectively simplifies to just returning the info of the latest recorded</span></div>
<div class="line"><span class="lineno">  131</span>      <span class="comment">// block. In that case, the start block and the end block of the batch are the same and there is no need for</span></div>
<div class="line"><span class="lineno">  132</span>      <span class="comment">// another lookup. So shortcut the rest of the process and return a successful result immediately.</span></div>
<div class="line"><span class="lineno">  133</span>      result.result.emplace(block_batch_info{</div>
<div class="line"><span class="lineno">  134</span>         .batch_start_height          = latest_block_batch_start_height,</div>
<div class="line"><span class="lineno">  135</span>         .batch_start_timestamp       = latest_block_info_itr-&gt;block_timestamp,</div>
<div class="line"><span class="lineno">  136</span>         .batch_current_end_height    = latest_block_batch_end_height,</div>
<div class="line"><span class="lineno">  137</span>         .batch_current_end_timestamp = latest_block_info_itr-&gt;block_timestamp,</div>
<div class="line"><span class="lineno">  138</span>      });</div>
<div class="line"><span class="lineno">  139</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  140</span>   }</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>   <span class="comment">// Find information on start block of the latest block batch recorded in the blockinfo table.</span></div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>   <span class="keyword">auto</span> start_block_info_itr = t.find(latest_block_batch_start_height);</div>
<div class="line"><span class="lineno">  145</span>   <span class="keywordflow">if</span> (start_block_info_itr == t.cend() || start_block_info_itr-&gt;block_height != latest_block_batch_start_height) {</div>
<div class="line"><span class="lineno">  146</span>      <span class="comment">// Record for information on start block of the latest block batch could not be found in blockinfo table.</span></div>
<div class="line"><span class="lineno">  147</span>      <span class="comment">// This is either because of:</span></div>
<div class="line"><span class="lineno">  148</span>      <span class="comment">//    * a gap in recording info due to a failed onblock action;</span></div>
<div class="line"><span class="lineno">  149</span>      <span class="comment">//    * a requested start block that was processed by onblock prior to deployment of the system contract code</span></div>
<div class="line"><span class="lineno">  150</span>      <span class="comment">//    introducing the blockinfo table;</span></div>
<div class="line"><span class="lineno">  151</span>      <span class="comment">//    * or, most likely, because the record for the requested start block was pruned from the blockinfo table as</span></div>
<div class="line"><span class="lineno">  152</span>      <span class="comment">//    it fell out of the rolling window.</span></div>
<div class="line"><span class="lineno">  153</span>      result.error_code = latest_block_batch_info_result::insufficient_data;</div>
<div class="line"><span class="lineno">  154</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  155</span>   }</div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span>   <span class="keywordflow">if</span> (start_block_info_itr-&gt;version != 0) {</div>
<div class="line"><span class="lineno">  158</span>      <span class="comment">// Compiled code for this function within the calling contract has not been updated to support new version of</span></div>
<div class="line"><span class="lineno">  159</span>      <span class="comment">// the blockinfo table.</span></div>
<div class="line"><span class="lineno">  160</span>      result.error_code = latest_block_batch_info_result::unsupported_version;</div>
<div class="line"><span class="lineno">  161</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  162</span>   }</div>
<div class="line"><span class="lineno">  163</span> </div>
<div class="line"><span class="lineno">  164</span>   <span class="comment">// Successfully return block_batch_info for the found latest block batch in its current state.</span></div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>   result.result.emplace(block_batch_info{</div>
<div class="line"><span class="lineno">  167</span>      .batch_start_height          = latest_block_batch_start_height,</div>
<div class="line"><span class="lineno">  168</span>      .batch_start_timestamp       = start_block_info_itr-&gt;block_timestamp,</div>
<div class="line"><span class="lineno">  169</span>      .batch_current_end_height    = latest_block_batch_end_height,</div>
<div class="line"><span class="lineno">  170</span>      .batch_current_end_timestamp = latest_block_info_itr-&gt;block_timestamp,</div>
<div class="line"><span class="lineno">  171</span>   });</div>
<div class="line"><span class="lineno">  172</span>   <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  173</span>}</div>
<div class="ttc" id="astdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition</b> <a href="stdint_8h_source.html#l00126">stdint.h:126</a></div></div>
<div class="ttc" id="astructsysiosystem_1_1block__info_1_1latest__block__batch__info__result_html"><div class="ttname"><a href="structsysiosystem_1_1block__info_1_1latest__block__batch__info__result.html">sysiosystem::block_info::latest_block_batch_info_result</a></div><div class="ttdef"><b>Definition</b> <a href="block__info_8hpp_source.html#l00044">block_info.hpp:45</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacesysiosystem_1_1block__info_aaac02db22145c90ec190da119ea3bd33_icgraph.png" border="0" usemap="#anamespacesysiosystem_1_1block__info_aaac02db22145c90ec190da119ea3bd33_icgraph" alt=""/></div>
<map name="anamespacesysiosystem_1_1block__info_aaac02db22145c90ec190da119ea3bd33_icgraph" id="anamespacesysiosystem_1_1block__info_aaac02db22145c90ec190da119ea3bd33_icgraph">
<area shape="rect" title=" " alt="" coords="446,5,598,61"/>
<area shape="rect" href="namespacesystem__contracts_1_1testing_1_1test__contracts_1_1blockinfo__tester.html#a705f35a783c6830287ee92b4f8146d49" title=" " alt="" coords="226,5,398,61"/>
<area shape="poly" title=" " alt="" coords="431,36,399,36,399,30,431,30"/>
<area shape="rect" href="namespacesystem__contracts_1_1testing_1_1test__contracts_1_1blockinfo__tester.html#a363d3c4aeaaf0d43dc7d2c8b36f35ed6" title=" " alt="" coords="5,5,178,61"/>
<area shape="poly" title=" " alt="" coords="210,36,178,36,178,30,210,30"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacesysiosystem.html">sysiosystem</a></li><li class="navelem"><a class="el" href="namespacesysiosystem_1_1block__info.html">block_info</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
