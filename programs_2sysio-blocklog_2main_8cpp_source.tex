\doxysection{main.\+cpp}
\hypertarget{programs_2sysio-blocklog_2main_8cpp_source}{}\label{programs_2sysio-blocklog_2main_8cpp_source}\index{programs/sysio-\/blocklog/main.cpp@{programs/sysio-\/blocklog/main.cpp}}
\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{abi__serializer_8hpp}{sysio/chain/abi\_serializer.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{block__log_8hpp}{sysio/chain/block\_log.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{fork__database_8hpp}{sysio/chain/fork\_database.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{chain_2include_2sysio_2chain_2config_8hpp}{sysio/chain/config.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00007}00007\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{json_8hpp}{fc/io/json.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00008}00008\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{filesystem_8hpp}{fc/filesystem.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00009}00009\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{fc_2include_2fc_2variant_8hpp}{fc/variant.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00010}00010\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{bitutil_8hpp}{fc/bitutil.hpp}}>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00012}00012\ \textcolor{preprocessor}{\#include\ <boost/exception/diagnostic\_information.hpp>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00013}00013\ \textcolor{preprocessor}{\#include\ <boost/program\_options.hpp>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00014}00014\ \textcolor{preprocessor}{\#include\ <boost/filesystem.hpp>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00015}00015\ \textcolor{preprocessor}{\#include\ <boost/filesystem/path.hpp>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00017}00017\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00019}00019\ \textcolor{preprocessor}{\#ifndef\ \_WIN32}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00020}\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_ae71fa88ae01a3daa2aa3021ad8a4e22a}{00020}}\ \textcolor{preprocessor}{\#define\ FOPEN(p,\ m)\ fopen(p,\ m)}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00021}00021\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00022}00022\ \textcolor{preprocessor}{\#define\ CAT(s1,\ s2)\ s1\ \#\#\ s2}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00023}00023\ \textcolor{preprocessor}{\#define\ PREL(s)\ CAT(L,\ s)}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00024}00024\ \textcolor{preprocessor}{\#define\ FOPEN(p,\ m)\ \_wfopen(p,\ PREL(m))}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00025}00025\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00027}00027\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacesysio_1_1chain}{sysio::chain}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00028}00028\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceboost_1_1filesystem}{bfs}}\ =\ \mbox{\hyperlink{namespaceboost_1_1filesystem}{boost::filesystem}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00029}00029\ \textcolor{keyword}{namespace\ }bpo\ =\ boost::program\_options;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00030}00030\ \textcolor{keyword}{using\ }bpo::options\_description;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00031}00031\ \textcolor{keyword}{using\ }bpo::variables\_map;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00033}\mbox{\hyperlink{structblocklog}{00033}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structblocklog}{blocklog}}\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00034}\mbox{\hyperlink{structblocklog_ae5a944aead970a28403a46fd74d87f9f}{00034}}\ \ \ \ \mbox{\hyperlink{structblocklog_ae5a944aead970a28403a46fd74d87f9f}{blocklog}}()}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00035}00035\ \ \ \ \{\}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00037}00037\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_ab8fb32dc3425a85102c05fe4a1c1fd62}{read\_log}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00038}00038\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_a28b743fa586fa3fdde6fe6d56c31bd10}{set\_program\_options}}(options\_description\&\ \mbox{\hyperlink{xbyak__mnemonic_8h_a4229a9b84f8b8673326f12bd41acd27c}{cli}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00039}00039\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_a9a8b4159b641c6ee906cbdc9f8a162d8}{initialize}}(\textcolor{keyword}{const}\ variables\_map\&\ options);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00040}00040\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_a08f56f870947694c27fb76f1fb73c887}{do\_vacuum}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00042}\mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{00042}}\ \ \ \ bfs::path\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00043}\mbox{\hyperlink{structblocklog_a742ff90b45cafbf8862479ade02278f4}{00043}}\ \ \ \ bfs::path\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a742ff90b45cafbf8862479ade02278f4}{output\_file}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00044}\mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{00044}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00045}\mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{00045}}\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{last\_block}}\ =\ std::numeric\_limits<uint32\_t>::max();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00046}\mbox{\hyperlink{structblocklog_a6d60edbd915af4a8ea0b9f17b328b788}{00046}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a6d60edbd915af4a8ea0b9f17b328b788}{no\_pretty\_print}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00047}\mbox{\hyperlink{structblocklog_acfb43e80efae5b28b093b6873f95b7b8}{00047}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_acfb43e80efae5b28b093b6873f95b7b8}{as\_json\_array}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00048}\mbox{\hyperlink{structblocklog_a47a28e90ebfa01f667ffb74c1423644f}{00048}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a47a28e90ebfa01f667ffb74c1423644f}{make\_index}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00049}\mbox{\hyperlink{structblocklog_a8846ed72bffb6e6e9bcc3ee2b88fa4b9}{00049}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a8846ed72bffb6e6e9bcc3ee2b88fa4b9}{trim\_log}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00050}\mbox{\hyperlink{structblocklog_a863df5b3d0843cc13da1783b395643f0}{00050}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a863df5b3d0843cc13da1783b395643f0}{smoke\_test}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00051}\mbox{\hyperlink{structblocklog_abd54d312af971ed1ac047ccc6853b388}{00051}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_abd54d312af971ed1ac047ccc6853b388}{vacuum}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00052}\mbox{\hyperlink{structblocklog_a442dfd1ca9af856f45b361f476439094}{00052}}\ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a442dfd1ca9af856f45b361f476439094}{help}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00054}\mbox{\hyperlink{structblocklog_aa44f09fc7a8bd52b05a25f1c592b5870}{00054}}\ \ \ \ std::optional<block\_log\_prune\_config>\ \mbox{\hyperlink{structblocklog_aa44f09fc7a8bd52b05a25f1c592b5870}{blog\_keep\_prune\_conf}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00055}00055\ \};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00057}\mbox{\hyperlink{structreport__time}{00057}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structreport__time}{report\_time}}\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00058}\mbox{\hyperlink{structreport__time_a2adc352a5e8326095cd22a2be7203260}{00058}}\ \ \ \ \ \mbox{\hyperlink{structreport__time_a2adc352a5e8326095cd22a2be7203260}{report\_time}}(std::string\ desc)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00059}00059\ \ \ \ \ :\ \mbox{\hyperlink{structreport__time_a4125b948a2f57b4420adc68be7e69d8d}{\_start}}(\mbox{\hyperlink{namespacestd}{std}}::chrono::high\_resolution\_clock::now())}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00060}00060\ \ \ \ \ ,\ \mbox{\hyperlink{structreport__time_a9f3ca525de316ff32554f723379e24e1}{\_desc}}(desc)\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00061}00061\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00063}\mbox{\hyperlink{structreport__time_a397785710bcbb888db539e0bb292fc82}{00063}}\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structreport__time_a397785710bcbb888db539e0bb292fc82}{report}}()\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00064}00064\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ duration\ =\ std::chrono::duration\_cast<std::chrono::microseconds>(std::chrono::high\_resolution\_clock::now()\ -\/\ \mbox{\hyperlink{structreport__time_a4125b948a2f57b4420adc68be7e69d8d}{\_start}}).count()\ /\ 1000;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00065}00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}sysio-\/blocklog\ -\/\ \$\{desc\}\ took\ \$\{t\}\ msec"{}},\ (\textcolor{stringliteral}{"{}desc"{}},\ \mbox{\hyperlink{structreport__time_a9f3ca525de316ff32554f723379e24e1}{\_desc}})(\textcolor{stringliteral}{"{}t"{}},\ duration));}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00066}00066\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00067}00067\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00068}\mbox{\hyperlink{structreport__time_a4125b948a2f57b4420adc68be7e69d8d}{00068}}\ \ \ \ \ \textcolor{keyword}{const}\ std::chrono::high\_resolution\_clock::time\_point\ \mbox{\hyperlink{structreport__time_a4125b948a2f57b4420adc68be7e69d8d}{\_start}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00069}\mbox{\hyperlink{structreport__time_a9f3ca525de316ff32554f723379e24e1}{00069}}\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structreport__time_a9f3ca525de316ff32554f723379e24e1}{\_desc}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00070}00070\ \};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00071}00071\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00072}\mbox{\hyperlink{structblocklog_a08f56f870947694c27fb76f1fb73c887}{00072}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_a08f56f870947694c27fb76f1fb73c887}{blocklog::do\_vacuum}}()\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00073}00073\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ \mbox{\hyperlink{structblocklog_aa44f09fc7a8bd52b05a25f1c592b5870}{blog\_keep\_prune\_conf}},\ block\_log\_exception,\ \textcolor{stringliteral}{"{}blocks.log\ is\ not\ a\ pruned\ log;\ nothing\ to\ vacuum"{}}\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00074}00074\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{block\_log}}\ blocks(\mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}},\ std::optional<block\_log\_prune\_config>());\ \textcolor{comment}{//passing\ an\ unset\ block\_log\_prune\_config\ turns\ off\ pruning\ this\ performs\ a\ vacuum}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00075}00075\ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\textcolor{stringliteral}{"{}Successfully\ vacuumed\ block\ log"{}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00076}00076\ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00078}\mbox{\hyperlink{structblocklog_ab8fb32dc3425a85102c05fe4a1c1fd62}{00078}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_ab8fb32dc3425a85102c05fe4a1c1fd62}{blocklog::read\_log}}()\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00079}00079\ \ \ \ \mbox{\hyperlink{structreport__time}{report\_time}}\ rt(\textcolor{stringliteral}{"{}reading\ log"{}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00080}00080\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{block\_log}}\ block\_logger(\mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}},\ \mbox{\hyperlink{structblocklog_aa44f09fc7a8bd52b05a25f1c592b5870}{blog\_keep\_prune\_conf}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00081}00081\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ end\ =\ block\_logger.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a2aa6dabbd33531db434a5e7325fde2e6}{read\_head}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00082}00082\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ end,\ block\_log\_exception,\ \textcolor{stringliteral}{"{}No\ blocks\ found\ in\ block\ log"{}}\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00083}00083\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ end-\/>block\_num()\ >\ 1,\ block\_log\_exception,\ \textcolor{stringliteral}{"{}Only\ one\ block\ found\ in\ block\ log"{}}\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00085}00085\ \ \ \ \textcolor{comment}{//fix\ message\ below,\ first\ block\ might\ not\ be\ 1,\ first\_block\_num\ is\ not\ set\ yet}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00086}00086\ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}existing\ block\ log\ contains\ block\ num\ \$\{first\}\ through\ block\ num\ \$\{n\}"{}},}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}first"{}},block\_logger.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}())(\textcolor{stringliteral}{"{}n"{}},end-\/>block\_num())\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00088}00088\ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}}\ <\ block\_logger.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}())\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00089}00089\ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}}\ =\ block\_logger.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00090}00090\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00092}00092\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_a3b287e6c2d3717609273c999ef660dea}{sysio::chain::branch\_type}}\ fork\_db\_branch;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00093}00093\ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacefc_a3fcf0d920aea28014aacae50a51d8485}{fc::exists}}(\ \mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}}\ /\ config::reversible\_blocks\_dir\_name\ /\ config::forkdb\_filename\ )\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00094}00094\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}opening\ fork\_db"{}}\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00095}00095\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1fork__database}{fork\_database}}\ fork\_db(\ \mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}}\ /\ config::reversible\_blocks\_dir\_name\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00097}00097\ \ \ \ \ \ \ fork\_db.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a378b089fe1ff7ac016ee51058ff52cb2}{open}}(\ [](\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__timestamp}{block\_timestamp\_type}}\ timestamp,}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ flat\_set<digest\_type>\&\ cur\_features,}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1vector}{vector<digest\_type>}}\&\ new\_features\ )\ \{\}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00100}00100\ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00102}00102\ \ \ \ \ \ \ fork\_db\_branch\ =\ fork\_db.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a18e51b748469f97473d120ef69e1da22}{fetch\_branch}}(\ fork\_db.\mbox{\hyperlink{classsysio_1_1chain_1_1fork__database_a3b128a7d57c262ef6351d83c16cffae3}{head}}()-\/>id\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00103}00103\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ fork\_db\_branch.empty()\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}no\ blocks\ available\ in\ reversible\ block\ database:\ only\ block\_log\ blocks\ are\ available"{}}\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00105}00105\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ first\ =\ fork\_db\_branch.rbegin();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ last\ =\ fork\_db\_branch.rend()\ -\/\ 1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a831cf08dc63704c11fd154132c6e8bdb}{ilog}}(\ \textcolor{stringliteral}{"{}existing\ reversible\ fork\_db\ block\ num\ \$\{first\}\ through\ block\ num\ \$\{last\}\ "{}},}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}first"{}},\ (*first)-\/>block\_num)(\ \textcolor{stringliteral}{"{}last"{}},\ (*last)-\/>block\_num\ )\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ end-\/>block\_num()\ +\ 1\ ==\ (*first)-\/>block\_num,\ block\_log\_exception,}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}fork\_db\ does\ not\ start\ at\ end\ of\ block\ log"{}}\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00112}00112\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00113}00113\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00115}00115\ \ \ \ std::ofstream\ output\_blocks;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00116}00116\ \ \ \ std::ostream*\ out;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00117}00117\ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structblocklog_a742ff90b45cafbf8862479ade02278f4}{output\_file}}.empty())\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00118}00118\ \ \ \ \ \ \ output\_blocks.open(\mbox{\hyperlink{structblocklog_a742ff90b45cafbf8862479ade02278f4}{output\_file}}.generic\_string().c\_str());}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00119}00119\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (output\_blocks.fail())\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00120}00120\ \ \ \ \ \ \ \ \ \ std::ostringstream\ ss;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00121}00121\ \ \ \ \ \ \ \ \ \ ss\ <<\ \textcolor{stringliteral}{"{}Unable\ to\ open\ file\ '"{}}\ <<\ \mbox{\hyperlink{structblocklog_a742ff90b45cafbf8862479ade02278f4}{output\_file}}.string()\ <<\ \textcolor{stringliteral}{"{}'"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(ss.str());}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00123}00123\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00124}00124\ \ \ \ \ \ \ out\ =\ \&output\_blocks;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00125}00125\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00126}00126\ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00127}00127\ \ \ \ \ \ \ out\ =\ \&std::cout;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00128}00128\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00129}00129\ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structblocklog_acfb43e80efae5b28b093b6873f95b7b8}{as\_json\_array}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00130}00130\ \ \ \ \ \ \ *out\ <<\ \textcolor{stringliteral}{"{}["{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00131}00131\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num\ =\ (\mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}}\ <\ 1)\ ?\ 1\ :\ \mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00132}00132\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ next;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00133}00133\ \ \ \ \mbox{\hyperlink{classfc_1_1variant}{fc::variant}}\ pretty\_output;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00134}00134\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1microseconds}{fc::microseconds}}\ deadline\ =\ \mbox{\hyperlink{namespacefc_a9623b8cae3f48bbed6aa1fc2afe9b174}{fc::seconds}}(10);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00135}00135\ \ \ \ \textcolor{keyword}{auto}\ print\_block\ =\ [\&](\mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ next)\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00136}00136\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1abi__serializer_a7e23d065d4624d99ec1945f3ea429415}{abi\_serializer::to\_variant}}(*next,}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pretty\_output,}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\ \mbox{\hyperlink{structsysio_1_1chain_1_1name}{account\_name}}\ n\ )\ \{\ \textcolor{keywordflow}{return}\ std::optional<abi\_serializer>();\ \},}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1abi__serializer_a2dc34bf706557f0c83d61b3791299c98}{abi\_serializer::create\_yield\_function}}(\ deadline\ ));}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00140}00140\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ block\_id\ =\ next-\/>calculate\_id();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00141}00141\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ ref\_block\_prefix\ =\ block\_id.\_hash[1];}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00142}00142\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ enhanced\_object\ =\ \mbox{\hyperlink{classfc_1_1mutable__variant__object}{fc::mutable\_variant\_object}}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}block\_num"{}},next-\/>block\_num())}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}id"{}},\ block\_id)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}ref\_block\_prefix"{}},\ ref\_block\_prefix)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (pretty\_output.\mbox{\hyperlink{classfc_1_1variant_a17a7054a10963360c6a14d60f6e30128}{get\_object}}());}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00147}00147\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1variant}{fc::variant}}\ v(std::move(enhanced\_object));}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00148}00148\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structblocklog_a6d60edbd915af4a8ea0b9f17b328b788}{no\_pretty\_print}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00149}00149\ \ \ \ \ \ \ \ \ \ *out\ <<\ \mbox{\hyperlink{classfc_1_1json_aa6541960d7f05567559b866cfaf88dfa}{fc::json::to\_string}}(v,\ \mbox{\hyperlink{classfc_1_1time__point_aeccf1b70aa34b132c5269313b8a50573}{fc::time\_point::maximum}}());}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00150}00150\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00151}00151\ \ \ \ \ \ \ \ \ \ *out\ <<\ \mbox{\hyperlink{classfc_1_1json_ae6c022ab581a9552ae2c97ff5d73aaf8}{fc::json::to\_pretty\_string}}(v)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00152}00152\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00153}00153\ \ \ \ \textcolor{keywordtype}{bool}\ contains\_obj\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00154}00154\ \ \ \ \textcolor{keywordflow}{while}((block\_num\ <=\ \mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{last\_block}})\ \&\&\ (next\ =\ block\_logger.\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a99c59d29b262144ad99eacc827f76107}{read\_block\_by\_num}}(\ block\_num\ )))\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00155}00155\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structblocklog_acfb43e80efae5b28b093b6873f95b7b8}{as\_json\_array}}\ \&\&\ contains\_obj)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00156}00156\ \ \ \ \ \ \ \ \ \ *out\ <<\ \textcolor{stringliteral}{"{},"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00157}00157\ \ \ \ \ \ \ print\_block(next);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00158}00158\ \ \ \ \ \ \ ++block\_num;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00159}00159\ \ \ \ \ \ \ contains\_obj\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00160}00160\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00161}00161\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00162}00162\ \ \ \ \textcolor{keywordflow}{if}(\ !fork\_db\_branch.empty()\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00163}00163\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keyword}{auto}\ bitr\ =\ fork\_db\_branch.rbegin();\ bitr\ !=\ fork\_db\_branch.rend()\ \&\&\ block\_num\ <=\ \mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{last\_block}};\ ++bitr\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structblocklog_acfb43e80efae5b28b093b6873f95b7b8}{as\_json\_array}}\ \&\&\ contains\_obj)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ *out\ <<\ \textcolor{stringliteral}{"{},"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ next\ =\ (*bitr)-\/>block;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00167}00167\ \ \ \ \ \ \ \ \ \ print\_block(next);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00168}00168\ \ \ \ \ \ \ \ \ \ ++block\_num;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00169}00169\ \ \ \ \ \ \ \ \ \ contains\_obj\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00170}00170\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00171}00171\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00173}00173\ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structblocklog_acfb43e80efae5b28b093b6873f95b7b8}{as\_json\_array}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00174}00174\ \ \ \ \ \ \ *out\ <<\ \textcolor{stringliteral}{"{}]"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00175}00175\ \ \ \ rt.\mbox{\hyperlink{structreport__time_a397785710bcbb888db539e0bb292fc82}{report}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00176}00176\ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00177}00177\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00178}\mbox{\hyperlink{structblocklog_a28b743fa586fa3fdde6fe6d56c31bd10}{00178}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_a28b743fa586fa3fdde6fe6d56c31bd10}{blocklog::set\_program\_options}}(options\_description\&\ \mbox{\hyperlink{xbyak__mnemonic_8h_a4229a9b84f8b8673326f12bd41acd27c}{cli}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00179}00179\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00180}00180\ \ \ \ \mbox{\hyperlink{xbyak__mnemonic_8h_a4229a9b84f8b8673326f12bd41acd27c}{cli}}.add\_options()}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00181}00181\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}blocks-\/dir"{}},\ bpo::value<bfs::path>()-\/>default\_value(\textcolor{stringliteral}{"{}blocks"{}}),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ location\ of\ the\ blocks\ directory\ (absolute\ path\ or\ relative\ to\ the\ current\ directory)"{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00183}00183\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}output-\/file,o"{}},\ bpo::value<bfs::path>(),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00184}00184\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ file\ to\ write\ the\ output\ to\ (absolute\ or\ relative\ path).\ \ If\ not\ specified\ then\ output\ is\ to\ stdout."{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00185}00185\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}first,f"{}},\ bpo::value<uint32\_t>(\&\mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}})-\/>default\_value(0),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ first\ block\ number\ to\ log\ or\ the\ first\ to\ keep\ if\ trim-\/blocklog"{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00187}00187\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}last,l"{}},\ bpo::value<uint32\_t>(\&\mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{last\_block}})-\/>default\_value(std::numeric\_limits<uint32\_t>::max()),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ last\ block\ number\ to\ log\ or\ the\ last\ to\ keep\ if\ trim-\/blocklog"{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00189}00189\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}no-\/pretty-\/print"{}},\ bpo::bool\_switch(\&\mbox{\hyperlink{structblocklog_a6d60edbd915af4a8ea0b9f17b328b788}{no\_pretty\_print}})-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Do\ not\ pretty\ print\ the\ output.\ \ Useful\ if\ piping\ to\ jq\ to\ improve\ performance."{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00191}00191\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}as-\/json-\/array"{}},\ bpo::bool\_switch(\&\mbox{\hyperlink{structblocklog_acfb43e80efae5b28b093b6873f95b7b8}{as\_json\_array}})-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00192}00192\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Print\ out\ json\ blocks\ wrapped\ in\ json\ array\ (otherwise\ the\ output\ is\ free-\/standing\ json\ objects)."{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00193}00193\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}make-\/index"{}},\ bpo::bool\_switch(\&\mbox{\hyperlink{structblocklog_a47a28e90ebfa01f667ffb74c1423644f}{make\_index}})-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00194}00194\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Create\ blocks.index\ from\ blocks.log.\ Must\ give\ 'blocks-\/dir'.\ Give\ 'output-\/file'\ relative\ to\ current\ directory\ or\ absolute\ path\ (default\ is\ <blocks-\/dir>/blocks.index)."{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00195}00195\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}trim-\/blocklog"{}},\ bpo::bool\_switch(\&\mbox{\hyperlink{structblocklog_a8846ed72bffb6e6e9bcc3ee2b88fa4b9}{trim\_log}})-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00196}00196\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Trim\ blocks.log\ and\ blocks.index.\ Must\ give\ 'blocks-\/dir'\ and\ 'first\ and/or\ 'last'."{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00197}00197\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}smoke-\/test"{}},\ bpo::bool\_switch(\&\mbox{\hyperlink{structblocklog_a863df5b3d0843cc13da1783b395643f0}{smoke\_test}})-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00198}00198\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Quick\ test\ that\ blocks.log\ and\ blocks.index\ are\ well\ formed\ and\ agree\ with\ each\ other."{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00199}00199\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}vacuum"{}},\ bpo::bool\_switch(\&\mbox{\hyperlink{structblocklog_abd54d312af971ed1ac047ccc6853b388}{vacuum}})-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00200}00200\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Vacuum\ a\ pruned\ blocks.log\ in\ to\ an\ un-\/pruned\ blocks.log"{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00201}00201\ \ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}help,h"{}},\ bpo::bool\_switch(\&\mbox{\hyperlink{structblocklog_a442dfd1ca9af856f45b361f476439094}{help}})-\/>default\_value(\textcolor{keyword}{false}),\ \textcolor{stringliteral}{"{}Print\ this\ help\ message\ and\ exit."{}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00202}00202\ \ \ \ \ \ \ \ \ \ ;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00203}00203\ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00204}00204\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00205}\mbox{\hyperlink{structblocklog_a9a8b4159b641c6ee906cbdc9f8a162d8}{00205}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structblocklog_a9a8b4159b641c6ee906cbdc9f8a162d8}{blocklog::initialize}}(\textcolor{keyword}{const}\ variables\_map\&\ options)\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00206}00206\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00207}00207\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bld\ =\ options.at(\ \textcolor{stringliteral}{"{}blocks-\/dir"{}}\ ).as<bfs::path>();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00208}00208\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ bld.is\_relative())}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}}\ =\ bfs::current\_path()\ /\ bld;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00210}00210\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}}\ =\ bld;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00213}00213\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (options.count(\ \textcolor{stringliteral}{"{}output-\/file"{}}\ ))\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00214}00214\ \ \ \ \ \ \ \ \ \ bld\ =\ options.at(\ \textcolor{stringliteral}{"{}output-\/file"{}}\ ).as<bfs::path>();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ bld.is\_relative())}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a742ff90b45cafbf8862479ade02278f4}{output\_file}}\ =\ bfs::current\_path()\ /\ bld;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00217}00217\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_a742ff90b45cafbf8862479ade02278f4}{output\_file}}\ =\ bld;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00219}00219\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00220}00220\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00221}00221\ \ \ \ \ \ \ \textcolor{comment}{//if\ the\ log\ is\ pruned,\ keep\ it\ that\ way\ by\ passing\ in\ a\ config\ with\ a\ large\ block\ pruning\ value.\ There\ is\ otherwise\ no}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00222}00222\ \ \ \ \ \ \ \textcolor{comment}{//\ way\ to\ tell\ block\_log\ "{}keep\ the\ current\ non/pruneness\ of\ the\ log"{}}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00223}00223\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a65b017352bcd2bdea5ed9d68af7215d1}{block\_log::is\_pruned\_log}}(\mbox{\hyperlink{structblocklog_aff8255d6c642b5df2997b0361a332f8e}{blocks\_dir}}))\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_aa44f09fc7a8bd52b05a25f1c592b5870}{blog\_keep\_prune\_conf}}.emplace();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog_aa44f09fc7a8bd52b05a25f1c592b5870}{blog\_keep\_prune\_conf}}-\/>prune\_blocks\ =\ \mbox{\hyperlink{stdint_8h_ab5eb23180f7cc12b7d6c04a8ec067fdd}{UINT32\_MAX}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00226}00226\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00227}00227\ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_ae70bfa24f5a3bc0917382b3c17fc033c}{FC\_LOG\_AND\_RETHROW}}()}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00228}00228\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00229}00229\ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00230}00230\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00231}\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_a3cfbe737c1a84d19629ae9ffc5bc40a2}{00231}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_a3cfbe737c1a84d19629ae9ffc5bc40a2}{trim\_blocklog\_end}}(bfs::path\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}},\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ n)\ \{\ \ \ \ \ \ \ \textcolor{comment}{//n\ is\ last\ block\ to\ keep\ (remove\ later\ blocks)}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00232}00232\ \ \ \ \mbox{\hyperlink{structreport__time}{report\_time}}\ rt(\textcolor{stringliteral}{"{}trimming\ blocklog\ end"{}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00233}00233\ \ \ \ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacestd}{std}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00234}00234\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data}{trim\_data}}\ td(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00235}00235\ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nIn\ directory\ "{}}\ <<\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}}\ <<\ \textcolor{stringliteral}{"{}\ will\ trim\ all\ blocks\ after\ block\ "{}}\ <<\ n\ <<\ \textcolor{stringliteral}{"{}\ from\ "{}}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00236}00236\ \ \ \ \ \ \ \ \ <<\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{block\_file\_name}}.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ <<\ \textcolor{stringliteral}{"{}\ and\ "{}}\ <<\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ac74b927870c5603572bd5b5e7be49f24}{index\_file\_name}}.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}()\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00237}00237\ \ \ \ \textcolor{keywordflow}{if}\ (n\ <\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a4f9ad5c06da3b28555c42b8414c77f02}{first\_block}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00238}00238\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}All\ blocks\ are\ after\ block\ "{}}\ <<\ n\ <<\ \textcolor{stringliteral}{"{}\ so\ do\ nothing\ (trim\_end\ would\ delete\ entire\ blocks.log)\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00239}00239\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00240}00240\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00241}00241\ \ \ \ \textcolor{keywordflow}{if}\ (n\ >=\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{last\_block}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00242}00242\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}There\ are\ no\ blocks\ after\ block\ "{}}\ <<\ n\ <<\ \textcolor{stringliteral}{"{}\ so\ do\ nothing\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00243}00243\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 2;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00244}00244\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00245}00245\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ end\_of\_new\_file\ =\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a031c642ba68c0e0cb6e834d5b59244c9}{block\_pos}}(n\ +\ 1);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00246}00246\ \ \ \ bfs::resize\_file(td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{block\_file\_name}},\ end\_of\_new\_file);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00247}00247\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ index\_end=\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ac17d9de35cb85c02c9941383403ee043}{block\_index}}(n)\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}});\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//advance\ past\ record\ for\ block\ n}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00248}00248\ \ \ \ bfs::resize\_file(td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ac74b927870c5603572bd5b5e7be49f24}{index\_file\_name}},\ index\_end);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00249}00249\ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}blocks.index\ has\ been\ trimmed\ to\ "{}}\ <<\ index\_end\ <<\ \textcolor{stringliteral}{"{}\ bytes\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00250}00250\ \ \ \ rt.\mbox{\hyperlink{structreport__time_a397785710bcbb888db539e0bb292fc82}{report}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00251}00251\ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00252}00252\ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00253}00253\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00254}\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_ace4e6c78c84c1c16b0486d5833afd9f2}{00254}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_ace4e6c78c84c1c16b0486d5833afd9f2}{trim\_blocklog\_front}}(bfs::path\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}},\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ n)\ \{\ \ \ \ \ \ \ \ \textcolor{comment}{//n\ is\ first\ block\ to\ keep\ (remove\ prior\ blocks)}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00255}00255\ \ \ \ \mbox{\hyperlink{structreport__time}{report\_time}}\ rt(\textcolor{stringliteral}{"{}trimming\ blocklog\ start"{}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00256}00256\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ status\ =\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a00f24c3412cd6231b93394e2bbcea904}{block\_log::trim\_blocklog\_front}}(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}},\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}}\ /\ \textcolor{stringliteral}{"{}old"{}},\ n);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00257}00257\ \ \ \ rt.\mbox{\hyperlink{structreport__time_a397785710bcbb888db539e0bb292fc82}{report}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00258}00258\ \ \ \ \textcolor{keywordflow}{return}\ status;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00259}00259\ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00260}00260\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00261}00261\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00262}\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_a37fad1474c0a90433ca0152870e1da72}{00262}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_a37fad1474c0a90433ca0152870e1da72}{smoke\_test}}(bfs::path\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00263}00263\ \ \ \ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacestd}{std}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00264}00264\ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nSmoke\ test\ of\ blocks.log\ and\ blocks.index\ in\ directory\ "{}}\ <<\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}}\ <<\ \textcolor{charliteral}{'\(\backslash\)n'};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00265}00265\ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data}{trim\_data}}\ td(\mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00266}00266\ \ \ \ \textcolor{keyword}{auto}\ status\ =\ fseek(td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a5faa95655dcebf6fed96719b79ecdc7e}{blk\_in}},\ -\/\textcolor{keyword}{sizeof}(\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}),\ SEEK\_END);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ last\_block\ from\ blocks.log,\ compare\ to\ from\ blocks.index}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00267}00267\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ status\ ==\ 0,\ block\_log\_exception,\ \textcolor{stringliteral}{"{}cannot\ seek\ to\ \$\{file\}\ \$\{pos\}\ from\ beginning\ of\ file"{}},\ (\textcolor{stringliteral}{"{}file"{}},\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{block\_file\_name}}.\mbox{\hyperlink{classfc_1_1path_aaf0107e4a41f9977032b2a604161cf85}{string}}())(\textcolor{stringliteral}{"{}pos"{}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}))\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00268}00268\ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ file\_pos;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00269}00269\ \ \ \ \textcolor{keyword}{auto}\ size\ =\ fread((\textcolor{keywordtype}{void}*)\&file\_pos,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}),\ 1,\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a5faa95655dcebf6fed96719b79ecdc7e}{blk\_in}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00270}00270\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ size\ ==\ 1,\ block\_log\_exception,\ \textcolor{stringliteral}{"{}\$\{file\}\ read\ fails"{}},\ (\textcolor{stringliteral}{"{}file"{}},\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{block\_file\_name}}.\mbox{\hyperlink{classfc_1_1path_aaf0107e4a41f9977032b2a604161cf85}{string}}())\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00271}00271\ \ \ \ status\ =\ fseek(td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a5faa95655dcebf6fed96719b79ecdc7e}{blk\_in}},\ file\_pos\ +\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_aeacad2aff58cf29973f137cd79819264}{trim\_data::blknum\_offset}},\ SEEK\_SET);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00272}00272\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ status\ ==\ 0,\ block\_log\_exception,\ \textcolor{stringliteral}{"{}cannot\ seek\ to\ \$\{file\}\ \$\{pos\}\ from\ beginning\ of\ file"{}},\ (\textcolor{stringliteral}{"{}file"{}},\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{block\_file\_name}}.\mbox{\hyperlink{classfc_1_1path_aaf0107e4a41f9977032b2a604161cf85}{string}}())(\textcolor{stringliteral}{"{}pos"{}},\ file\_pos\ +\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_aeacad2aff58cf29973f137cd79819264}{trim\_data::blknum\_offset}})\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00273}00273\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ bnum;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00274}00274\ \ \ \ size\ =\ fread((\textcolor{keywordtype}{void}*)\&bnum,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}),\ 1,\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a5faa95655dcebf6fed96719b79ecdc7e}{blk\_in}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00275}00275\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ size\ ==\ 1,\ block\_log\_exception,\ \textcolor{stringliteral}{"{}\$\{file\}\ read\ fails"{}},\ (\textcolor{stringliteral}{"{}file"{}},\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{block\_file\_name}}.\mbox{\hyperlink{classfc_1_1path_aaf0107e4a41f9977032b2a604161cf85}{string}}())\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00276}00276\ \ \ \ bnum\ =\ \mbox{\hyperlink{namespacefc_afb668c55fd6ee73e1fcd67e77d8f6009}{endian\_reverse\_u32}}(bnum)\ +\ 1;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//convert\ from\ big\ endian\ to\ little\ endian\ and\ add\ 1}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00277}00277\ \ \ \ \mbox{\hyperlink{chain_2include_2sysio_2chain_2exceptions_8hpp_a40c2826a6fba35c1ffbf912bdf559792}{SYS\_ASSERT}}(\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{last\_block}}\ ==\ bnum,\ block\_log\_exception,\ \textcolor{stringliteral}{"{}blocks.log\ says\ last\ block\ is\ \$\{lb\}\ which\ disagrees\ with\ blocks.index"{}},\ (\textcolor{stringliteral}{"{}lb"{}},\ bnum)\ );}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00278}00278\ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}blocks.log\ and\ blocks.index\ agree\ on\ number\ of\ blocks\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00279}00279\ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ delta\ =\ (td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{last\_block}}\ +\ 8\ -\/\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a4f9ad5c06da3b28555c42b8414c77f02}{first\_block}})\ >>\ 3;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00280}00280\ \ \ \ \textcolor{keywordflow}{if}\ (delta\ <\ 1)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00281}00281\ \ \ \ \ \ \ delta\ =\ 1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00282}00282\ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ n\ =\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a4f9ad5c06da3b28555c42b8414c77f02}{first\_block}};\ ;\ n\ +=\ delta)\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00283}00283\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ >\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{last\_block}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00284}00284\ \ \ \ \ \ \ \ \ \ n\ =\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{last\_block}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00285}00285\ \ \ \ \ \ \ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a031c642ba68c0e0cb6e834d5b59244c9}{block\_pos}}(n);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//check\ block\ 'n'\ is\ where\ blocks.index\ says}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00286}00286\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ ==\ td.\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{last\_block}})}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00287}00287\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00288}00288\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00289}00289\ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nno\ problems\ found\(\backslash\)n"{}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//if\ get\ here\ there\ were\ no\ exceptions}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00290}00290\ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00291}00291\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00292}\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{00292}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{platform__timer__posix__test_8c_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}}(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}**\ \mbox{\hyperlink{hello__driver_8cpp_af2efa898e9eed6fe6715279cb1ec35b0}{argv}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00293}00293\ \ \ \ std::ios::sync\_with\_stdio(\textcolor{keyword}{false});\ \textcolor{comment}{//\ for\ potential\ performance\ boost\ for\ large\ block\ log\ files}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00294}00294\ \ \ \ options\_description\ \mbox{\hyperlink{xbyak__mnemonic_8h_a4229a9b84f8b8673326f12bd41acd27c}{cli}}\ (\textcolor{stringliteral}{"{}sysio-\/blocklog\ command\ line\ options"{}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00295}00295\ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00296}00296\ \ \ \ \ \ \ \mbox{\hyperlink{structblocklog}{blocklog}}\ blog;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00297}00297\ \ \ \ \ \ \ blog.\mbox{\hyperlink{structblocklog_a28b743fa586fa3fdde6fe6d56c31bd10}{set\_program\_options}}(\mbox{\hyperlink{xbyak__mnemonic_8h_a4229a9b84f8b8673326f12bd41acd27c}{cli}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00298}00298\ \ \ \ \ \ \ variables\_map\ vmap;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00299}00299\ \ \ \ \ \ \ bpo::store(bpo::parse\_command\_line(argc,\ \mbox{\hyperlink{hello__driver_8cpp_af2efa898e9eed6fe6715279cb1ec35b0}{argv}},\ \mbox{\hyperlink{xbyak__mnemonic_8h_a4229a9b84f8b8673326f12bd41acd27c}{cli}}),\ vmap);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00300}00300\ \ \ \ \ \ \ bpo::notify(vmap);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00301}00301\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_a442dfd1ca9af856f45b361f476439094}{help}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00302}00302\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{xbyak__mnemonic_8h_a4229a9b84f8b8673326f12bd41acd27c}{cli}}.print(std::cerr);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00303}00303\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00304}00304\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00305}00305\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_a863df5b3d0843cc13da1783b395643f0}{smoke\_test}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00306}00306\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_a37fad1474c0a90433ca0152870e1da72}{smoke\_test}}(vmap.at(\textcolor{stringliteral}{"{}blocks-\/dir"{}}).as<bfs::path>());}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00307}00307\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00308}00308\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00309}00309\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_a8846ed72bffb6e6e9bcc3ee2b88fa4b9}{trim\_log}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00310}00310\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}}\ ==\ 0\ \&\&\ blog.\mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{last\_block}}\ ==\ std::numeric\_limits<uint32\_t>::max())\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00311}00311\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}trim-\/blocklog\ does\ nothing\ unless\ specify\ first\ and/or\ last\ block."{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00312}00312\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00313}00313\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00314}00314\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{last\_block}}\ !=\ std::numeric\_limits<uint32\_t>::max())\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00315}00315\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_a3cfbe737c1a84d19629ae9ffc5bc40a2}{trim\_blocklog\_end}}(vmap.at(\textcolor{stringliteral}{"{}blocks-\/dir"{}}).as<bfs::path>(),\ blog.\mbox{\hyperlink{structblocklog_a504bea1a7eecb02361022f3be70943e3}{last\_block}})\ !=\ 0)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00316}00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00318}00318\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}}\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00319}00319\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{programs_2sysio-blocklog_2main_8cpp_ace4e6c78c84c1c16b0486d5833afd9f2}{trim\_blocklog\_front}}(vmap.at(\textcolor{stringliteral}{"{}blocks-\/dir"{}}).as<bfs::path>(),\ blog.\mbox{\hyperlink{structblocklog_af082dff0eddf0db2bf2c5918d7d5d6d8}{first\_block}}))}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00323}00323\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00324}00324\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_abd54d312af971ed1ac047ccc6853b388}{vacuum}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00325}00325\ \ \ \ \ \ \ \ \ \ blog.\mbox{\hyperlink{structblocklog_a9a8b4159b641c6ee906cbdc9f8a162d8}{initialize}}(vmap);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00326}00326\ \ \ \ \ \ \ \ \ \ blog.\mbox{\hyperlink{structblocklog_a08f56f870947694c27fb76f1fb73c887}{do\_vacuum}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00328}00328\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00329}00329\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (blog.\mbox{\hyperlink{structblocklog_a47a28e90ebfa01f667ffb74c1423644f}{make\_index}})\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ bfs::path\ blocks\_dir\ =\ vmap.at(\textcolor{stringliteral}{"{}blocks-\/dir"{}}).as<bfs::path>();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00331}00331\ \ \ \ \ \ \ \ \ \ bfs::path\ out\_file\ =\ blocks\_dir\ /\ \textcolor{stringliteral}{"{}blocks.index"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ bfs::path\ block\_file\ =\ blocks\_dir\ /\ \textcolor{stringliteral}{"{}blocks.log"{}};}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00333}00333\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vmap.count(\textcolor{stringliteral}{"{}output-\/file"{}})\ >\ 0)}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00335}00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ out\_file\ =\ vmap.at(\textcolor{stringliteral}{"{}output-\/file"{}}).as<bfs::path>();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00337}00337\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structreport__time}{report\_time}}\ rt(\textcolor{stringliteral}{"{}making\ index"{}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00338}00338\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classfc_1_1log__level}{log\_level}}\ =\ \mbox{\hyperlink{classfc_1_1logger_a4e12ef2e794551d593e497b4b90601ab}{fc::logger::get}}(\mbox{\hyperlink{logger_8hpp_a8c7a288fea519c7e895518f8dff4888f}{DEFAULT\_LOGGER}}).\mbox{\hyperlink{classfc_1_1logger_ab4ee187ac7a43ba90d16c93da35e9954}{get\_log\_level}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00339}00339\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1logger_a4e12ef2e794551d593e497b4b90601ab}{fc::logger::get}}(\mbox{\hyperlink{logger_8hpp_a8c7a288fea519c7e895518f8dff4888f}{DEFAULT\_LOGGER}}).\mbox{\hyperlink{classfc_1_1logger_a4c22e498cec41efb806fda9733662650}{set\_log\_level}}(\mbox{\hyperlink{classfc_1_1log__level_a5a5e31c4c1f38d9115ecbe44927fb2e4a30d2de77e71beb8d09d530cac04efa25}{fc::log\_level::debug}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00340}00340\ \ \ \ \ \ \ \ \ \ block\_log::construct\_index(block\_file.generic\_string(),\ out\_file.generic\_string());}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00341}00341\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1logger_a4e12ef2e794551d593e497b4b90601ab}{fc::logger::get}}(\mbox{\hyperlink{logger_8hpp_a8c7a288fea519c7e895518f8dff4888f}{DEFAULT\_LOGGER}}).\mbox{\hyperlink{classfc_1_1logger_a4c22e498cec41efb806fda9733662650}{set\_log\_level}}(\mbox{\hyperlink{classfc_1_1log__level}{log\_level}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00342}00342\ \ \ \ \ \ \ \ \ \ rt.report();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00344}00344\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00345}00345\ \ \ \ \ \ \ \textcolor{comment}{//else\ print\ blocks.log\ as\ JSON}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00346}00346\ \ \ \ \ \ \ blog.\mbox{\hyperlink{structblocklog_a9a8b4159b641c6ee906cbdc9f8a162d8}{initialize}}(vmap);}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00347}00347\ \ \ \ \ \ \ blog.\mbox{\hyperlink{structblocklog_ab8fb32dc3425a85102c05fe4a1c1fd62}{read\_log}}();}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00348}00348\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1exception}{fc::exception}}\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00349}00349\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\ \textcolor{stringliteral}{"{}\$\{e\}"{}},\ (\textcolor{stringliteral}{"{}e"{}},\ e.\mbox{\hyperlink{classfc_1_1exception_a7611ea8fbe25dde56649b685c2298a37}{to\_detail\_string}}()));}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00350}00350\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00351}00351\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ boost::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00352}00352\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}\$\{e\}"{}},\ (\textcolor{stringliteral}{"{}e"{}},boost::diagnostic\_information(e)));}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00353}00353\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00354}00354\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ \textcolor{keyword}{const}\ std::exception\&\ e\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00355}00355\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}\$\{e\}"{}},\ (\textcolor{stringliteral}{"{}e"{}},e.\mbox{\hyperlink{classfc_1_1exception_ab1104818bf0d9b6a29f0dfe036cf97f6}{what}}()));}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00356}00356\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00357}00357\ \ \ \ \}\ \textcolor{keywordflow}{catch}(\ ...\ )\ \{}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00358}00358\ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}unknown\ exception"{}});}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00359}00359\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00360}00360\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00361}00361\ }
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00362}00362\ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{programs_2sysio-blocklog_2main_8cpp_source_l00363}00363\ \}}

\end{DoxyCode}
