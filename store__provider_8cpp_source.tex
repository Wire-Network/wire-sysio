\doxysection{store\+\_\+provider.\+cpp}
\hypertarget{store__provider_8cpp_source}{}\label{store__provider_8cpp_source}\index{plugins/trace\_api\_plugin/store\_provider.cpp@{plugins/trace\_api\_plugin/store\_provider.cpp}}
\mbox{\hyperlink{store__provider_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{store__provider_8hpp}{sysio/trace\_api/store\_provider.hpp}}>}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{variant__object_8hpp}{fc/variant\_object.hpp}}>}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger__config_8hpp}{fc/log/logger\_config.hpp}}>}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00006}00006\ \textcolor{keyword}{namespace\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00007}00007\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \_current\_version\ =\ 1;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00008}00008\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \_trace\_prefix\ =\ \textcolor{stringliteral}{"{}trace\_"{}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00009}00009\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \_trace\_index\_prefix\ =\ \textcolor{stringliteral}{"{}trace\_index\_"{}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00010}00010\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \_trace\_trx\_id\_prefix\ =\ \textcolor{stringliteral}{"{}trace\_trx\_id\_"{}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00011}00011\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \_trace\_ext\ =\ \textcolor{stringliteral}{"{}.log"{}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00012}00012\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \_compressed\_trace\_ext\ =\ \textcolor{stringliteral}{"{}.clog"{}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00013}00013\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ \_max\_filename\_size\ =\ std::char\_traits<char>::length(\_trace\_index\_prefix)\ +\ 10\ +\ 1\ +\ 10\ +\ std::char\_traits<char>::length(\_compressed\_trace\_ext)\ +\ 1;\ \textcolor{comment}{//\ "{}trace\_index\_"{}\ +\ 10-\/digits\ +\ '-\/'\ +\ 10-\/digits\ +\ "{}.clog"{}\ +\ null-\/char}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00015}00015\ \ \ \ \ \ \ std::string\ make\_filename(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ slice\_prefix,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ slice\_ext,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_width)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00016}00016\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ filename[\_max\_filename\_size]\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00017}00017\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_start\ =\ slice\_number\ *\ slice\_width;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00018}00018\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ size\_written\ =\ snprintf(filename,\ \_max\_filename\_size,\ \textcolor{stringliteral}{"{}\%s\%010d-\/\%010d\%s"{}},\ slice\_prefix,\ slice\_start,\ (slice\_start\ +\ slice\_width),\ slice\_ext);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00019}00019\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assert\ that\ \_max\_filename\_size\ is\ correct}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00020}00020\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ size\_written\ >=\ \_max\_filename\_size\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00021}00021\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ max\_size\_str\ =\ std::to\_string(\_max\_filename\_size\ -\/\ 1);\ \textcolor{comment}{//\ dropping\ null\ character\ from\ size}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00022}00022\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ size\_written\_str\ =\ std::to\_string(size\_written);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00023}00023\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::runtime\_error(\textcolor{stringliteral}{"{}Could\ not\ write\ the\ complete\ filename.\ \ Anticipated\ the\ max\ filename\ characters\ to\ be:\ "{}}\ +}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00024}00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_size\_str\ +\ \textcolor{stringliteral}{"{}\ or\ less,\ but\ wrote:\ "{}}\ +\ size\_written\_str\ +\ \textcolor{stringliteral}{"{}\ characters.\ \ This\ is\ likely\ because\ the\ file\ "{}}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00025}00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}format\ was\ changed\ and\ the\ code\ was\ not\ updated\ accordingly.\ Filename\ created:\ "{}}\ +\ filename);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00026}00026\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00028}00028\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::string(filename);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00029}00029\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00030}00030\ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00032}00032\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio_1_1trace__api}{sysio::trace\_api}}\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00033}00033\ \ \ \ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceboost_1_1filesystem}{bfs}}\ =\ \mbox{\hyperlink{namespaceboost_1_1filesystem}{boost::filesystem}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00034}\mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a3cc96fc91b74439c3e62e00c7256a1e9}{00034}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a3cc96fc91b74439c3e62e00c7256a1e9}{store\_provider::store\_provider}}(\textcolor{keyword}{const}\ bfs::path\&\ slice\_dir,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ stride\_width,\ std::optional<uint32\_t>\ minimum\_irreversible\_history\_blocks,}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00035}00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::optional<uint32\_t>\ minimum\_uncompressed\_irreversible\_history\_blocks,\ \textcolor{keywordtype}{size\_t}\ compression\_seek\_point\_stride)}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00036}00036\ \ \ \ :\ \_slice\_directory(slice\_dir,\ stride\_width,\ minimum\_irreversible\_history\_blocks,\ minimum\_uncompressed\_irreversible\_history\_blocks,\ compression\_seek\_point\_stride)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00037}00037\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00039}00039\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ BlockTrace>}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00040}\mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a2bd4f8dab0dda219044a2032d94a1668}{00040}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a2bd4f8dab0dda219044a2032d94a1668}{store\_provider::append}}(\textcolor{keyword}{const}\ BlockTrace\&\ \mbox{\hyperlink{xbyak__mnemonic_8h_a9be923ac9afe48bc98bd22e398415272}{bt}})\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00041}00041\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ trace;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00042}00042\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ index;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00043}00043\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}}(\mbox{\hyperlink{xbyak__mnemonic_8h_a9be923ac9afe48bc98bd22e398415272}{bt}}.number);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00044}00044\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_ac7433eb9c741feab026859dc4807b174}{find\_or\_create\_slice\_pair}}(slice\_number,\ open\_state::write,\ trace,\ index);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00045}00045\ \ \ \ \ \ \ \textcolor{comment}{//\ storing\ as\ static\_variant\ to\ allow\ adding\ other\ data\ types\ to\ the\ trace\ file\ in\ the\ future}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00046}00046\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ offset\ =\ append\_store(\mbox{\hyperlink{namespacesysio_1_1trace__api_a98bdcc53a9d9aa6aff851a743516c3b9}{data\_log\_entry}}\ \{\ \mbox{\hyperlink{xbyak__mnemonic_8h_a9be923ac9afe48bc98bd22e398415272}{bt}}\ \},\ trace);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00048}00048\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ be\ =\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a7a6a31e37b6c94cbd85b0f2019e2ff3c}{metadata\_log\_entry}}\ \{\ \mbox{\hyperlink{structsysio_1_1trace__api_1_1block__entry__v0}{block\_entry\_v0}}\ \{\ .id\ =\ \mbox{\hyperlink{xbyak__mnemonic_8h_a9be923ac9afe48bc98bd22e398415272}{bt}}.id,\ .number\ =\ \mbox{\hyperlink{xbyak__mnemonic_8h_a9be923ac9afe48bc98bd22e398415272}{bt}}.number,\ .offset\ =\ offset\ \}\};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00049}00049\ \ \ \ \ \ \ append\_store(be,\ index);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00050}00050\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00052}00052\ \ \ \ \textcolor{keyword}{template}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a2bd4f8dab0dda219044a2032d94a1668}{store\_provider::append<block\_trace\_v1>}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1trace__api_1_1block__trace__v1}{block\_trace\_v1}}\&\ \mbox{\hyperlink{xbyak__mnemonic_8h_a9be923ac9afe48bc98bd22e398415272}{bt}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00053}00053\ \ \ \ \textcolor{keyword}{template}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a2bd4f8dab0dda219044a2032d94a1668}{store\_provider::append<block\_trace\_v2>}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1trace__api_1_1block__trace__v2}{block\_trace\_v2}}\&\ \mbox{\hyperlink{xbyak__mnemonic_8h_a9be923ac9afe48bc98bd22e398415272}{bt}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00055}\mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a34a4fdef03a4b354b005e73e383d7e59}{00055}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a34a4fdef03a4b354b005e73e383d7e59}{store\_provider::append\_lib}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00056}00056\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ index,\ trx\_id;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00057}00057\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}}(lib);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00058}00058\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a24faf23a87e249099bea549dbda165b2}{find\_or\_create\_index\_slice}}(slice\_number,\ open\_state::write,\ index);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00059}00059\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ le\ =\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a7a6a31e37b6c94cbd85b0f2019e2ff3c}{metadata\_log\_entry}}\ \{\ \mbox{\hyperlink{structsysio_1_1trace__api_1_1lib__entry__v0}{lib\_entry\_v0}}\ \{\ .lib\ =\ lib\ \}\};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00060}00060\ \ \ \ \ \ \ append\_store(le,\ index);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00061}00061\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aaa86b5afdb3d46491da2af321f6b54bd}{find\_or\_create\_trx\_id\_slice}}(slice\_number,\ open\_state::write,\ trx\_id);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00062}00062\ \ \ \ \ \ \ append\_store(le,\ trx\_id);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00063}00063\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aca2e44229ad8159ea40397ec974fca22}{set\_lib}}(lib);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00064}00064\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00066}\mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a03c9a6e4e79e019651c9a8f8a16ff4bf}{00066}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a03c9a6e4e79e019651c9a8f8a16ff4bf}{store\_provider::append\_trx\_ids}}(\mbox{\hyperlink{structsysio_1_1trace__api_1_1block__trxs__entry}{block\_trxs\_entry}}\ tt)\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00067}00067\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ trx\_id\_file;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00068}00068\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}}(tt.\mbox{\hyperlink{structsysio_1_1trace__api_1_1block__trxs__entry_a10c9e5753dc6cc8fe55b8d0ebf3e650f}{block\_num}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00069}00069\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aaa86b5afdb3d46491da2af321f6b54bd}{find\_or\_create\_trx\_id\_slice}}(slice\_number,\ open\_state::write,\ trx\_id\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00070}00070\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ entry\ =\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a7a6a31e37b6c94cbd85b0f2019e2ff3c}{metadata\_log\_entry}}\ \{\ std::move(tt)\ \};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00071}00071\ \ \ \ \ \ \ append\_store(entry,\ trx\_id\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00072}00072\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00074}\mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a334e53cb7d09b7a835e1ddf9d8695035}{00074}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1trace__api_a4fe812fd823fbfebfe869a30ef75a248}{get\_block\_t}}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a334e53cb7d09b7a835e1ddf9d8695035}{store\_provider::get\_block}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_height,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{yield\_function}}\&\ yield)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00075}00075\ \ \ \ \ \ \ std::optional<uint64\_t>\ trace\_offset;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00076}00076\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ irreversible\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00077}00077\ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a22d3bc262b20308a93c1e9c8a423a1fa}{scan\_metadata\_log\_from}}(block\_height,\ 0,\ [\&block\_height,\ \&trace\_offset,\ \&irreversible](\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a7a6a31e37b6c94cbd85b0f2019e2ff3c}{metadata\_log\_entry}}\&\ e)\ -\/>\ \textcolor{keywordtype}{bool}\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::holds\_alternative<block\_entry\_v0>(e))\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ block\ =\ std::get<block\_entry\_v0>(e);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (block.number\ ==\ block\_height)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trace\_offset\ =\ block.offset;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (std::holds\_alternative<lib\_entry\_v0>(e))\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lib\ =\ std::get<lib\_entry\_v0>(e).lib;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lib\ >=\ block\_height)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ irreversible\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00091}00091\ \ \ \ \ \ \ \},\ yield);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00092}00092\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trace\_offset)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a4fe812fd823fbfebfe869a30ef75a248}{get\_block\_t}}\{\};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00094}00094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00095}00095\ \ \ \ \ \ \ std::optional<data\_log\_entry>\ entry\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_afcff133b7357a33643a4ae3e7df99284}{read\_data\_log}}(block\_height,\ *trace\_offset);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00096}00096\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!entry)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1trace__api_a4fe812fd823fbfebfe869a30ef75a248}{get\_block\_t}}\{\};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00098}00098\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00099}00099\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_tuple(\ entry.value(),\ irreversible\ );}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00100}00100\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00102}\mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a22f36ae69988e2b50a48dbe604f09bf9}{00102}}\ \ \ \ \mbox{\hyperlink{namespacesysio_1_1trace__api_abd0f429b16506edddbd4a2cc5a8acea0}{get\_block\_n}}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_a22f36ae69988e2b50a48dbe604f09bf9}{store\_provider::get\_trx\_block\_number}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{chain::transaction\_id\_type}}\&\ trx\_id,\ std::optional<uint32\_t>\ minimum\_irreversible\_history\_blocks,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{yield\_function}}\&\ yield)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00103}00103\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ trx\_id\_file;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00104}00104\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_ab1967d8591af1a4e48c37fd2b0f184d0}{int32\_t}}\ slice\_number;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00105}00105\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (minimum\_irreversible\_history\_blocks)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00106}00106\ \ \ \ \ \ \ \ \ \ slice\_number\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}}(*minimum\_irreversible\_history\_blocks);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00107}00107\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00108}00108\ \ \ \ \ \ \ \ \ \ slice\_number\ =\ 0;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00109}00109\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00111}00111\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ trx\_block\_num\ =\ 0;\ \textcolor{comment}{//\ number\ of\ the\ block\ that\ contains\ the\ target\ trx}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00112}00112\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ trx\_entries\ =\ 0;\ \ \ \textcolor{comment}{//\ number\ of\ entries\ that\ contain\ the\ target\ trx}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00113}00113\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1store__provider_ae684bf4119be3e3464e2d5bc4183b12b}{\_slice\_directory}}.\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_afd4f092c1fd16893e6d0a8cc06a40ea4}{find\_trx\_id\_slice}}(slice\_number,\ open\_state::read,\ trx\_id\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !found\ )}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00116}00116\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ traversed\ all\ slices}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00117}00117\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1trace__api_a7a6a31e37b6c94cbd85b0f2019e2ff3c}{metadata\_log\_entry}}\ entry;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ ds\ =\ trx\_id\_file.\mbox{\hyperlink{classfc_1_1cfile_a801dd3c493741ff16ef5cf609cc5f9c5}{create\_datastream}}();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ end\ =\ \mbox{\hyperlink{namespacefc_aae3e907b120751591ca6919ac66c384b}{file\_size}}(trx\_id\_file.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ offset\ =\ trx\_id\_file.\mbox{\hyperlink{classfc_1_1cfile_abc92fc8d64550b772a69ca1b63f75bfb}{tellp}}();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (offset\ <\ end)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ yield();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_1_1raw_a0b442d98ceb22dd5a6ae84745e43ffab}{fc::raw::unpack}}(ds,\ entry);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::holds\_alternative<block\_trxs\_entry>(entry))\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00126}00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ trxs\_entry\ =\ std::get<block\_trxs\_entry>(entry);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ =\ 0\mbox{\hyperlink{union_u}{U}};\ i\ <\ trxs\_entry.ids.size();\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trxs\_entry.ids[i]\ ==\ trx\_id)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00129}00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_entries++;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trx\_block\_num\ =\ trxs\_entry.block\_num;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00132}00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (std::holds\_alternative<lib\_entry\_v0>(entry))\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ lib\ =\ std::get<lib\_entry\_v0>(entry).lib;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trx\_entries\ >\ 0\ \&\&\ lib\ >=\ trx\_block\_num)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trx\_block\_num;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exception_8hpp_abed525eeff3ae581be7e4e2fcd3b7bf4}{FC\_ASSERT}}(\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{"{}unpacked\ data\ should\ be\ a\ block\_trxs\_entry\ or\ a\ lib\_entry\_v0"{}}\ );;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00140}00140\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ =\ trx\_id\_file.\mbox{\hyperlink{classfc_1_1cfile_abc92fc8d64550b772a69ca1b63f75bfb}{tellp}}();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00142}00142\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00143}00143\ \ \ \ \ \ \ \ \ \ slice\_number++;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00144}00144\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00145}00145\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00146}00146\ \ \ \ \ \ \ \textcolor{comment}{//\ transaction's\ block\ is\ not\ irreversible}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00147}00147\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trx\_entries\ >\ 0)}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ trx\_block\_num;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00150}00150\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacesysio_1_1trace__api_abd0f429b16506edddbd4a2cc5a8acea0}{get\_block\_n}}\{\};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00151}00151\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00152}00152\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00153}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aa1109759adce42b01b76b9e72a8e8ae8}{00153}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aa1109759adce42b01b76b9e72a8e8ae8}{slice\_directory::slice\_directory}}(\textcolor{keyword}{const}\ bfs::path\&\ slice\_dir,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{catch__reporter__console_8cpp_a2474a5474cbff19523a51eb1de01cda4}{width}},\ std::optional<uint32\_t>\ minimum\_irreversible\_history\_blocks,\ std::optional<uint32\_t>\ minimum\_uncompressed\_irreversible\_history\_blocks,\ \textcolor{keywordtype}{size\_t}\ compression\_seek\_point\_stride)}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00154}00154\ \ \ \ :\ \_slice\_dir(slice\_dir)}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00155}00155\ \ \ \ ,\ \_width(\mbox{\hyperlink{catch__reporter__console_8cpp_a2474a5474cbff19523a51eb1de01cda4}{width}})}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00156}00156\ \ \ \ ,\ \_minimum\_irreversible\_history\_blocks(minimum\_irreversible\_history\_blocks)}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00157}00157\ \ \ \ ,\ \_minimum\_uncompressed\_irreversible\_history\_blocks(minimum\_uncompressed\_irreversible\_history\_blocks)}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00158}00158\ \ \ \ ,\ \_compression\_seek\_point\_stride(compression\_seek\_point\_stride)}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00159}00159\ \ \ \ ,\ \_best\_known\_lib(0)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00160}00160\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespacefc_a3fcf0d920aea28014aacae50a51d8485}{exists}}(\_slice\_dir))\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00161}00161\ \ \ \ \ \ \ \ \ \ bfs::create\_directories(slice\_dir);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00162}00162\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00163}00163\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00164}00164\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00165}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a24faf23a87e249099bea549dbda165b2}{00165}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a24faf23a87e249099bea549dbda165b2}{slice\_directory::find\_or\_create\_index\_slice}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a532effe653319aa639caa41b48709ae0}{open\_state}}\ \mbox{\hyperlink{structstate}{state}},\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ index\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00166}00166\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aa8fdc6fcd3d18c76b517d65b6ea56bef}{find\_index\_slice}}(\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ \mbox{\hyperlink{structstate}{state}},\ index\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00167}00167\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !found\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00168}00168\ \ \ \ \ \ \ \ \ \ create\_new\_index\_slice\_file(index\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00169}00169\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00170}00170\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00171}00171\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00173}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aa8fdc6fcd3d18c76b517d65b6ea56bef}{00173}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aa8fdc6fcd3d18c76b517d65b6ea56bef}{slice\_directory::find\_index\_slice}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a532effe653319aa639caa41b48709ae0}{open\_state}}\ \mbox{\hyperlink{structstate}{state}},\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ index\_file,\ \textcolor{keywordtype}{bool}\ open\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00174}00174\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ find\_slice(\_trace\_index\_prefix,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ index\_file,\ open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00175}00175\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !found\ ||\ !open\_file\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00177}00177\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00179}00179\ \ \ \ \ \ \ validate\_existing\_index\_slice\_file(index\_file,\ \mbox{\hyperlink{structstate}{state}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00180}00180\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00181}00181\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00182}00182\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00183}00183\ \ \ \ \textcolor{keywordtype}{void}\ slice\_directory::create\_new\_index\_slice\_file(\mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ index\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00184}00184\ \ \ \ \ \ \ index\_file.\mbox{\hyperlink{classfc_1_1cfile_a9e01adaeee108420312ed271133a2d7d}{open}}(\mbox{\hyperlink{classfc_1_1cfile_a7a3023c63962b85efb8129379442234b}{fc::cfile::create\_or\_update\_rw\_mode}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00185}00185\ \ \ \ \ \ \ index\_header\ h\ \{\ .version\ =\ \_current\_version\ \};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00186}00186\ \ \ \ \ \ \ append\_store(h,\ index\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00187}00187\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00188}00188\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00189}00189\ \ \ \ \textcolor{keywordtype}{void}\ slice\_directory::validate\_existing\_index\_slice\_file(\mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ index\_file,\ \mbox{\hyperlink{test__trace__file_8cpp_a198834d0a121ab5b82820ffa8361e521}{open\_state}}\ \mbox{\hyperlink{structstate}{state}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00190}00190\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ header\ =\ extract\_store<index\_header>(index\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00191}00191\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (header.version\ !=\ \_current\_version)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00192}00192\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ old\_slice\_version(\textcolor{stringliteral}{"{}Old\ slice\ file\ with\ version:\ "{}}\ +\ std::to\_string(header.version)\ +}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00193}00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ is\ in\ directory,\ only\ supporting\ version:\ "{}}\ +\ std::to\_string(\_current\_version));}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00194}00194\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00195}00195\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00196}00196\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structstate}{state}}\ ==\ open\_state::write\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00197}00197\ \ \ \ \ \ \ \ \ \ index\_file.\mbox{\hyperlink{classfc_1_1cfile_a29badc2b6c1f589d0c79b20ce31cacf0}{seek\_end}}(0);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00198}00198\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00199}00199\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00200}00200\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00201}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a365023e0ceb97c69aa3ad66c393c2125}{00201}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a365023e0ceb97c69aa3ad66c393c2125}{slice\_directory::find\_or\_create\_trace\_slice}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a532effe653319aa639caa41b48709ae0}{open\_state}}\ \mbox{\hyperlink{structstate}{state}},\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ trace\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00202}00202\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a314838e3f2122e4bcc7f1279b78f7d0c}{find\_trace\_slice}}(\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ \mbox{\hyperlink{structstate}{state}},\ trace\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00203}00203\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00204}00204\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !found\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00205}00205\ \ \ \ \ \ \ \ \ \ trace\_file.\mbox{\hyperlink{classfc_1_1cfile_a9e01adaeee108420312ed271133a2d7d}{open}}(\mbox{\hyperlink{classfc_1_1cfile_a7a3023c63962b85efb8129379442234b}{fc::cfile::create\_or\_update\_rw\_mode}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00206}00206\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00208}00208\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00209}00209\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00210}00210\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00211}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a314838e3f2122e4bcc7f1279b78f7d0c}{00211}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a314838e3f2122e4bcc7f1279b78f7d0c}{slice\_directory::find\_trace\_slice}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a532effe653319aa639caa41b48709ae0}{open\_state}}\ \mbox{\hyperlink{structstate}{state}},\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ trace\_file,\ \textcolor{keywordtype}{bool}\ open\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00212}00212\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ find\_slice(\_trace\_prefix,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ trace\_file,\ open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00213}00213\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00214}00214\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !found\ ||\ !open\_file\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00216}00216\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00218}00218\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structstate}{state}}\ ==\ open\_state::write\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00219}00219\ \ \ \ \ \ \ \ \ \ trace\_file.\mbox{\hyperlink{classfc_1_1cfile_a29badc2b6c1f589d0c79b20ce31cacf0}{seek\_end}}(0);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00220}00220\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00221}00221\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00222}00222\ \ \ \ \ \ \ \ \ \ trace\_file.\mbox{\hyperlink{classfc_1_1cfile_a6eb4fe4530480f13c6cf773a7f1e3847}{seek}}(0);\ \textcolor{comment}{//\ ensure\ we\ are\ at\ the\ start\ of\ the\ file}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00223}00223\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00224}00224\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00225}00225\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00227}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a79cb70775a7aa5e99311529fa6ce30a2}{00227}}\ \ \ \ std::optional<compressed\_file>\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a79cb70775a7aa5e99311529fa6ce30a2}{slice\_directory::find\_compressed\_trace\_slice}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \textcolor{keywordtype}{bool}\ open\_file\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00228}00228\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ filename\ =\ make\_filename(\_trace\_prefix,\ \_compressed\_trace\_ext,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ \_width);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00229}00229\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{path}}\ slice\_path\ =\ \_slice\_dir\ /\ filename;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00230}00230\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ file\_exists\ =\ \mbox{\hyperlink{namespacefc_a3fcf0d920aea28014aacae50a51d8485}{exists}}(slice\_path);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00232}00232\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (file\_exists)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00233}00233\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ result\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1compressed__file}{compressed\_file}}(slice\_path);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (open\_file)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00235}00235\ \ \ \ \ \ \ \ \ \ \ \ \ result.open();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00236}00236\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00237}00237\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00238}00238\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::move(result);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00239}00239\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00240}00240\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00241}00241\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00242}00242\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00244}00244\ \ \ \ \textcolor{keywordtype}{bool}\ slice\_directory::find\_slice(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ slice\_prefix,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ slice\_file,\ \textcolor{keywordtype}{bool}\ open\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00245}00245\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ filename\ =\ make\_filename(slice\_prefix,\ \_trace\_ext,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ \_width);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00246}00246\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{path}}\ slice\_path\ =\ \_slice\_dir\ /\ filename;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00247}00247\ \ \ \ \ \ \ slice\_file.\mbox{\hyperlink{classfc_1_1cfile_ac4a0191d7846c07a907d3c7eb35e848d}{set\_file\_path}}(slice\_path);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00248}00248\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00249}00249\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ file\_exists\ =\ \mbox{\hyperlink{namespacefc_a3fcf0d920aea28014aacae50a51d8485}{exists}}(slice\_path);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00250}00250\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !file\_exists\ ||\ !open\_file\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00251}00251\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ file\_exists;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00252}00252\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00253}00253\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00254}00254\ \ \ \ \ \ \ slice\_file.\mbox{\hyperlink{classfc_1_1cfile_a9e01adaeee108420312ed271133a2d7d}{open}}(\mbox{\hyperlink{classfc_1_1cfile_a7a3023c63962b85efb8129379442234b}{fc::cfile::create\_or\_update\_rw\_mode}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00255}00255\ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ this\ is\ a\ temporary\ fix\ until\ fc::cfile\ handles\ it\ internally.\ \ OSX\ and\ Linux\ differ\ on\ the\ read\ offset}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00256}00256\ \ \ \ \ \ \ \textcolor{comment}{//\ when\ opening\ in\ "{}ab+"{}\ mode}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00257}00257\ \ \ \ \ \ \ slice\_file.\mbox{\hyperlink{classfc_1_1cfile_a6eb4fe4530480f13c6cf773a7f1e3847}{seek}}(0);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00258}00258\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00259}00259\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00260}00260\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00261}00261\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00262}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_ac7433eb9c741feab026859dc4807b174}{00262}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_ac7433eb9c741feab026859dc4807b174}{slice\_directory::find\_or\_create\_slice\_pair}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a532effe653319aa639caa41b48709ae0}{open\_state}}\ \mbox{\hyperlink{structstate}{state}},\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ trace,\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ index)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00263}00263\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ trace\_found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a365023e0ceb97c69aa3ad66c393c2125}{find\_or\_create\_trace\_slice}}(\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ \mbox{\hyperlink{structstate}{state}},\ trace);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00264}00264\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ index\_found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a24faf23a87e249099bea549dbda165b2}{find\_or\_create\_index\_slice}}(\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ \mbox{\hyperlink{structstate}{state}},\ index);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00265}00265\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trace\_found\ !=\ index\_found)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ trace\_status\ =\ trace\_found\ ?\ \textcolor{stringliteral}{"{}existing"{}}\ :\ \textcolor{stringliteral}{"{}new"{}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ index\_status\ =\ index\_found\ ?\ \textcolor{stringliteral}{"{}existing"{}}\ :\ \textcolor{stringliteral}{"{}new"{}};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a9e3cdbaecd5a34b42956e888f7326fad}{elog}}(\textcolor{stringliteral}{"{}Trace\ file\ is\ \$\{ts\},\ but\ it's\ metadata\ file\ is\ \$\{is\}.\ This\ means\ the\ files\ are\ not\ consistent."{}},\ (\textcolor{stringliteral}{"{}ts"{}},\ trace\_status)(\textcolor{stringliteral}{"{}is"{}},\ index\_status));}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00269}00269\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00270}00270\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00271}00271\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00272}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aaa86b5afdb3d46491da2af321f6b54bd}{00272}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aaa86b5afdb3d46491da2af321f6b54bd}{slice\_directory::find\_or\_create\_trx\_id\_slice}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a532effe653319aa639caa41b48709ae0}{open\_state}}\ \mbox{\hyperlink{structstate}{state}},\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ trx\_id\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00273}00273\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_afd4f092c1fd16893e6d0a8cc06a40ea4}{find\_trx\_id\_slice}}(\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ \mbox{\hyperlink{structstate}{state}},\ trx\_id\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00274}00274\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !found\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00275}00275\ \ \ \ \ \ \ \ \ \ \ \ trx\_id\_file.\mbox{\hyperlink{classfc_1_1cfile_a9e01adaeee108420312ed271133a2d7d}{open}}(\mbox{\hyperlink{classfc_1_1cfile_a7a3023c63962b85efb8129379442234b}{fc::cfile::create\_or\_update\_rw\_mode}});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00276}00276\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00277}00277\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00278}00278\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00279}00279\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00280}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_afd4f092c1fd16893e6d0a8cc06a40ea4}{00280}}\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_afd4f092c1fd16893e6d0a8cc06a40ea4}{slice\_directory::find\_trx\_id\_slice}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_number,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a532effe653319aa639caa41b48709ae0}{open\_state}}\ \mbox{\hyperlink{structstate}{state}},\ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\&\ trx\_id\_file,\ \textcolor{keywordtype}{bool}\ open\_file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00281}00281\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ find\_slice(\_trace\_trx\_id\_prefix,\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}},\ trx\_id\_file,\ open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00282}00282\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !found\ ||\ !open\_file\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00283}00283\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00284}00284\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00285}00285\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structstate}{state}}\ ==\ open\_state::write\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00286}00286\ \ \ \ \ \ \ \ \ \ \ trx\_id\_file.\mbox{\hyperlink{classfc_1_1cfile_a29badc2b6c1f589d0c79b20ce31cacf0}{seek\_end}}(0);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00287}00287\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00288}00288\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00289}00289\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00290}00290\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00291}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aca2e44229ad8159ea40397ec974fca22}{00291}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aca2e44229ad8159ea40397ec974fca22}{slice\_directory::set\_lib}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00292}00292\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00293}00293\ \ \ \ \ \ \ \ \ \ std::scoped\_lock\ \mbox{\hyperlink{xbyak__mnemonic_8h_aa81aed607133209dade63a226818224d}{lock}}(\_maintenance\_mtx);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00294}00294\ \ \ \ \ \ \ \ \ \ \_best\_known\_lib\ =\ lib;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00295}00295\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00296}00296\ \ \ \ \ \ \ \_maintenance\_condition.notify\_one();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00297}00297\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00298}00298\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00299}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a7c7ccb0852100b5ab21daef4ac3133cc}{00299}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a7c7ccb0852100b5ab21daef4ac3133cc}{slice\_directory::start\_maintenance\_thread}}(\mbox{\hyperlink{classfc_1_1optional__delegate}{log\_handler}}\ log)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00300}00300\ \ \ \ \ \ \ \_maintenance\_thread\ =\ std::thread([\textcolor{keyword}{this},\ log=std::move(log)]()\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00301}00301\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacefc_ab58a7f71e88d7d4d5761bbd24837c595}{fc::set\_os\_thread\_name}}(\ \textcolor{stringliteral}{"{}trace-\/mx"{}}\ );}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00302}00302\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ last\_lib\ =\ 0;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00303}00303\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00304}00304\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00305}00305\ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_lock<std::mutex>\ \mbox{\hyperlink{xbyak__mnemonic_8h_aa81aed607133209dade63a226818224d}{lock}}(\_maintenance\_mtx);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00306}00306\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ last\_lib\ >=\ \_best\_known\_lib\ \&\&\ !\_maintenance\_shutdown\ )\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00307}00307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_maintenance\_condition.wait(lock);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00308}00308\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00309}00309\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00310}00310\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_maintenance\_shutdown)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00311}00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00312}00312\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00313}00313\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00314}00314\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ best\_known\_lib\ =\ \_best\_known\_lib;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00315}00315\ \ \ \ \ \ \ \ \ \ \ \ \ lock.unlock();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Waking\ up\ to\ handle\ lib:\ "{}})\ +\ std::to\_string(best\_known\_lib));}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00318}00318\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00319}00319\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (last\_lib\ <\ best\_known\_lib)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a8b15d66d020bfc67d541e6cf09404ab9}{run\_maintenance\_tasks}}(best\_known\_lib,\ log);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ last\_lib\ =\ best\_known\_lib;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \mbox{\hyperlink{exception_8hpp_aed56aa2593b6f6fc6a839b7cb5c6e8e3}{FC\_LOG\_AND\_DROP}}();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00324}00324\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00326}00326\ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00327}00327\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00328}00328\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00329}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_ad847f59ef5d63042406e109f2fd836a6}{00329}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_ad847f59ef5d63042406e109f2fd836a6}{slice\_directory::stop\_maintenance\_thread}}()\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00330}00330\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00331}00331\ \ \ \ \ \ \ \ \ \ std::scoped\_lock\ \mbox{\hyperlink{xbyak__mnemonic_8h_aa81aed607133209dade63a226818224d}{lock}}(\_maintenance\_mtx);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \_maintenance\_shutdown\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00333}00333\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00334}00334\ \ \ \ \ \ \ \_maintenance\_condition.notify\_one();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00335}00335\ \ \ \ \ \ \ \_maintenance\_thread.join();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00336}00336\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00337}00337\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00338}00338\ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ F>}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00339}00339\ \ \ \ \textcolor{keywordtype}{void}\ slice\_directory::process\_irreversible\_slice\_range(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ min\_irreversible,\ std::optional<uint32\_t>\&\ lower\_bound\_slice,\ F\&\&\ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}})\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00340}00340\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib\_slice\_number\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}}(\ lib\ );}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00341}00341\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lib\_slice\_number\ <\ 1\ ||\ (lower\_bound\_slice\ \&\&\ *lower\_bound\_slice\ >=\ lib\_slice\_number\ -\/\ 1))}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00342}00342\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00343}00343\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00344}00344\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\ upper\_bound\_block\_number\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\textcolor{keyword}{>}(lib)\ -\/\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a414156feea104f8f75b4ed9e3121b2f6}{int64\_t}}\textcolor{keyword}{>}(min\_irreversible)\ -\/\ \_width;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00345}00345\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (upper\_bound\_block\_number\ >=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00346}00346\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ upper\_bound\_slice\_num\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a47a30741cf28932df1556209da63b227}{slice\_number}}(\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\textcolor{keyword}{>}(upper\_bound\_block\_number));}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00347}00347\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!lower\_bound\_slice\ ||\ *lower\_bound\_slice\ <\ upper\_bound\_slice\_num)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00348}00348\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_to\_process\ =\ lower\_bound\_slice\ ?\ *lower\_bound\_slice\ +\ 1\ :\ 0;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00349}00349\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_x02-_disabled_macros_8cpp_ae28240b98d91d6eb7da702b770490f39}{f}}(slice\_to\_process);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00350}00350\ \ \ \ \ \ \ \ \ \ \ \ \ lower\_bound\_slice\ =\ slice\_to\_process;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00352}00352\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00353}00353\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00354}00354\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00355}\mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a8b15d66d020bfc67d541e6cf09404ab9}{00355}}\ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a8b15d66d020bfc67d541e6cf09404ab9}{slice\_directory::run\_maintenance\_tasks}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ lib,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1optional__delegate}{log\_handler}}\&\ log)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00356}00356\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_minimum\_irreversible\_history\_blocks)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00357}00357\ \ \ \ \ \ \ \ \ \ process\_irreversible\_slice\_range(lib,\ *\_minimum\_irreversible\_history\_blocks,\ \_last\_cleaned\_up\_slice,\ [\textcolor{keyword}{this},\ \&log](\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_to\_clean)\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00358}00358\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ trace;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00359}00359\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ index;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00360}00360\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ trx\_id;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00361}00361\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00362}00362\ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Attempting\ Prune\ of\ slice:\ "{}})\ +\ std::to\_string(slice\_to\_clean));}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00363}00363\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00364}00364\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cleanup\ index\ first\ to\ reduce\ the\ likelihood\ of\ reader\ finding\ index,\ but\ not\ finding\ trace}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00365}00365\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ dont\_open\_file\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00366}00366\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ index\_found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_aa8fdc6fcd3d18c76b517d65b6ea56bef}{find\_index\_slice}}(slice\_to\_clean,\ open\_state::read,\ index,\ dont\_open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00367}00367\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (index\_found)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00368}00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Removing:\ "{}})\ +\ index.get\_file\_path().generic\_string());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00369}00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bfs::remove(index.get\_file\_path());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00371}00371\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ trace\_found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a314838e3f2122e4bcc7f1279b78f7d0c}{find\_trace\_slice}}(slice\_to\_clean,\ open\_state::read,\ trace,\ dont\_open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trace\_found)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Removing:\ "{}})\ +\ trace.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}().\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00374}00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bfs::remove(trace.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00375}00375\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ trx\_id\_found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_afd4f092c1fd16893e6d0a8cc06a40ea4}{find\_trx\_id\_slice}}(slice\_to\_clean,\ open\_state::read,\ trx\_id,\ dont\_open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00377}00377\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trx\_id\_found)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00378}00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Removing:\ "{}})\ +\ trx\_id.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}().\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00379}00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bfs::remove(trx\_id.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00380}00380\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00381}00381\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00382}00382\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ ctrace\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a79cb70775a7aa5e99311529fa6ce30a2}{find\_compressed\_trace\_slice}}(slice\_to\_clean,\ dont\_open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00383}00383\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ctrace)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Removing:\ "{}})\ +\ ctrace-\/>get\_file\_path().generic\_string());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bfs::remove(ctrace-\/>get\_file\_path());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00386}00386\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00387}00387\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00388}00388\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00389}00389\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00390}00390\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ process\ compression\ if\ its\ configured\ AND\ there\ is\ a\ range\ of\ irreversible\ blocks\ which\ would\ not\ also}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00391}00391\ \ \ \ \ \ \ \textcolor{comment}{//\ be\ deleted}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00392}00392\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_minimum\_uncompressed\_irreversible\_history\_blocks\ \&\&}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00393}00393\ \ \ \ \ \ \ \ \ \ \ (!\_minimum\_irreversible\_history\_blocks\ ||\ *\_minimum\_uncompressed\_irreversible\_history\_blocks\ <\ *\_minimum\_irreversible\_history\_blocks)\ )}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00394}00394\ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00395}00395\ \ \ \ \ \ \ \ \ \ process\_irreversible\_slice\_range(lib,\ *\_minimum\_uncompressed\_irreversible\_history\_blocks,\ \_last\_compressed\_slice,\ [\textcolor{keyword}{this},\ \&log](\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ slice\_to\_compress)\{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1cfile}{fc::cfile}}\ trace;}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00397}00397\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ dont\_open\_file\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00398}00398\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ trace\_found\ =\ \mbox{\hyperlink{classsysio_1_1trace__api_1_1slice__directory_a314838e3f2122e4bcc7f1279b78f7d0c}{find\_trace\_slice}}(slice\_to\_compress,\ open\_state::read,\ trace,\ dont\_open\_file);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00399}00399\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00400}00400\ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Attempting\ compression\ of\ slice:\ "{}})\ +\ std::to\_string(slice\_to\_compress));}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00401}00401\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00402}00402\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (trace\_found)\ \{}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00403}00403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ compressed\_path\ =\ trace.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}();}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00404}00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ compressed\_path.\mbox{\hyperlink{classfc_1_1path_af7de3b21cee1e93c7496e480181e7af2}{replace\_extension}}(\_compressed\_trace\_ext);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00405}00405\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Compressing:\ "{}})\ +\ trace.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}().\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1trace__api_1_1compressed__file_ab13021e139e2ee1be1e38e84499810e2}{compressed\_file::process}}(trace.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}(),\ compressed\_path.\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}(),\ \_compression\_seek\_point\_stride);}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00408}00408\ }
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ after\ compression\ is\ complete,\ delete\ the\ old\ uncompressed\ file}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00410}00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ log(std::string(\textcolor{stringliteral}{"{}Removing:\ "{}})\ +\ trace.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}().\mbox{\hyperlink{classfc_1_1path_ab1eae2062df4ea01435348ec52fb3784}{generic\_string}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00411}00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bfs::remove(trace.\mbox{\hyperlink{classfc_1_1cfile_aba9b5dcf06d12cc653b8eb4224351ff7}{get\_file\_path}}());}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00414}00414\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00415}00415\ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{store__provider_8cpp_source_l00416}00416\ \}}

\end{DoxyCode}
