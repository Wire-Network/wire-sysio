\doxysection{block\+\_\+log.\+hpp}
\hypertarget{block__log_8hpp_source}{}\label{block__log_8hpp_source}\index{libraries/chain/include/sysio/chain/block\_log.hpp@{libraries/chain/include/sysio/chain/block\_log.hpp}}
\mbox{\hyperlink{block__log_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00001}00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00002}00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{filesystem_8hpp}{fc/filesystem.hpp}}>}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{block_8hpp}{sysio/chain/block.hpp}}>}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{genesis__state_8hpp}{sysio/chain/genesis\_state.hpp}}>}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00006}00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesysio}{sysio}}\ \{\ \textcolor{keyword}{namespace\ }chain\ \{}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00008}00008\ \ \ \ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedetail}{detail}}\ \{\ \textcolor{keyword}{class\ }block\_log\_impl;\ \}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00010}00010\ \ \ \ \textcolor{comment}{/*\ The\ block\ log\ is\ an\ external\ append\ only\ log\ of\ the\ blocks\ with\ a\ header.\ Blocks\ should\ only}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00011}00011\ \textcolor{comment}{\ \ \ \ *\ be\ written\ to\ the\ log\ after\ they\ irreverisble\ as\ the\ log\ is\ append\ only.\ The\ log\ is\ a\ doubly}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00012}00012\ \textcolor{comment}{\ \ \ \ *\ linked\ list\ of\ blocks.\ There\ is\ a\ secondary\ index\ file\ of\ only\ block\ positions\ that\ enables}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00013}00013\ \textcolor{comment}{\ \ \ \ *\ O(1)\ random\ access\ lookup\ by\ block\ number.}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00014}00014\ \textcolor{comment}{\ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00015}00015\ \textcolor{comment}{\ \ \ \ *\ +-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00016}00016\ \textcolor{comment}{\ \ \ \ *\ |\ Block\ 1\ |\ Pos\ of\ Block\ 1\ |\ Block\ 2\ |\ Pos\ of\ Block\ 2\ |\ ...\ |\ Head\ Block\ |\ Pos\ of\ Head\ Block\ |}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00017}00017\ \textcolor{comment}{\ \ \ \ *\ +-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00018}00018\ \textcolor{comment}{\ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00019}00019\ \textcolor{comment}{\ \ \ \ *\ +-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00020}00020\ \textcolor{comment}{\ \ \ \ *\ |\ Pos\ of\ Block\ 1\ |\ Pos\ of\ Block\ 2\ |\ ...\ |\ Pos\ of\ Head\ Block\ |}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00021}00021\ \textcolor{comment}{\ \ \ \ *\ +-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00022}00022\ \textcolor{comment}{\ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00023}00023\ \textcolor{comment}{\ \ \ \ *\ The\ block\ log\ can\ be\ walked\ in\ order\ by\ deserializing\ a\ block,\ skipping\ 8\ bytes,\ deserializing\ a}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00024}00024\ \textcolor{comment}{\ \ \ \ *\ block,\ repeat...\ The\ head\ block\ of\ the\ file\ can\ be\ found\ by\ seeking\ to\ the\ position\ contained}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00025}00025\ \textcolor{comment}{\ \ \ \ *\ in\ the\ last\ 8\ bytes\ the\ file.\ The\ block\ log\ can\ be\ read\ backwards\ by\ jumping\ back\ 8\ bytes,\ following}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00026}00026\ \textcolor{comment}{\ \ \ \ *\ the\ position,\ reading\ the\ block,\ jumping\ back\ 8\ bytes,\ etc.}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00027}00027\ \textcolor{comment}{\ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00028}00028\ \textcolor{comment}{\ \ \ \ *\ Blocks\ can\ be\ accessed\ at\ random\ via\ block\ number\ through\ the\ index\ file.\ Seek\ to\ 8\ *\ (block\_num\ -\/\ 1)}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00029}00029\ \textcolor{comment}{\ \ \ \ *\ to\ find\ the\ position\ of\ the\ block\ in\ the\ main\ file.}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00030}00030\ \textcolor{comment}{\ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00031}00031\ \textcolor{comment}{\ \ \ \ *\ The\ main\ file\ is\ the\ only\ file\ that\ needs\ to\ persist.\ The\ index\ file\ can\ be\ reconstructed\ during\ a}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00032}00032\ \textcolor{comment}{\ \ \ \ *\ linear\ scan\ of\ the\ main\ file.}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00033}00033\ \textcolor{comment}{\ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00034}00034\ \textcolor{comment}{\ \ \ \ *\ An\ optional\ "{}pruned"{}\ mode\ can\ be\ activated\ which\ stores\ a\ 4\ byte\ trailer\ on\ the\ log\ file\ indicating}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00035}00035\ \textcolor{comment}{\ \ \ \ *\ how\ many\ blocks\ at\ the\ end\ of\ the\ log\ are\ valid.\ Any\ earlier\ blocks\ in\ the\ log\ are\ assumed\ destroyed}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00036}00036\ \textcolor{comment}{\ \ \ \ *\ and\ unreadable\ due\ to\ reclamation\ for\ purposes\ of\ saving\ space.}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00037}00037\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00039}\mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config}{00039}}\ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config}{block\_log\_prune\_config}}\ \{}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00040}\mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config_ac4b36913fb72b7366d7a15ac8244459d}{00040}}\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config_ac4b36913fb72b7366d7a15ac8244459d}{prune\_blocks}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//number\ of\ blocks\ to\ prune\ to\ when\ doing\ a\ prune}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00041}\mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config_afcd718785c7c18d8af573f2892f3206c}{00041}}\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config_afcd718785c7c18d8af573f2892f3206c}{prune\_threshold}}\ =\ 4*1024*1024;\ \textcolor{comment}{//(approximately)\ how\ many\ bytes\ need\ to\ be\ added\ before\ a\ prune\ is\ performed}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00042}\mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config_a9163e1f6fa8114e8e3d70d2de0c10b26}{00042}}\ \ \ \ \ \ \ std::optional<size\_t>\ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1block__log__prune__config_a9163e1f6fa8114e8e3d70d2de0c10b26}{vacuum\_on\_close}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//when\ set,\ a\ vacuum\ is\ performed\ on\ dtor\ if\ log\ contains\ less\ than\ this\ many\ live\ bytes}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00043}00043\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00045}\mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{00045}}\ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{block\_log}}\ \{}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00046}00046\ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00047}00047\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a5e277b1da07f22d861b769530b837f1d}{block\_log}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ data\_dir,\ std::optional<block\_log\_prune\_config>\ prune\_config);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a5e277b1da07f22d861b769530b837f1d}{block\_log}}(\mbox{\hyperlink{classsysio_1_1chain_1_1block__log}{block\_log}}\&\&\ other);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a45c70cce7837458f4519a52979632e8d}{\string~block\_log}}();}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_aca2eca093aee072fc3f599a7c642a227}{append}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ b);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a44ab2b550fcc2be7e0b0e98faabd1f21}{flush}}();}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1genesis__state}{genesis\_state}}\&\ gs,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ genesis\_block\ );}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_af7c368f1aa0e3e827d619228c4e144bd}{reset}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\&\ chain\_id,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}\ );}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00055}00055\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a8649ead0a8c1e670284a8880747ee1bf}{read\_block}}(\mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ file\_pos)\textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ab651ea69962e02a5386194e4d7e055a0}{read\_block\_header}}(\mbox{\hyperlink{structsysio_1_1chain_1_1block__header}{block\_header}}\&\ bh,\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ file\_pos)\textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a99c59d29b262144ad99eacc827f76107}{read\_block\_by\_num}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num)\textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a6ffacf2e1c69079d8c847a61d99b6219}{read\_block\_id\_by\_num}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num)\textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00060}\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a93b930af1b79483fd4969b3eb4f9d08b}{00060}}\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a93b930af1b79483fd4969b3eb4f9d08b}{read\_block\_by\_id}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \textcolor{keywordtype}{id})\textcolor{keyword}{const\ }\{}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a99c59d29b262144ad99eacc827f76107}{read\_block\_by\_num}}(\mbox{\hyperlink{structsysio_1_1chain_1_1block__header_a39d57e33ef8d3f6ba59b4c458f0ae375}{block\_header::num\_from\_id}}(\textcolor{keywordtype}{id}));}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ad95f8bb0f2ccd5d0fd4db1a13eb3106a}{get\_block\_pos}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ block\_num)\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a2aa6dabbd33531db434a5e7325fde2e6}{read\_head}}()\textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacesysio_1_1chain_aa10ee348c57604b615bc8570f6685102}{signed\_block\_ptr}}\&\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ae787e7866ebfcd4c5dd5632c15c07c88}{head}}()\textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1sha256}{block\_id\_type}}\&\ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a4d0b6ecf420faffc4f00ba6af3d0af99}{head\_id}}()\textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00073}\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a02319a8bef22b7a167f17314c00b1ac1}{00073}}\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a02319a8bef22b7a167f17314c00b1ac1}{npos}}\ =\ std::numeric\_limits<uint64\_t>::max();}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00075}\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a8f0f031e0f64def456185998d462d35d}{00075}}\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a8f0f031e0f64def456185998d462d35d}{min\_supported\_version}};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00076}\mbox{\hyperlink{classsysio_1_1chain_1_1block__log_add7716a8093b81e1a51ed52897e97770}{00076}}\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_add7716a8093b81e1a51ed52897e97770}{max\_supported\_version}};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a28d7828f2ef978077453c8b0f97f5c04}{repair\_log}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ data\_dir,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ truncate\_at\_block\ =\ 0,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ reversible\_block\_dir\_name=\textcolor{stringliteral}{"{}"{}}\ );}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ std::optional<genesis\_state>\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a0c03de4dfe3908668418da4620af63e3}{extract\_genesis\_state}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ data\_dir\ );}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ad17bd0904611f780b5d49ad14b363208}{extract\_chain\_id}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ data\_dir\ );}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_aa470fc3f2a09d1204b1321ecd0fbed33}{construct\_index}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ block\_file\_name,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ index\_file\_name);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ad760661c5030845b1369fee21e08a909}{contains\_genesis\_state}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ version,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}});}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a370e648384d16b6d60ca211921501cc6}{contains\_chain\_id}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ version,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_ac5f1c1e78e72414fbf9bae75da42303e}{first\_block\_num}});}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a5afbeabca60a1f842b83c107ec54cf99}{is\_supported\_version}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ version);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a65b017352bcd2bdea5ed9d68af7215d1}{is\_pruned\_log}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ data\_dir);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_a00f24c3412cd6231b93394e2bbcea904}{trim\_blocklog\_front}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ temp\_dir,\ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ truncate\_at\_block);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00096}00096\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ open(\textcolor{keyword}{const}\ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\&\ data\_dir);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classsysio_1_1chain_1_1block__log_aa470fc3f2a09d1204b1321ecd0fbed33}{construct\_index}}();}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00099}00099\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00100}00100\ \ \ \ \ \ \ \ \ \ std::unique\_ptr<detail::block\_log\_impl>\ my;}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00101}00101\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00103}00103\ \textcolor{comment}{//to\ derive\ blknum\_offset==14\ see\ block\_header.hpp\ and\ note\ on\ disk\ struct\ is\ packed}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00104}00104\ \textcolor{comment}{//\ \ \ block\_timestamp\_type\ timestamp;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //bytes\ 0:3}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00105}00105\ \textcolor{comment}{//\ \ \ account\_name\ \ \ \ \ \ \ \ \ producer;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //bytes\ 4:11}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00106}00106\ \textcolor{comment}{//\ \ \ uint16\_t\ \ \ \ \ \ \ \ \ \ \ \ \ confirmed;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //bytes\ 12:13}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00107}00107\ \textcolor{comment}{//\ \ \ block\_id\_type\ \ \ \ \ \ \ \ previous;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ //bytes\ 14:45,\ low\ 4\ bytes\ is\ big\ endian\ block\ number\ of\ previous\ block}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00109}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data}{00109}}\ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data}{trim\_data}}\ \{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//used\ by\ trim\_blocklog\_front(),\ trim\_blocklog\_end(),\ and\ smoke\_test()}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00110}00110\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ab5de810b1245a1ebff191bda8b98c9a1}{trim\_data}}(\mbox{\hyperlink{classfc_1_1path}{fc::path}}\ \mbox{\hyperlink{programs_2sysio-launcher_2main_8cpp_a3426d59b828f63d073d546fed967330e}{block\_dir}});}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00111}00111\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_afd21cc1e7b397aee685160aaf721736d}{\string~trim\_data}}();}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00112}00112\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ac17d9de35cb85c02c9941383403ee043}{block\_index}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ n)\ \textcolor{keyword}{const};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00113}00113\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a031c642ba68c0e0cb6e834d5b59244c9}{block\_pos}}(\mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ n);}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00114}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{00114}}\ \ \ \ \ \ \ \mbox{\hyperlink{classfc_1_1path}{fc::path}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a9b9c1456b3224e34b79503cb529af094}{block\_file\_name}},\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ac74b927870c5603572bd5b5e7be49f24}{index\_file\_name}};\ \ \ \ \ \ \ \ \textcolor{comment}{//full\ pathname\ for\ blocks.log\ and\ blocks.index}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00115}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a7e4b371e3182b3a7f14f3ce259e9e85b}{00115}}\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a7e4b371e3182b3a7f14f3ce259e9e85b}{version}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//blocklog\ version}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00116}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a4f9ad5c06da3b28555c42b8414c77f02}{00116}}\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a4f9ad5c06da3b28555c42b8414c77f02}{first\_block}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//first\ block\ in\ blocks.log}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00117}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{00117}}\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a957dfc1ecb5587c97f7020be201bb4d9}{last\_block}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//last\ block\ in\ blocks.log}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00118}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a5faa95655dcebf6fed96719b79ecdc7e}{00118}}\ \ \ \ \ \ \ FILE*\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a5faa95655dcebf6fed96719b79ecdc7e}{blk\_in}}\ =\ \textcolor{keyword}{nullptr};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//C\ style\ files\ for\ reading\ blocks.log\ and\ blocks.index}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00119}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ad36ef41dbc453f96852a0ab9577c645e}{00119}}\ \ \ \ \ \ \ FILE*\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_ad36ef41dbc453f96852a0ab9577c645e}{ind\_in}}\ =\ \textcolor{keyword}{nullptr};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//C\ style\ files\ for\ reading\ blocks.log\ and\ blocks.index}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00120}00120\ \ \ \ \ \ \ \textcolor{comment}{//we\ use\ low\ level\ file\ IO\ because\ it\ is\ distinctly\ faster\ than\ C++\ filebuf\ or\ iostream}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00121}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_acd8f1c5d27140de411c67ca968bf8a9c}{00121}}\ \ \ \ \ \ \ \mbox{\hyperlink{stdint_8h_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_acd8f1c5d27140de411c67ca968bf8a9c}{first\_block\_pos}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//file\ position\ in\ blocks.log\ for\ the\ first\ block\ in\ the\ log}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00122}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a7d928be578fee45a79cb2d43ffca9a2d}{00122}}\ \ \ \ \ \ \ \mbox{\hyperlink{structsysio_1_1chain_1_1chain__id__type}{chain\_id\_type}}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_a7d928be578fee45a79cb2d43ffca9a2d}{chain\_id}};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00124}\mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_aeacad2aff58cf29973f137cd79819264}{00124}}\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structsysio_1_1chain_1_1trim__data_aeacad2aff58cf29973f137cd79819264}{blknum\_offset}}\{14\};\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//offset\ from\ start\ of\ block\ to\ 4\ byte\ block\ number,\ valid\ for\ the\ only\ allowed\ versions}}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00125}00125\ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{block__log_8hpp_source_l00126}00126\ \}\ \}}

\end{DoxyCode}
