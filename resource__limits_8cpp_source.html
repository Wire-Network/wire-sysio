<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wire Sysio: libraries/chain/resource_limits.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Wire Sysio<span id="projectnumber">&#160;Wire Sysion 1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('resource__limits_8cpp_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">resource_limits.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="resource__limits_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &lt;<a class="code" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html">sysio/chain/exceptions.hpp</a>&gt;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#include &lt;<a class="code" href="resource__limits_8hpp.html">sysio/chain/resource_limits.hpp</a>&gt;</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#include &lt;<a class="code" href="resource__limits__private_8hpp.html">sysio/chain/resource_limits_private.hpp</a>&gt;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &lt;<a class="code" href="transaction__metadata_8hpp.html">sysio/chain/transaction_metadata.hpp</a>&gt;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &lt;<a class="code" href="transaction_8hpp.html">sysio/chain/transaction.hpp</a>&gt;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#include &lt;<a class="code" href="deep__mind_8hpp.html">sysio/chain/deep_mind.hpp</a>&gt;</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;boost/tuple/tuple_io.hpp&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;<a class="code" href="database__utils_8hpp.html">sysio/chain/database_utils.hpp</a>&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacesysio.html">sysio</a> { <span class="keyword">namespace </span>chain { <span class="keyword">namespace </span>resource_limits {</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno"><a class="line" href="namespacesysio_1_1chain_1_1resource__limits.html#a052fc90c1a27445ea69fad79d361d90f">   13</a></span><span class="keyword">using </span><a class="code hl_class" href="classsysio_1_1chain_1_1index__set.html">resource_index_set</a> = <a class="code hl_class" href="classsysio_1_1chain_1_1index__set.html">index_set</a>&lt;</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain_1_1resource__limits.html#a46a650001834ee5948b425f2e83cf948">resource_limits_index</a>,</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain_1_1resource__limits.html#a0b3297439198d69fd3b3bb4cb9eefa6d">resource_usage_index</a>,</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain_1_1resource__limits.html#ac8c3fe48e6c4c00d12cb2f55913798ca">resource_limits_state_index</a>,</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain_1_1resource__limits.html#af0e92e61b12c4eb0ff352f44ca9fbe09">resource_limits_config_index</a></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>&gt;;</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="keyword">static_assert</span>( config::rate_limiting_precision &gt; 0, <span class="stringliteral">&quot;config::rate_limiting_precision must be positive&quot;</span> );</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="keyword">static</span> <a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> update_elastic_limit(<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> current_limit, <a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> average_usage, <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html">elastic_limit_parameters</a>&amp; <a class="code hl_struct" href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">params</a>) {</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>   <a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> result = current_limit;</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>   <span class="keywordflow">if</span> (average_usage &gt; <a class="code hl_struct" href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">params</a>.target ) {</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>      result = result * <a class="code hl_struct" href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">params</a>.contract_rate;</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>   } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>      result = result * <a class="code hl_struct" href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">params</a>.expand_rate;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>   }</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>   <span class="keywordflow">return</span> std::min(std::max(result, <a class="code hl_struct" href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">params</a>.max), <a class="code hl_struct" href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">params</a>.max * <a class="code hl_struct" href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">params</a>.max_multiplier);</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>}</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="foldopen" id="foldopen00032" data-start="{" data-end="}">
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a5535b786bf4289eccf551d6b15e5c839">   32</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a5535b786bf4289eccf551d6b15e5c839">elastic_limit_parameters::validate</a>()<span class="keyword">const </span>{</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>   <span class="comment">// At the very least ensure parameters are not set to values that will cause divide by zero errors later on.</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>   <span class="comment">// Stricter checks for sensible values can be added later.</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>   <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( <a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a38d39aa4bea732e345f3241e5a694b33">periods</a> &gt; 0, resource_limit_exception, <span class="stringliteral">&quot;elastic limit parameter &#39;periods&#39; cannot be zero&quot;</span> );</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>   <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( <a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#adaca231933dffd76677d9f3038cf830d">contract_rate</a>.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1impl_1_1ratio.html#af665e471f6d066272fc308f463c5437d">denominator</a> &gt; 0, resource_limit_exception, <span class="stringliteral">&quot;elastic limit parameter &#39;contract_rate&#39; is not a well-defined ratio&quot;</span> );</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>   <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( <a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a9e748ed99e9b3753b49cc753d8031913">expand_rate</a>.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1impl_1_1ratio.html#af665e471f6d066272fc308f463c5437d">denominator</a> &gt; 0, resource_limit_exception, <span class="stringliteral">&quot;elastic limit parameter &#39;expand_rate&#39; is not a well-defined ratio&quot;</span> );</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>}</div>
</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="keywordtype">void</span> resource_limits_state_object::update_virtual_cpu_limit( <span class="keyword">const</span> <a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&amp; cfg ) {</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>   <span class="comment">//idump((average_block_cpu_usage.average()));</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>   virtual_cpu_limit = update_elastic_limit(virtual_cpu_limit, average_block_cpu_usage.<a class="code hl_function" href="structsysio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator.html#ac565af684cfacb1625e39084e88ec742">average</a>(), cfg.cpu_limit_parameters);</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>   <span class="comment">//idump((virtual_cpu_limit));</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>}</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="keywordtype">void</span> resource_limits_state_object::update_virtual_net_limit( <span class="keyword">const</span> resource_limits_config_object&amp; cfg ) {</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>   virtual_net_limit = update_elastic_limit(virtual_net_limit, average_block_net_usage.<a class="code hl_function" href="structsysio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator.html#ac565af684cfacb1625e39084e88ec742">average</a>(), cfg.net_limit_parameters);</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>}</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="foldopen" id="foldopen00051" data-start="{" data-end="}">
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#acc5c0d662f97873d93dadbf8b6451978">   51</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#acc5c0d662f97873d93dadbf8b6451978">resource_limits_manager::add_indices</a>() {</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>   resource_index_set::add_indices(_db);</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>}</div>
</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="foldopen" id="foldopen00055" data-start="{" data-end="}">
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a1b9d0326965430166923c2241a3a6a45">   55</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a1b9d0326965430166923c2241a3a6a45">resource_limits_manager::initialize_database</a>() {</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#adc8f336b33d7013d1b0400399b16c5a7">create</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;([](<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&amp; <a class="code hl_struct" href="classconfig.html">config</a>){</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>      <span class="comment">// see default settings in the declaration</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>   });</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#adc8f336b33d7013d1b0400399b16c5a7">create</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;([&amp;<a class="code hl_struct" href="classconfig.html">config</a>](<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; <a class="code hl_struct" href="structstate.html">state</a>){</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>      <span class="comment">// see default settings in the declaration</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>      <span class="comment">// start the chain off in a way that it is &quot;congested&quot; aka slow-start</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>      <a class="code hl_struct" href="structstate.html">state</a>.virtual_cpu_limit = <a class="code hl_struct" href="classconfig.html">config</a>.cpu_limit_parameters.max;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>      <a class="code hl_struct" href="structstate.html">state</a>.virtual_net_limit = <a class="code hl_struct" href="classconfig.html">config</a>.net_limit_parameters.max;</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>   });</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>   <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>      dm_logger-&gt;on_init_resource_limits(<a class="code hl_struct" href="classconfig.html">config</a>, <a class="code hl_struct" href="structstate.html">state</a>);</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>   }</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>}</div>
</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="foldopen" id="foldopen00073" data-start="{" data-end="}">
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a7160417d30f5ef3a91467fefebf65dc6">   73</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a7160417d30f5ef3a91467fefebf65dc6">resource_limits_manager::add_to_snapshot</a>( <span class="keyword">const</span> <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a80afaa06d96e661a0f93e0ba4b09c8dc">snapshot_writer_ptr</a>&amp; snapshot )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>   resource_index_set::walk_indices([<span class="keyword">this</span>, &amp;snapshot]( <span class="keyword">auto</span> utils ){</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>      snapshot-&gt;write_section&lt;<span class="keyword">typename</span> <span class="keyword">decltype</span>(utils)::index_t::value_type&gt;([<span class="keyword">this</span>]( <span class="keyword">auto</span>&amp; section ){</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>         <span class="keyword">decltype</span>(utils)::walk(_db, [<span class="keyword">this</span>, &amp;section]( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;row ) {</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>            section.add_row(row, _db);</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>         });</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>      });</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>   });</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>}</div>
</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="foldopen" id="foldopen00083" data-start="{" data-end="}">
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a32baa74135a1423302de3a849dc8b40c">   83</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a32baa74135a1423302de3a849dc8b40c">resource_limits_manager::read_from_snapshot</a>( <span class="keyword">const</span> <a class="code hl_typedef" href="namespacesysio_1_1chain.html#aaa27dacddc54cea475602788c8e7a02c">snapshot_reader_ptr</a>&amp; snapshot ) {</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>   resource_index_set::walk_indices([<span class="keyword">this</span>, &amp;snapshot]( <span class="keyword">auto</span> utils ){</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>      snapshot-&gt;read_section&lt;<span class="keyword">typename</span> <span class="keyword">decltype</span>(utils)::index_t::value_type&gt;([<span class="keyword">this</span>]( <span class="keyword">auto</span>&amp; section ) {</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>         <span class="keywordtype">bool</span> more = !section.empty();</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>         <span class="keywordflow">while</span>(more) {</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            <span class="keyword">decltype</span>(utils)::create(_db, [<span class="keyword">this</span>, &amp;section, &amp;more]( <span class="keyword">auto</span> &amp;row ) {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>               more = section.read_row(row, _db);</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            });</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>         }</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>      });</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>   });</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>}</div>
</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="foldopen" id="foldopen00096" data-start="{" data-end="}">
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a30cd4db6f08948e05aba424431ec0605">   96</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a30cd4db6f08948e05aba424431ec0605">resource_limits_manager::initialize_account</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; account) {</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; limits = _db.<a class="code hl_function" href="classchainbase_1_1database.html#adc8f336b33d7013d1b0400399b16c5a7">create</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&gt;([&amp;]( <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; bl ) {</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>      bl.owner = account;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>   });</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.<a class="code hl_function" href="classchainbase_1_1database.html#adc8f336b33d7013d1b0400399b16c5a7">create</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>&gt;([&amp;]( <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>&amp; bu ) {</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>      bu.owner = account;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>   });</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>   <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>      dm_logger-&gt;on_newaccount_resource_limits(limits, usage);</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>   }</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>}</div>
</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="foldopen" id="foldopen00109" data-start="{" data-end="}">
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a4396d0acb70ebbd8054b13ff4c564e20">  109</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a4396d0acb70ebbd8054b13ff4c564e20">resource_limits_manager::set_block_parameters</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html">elastic_limit_parameters</a>&amp; cpu_limit_parameters, <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html">elastic_limit_parameters</a>&amp; net_limit_parameters ) {</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>   cpu_limit_parameters.<a class="code hl_function" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a5535b786bf4289eccf551d6b15e5c839">validate</a>();</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>   net_limit_parameters.<a class="code hl_function" href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a5535b786bf4289eccf551d6b15e5c839">validate</a>();</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>   <span class="keywordflow">if</span>( <a class="code hl_struct" href="classconfig.html">config</a>.cpu_limit_parameters == cpu_limit_parameters &amp;&amp; <a class="code hl_struct" href="classconfig.html">config</a>.net_limit_parameters == net_limit_parameters )</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>   _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>(<a class="code hl_struct" href="classconfig.html">config</a>, [&amp;](<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&amp; c){</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>      c.cpu_limit_parameters = cpu_limit_parameters;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>      c.net_limit_parameters = net_limit_parameters;</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>         dm_logger-&gt;on_update_resource_limits_config(c);</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>      }</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>   });</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>}</div>
</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span> </div>
<div class="foldopen" id="foldopen00125" data-start="{" data-end="}">
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#aaa7345adbf341592a81c087c50655597">  125</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#aaa7345adbf341592a81c087c50655597">resource_limits_manager::update_account_usage</a>(<span class="keyword">const</span> flat_set&lt;account_name&gt;&amp; accounts, <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> time_slot ) {</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>   <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a> : accounts ) {</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a> );</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>      _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>( usage, [&amp;]( <span class="keyword">auto</span>&amp; bu ){</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>          bu.net_usage.add( 0, time_slot, <a class="code hl_struct" href="classconfig.html">config</a>.account_net_usage_average_window );</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>          bu.cpu_usage.add( 0, time_slot, <a class="code hl_struct" href="classconfig.html">config</a>.account_cpu_usage_average_window );</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>      });</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>   }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>}</div>
</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="foldopen" id="foldopen00136" data-start="{" data-end="}">
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#ae6e413bd0a6e43b36deff7aacdd0bfd6">  136</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#ae6e413bd0a6e43b36deff7aacdd0bfd6">resource_limits_manager::add_transaction_usage</a>(<span class="keyword">const</span> flat_set&lt;account_name&gt;&amp; accounts, <a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> cpu_usage, <a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> net_usage, <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> time_slot ) {</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>   <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a> : accounts ) {</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a> );</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>      <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> unused;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>      <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> net_weight;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>      <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> cpu_weight;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>      <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a140981c195e4e0c5788f0aa6383c2697">get_account_limits</a>( <a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>, unused, net_weight, cpu_weight );</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>      _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>( usage, [&amp;]( <span class="keyword">auto</span>&amp; bu ){</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>          bu.net_usage.add( net_usage, time_slot, <a class="code hl_struct" href="classconfig.html">config</a>.account_net_usage_average_window );</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>          bu.cpu_usage.add( cpu_usage, time_slot, <a class="code hl_struct" href="classconfig.html">config</a>.account_cpu_usage_average_window );</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>         <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>            dm_logger-&gt;on_update_account_usage(bu);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>         }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>      });</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>      <span class="keywordflow">if</span>( cpu_weight &gt;= 0 &amp;&amp; <a class="code hl_struct" href="structstate.html">state</a>.total_cpu_weight &gt; 0 ) {</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>         <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> window_size = <a class="code hl_struct" href="classconfig.html">config</a>.account_cpu_usage_average_window;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>         <span class="keyword">auto</span> virtual_network_capacity_in_window = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)<a class="code hl_struct" href="structstate.html">state</a>.virtual_cpu_limit * window_size;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>         <span class="keyword">auto</span> cpu_used_in_window                 = ((<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)usage.cpu_usage.value_ex * window_size) / (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)config::rate_limiting_precision;</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>         <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> user_weight     = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)cpu_weight;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>         <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> all_user_weight = <a class="code hl_struct" href="structstate.html">state</a>.total_cpu_weight;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>         <span class="keyword">auto</span> max_user_use_in_window = (virtual_network_capacity_in_window * user_weight) / all_user_weight;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>         <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( cpu_used_in_window &lt;= max_user_use_in_window,</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                     tx_cpu_usage_exceeded,</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                     <span class="stringliteral">&quot;authorizing account &#39;${n}&#39; has insufficient cpu resources for this transaction&quot;</span>,</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                     (<span class="stringliteral">&quot;n&quot;</span>, <a class="code hl_variable" href="catch__reporter__console_8cpp.html#a9b45b3e13bd9167aab02e17e08916231">name</a>(<a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>))</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                     (<span class="stringliteral">&quot;cpu_used_in_window&quot;</span>,cpu_used_in_window)</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                     (<span class="stringliteral">&quot;max_user_use_in_window&quot;</span>,max_user_use_in_window) );</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>      }</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>      <span class="keywordflow">if</span>( net_weight &gt;= 0 &amp;&amp; <a class="code hl_struct" href="structstate.html">state</a>.total_net_weight &gt; 0) {</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>         <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> window_size = <a class="code hl_struct" href="classconfig.html">config</a>.account_net_usage_average_window;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>         <span class="keyword">auto</span> virtual_network_capacity_in_window = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)<a class="code hl_struct" href="structstate.html">state</a>.virtual_net_limit * window_size;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>         <span class="keyword">auto</span> net_used_in_window                 = ((<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)usage.net_usage.value_ex * window_size) / (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)config::rate_limiting_precision;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>         <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> user_weight     = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)net_weight;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>         <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> all_user_weight = <a class="code hl_struct" href="structstate.html">state</a>.total_net_weight;</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>         <span class="keyword">auto</span> max_user_use_in_window = (virtual_network_capacity_in_window * user_weight) / all_user_weight;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>         <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( net_used_in_window &lt;= max_user_use_in_window,</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                     tx_net_usage_exceeded,</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                     <span class="stringliteral">&quot;authorizing account &#39;${n}&#39; has insufficient net resources for this transaction&quot;</span>,</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                     (<span class="stringliteral">&quot;n&quot;</span>, <a class="code hl_variable" href="catch__reporter__console_8cpp.html#a9b45b3e13bd9167aab02e17e08916231">name</a>(<a class="code hl_variable" href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a>))</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                     (<span class="stringliteral">&quot;net_used_in_window&quot;</span>,net_used_in_window)</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                     (<span class="stringliteral">&quot;max_user_use_in_window&quot;</span>,max_user_use_in_window) );</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>      }</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>   }</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span> </div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>   <span class="comment">// account for this transaction in the block and do not exceed those limits either</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>   _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>(<a class="code hl_struct" href="structstate.html">state</a>, [&amp;](<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; rls){</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>      rls.pending_cpu_usage += cpu_usage;</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>      rls.pending_net_usage += net_usage;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>   });</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>   <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( <a class="code hl_struct" href="structstate.html">state</a>.pending_cpu_usage &lt;= <a class="code hl_struct" href="classconfig.html">config</a>.cpu_limit_parameters.max, block_resource_exhausted, <span class="stringliteral">&quot;Block has insufficient cpu resources&quot;</span> );</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>   <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( <a class="code hl_struct" href="structstate.html">state</a>.pending_net_usage &lt;= <a class="code hl_struct" href="classconfig.html">config</a>.net_limit_parameters.max, block_resource_exhausted, <span class="stringliteral">&quot;Block has insufficient net resources&quot;</span> );</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>}</div>
</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="foldopen" id="foldopen00206" data-start="{" data-end="}">
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a7fea1de6a3806590de0bda86e53c7995">  206</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a7fea1de6a3806590de0bda86e53c7995">resource_limits_manager::add_pending_ram_usage</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a> account, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> ram_delta ) {</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>   <span class="keywordflow">if</span> (ram_delta == 0) {</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>   }</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage  = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( account );</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>   <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( ram_delta &lt;= 0 || UINT64_MAX - usage.ram_usage &gt;= (<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a>)ram_delta, <a class="code hl_variable" href="namespacesysio_1_1chain.html#a5dfe17906469eaf079c180c1afb4ad94">transaction_exception</a>,</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>              <span class="stringliteral">&quot;Ram usage delta would overflow UINT64_MAX&quot;</span>);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>   <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>(ram_delta &gt;= 0 || usage.ram_usage &gt;= (<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a>)(-ram_delta), <a class="code hl_variable" href="namespacesysio_1_1chain.html#a5dfe17906469eaf079c180c1afb4ad94">transaction_exception</a>,</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>              <span class="stringliteral">&quot;Ram usage delta would underflow UINT64_MAX&quot;</span>);</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>   _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>( usage, [&amp;]( <span class="keyword">auto</span>&amp; u ) {</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>      u.ram_usage += ram_delta;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>         dm_logger-&gt;on_ram_event(account, u.ram_usage, ram_delta);</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>      }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>   });</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>}</div>
</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="foldopen" id="foldopen00227" data-start="{" data-end="}">
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af72734af83f353fae77fbf837776db10">  227</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af72734af83f353fae77fbf837776db10">resource_limits_manager::verify_account_ram_usage</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a> account )<span class="keyword">const </span>{</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>   <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> ram_bytes; <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> net_weight; <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> cpu_weight;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>   <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a140981c195e4e0c5788f0aa6383c2697">get_account_limits</a>( account, ram_bytes, net_weight, cpu_weight );</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage  = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( account );</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>   <span class="keywordflow">if</span>( ram_bytes &gt;= 0 ) {</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>      <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>( usage.ram_usage &lt;= <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a><span class="keyword">&gt;</span>(ram_bytes), ram_usage_exceeded,</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>                  <span class="stringliteral">&quot;account ${account} has insufficient ram; needs ${needs} bytes has ${available} bytes&quot;</span>,</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                  (<span class="stringliteral">&quot;account&quot;</span>, account)(<span class="stringliteral">&quot;needs&quot;</span>,usage.ram_usage)(<span class="stringliteral">&quot;available&quot;</span>,ram_bytes)              );</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>   }</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>}</div>
</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="foldopen" id="foldopen00239" data-start="{" data-end="}">
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#ae7d1b3c435910424a1142b052a8774be">  239</a></span><a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#ae7d1b3c435910424a1142b052a8774be">resource_limits_manager::get_account_ram_usage</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a> )<span class="keyword">const </span>{</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>   <span class="keywordflow">return</span> _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>,by_owner&gt;( <a class="code hl_variable" href="catch__reporter__console_8cpp.html#a9b45b3e13bd9167aab02e17e08916231">name</a> ).ram_usage;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>}</div>
</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="foldopen" id="foldopen00244" data-start="{" data-end="}">
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a3455e73574b3df18ee52bfc075a3a208">  244</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a3455e73574b3df18ee52bfc075a3a208">resource_limits_manager::set_account_limits</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; account, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> ram_bytes, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> net_weight, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> cpu_weight) {</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>   <span class="comment">//const auto&amp; usage = _db.get&lt;resource_usage_object,by_owner&gt;( account );</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>   <span class="comment">/*</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="comment">    * Since we need to delay these until the next resource limiting boundary, these are created in a &quot;pending&quot;</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span><span class="comment">    * state or adjusted in an existing &quot;pending&quot; state.  The chain controller will collapse &quot;pending&quot; state into</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="comment">    * the actual state at the next appropriate boundary.</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="comment">    */</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>   <span class="keyword">auto</span> find_or_create_pending_limits = [&amp;]() -&gt; <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; {</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>      <span class="keyword">const</span> <span class="keyword">auto</span>* pending_limits = _db.<a class="code hl_function" href="classchainbase_1_1database.html#aa5a2ca0da0092693ac49b36b7ec6817a">find</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>, by_owner&gt;( boost::make_tuple(<span class="keyword">true</span>, account) );</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>      <span class="keywordflow">if</span> (pending_limits == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>         <span class="keyword">const</span> <span class="keyword">auto</span>&amp; limits = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>, by_owner&gt;( boost::make_tuple(<span class="keyword">false</span>, account));</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>         <span class="keywordflow">return</span> _db.<a class="code hl_function" href="classchainbase_1_1database.html#adc8f336b33d7013d1b0400399b16c5a7">create</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&gt;([&amp;](<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; pending_limits){</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            pending_limits.owner = limits.owner;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>            pending_limits.ram_bytes = limits.ram_bytes;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            pending_limits.net_weight = limits.net_weight;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            pending_limits.cpu_weight = limits.cpu_weight;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            pending_limits.pending = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>         });</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>         <span class="keywordflow">return</span> *pending_limits;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>      }</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>   };</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>   <span class="comment">// update the users weights directly</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>   <span class="keyword">auto</span>&amp; limits = find_or_create_pending_limits();</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>   <span class="keywordtype">bool</span> decreased_limit = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>   <span class="keywordflow">if</span>( ram_bytes &gt;= 0 ) {</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>      decreased_limit = ( (limits.ram_bytes &lt; 0) || (ram_bytes &lt; limits.ram_bytes) );</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>      <span class="comment">/*</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="comment">      if( limits.ram_bytes &lt; 0 ) {</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span><span class="comment">         SYS_ASSERT(ram_bytes &gt;= usage.ram_usage, wasm_execution_error, &quot;converting unlimited account would result in overcommitment [commit=${c}, desired limit=${l}]&quot;, (&quot;c&quot;, usage.ram_usage)(&quot;l&quot;, ram_bytes));</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span><span class="comment">      } else {</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span><span class="comment">         SYS_ASSERT(ram_bytes &gt;= usage.ram_usage, wasm_execution_error, &quot;attempting to release committed ram resources [commit=${c}, desired limit=${l}]&quot;, (&quot;c&quot;, usage.ram_usage)(&quot;l&quot;, ram_bytes));</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="comment">      }</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span><span class="comment">      */</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>   }</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>   _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>( limits, [&amp;]( <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; pending_limits ){</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>      pending_limits.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#a7e7945f847d9e441e69f938921270836">ram_bytes</a> = ram_bytes;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>      pending_limits.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#a9eaec91376588de2dd82766e23750f87">net_weight</a> = net_weight;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>      pending_limits.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#aaeaa8f4c3c9e4cd8c823ecb22cc3f982">cpu_weight</a> = cpu_weight;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>         dm_logger-&gt;on_set_account_limits(pending_limits);</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>      }</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>   });</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>   <span class="keywordflow">return</span> decreased_limit;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>}</div>
</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="foldopen" id="foldopen00298" data-start="{" data-end="}">
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a140981c195e4e0c5788f0aa6383c2697">  298</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a140981c195e4e0c5788f0aa6383c2697">resource_limits_manager::get_account_limits</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; account, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a>&amp; ram_bytes, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a>&amp; net_weight, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a>&amp; cpu_weight )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>   <span class="keyword">const</span> <span class="keyword">auto</span>* pending_buo = _db.<a class="code hl_function" href="classchainbase_1_1database.html#aa5a2ca0da0092693ac49b36b7ec6817a">find</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>,by_owner&gt;( boost::make_tuple(<span class="keyword">true</span>, account) );</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>   <span class="keywordflow">if</span> (pending_buo) {</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>      ram_bytes  = pending_buo-&gt;ram_bytes;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>      net_weight = pending_buo-&gt;net_weight;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>      cpu_weight = pending_buo-&gt;cpu_weight;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>   } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; buo = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>,by_owner&gt;( boost::make_tuple( <span class="keyword">false</span>, account ) );</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>      ram_bytes  = buo.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#a7e7945f847d9e441e69f938921270836">ram_bytes</a>;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>      net_weight = buo.net_weight;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>      cpu_weight = buo.cpu_weight;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>   }</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>}</div>
</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="foldopen" id="foldopen00312" data-start="{" data-end="}">
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a0c71ab0bbfd401a4886d11f4756d5fc1">  312</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a0c71ab0bbfd401a4886d11f4756d5fc1">resource_limits_manager::is_unlimited_cpu</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; account )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>   <span class="keyword">const</span> <span class="keyword">auto</span>* buo = _db.<a class="code hl_function" href="classchainbase_1_1database.html#aa5a2ca0da0092693ac49b36b7ec6817a">find</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>,by_owner&gt;( boost::make_tuple(<span class="keyword">false</span>, account) );</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>   <span class="keywordflow">if</span> (buo) {</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>      <span class="keywordflow">return</span> buo-&gt;cpu_weight == -1;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>   }</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>   <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>}</div>
</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="foldopen" id="foldopen00320" data-start="{" data-end="}">
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a983919d376e5757bceee573e52b3c571">  320</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a983919d376e5757bceee573e52b3c571">resource_limits_manager::process_account_limit_updates</a>() {</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>   <span class="keyword">auto</span>&amp; multi_index = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afaea057692a8bbbf3f506b64c60308b6">get_mutable_index</a>&lt;<a class="code hl_typedef" href="namespacesysio_1_1chain_1_1resource__limits.html#a46a650001834ee5948b425f2e83cf948">resource_limits_index</a>&gt;();</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>   <span class="keyword">auto</span>&amp; by_owner_index = multi_index.indices().get&lt;by_owner&gt;();</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>   <span class="comment">// convenience local lambda to reduce clutter</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>   <span class="keyword">auto</span> update_state_and_value = [](<a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> &amp;total, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> &amp;<a class="code hl_define" href="pkcs11_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a>, <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> pending_value, <span class="keyword">const</span> <span class="keywordtype">char</span>* debug_which) -&gt; <span class="keywordtype">void</span> {</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      <span class="keywordflow">if</span> (<a class="code hl_define" href="pkcs11_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a> &gt; 0) {</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>         <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>(total &gt;= <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a><span class="keyword">&gt;</span>(<a class="code hl_define" href="pkcs11_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a>), rate_limiting_state_inconsistent, <span class="stringliteral">&quot;underflow when reverting old value to ${which}&quot;</span>, (<span class="stringliteral">&quot;which&quot;</span>, debug_which));</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>         total -= <a class="code hl_define" href="pkcs11_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a>;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>      }</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>      <span class="keywordflow">if</span> (pending_value &gt; 0) {</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>         <a class="code hl_define" href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a>(<a class="code hl_define" href="stdint_8h.html#a30654b4b67d97c42ca3f9b6052dda916">UINT64_MAX</a> - total &gt;= <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a><span class="keyword">&gt;</span>(pending_value), rate_limiting_state_inconsistent, <span class="stringliteral">&quot;overflow when applying new value to ${which}&quot;</span>, (<span class="stringliteral">&quot;which&quot;</span>, debug_which));</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>         total += pending_value;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>      }</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>      <a class="code hl_define" href="pkcs11_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a> = pending_value;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>   };</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>   _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>(<a class="code hl_struct" href="structstate.html">state</a>, [&amp;](<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; rso){</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>      <span class="keywordflow">while</span>(!by_owner_index.empty()) {</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>         <span class="keyword">const</span> <span class="keyword">auto</span>&amp; itr = by_owner_index.lower_bound(boost::make_tuple(<span class="keyword">true</span>));</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>         <span class="keywordflow">if</span> (itr == by_owner_index.end() || itr-&gt;pending!= <span class="keyword">true</span>) {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>         }</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span> </div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>         <span class="keyword">const</span> <span class="keyword">auto</span>&amp; actual_entry = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>, by_owner&gt;(boost::make_tuple(<span class="keyword">false</span>, itr-&gt;owner));</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>         _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>(actual_entry, [&amp;](<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">resource_limits_object</a>&amp; rlo){</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            update_state_and_value(rso.total_ram_bytes,  rlo.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#a7e7945f847d9e441e69f938921270836">ram_bytes</a>,  itr-&gt;ram_bytes, <span class="stringliteral">&quot;ram_bytes&quot;</span>);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            update_state_and_value(rso.total_cpu_weight, rlo.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#aaeaa8f4c3c9e4cd8c823ecb22cc3f982">cpu_weight</a>, itr-&gt;cpu_weight, <span class="stringliteral">&quot;cpu_weight&quot;</span>);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>            update_state_and_value(rso.total_net_weight, rlo.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#a9eaec91376588de2dd82766e23750f87">net_weight</a>, itr-&gt;net_weight, <span class="stringliteral">&quot;net_weight&quot;</span>);</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>         });</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>         multi_index.remove(*itr);</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>      }</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>         dm_logger-&gt;on_update_resource_limits_state(<a class="code hl_struct" href="structstate.html">state</a>);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>      }</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>   });</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>}</div>
</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="foldopen" id="foldopen00363" data-start="{" data-end="}">
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a5ebf5f04366d7120f58430d9ba4f8c7a">  363</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a5ebf5f04366d7120f58430d9ba4f8c7a">resource_limits_manager::process_block_usage</a>(<a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> block_num) {</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a506da415c9307c897ca9be93acfe1d0f">s</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>   _db.<a class="code hl_function" href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">modify</a>(<a class="code hl_variable" href="yubihsm__pkcs11_8c.html#a506da415c9307c897ca9be93acfe1d0f">s</a>, [&amp;](<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&amp; <a class="code hl_struct" href="structstate.html">state</a>){</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>      <span class="comment">// apply pending usage, update virtual limits and reset the pending</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>      <a class="code hl_struct" href="structstate.html">state</a>.average_block_cpu_usage.add(<a class="code hl_struct" href="structstate.html">state</a>.pending_cpu_usage, block_num, <a class="code hl_struct" href="classconfig.html">config</a>.cpu_limit_parameters.periods);</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>      <a class="code hl_struct" href="structstate.html">state</a>.update_virtual_cpu_limit(<a class="code hl_struct" href="classconfig.html">config</a>);</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>      <a class="code hl_struct" href="structstate.html">state</a>.pending_cpu_usage = 0;</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span> </div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>      <a class="code hl_struct" href="structstate.html">state</a>.average_block_net_usage.add(<a class="code hl_struct" href="structstate.html">state</a>.pending_net_usage, block_num, <a class="code hl_struct" href="classconfig.html">config</a>.net_limit_parameters.periods);</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>      <a class="code hl_struct" href="structstate.html">state</a>.update_virtual_net_limit(<a class="code hl_struct" href="classconfig.html">config</a>);</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>      <a class="code hl_struct" href="structstate.html">state</a>.pending_net_usage = 0;</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> dm_logger = _get_deep_mind_logger()) {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>         dm_logger-&gt;on_update_resource_limits_state(<a class="code hl_struct" href="structstate.html">state</a>);</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>      }</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>   });</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span> </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>}</div>
</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="foldopen" id="foldopen00384" data-start="{" data-end="}">
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a1fcebec58c85ac219bba44a3139a22d5">  384</a></span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a1fcebec58c85ac219bba44a3139a22d5">resource_limits_manager::get_total_cpu_weight</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>   <span class="keywordflow">return</span> <a class="code hl_struct" href="structstate.html">state</a>.total_cpu_weight;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>}</div>
</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span> </div>
<div class="foldopen" id="foldopen00389" data-start="{" data-end="}">
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af9c0bd8105ce922baaa87a06560bb1ad">  389</a></span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af9c0bd8105ce922baaa87a06560bb1ad">resource_limits_manager::get_total_net_weight</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>   <span class="keywordflow">return</span> <a class="code hl_struct" href="structstate.html">state</a>.total_net_weight;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>}</div>
</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="foldopen" id="foldopen00394" data-start="{" data-end="}">
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a11a6138d48057c1992128575ec0d2c99">  394</a></span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a11a6138d48057c1992128575ec0d2c99">resource_limits_manager::get_virtual_block_cpu_limit</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>   <span class="keywordflow">return</span> <a class="code hl_struct" href="structstate.html">state</a>.virtual_cpu_limit;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>}</div>
</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="foldopen" id="foldopen00399" data-start="{" data-end="}">
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af1cdd5c700248d54dc20be704662534d">  399</a></span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af1cdd5c700248d54dc20be704662534d">resource_limits_manager::get_virtual_block_net_limit</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>   <span class="keywordflow">return</span> <a class="code hl_struct" href="structstate.html">state</a>.virtual_net_limit;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>}</div>
</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="foldopen" id="foldopen00404" data-start="{" data-end="}">
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a59c1ce742daefcf8e370e844ed49f955">  404</a></span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a59c1ce742daefcf8e370e844ed49f955">resource_limits_manager::get_block_cpu_limit</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>   <span class="keywordflow">return</span> <a class="code hl_struct" href="classconfig.html">config</a>.cpu_limit_parameters.max - <a class="code hl_struct" href="structstate.html">state</a>.pending_cpu_usage;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>}</div>
</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="foldopen" id="foldopen00410" data-start="{" data-end="}">
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a2a7986ffd86acb7135b07d3b35d767fd">  410</a></span><a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a2a7986ffd86acb7135b07d3b35d767fd">resource_limits_manager::get_block_net_limit</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>   <span class="keywordflow">return</span> <a class="code hl_struct" href="classconfig.html">config</a>.net_limit_parameters.max - <a class="code hl_struct" href="structstate.html">state</a>.pending_net_usage;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>}</div>
</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="foldopen" id="foldopen00416" data-start="{" data-end="}">
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a43b17296f9507b5d046c5bf57568d8b2">  416</a></span>std::pair&lt;int64_t, bool&gt; <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a43b17296f9507b5d046c5bf57568d8b2">resource_limits_manager::get_account_cpu_limit</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> greylist_limit )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>   <span class="keyword">auto</span> [arl, greylisted] = <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a2dc85a639cfd3a5e0238142d3ed3c53f">get_account_cpu_limit_ex</a>(<a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, greylist_limit);</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>   <span class="keywordflow">return</span> {arl.available, greylisted};</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>}</div>
</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span> </div>
<div class="foldopen" id="foldopen00421" data-start="{" data-end="}">
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a2dc85a639cfd3a5e0238142d3ed3c53f">  421</a></span>std::pair&lt;account_resource_limit, bool&gt; <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a2dc85a639cfd3a5e0238142d3ed3c53f">resource_limits_manager::get_account_cpu_limit_ex</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> greylist_limit )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>, by_owner&gt;(<a class="code hl_variable" href="catch__reporter__console_8cpp.html#a9b45b3e13bd9167aab02e17e08916231">name</a>);</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>   <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> cpu_weight, x, <a class="code hl_variable" href="namespacefc.html#ab199a7c94624123911206db59ebe45da">y</a>;</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>   <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a140981c195e4e0c5788f0aa6383c2697">get_account_limits</a>( <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, x, <a class="code hl_variable" href="namespacefc.html#ab199a7c94624123911206db59ebe45da">y</a>, cpu_weight );</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>   <span class="keywordflow">if</span>( cpu_weight &lt; 0 || <a class="code hl_struct" href="structstate.html">state</a>.total_cpu_weight == 0 ) {</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      <span class="keywordflow">return</span> {{ -1, -1, -1 }, <span class="keyword">false</span>};</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>   }</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span> </div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>   <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">account_resource_limit</a> arl;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> window_size = <a class="code hl_struct" href="classconfig.html">config</a>.account_cpu_usage_average_window;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span> </div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>   <span class="keywordtype">bool</span> greylisted = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> virtual_cpu_capacity_in_window = window_size;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>   <span class="keywordflow">if</span>( greylist_limit &lt; config::maximum_elastic_resource_multiplier ) {</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>      <a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> greylisted_virtual_cpu_limit = <a class="code hl_struct" href="classconfig.html">config</a>.cpu_limit_parameters.max * greylist_limit;</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>      <span class="keywordflow">if</span>( greylisted_virtual_cpu_limit &lt; <a class="code hl_struct" href="structstate.html">state</a>.virtual_cpu_limit ) {</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>         virtual_cpu_capacity_in_window *= greylisted_virtual_cpu_limit;</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>         greylisted = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>         virtual_cpu_capacity_in_window *= <a class="code hl_struct" href="structstate.html">state</a>.virtual_cpu_limit;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>      }</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>   } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>      virtual_cpu_capacity_in_window *= <a class="code hl_struct" href="structstate.html">state</a>.virtual_cpu_limit;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>   }</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span> </div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> user_weight     = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)cpu_weight;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> all_user_weight = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)<a class="code hl_struct" href="structstate.html">state</a>.total_cpu_weight;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span> </div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>   <span class="keyword">auto</span> max_user_use_in_window = (virtual_cpu_capacity_in_window * user_weight) / all_user_weight;</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>   <span class="keyword">auto</span> cpu_used_in_window  = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#a27299c32ef2c573ed173bd68edd2cd21">impl::integer_divide_ceil</a>((<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)usage.cpu_usage.value_ex * window_size, (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)config::rate_limiting_precision);</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span> </div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>   <span class="keywordflow">if</span>( max_user_use_in_window &lt;= cpu_used_in_window )</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>      arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#ad5726de3c27ed7bd7d80decd66ded088">available</a> = 0;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>      arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#ad5726de3c27ed7bd7d80decd66ded088">available</a> = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#ad13603146ccf93edbdb851067320dd6e">impl::downgrade_cast&lt;int64_t&gt;</a>(max_user_use_in_window - cpu_used_in_window);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>   arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#a25bb0386b0663efe779b395c992546f3">used</a> = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#ad13603146ccf93edbdb851067320dd6e">impl::downgrade_cast&lt;int64_t&gt;</a>(cpu_used_in_window);</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>   arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#a3c8501c7709c924c44457211a616c985">max</a> = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#ad13603146ccf93edbdb851067320dd6e">impl::downgrade_cast&lt;int64_t&gt;</a>(max_user_use_in_window);</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>   <span class="keywordflow">return</span> {arl, greylisted};</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>}</div>
</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="foldopen" id="foldopen00468" data-start="{" data-end="}">
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a6ee64e0876365e3c6e2aeec83591a9ef">  468</a></span>std::pair&lt;int64_t, bool&gt; <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a6ee64e0876365e3c6e2aeec83591a9ef">resource_limits_manager::get_account_net_limit</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> greylist_limit )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>   <span class="keyword">auto</span> [arl, greylisted] = <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#afa522b2321b49a3f55beba024129e000">get_account_net_limit_ex</a>(<a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, greylist_limit);</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>   <span class="keywordflow">return</span> {arl.available, greylisted};</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>}</div>
</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span> </div>
<div class="foldopen" id="foldopen00473" data-start="{" data-end="}">
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno"><a class="line" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#afa522b2321b49a3f55beba024129e000">  473</a></span>std::pair&lt;account_resource_limit, bool&gt; <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#afa522b2321b49a3f55beba024129e000">resource_limits_manager::get_account_net_limit_ex</a>( <span class="keyword">const</span> <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">account_name</a>&amp; <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, <a class="code hl_typedef" href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> greylist_limit )<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="classconfig.html">config</a> = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">resource_limits_config_object</a>&gt;();</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_struct" href="structstate.html">state</a>  = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_class" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">resource_limits_state_object</a>&gt;();</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; usage  = _db.<a class="code hl_function" href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">get</a>&lt;<a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">resource_usage_object</a>, by_owner&gt;(<a class="code hl_variable" href="catch__reporter__console_8cpp.html#a9b45b3e13bd9167aab02e17e08916231">name</a>);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span> </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>   <a class="code hl_typedef" href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a> net_weight, x, <a class="code hl_variable" href="namespacefc.html#ab199a7c94624123911206db59ebe45da">y</a>;</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>   <a class="code hl_function" href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a140981c195e4e0c5788f0aa6383c2697">get_account_limits</a>( <a class="code hl_struct" href="structsysio_1_1chain_1_1name.html">name</a>, x, net_weight, <a class="code hl_variable" href="namespacefc.html#ab199a7c94624123911206db59ebe45da">y</a> );</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>   <span class="keywordflow">if</span>( net_weight &lt; 0 || <a class="code hl_struct" href="structstate.html">state</a>.total_net_weight == 0) {</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>      <span class="keywordflow">return</span> {{ -1, -1, -1 }, <span class="keyword">false</span>};</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>   }</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>   <a class="code hl_struct" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">account_resource_limit</a> arl;</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> window_size = <a class="code hl_struct" href="classconfig.html">config</a>.account_net_usage_average_window;</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>   <span class="keywordtype">bool</span> greylisted = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> virtual_network_capacity_in_window = window_size;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>   <span class="keywordflow">if</span>( greylist_limit &lt; config::maximum_elastic_resource_multiplier ) {</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>      <a class="code hl_typedef" href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a> greylisted_virtual_net_limit = <a class="code hl_struct" href="classconfig.html">config</a>.net_limit_parameters.max * greylist_limit;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>      <span class="keywordflow">if</span>( greylisted_virtual_net_limit &lt; <a class="code hl_struct" href="structstate.html">state</a>.virtual_net_limit ) {</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>         virtual_network_capacity_in_window *= greylisted_virtual_net_limit;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>         greylisted = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>         virtual_network_capacity_in_window *= <a class="code hl_struct" href="structstate.html">state</a>.virtual_net_limit;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>      }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>   } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>      virtual_network_capacity_in_window *= <a class="code hl_struct" href="structstate.html">state</a>.virtual_net_limit;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>   }</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span> </div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> user_weight     = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)net_weight;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>   <a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a> all_user_weight = (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)<a class="code hl_struct" href="structstate.html">state</a>.total_net_weight;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>   <span class="keyword">auto</span> max_user_use_in_window = (virtual_network_capacity_in_window * user_weight) / all_user_weight;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>   <span class="keyword">auto</span> net_used_in_window  = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#a27299c32ef2c573ed173bd68edd2cd21">impl::integer_divide_ceil</a>((<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)usage.net_usage.value_ex * window_size, (<a class="code hl_typedef" href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">uint128_t</a>)config::rate_limiting_precision);</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>   <span class="keywordflow">if</span>( max_user_use_in_window &lt;= net_used_in_window )</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>      arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#ad5726de3c27ed7bd7d80decd66ded088">available</a> = 0;</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>   <span class="keywordflow">else</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>      arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#ad5726de3c27ed7bd7d80decd66ded088">available</a> = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#ad13603146ccf93edbdb851067320dd6e">impl::downgrade_cast&lt;int64_t&gt;</a>(max_user_use_in_window - net_used_in_window);</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>   arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#a25bb0386b0663efe779b395c992546f3">used</a> = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#ad13603146ccf93edbdb851067320dd6e">impl::downgrade_cast&lt;int64_t&gt;</a>(net_used_in_window);</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>   arl.<a class="code hl_variable" href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#a3c8501c7709c924c44457211a616c985">max</a> = <a class="code hl_function" href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#ad13603146ccf93edbdb851067320dd6e">impl::downgrade_cast&lt;int64_t&gt;</a>(max_user_use_in_window);</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>   <span class="keywordflow">return</span> {arl, greylisted};</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>}</div>
</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span> </div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>} } } </div>
<div class="ttc" id="acatch__reporter__console_8cpp_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="catch__reporter__console_8cpp.html#a9b45b3e13bd9167aab02e17e08916231">name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition</b> <a href="catch__reporter__console_8cpp_source.html#l00186">catch_reporter_console.cpp:186</a></div></div>
<div class="ttc" id="achain_2include_2sysio_2chain_2exceptions_8hpp_html"><div class="ttname"><a href="chain_2include_2sysio_2chain_2exceptions_8hpp.html">exceptions.hpp</a></div></div>
<div class="ttc" id="achain_2include_2sysio_2chain_2exceptions_8hpp_html_a40c2826a6fba35c1ffbf912bdf559792"><div class="ttname"><a href="chain_2include_2sysio_2chain_2exceptions_8hpp.html#a40c2826a6fba35c1ffbf912bdf559792">SYS_ASSERT</a></div><div class="ttdeci">#define SYS_ASSERT(expr, exc_type, FORMAT,...)</div><div class="ttdef"><b>Definition</b> <a href="chain_2include_2sysio_2chain_2exceptions_8hpp_source.html#l00007">exceptions.hpp:7</a></div></div>
<div class="ttc" id="aclasschainbase_1_1database_html_a9ebc006075e8fc2e84357a0e068b58d4"><div class="ttname"><a href="classchainbase_1_1database.html#a9ebc006075e8fc2e84357a0e068b58d4">chainbase::database::modify</a></div><div class="ttdeci">void modify(const ObjectType &amp;obj, Modifier &amp;&amp;m)</div><div class="ttdef"><b>Definition</b> <a href="chainbase_8hpp_source.html#l00503">chainbase.hpp:503</a></div></div>
<div class="ttc" id="aclasschainbase_1_1database_html_aa5a2ca0da0092693ac49b36b7ec6817a"><div class="ttname"><a href="classchainbase_1_1database.html#aa5a2ca0da0092693ac49b36b7ec6817a">chainbase::database::find</a></div><div class="ttdeci">const ObjectType * find(CompatibleKey &amp;&amp;key) const</div><div class="ttdef"><b>Definition</b> <a href="chainbase_8hpp_source.html#l00458">chainbase.hpp:458</a></div></div>
<div class="ttc" id="aclasschainbase_1_1database_html_adc8f336b33d7013d1b0400399b16c5a7"><div class="ttname"><a href="classchainbase_1_1database.html#adc8f336b33d7013d1b0400399b16c5a7">chainbase::database::create</a></div><div class="ttdeci">const ObjectType &amp; create(Constructor &amp;&amp;con)</div><div class="ttdef"><b>Definition</b> <a href="chainbase_8hpp_source.html#l00519">chainbase.hpp:519</a></div></div>
<div class="ttc" id="aclasschainbase_1_1database_html_afaea057692a8bbbf3f506b64c60308b6"><div class="ttname"><a href="classchainbase_1_1database.html#afaea057692a8bbbf3f506b64c60308b6">chainbase::database::get_mutable_index</a></div><div class="ttdeci">generic_index&lt; MultiIndexType &gt; &amp; get_mutable_index()</div><div class="ttdef"><b>Definition</b> <a href="chainbase_8hpp_source.html#l00447">chainbase.hpp:447</a></div></div>
<div class="ttc" id="aclasschainbase_1_1database_html_afcfe00f81a526c1376d4f51197dd3a9a"><div class="ttname"><a href="classchainbase_1_1database.html#afcfe00f81a526c1376d4f51197dd3a9a">chainbase::database::get</a></div><div class="ttdeci">const ObjectType &amp; get(CompatibleKey &amp;&amp;key) const</div><div class="ttdef"><b>Definition</b> <a href="chainbase_8hpp_source.html#l00477">chainbase.hpp:477</a></div></div>
<div class="ttc" id="aclassconfig_html"><div class="ttname"><a href="classconfig.html">config</a></div><div class="ttdef"><b>Definition</b> <a href="permessage__deflate_8cpp_source.html#l00042">permessage_deflate.cpp:42</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1index__set_html"><div class="ttname"><a href="classsysio_1_1chain_1_1index__set.html">sysio::chain::index_set</a></div><div class="ttdef"><b>Definition</b> <a href="database__utils_8hpp_source.html#l00010">database_utils.hpp:10</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object_html"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__config__object.html">sysio::chain::resource_limits::resource_limits_config_object</a></div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00247">resource_limits_private.hpp:247</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a0c71ab0bbfd401a4886d11f4756d5fc1"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a0c71ab0bbfd401a4886d11f4756d5fc1">sysio::chain::resource_limits::resource_limits_manager::is_unlimited_cpu</a></div><div class="ttdeci">bool is_unlimited_cpu(const account_name &amp;account) const</div><div class="ttdef"><b>Definition</b> <a href="#l00312">resource_limits.cpp:312</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a11a6138d48057c1992128575ec0d2c99"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a11a6138d48057c1992128575ec0d2c99">sysio::chain::resource_limits::resource_limits_manager::get_virtual_block_cpu_limit</a></div><div class="ttdeci">uint64_t get_virtual_block_cpu_limit() const</div><div class="ttdef"><b>Definition</b> <a href="#l00394">resource_limits.cpp:394</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a140981c195e4e0c5788f0aa6383c2697"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a140981c195e4e0c5788f0aa6383c2697">sysio::chain::resource_limits::resource_limits_manager::get_account_limits</a></div><div class="ttdeci">void get_account_limits(const account_name &amp;account, int64_t &amp;ram_bytes, int64_t &amp;net_weight, int64_t &amp;cpu_weight) const</div><div class="ttdef"><b>Definition</b> <a href="#l00298">resource_limits.cpp:298</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a1b9d0326965430166923c2241a3a6a45"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a1b9d0326965430166923c2241a3a6a45">sysio::chain::resource_limits::resource_limits_manager::initialize_database</a></div><div class="ttdeci">void initialize_database()</div><div class="ttdef"><b>Definition</b> <a href="#l00055">resource_limits.cpp:55</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a1fcebec58c85ac219bba44a3139a22d5"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a1fcebec58c85ac219bba44a3139a22d5">sysio::chain::resource_limits::resource_limits_manager::get_total_cpu_weight</a></div><div class="ttdeci">uint64_t get_total_cpu_weight() const</div><div class="ttdef"><b>Definition</b> <a href="#l00384">resource_limits.cpp:384</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a2a7986ffd86acb7135b07d3b35d767fd"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a2a7986ffd86acb7135b07d3b35d767fd">sysio::chain::resource_limits::resource_limits_manager::get_block_net_limit</a></div><div class="ttdeci">uint64_t get_block_net_limit() const</div><div class="ttdef"><b>Definition</b> <a href="#l00410">resource_limits.cpp:410</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a2dc85a639cfd3a5e0238142d3ed3c53f"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a2dc85a639cfd3a5e0238142d3ed3c53f">sysio::chain::resource_limits::resource_limits_manager::get_account_cpu_limit_ex</a></div><div class="ttdeci">std::pair&lt; account_resource_limit, bool &gt; get_account_cpu_limit_ex(const account_name &amp;name, uint32_t greylist_limit=config::maximum_elastic_resource_multiplier) const</div><div class="ttdef"><b>Definition</b> <a href="#l00421">resource_limits.cpp:421</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a30cd4db6f08948e05aba424431ec0605"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a30cd4db6f08948e05aba424431ec0605">sysio::chain::resource_limits::resource_limits_manager::initialize_account</a></div><div class="ttdeci">void initialize_account(const account_name &amp;account)</div><div class="ttdef"><b>Definition</b> <a href="#l00096">resource_limits.cpp:96</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a32baa74135a1423302de3a849dc8b40c"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a32baa74135a1423302de3a849dc8b40c">sysio::chain::resource_limits::resource_limits_manager::read_from_snapshot</a></div><div class="ttdeci">void read_from_snapshot(const snapshot_reader_ptr &amp;snapshot)</div><div class="ttdef"><b>Definition</b> <a href="#l00083">resource_limits.cpp:83</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a3455e73574b3df18ee52bfc075a3a208"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a3455e73574b3df18ee52bfc075a3a208">sysio::chain::resource_limits::resource_limits_manager::set_account_limits</a></div><div class="ttdeci">bool set_account_limits(const account_name &amp;account, int64_t ram_bytes, int64_t net_weight, int64_t cpu_weight)</div><div class="ttdoc">set_account_limits returns true if new ram_bytes limit is more restrictive than the previously set on...</div><div class="ttdef"><b>Definition</b> <a href="#l00244">resource_limits.cpp:244</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a4396d0acb70ebbd8054b13ff4c564e20"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a4396d0acb70ebbd8054b13ff4c564e20">sysio::chain::resource_limits::resource_limits_manager::set_block_parameters</a></div><div class="ttdeci">void set_block_parameters(const elastic_limit_parameters &amp;cpu_limit_parameters, const elastic_limit_parameters &amp;net_limit_parameters)</div><div class="ttdef"><b>Definition</b> <a href="#l00109">resource_limits.cpp:109</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a43b17296f9507b5d046c5bf57568d8b2"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a43b17296f9507b5d046c5bf57568d8b2">sysio::chain::resource_limits::resource_limits_manager::get_account_cpu_limit</a></div><div class="ttdeci">std::pair&lt; int64_t, bool &gt; get_account_cpu_limit(const account_name &amp;name, uint32_t greylist_limit=config::maximum_elastic_resource_multiplier) const</div><div class="ttdef"><b>Definition</b> <a href="#l00416">resource_limits.cpp:416</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a59c1ce742daefcf8e370e844ed49f955"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a59c1ce742daefcf8e370e844ed49f955">sysio::chain::resource_limits::resource_limits_manager::get_block_cpu_limit</a></div><div class="ttdeci">uint64_t get_block_cpu_limit() const</div><div class="ttdef"><b>Definition</b> <a href="#l00404">resource_limits.cpp:404</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a5ebf5f04366d7120f58430d9ba4f8c7a"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a5ebf5f04366d7120f58430d9ba4f8c7a">sysio::chain::resource_limits::resource_limits_manager::process_block_usage</a></div><div class="ttdeci">void process_block_usage(uint32_t block_num)</div><div class="ttdef"><b>Definition</b> <a href="#l00363">resource_limits.cpp:363</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a6ee64e0876365e3c6e2aeec83591a9ef"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a6ee64e0876365e3c6e2aeec83591a9ef">sysio::chain::resource_limits::resource_limits_manager::get_account_net_limit</a></div><div class="ttdeci">std::pair&lt; int64_t, bool &gt; get_account_net_limit(const account_name &amp;name, uint32_t greylist_limit=config::maximum_elastic_resource_multiplier) const</div><div class="ttdef"><b>Definition</b> <a href="#l00468">resource_limits.cpp:468</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a7160417d30f5ef3a91467fefebf65dc6"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a7160417d30f5ef3a91467fefebf65dc6">sysio::chain::resource_limits::resource_limits_manager::add_to_snapshot</a></div><div class="ttdeci">void add_to_snapshot(const snapshot_writer_ptr &amp;snapshot) const</div><div class="ttdef"><b>Definition</b> <a href="#l00073">resource_limits.cpp:73</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a7fea1de6a3806590de0bda86e53c7995"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a7fea1de6a3806590de0bda86e53c7995">sysio::chain::resource_limits::resource_limits_manager::add_pending_ram_usage</a></div><div class="ttdeci">void add_pending_ram_usage(const account_name account, int64_t ram_delta)</div><div class="ttdef"><b>Definition</b> <a href="#l00206">resource_limits.cpp:206</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_a983919d376e5757bceee573e52b3c571"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#a983919d376e5757bceee573e52b3c571">sysio::chain::resource_limits::resource_limits_manager::process_account_limit_updates</a></div><div class="ttdeci">void process_account_limit_updates()</div><div class="ttdef"><b>Definition</b> <a href="#l00320">resource_limits.cpp:320</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_aaa7345adbf341592a81c087c50655597"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#aaa7345adbf341592a81c087c50655597">sysio::chain::resource_limits::resource_limits_manager::update_account_usage</a></div><div class="ttdeci">void update_account_usage(const flat_set&lt; account_name &gt; &amp;accounts, uint32_t ordinal)</div><div class="ttdef"><b>Definition</b> <a href="#l00125">resource_limits.cpp:125</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_acc5c0d662f97873d93dadbf8b6451978"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#acc5c0d662f97873d93dadbf8b6451978">sysio::chain::resource_limits::resource_limits_manager::add_indices</a></div><div class="ttdeci">void add_indices()</div><div class="ttdef"><b>Definition</b> <a href="#l00051">resource_limits.cpp:51</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_ae6e413bd0a6e43b36deff7aacdd0bfd6"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#ae6e413bd0a6e43b36deff7aacdd0bfd6">sysio::chain::resource_limits::resource_limits_manager::add_transaction_usage</a></div><div class="ttdeci">void add_transaction_usage(const flat_set&lt; account_name &gt; &amp;accounts, uint64_t cpu_usage, uint64_t net_usage, uint32_t ordinal)</div><div class="ttdef"><b>Definition</b> <a href="#l00136">resource_limits.cpp:136</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_ae7d1b3c435910424a1142b052a8774be"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#ae7d1b3c435910424a1142b052a8774be">sysio::chain::resource_limits::resource_limits_manager::get_account_ram_usage</a></div><div class="ttdeci">int64_t get_account_ram_usage(const account_name &amp;name) const</div><div class="ttdef"><b>Definition</b> <a href="#l00239">resource_limits.cpp:239</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_af1cdd5c700248d54dc20be704662534d"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af1cdd5c700248d54dc20be704662534d">sysio::chain::resource_limits::resource_limits_manager::get_virtual_block_net_limit</a></div><div class="ttdeci">uint64_t get_virtual_block_net_limit() const</div><div class="ttdef"><b>Definition</b> <a href="#l00399">resource_limits.cpp:399</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_af72734af83f353fae77fbf837776db10"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af72734af83f353fae77fbf837776db10">sysio::chain::resource_limits::resource_limits_manager::verify_account_ram_usage</a></div><div class="ttdeci">void verify_account_ram_usage(const account_name accunt) const</div><div class="ttdef"><b>Definition</b> <a href="#l00227">resource_limits.cpp:227</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_af9c0bd8105ce922baaa87a06560bb1ad"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#af9c0bd8105ce922baaa87a06560bb1ad">sysio::chain::resource_limits::resource_limits_manager::get_total_net_weight</a></div><div class="ttdeci">uint64_t get_total_net_weight() const</div><div class="ttdef"><b>Definition</b> <a href="#l00389">resource_limits.cpp:389</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__manager_html_afa522b2321b49a3f55beba024129e000"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__manager.html#afa522b2321b49a3f55beba024129e000">sysio::chain::resource_limits::resource_limits_manager::get_account_net_limit_ex</a></div><div class="ttdeci">std::pair&lt; account_resource_limit, bool &gt; get_account_net_limit_ex(const account_name &amp;name, uint32_t greylist_limit=config::maximum_elastic_resource_multiplier) const</div><div class="ttdef"><b>Definition</b> <a href="#l00473">resource_limits.cpp:473</a></div></div>
<div class="ttc" id="aclasssysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object_html"><div class="ttname"><a href="classsysio_1_1chain_1_1resource__limits_1_1resource__limits__state__object.html">sysio::chain::resource_limits::resource_limits_state_object</a></div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00272">resource_limits_private.hpp:272</a></div></div>
<div class="ttc" id="adatabase__utils_8hpp_html"><div class="ttname"><a href="database__utils_8hpp.html">database_utils.hpp</a></div></div>
<div class="ttc" id="adeep__mind_8hpp_html"><div class="ttname"><a href="deep__mind_8hpp.html">deep_mind.hpp</a></div></div>
<div class="ttc" id="anamespacefc_html_ab199a7c94624123911206db59ebe45da"><div class="ttname"><a href="namespacefc.html#ab199a7c94624123911206db59ebe45da">fc::y</a></div><div class="ttdeci">uint64_t y</div><div class="ttdef"><b>Definition</b> <a href="sha3_8cpp_source.html#l00034">sha3.cpp:34</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_1_1resource__limits_1_1impl_html_a27299c32ef2c573ed173bd68edd2cd21"><div class="ttname"><a href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#a27299c32ef2c573ed173bd68edd2cd21">sysio::chain::resource_limits::impl::integer_divide_ceil</a></div><div class="ttdeci">constexpr UnsignedIntType integer_divide_ceil(UnsignedIntType num, UnsignedIntType den)</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00025">resource_limits_private.hpp:25</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_1_1resource__limits_1_1impl_html_ad13603146ccf93edbdb851067320dd6e"><div class="ttname"><a href="namespacesysio_1_1chain_1_1resource__limits_1_1impl.html#ad13603146ccf93edbdb851067320dd6e">sysio::chain::resource_limits::impl::downgrade_cast</a></div><div class="ttdeci">constexpr auto downgrade_cast(GreaterIntType val) -&gt; std::enable_if_t&lt; is_valid_downgrade_cast&lt; LesserIntType, GreaterIntType &gt; &amp;&amp;std::is_signed&lt; LesserIntType &gt;::value==std::is_signed&lt; GreaterIntType &gt;::value, LesserIntType &gt;</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00040">resource_limits_private.hpp:40</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_1_1resource__limits_html_a0b3297439198d69fd3b3bb4cb9eefa6d"><div class="ttname"><a href="namespacesysio_1_1chain_1_1resource__limits.html#a0b3297439198d69fd3b3bb4cb9eefa6d">sysio::chain::resource_limits::resource_usage_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_usage_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_usage_object, resource_usage_object::id_type, &amp;resource_usage_object::id &gt; &gt;, ordered_unique&lt; tag&lt; by_owner &gt;, member&lt; resource_usage_object, account_name, &amp;resource_usage_object::owner &gt; &gt; &gt; &gt; resource_usage_index</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00239">resource_limits_private.hpp:239</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_1_1resource__limits_html_a46a650001834ee5948b425f2e83cf948"><div class="ttname"><a href="namespacesysio_1_1chain_1_1resource__limits.html#a46a650001834ee5948b425f2e83cf948">sysio::chain::resource_limits::resource_limits_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_limits_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_limits_object, resource_limits_object::id_type, &amp;resource_limits_object::id &gt; &gt;, ordered_unique&lt; tag&lt; by_owner &gt;, composite_key&lt; resource_limits_object, BOOST_MULTI_INDEX_MEMBER(resource_limits_object, bool, pending), &gt; &gt; &gt; &gt; resource_limits_index</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00214">resource_limits_private.hpp:214</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_1_1resource__limits_html_ac8c3fe48e6c4c00d12cb2f55913798ca"><div class="ttname"><a href="namespacesysio_1_1chain_1_1resource__limits.html#ac8c3fe48e6c4c00d12cb2f55913798ca">sysio::chain::resource_limits::resource_limits_state_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_limits_state_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_limits_state_object, resource_limits_state_object::id_type, &amp;resource_limits_state_object::id &gt; &gt; &gt; &gt; resource_limits_state_index</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00320">resource_limits_private.hpp:320</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_1_1resource__limits_html_af0e92e61b12c4eb0ff352f44ca9fbe09"><div class="ttname"><a href="namespacesysio_1_1chain_1_1resource__limits.html#af0e92e61b12c4eb0ff352f44ca9fbe09">sysio::chain::resource_limits::resource_limits_config_index</a></div><div class="ttdeci">chainbase::shared_multi_index_container&lt; resource_limits_config_object, indexed_by&lt; ordered_unique&lt; tag&lt; by_id &gt;, member&lt; resource_limits_config_object, resource_limits_config_object::id_type, &amp;resource_limits_config_object::id &gt; &gt; &gt; &gt; resource_limits_config_index</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00265">resource_limits_private.hpp:265</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_html_a5dfe17906469eaf079c180c1afb4ad94"><div class="ttname"><a href="namespacesysio_1_1chain.html#a5dfe17906469eaf079c180c1afb4ad94">sysio::chain::transaction_exception</a></div><div class="ttdeci">key Invalid authority Invalid transaction Invalid block ID Invalid packed transaction Invalid chain ID Invalid symbol Signature type is not a currently activated type Block can not be found Unlinkable block Block does not guarantee concurrent execution without conflicts Block exhausted allowed resources Block is from the future Block is not signed by expected producer Block includes an ill formed protocol feature activation extension Block includes an ill formed additional block signature extension transaction_exception</div><div class="ttdef"><b>Definition</b> <a href="chain_2include_2sysio_2chain_2exceptions_8hpp_source.html#l00243">exceptions.hpp:243</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_html_a80afaa06d96e661a0f93e0ba4b09c8dc"><div class="ttname"><a href="namespacesysio_1_1chain.html#a80afaa06d96e661a0f93e0ba4b09c8dc">sysio::chain::snapshot_writer_ptr</a></div><div class="ttdeci">std::shared_ptr&lt; snapshot_writer &gt; snapshot_writer_ptr</div><div class="ttdef"><b>Definition</b> <a href="snapshot_8hpp_source.html#l00155">snapshot.hpp:155</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_html_a896515137d9a7844105786ee3a6b1d47"><div class="ttname"><a href="namespacesysio_1_1chain.html#a896515137d9a7844105786ee3a6b1d47">sysio::chain::uint128_t</a></div><div class="ttdeci">unsigned __int128 uint128_t</div><div class="ttdef"><b>Definition</b> <a href="chain_2include_2sysio_2chain_2types_8hpp_source.html#l00242">types.hpp:242</a></div></div>
<div class="ttc" id="anamespacesysio_1_1chain_html_aaa27dacddc54cea475602788c8e7a02c"><div class="ttname"><a href="namespacesysio_1_1chain.html#aaa27dacddc54cea475602788c8e7a02c">sysio::chain::snapshot_reader_ptr</a></div><div class="ttdeci">std::shared_ptr&lt; snapshot_reader &gt; snapshot_reader_ptr</div><div class="ttdef"><b>Definition</b> <a href="snapshot_8hpp_source.html#l00294">snapshot.hpp:294</a></div></div>
<div class="ttc" id="anamespacesysio_html"><div class="ttname"><a href="namespacesysio.html">sysio</a></div><div class="ttdef"><b>Definition</b> <a href="abi__serializer_8cpp_source.html#l00008">abi_serializer.cpp:8</a></div></div>
<div class="ttc" id="apkcs11_8h_html_a32aff7c6c4cd253fdf6563677afab5ce"><div class="ttname"><a href="pkcs11_8h.html#a32aff7c6c4cd253fdf6563677afab5ce">value</a></div><div class="ttdeci">#define value</div><div class="ttdef"><b>Definition</b> <a href="pkcs11_8h_source.html#l00157">pkcs11.h:157</a></div></div>
<div class="ttc" id="apointer_8h_html_aeeddce917cf130d62c370b8f216026dd"><div class="ttname"><a href="pointer_8h.html#aeeddce917cf130d62c370b8f216026dd">a</a></div><div class="ttdeci">const GenericPointer&lt; typename T::ValueType &gt; T2 T::AllocatorType &amp; a</div><div class="ttdef"><b>Definition</b> <a href="pointer_8h_source.html#l01181">pointer.h:1181</a></div></div>
<div class="ttc" id="aresource__limits_8hpp_html"><div class="ttname"><a href="resource__limits_8hpp.html">resource_limits.hpp</a></div></div>
<div class="ttc" id="aresource__limits__private_8hpp_html"><div class="ttname"><a href="resource__limits__private_8hpp.html">resource_limits_private.hpp</a></div></div>
<div class="ttc" id="astdint_8h_html_a30654b4b67d97c42ca3f9b6052dda916"><div class="ttname"><a href="stdint_8h.html#a30654b4b67d97c42ca3f9b6052dda916">UINT64_MAX</a></div><div class="ttdeci">#define UINT64_MAX</div><div class="ttdef"><b>Definition</b> <a href="stdint_8h_source.html#l00189">stdint.h:189</a></div></div>
<div class="ttc" id="astdint_8h_html_a414156feea104f8f75b4ed9e3121b2f6"><div class="ttname"><a href="stdint_8h.html#a414156feea104f8f75b4ed9e3121b2f6">int64_t</a></div><div class="ttdeci">signed __int64 int64_t</div><div class="ttdef"><b>Definition</b> <a href="stdint_8h_source.html#l00135">stdint.h:135</a></div></div>
<div class="ttc" id="astdint_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="stdint_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition</b> <a href="stdint_8h_source.html#l00126">stdint.h:126</a></div></div>
<div class="ttc" id="astdint_8h_html_aec6fcb673ff035718c238c8c9d544c47"><div class="ttname"><a href="stdint_8h.html#aec6fcb673ff035718c238c8c9d544c47">uint64_t</a></div><div class="ttdeci">unsigned __int64 uint64_t</div><div class="ttdef"><b>Definition</b> <a href="stdint_8h_source.html#l00136">stdint.h:136</a></div></div>
<div class="ttc" id="astructstate_html"><div class="ttname"><a href="structstate.html">state</a></div><div class="ttdef"><b>Definition</b> <a href="yubihsm__curl_8c_source.html#l00028">yubihsm_curl.c:28</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1name_html"><div class="ttname"><a href="structsysio_1_1chain_1_1name.html">sysio::chain::name</a></div><div class="ttdoc">Immutable except for fc::from_variant.</div><div class="ttdef"><b>Definition</b> <a href="name_8hpp_source.html#l00043">name.hpp:43</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1account__resource__limit_html"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html">sysio::chain::resource_limits::account_resource_limit</a></div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00055">resource_limits.hpp:55</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1account__resource__limit_html_a25bb0386b0663efe779b395c992546f3"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#a25bb0386b0663efe779b395c992546f3">sysio::chain::resource_limits::account_resource_limit::used</a></div><div class="ttdeci">int64_t used</div><div class="ttdoc">quantity used in current window</div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00056">resource_limits.hpp:56</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1account__resource__limit_html_a3c8501c7709c924c44457211a616c985"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#a3c8501c7709c924c44457211a616c985">sysio::chain::resource_limits::account_resource_limit::max</a></div><div class="ttdeci">int64_t max</div><div class="ttdoc">max per window under current congestion</div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00058">resource_limits.hpp:58</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1account__resource__limit_html_ad5726de3c27ed7bd7d80decd66ded088"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1account__resource__limit.html#ad5726de3c27ed7bd7d80decd66ded088">sysio::chain::resource_limits::account_resource_limit::available</a></div><div class="ttdeci">int64_t available</div><div class="ttdoc">quantity available in current window (based upon fractional reserve)</div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00057">resource_limits.hpp:57</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_html"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html">sysio::chain::resource_limits::elastic_limit_parameters</a></div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00034">resource_limits.hpp:34</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_html_a38d39aa4bea732e345f3241e5a694b33"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a38d39aa4bea732e345f3241e5a694b33">sysio::chain::resource_limits::elastic_limit_parameters::periods</a></div><div class="ttdeci">uint32_t periods</div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00037">resource_limits.hpp:37</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_html_a5535b786bf4289eccf551d6b15e5c839"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a5535b786bf4289eccf551d6b15e5c839">sysio::chain::resource_limits::elastic_limit_parameters::validate</a></div><div class="ttdeci">void validate() const</div><div class="ttdef"><b>Definition</b> <a href="#l00032">resource_limits.cpp:32</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_html_a9e748ed99e9b3753b49cc753d8031913"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#a9e748ed99e9b3753b49cc753d8031913">sysio::chain::resource_limits::elastic_limit_parameters::expand_rate</a></div><div class="ttdeci">ratio expand_rate</div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00041">resource_limits.hpp:41</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters_html_adaca231933dffd76677d9f3038cf830d"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1elastic__limit__parameters.html#adaca231933dffd76677d9f3038cf830d">sysio::chain::resource_limits::elastic_limit_parameters::contract_rate</a></div><div class="ttdeci">ratio contract_rate</div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00040">resource_limits.hpp:40</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator_html_ac565af684cfacb1625e39084e88ec742"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1impl_1_1exponential__moving__average__accumulator.html#ac565af684cfacb1625e39084e88ec742">sysio::chain::resource_limits::impl::exponential_moving_average_accumulator::average</a></div><div class="ttdeci">uint64_t average() const</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00088">resource_limits_private.hpp:88</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1impl_1_1ratio_html_af665e471f6d066272fc308f463c5437d"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1impl_1_1ratio.html#af665e471f6d066272fc308f463c5437d">sysio::chain::resource_limits::impl::ratio::denominator</a></div><div class="ttdeci">T denominator</div><div class="ttdef"><b>Definition</b> <a href="resource__limits_8hpp_source.html#l00020">resource_limits.hpp:20</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1resource__limits__object_html"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html">sysio::chain::resource_limits::resource_limits_object</a></div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00197">resource_limits_private.hpp:197</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1resource__limits__object_html_a7e7945f847d9e441e69f938921270836"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#a7e7945f847d9e441e69f938921270836">sysio::chain::resource_limits::resource_limits_object::ram_bytes</a></div><div class="ttdeci">int64_t ram_bytes</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00207">resource_limits_private.hpp:207</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1resource__limits__object_html_a9eaec91376588de2dd82766e23750f87"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#a9eaec91376588de2dd82766e23750f87">sysio::chain::resource_limits::resource_limits_object::net_weight</a></div><div class="ttdeci">int64_t net_weight</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00205">resource_limits_private.hpp:205</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1resource__limits__object_html_aaeaa8f4c3c9e4cd8c823ecb22cc3f982"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1resource__limits__object.html#aaeaa8f4c3c9e4cd8c823ecb22cc3f982">sysio::chain::resource_limits::resource_limits_object::cpu_weight</a></div><div class="ttdeci">int64_t cpu_weight</div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00206">resource_limits_private.hpp:206</a></div></div>
<div class="ttc" id="astructsysio_1_1chain_1_1resource__limits_1_1resource__usage__object_html"><div class="ttname"><a href="structsysio_1_1chain_1_1resource__limits_1_1resource__usage__object.html">sysio::chain::resource_limits::resource_usage_object</a></div><div class="ttdef"><b>Definition</b> <a href="resource__limits__private_8hpp_source.html#l00227">resource_limits_private.hpp:227</a></div></div>
<div class="ttc" id="astructsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params_html"><div class="ttname"><a href="structsysio_1_1chain__apis_1_1account__query__db_1_1get__accounts__by__authorizers__params.html">sysio::chain_apis::account_query_db::get_accounts_by_authorizers_params</a></div><div class="ttdef"><b>Definition</b> <a href="account__query__db_8hpp_source.html#l00048">account_query_db.hpp:48</a></div></div>
<div class="ttc" id="atransaction_8hpp_html"><div class="ttname"><a href="transaction_8hpp.html">transaction.hpp</a></div></div>
<div class="ttc" id="atransaction__metadata_8hpp_html"><div class="ttname"><a href="transaction__metadata_8hpp.html">transaction_metadata.hpp</a></div></div>
<div class="ttc" id="ayubihsm__pkcs11_8c_html_a506da415c9307c897ca9be93acfe1d0f"><div class="ttname"><a href="yubihsm__pkcs11_8c.html#a506da415c9307c897ca9be93acfe1d0f">s</a></div><div class="ttdeci">char * s</div><div class="ttdef"><b>Definition</b> <a href="yubihsm__pkcs11_8c_source.html#l00524">yubihsm_pkcs11.c:524</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_428556e0652617aa37d2f7d8bcaf7fdf.html">libraries</a></li><li class="navelem"><a class="el" href="dir_0d4aba5c25a4be0a24c819a636048cb8.html">chain</a></li><li class="navelem"><a class="el" href="resource__limits_8cpp.html">resource_limits.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
